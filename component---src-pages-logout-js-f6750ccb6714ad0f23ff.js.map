{"version":3,"sources":["webpack:///./src/pages/logout.js"],"names":["isBrowser","window","getUserCraftData","userCraft","keys","then","Promise","all","map","key","getItem","value","ConfirmLogout","props","useState","userCraftLogin","setUserCraftLogin","userCrafts","setUserCrafts","savingUserCrafts","setSavingUserCrafts","useEffect","a","memoryCrafts","getUserData","variant","size","onClick","user","replace","myCrafts","forEach","element","firebase","database","ref","update","clear","auth","signOut","console","log","catch","err","Logout","isLoggingOut","setLoggingOut"],"mappings":"4jBAOA,IAAMA,EAAY,oBAAOC,OAEzB,SAASC,IACP,OAAOC,YAAUC,OAAOC,MAAK,SAAUD,GACrC,OAAOE,QAAQC,IAAIH,EAAKI,KAAI,SAAUC,GACpC,OAAON,YAAUO,QAAQD,GACtBJ,MAAK,SAAUM,GACd,MAAO,CAAEF,IAAKA,EAAKE,MAAOA,aAkBpC,SAASC,EAAcC,GAAQ,IAAD,EACgBC,mBAAS,MAA9CC,EADqB,KACLC,EADK,OAEQF,mBAAS,MAAtCG,EAFqB,KAETC,EAFS,OAIoBJ,oBAAS,GAAlDK,EAJqB,KAIHC,EAJG,KAoD5B,OA9CAC,qBAAU,WAAM,kCACd,8BAAAC,EAAA,sEAE6BnB,YAAUO,QAAQ,SAF/C,cAEMK,EAFN,OAGEC,EAAkBD,GAHpB,SAI2Bb,IAJ3B,OAIMqB,EAJN,OAKEL,EAAcK,GALhB,4CADc,uBAAC,WAAD,wBAQdC,KACC,IAqCI,kBAAC,IAAD,CAAQC,QAA4B,oBAA2CC,KAAK,KAAKC,QAjChG,WACE,IAAIC,EAAOb,EAAec,QAAQ,gBAAiB,KACnDT,GAAoB,GAEpB,IAAIU,EAAW,GACfb,EAAWc,SAAQ,SAAAC,GAEjBF,EAASE,EAAQvB,KAAOuB,EAAQrB,SAQlCsB,IAASC,WAAWC,IAApB,cAAsCP,EAAtC,KAA+CQ,OAAON,GAAUzB,MAAK,WACnEe,GAAoB,GACpBP,EAAMG,kBAAkB,MACxBb,YAAUkC,QAAQhC,MAAK,WAErB4B,IAASK,OAAOC,UAAUlC,MAAK,kBAAMmC,QAAQC,IAAI,oBAChDC,OAAM,SAAUC,GAEjBH,QAAQC,IAAIE,WAUkGxB,EAAmB,iCAAmC,gCAtD7JyB,UATf,SAAgB/B,GAAQ,IAAD,EACiBC,mBAAS,MAAxC+B,EADc,KACAC,EADA,KAGrB,OAAK9C,EAED6C,EAAuB,kBAACjC,EAAkBC,GACvC,kBAAC,IAAD,CAAQY,QAASoB,EAAe,YAAc,gBAAiBnB,KAAK,KAAKC,QAAS,kBAAMmB,GAAc,KAAtG,UAHgB","file":"component---src-pages-logout-js-f6750ccb6714ad0f23ff.js","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport firebase from \"gatsby-plugin-firebase\"\n\nimport { userCraft } from \"./login\"\n\nimport Button from 'react-bootstrap/Button'\n\nconst isBrowser = typeof window !== `undefined`;\n\nfunction getUserCraftData() {\n  return userCraft.keys().then(function (keys) {\n    return Promise.all(keys.map(function (key) {\n      return userCraft.getItem(key)\n        .then(function (value) {\n          return { key: key, value: value };\n        });\n    }));\n  });\n}\n\n\nfunction Logout(props) {\n  const [isLoggingOut, setLoggingOut] = useState(null);\n\n  if (!isBrowser) return null\n\n  if (isLoggingOut) { return <ConfirmLogout {...props} /> }\n  return <Button variant={isLoggingOut ? \"secondary\" : \"outline-light\"} size=\"sm\" onClick={() => setLoggingOut(true)}>Logout</Button>\n}\n\nexport default Logout\n\nfunction ConfirmLogout(props) {\n  const [userCraftLogin, setUserCraftLogin] = useState(null);\n  const [userCrafts, setUserCrafts] = useState(null);\n\n  const [savingUserCrafts, setSavingUserCrafts] = useState(false);\n\n  useEffect(() => {\n    async function getUserData() {\n      //     // You can await here\n      let userCraftLogin = await userCraft.getItem('login');\n      setUserCraftLogin(userCraftLogin);\n      let memoryCrafts = await getUserCraftData();\n      setUserCrafts(memoryCrafts);\n    }\n    getUserData();\n  }, []);\n\n\n\n  function doLogout() {\n    let user = userCraftLogin.replace(/[^a-zA-Z0-9]/g, \"_\");\n    setSavingUserCrafts(true);\n  //  console.log(userCrafts);\n    let myCrafts = {};\n    userCrafts.forEach(element => {\n    //  console.log(element);\n      myCrafts[element.key] = element.value;\n      // myCrafts[element]=memoryCrafts[element]\n    });\n  //  console.log(myCrafts);\n\n // userCraft.clear().then(()=>console.log(\"Cleared\"));\n\n\n    firebase.database().ref(`usersCraft/${user}/`).update(myCrafts).then(() => {\n      setSavingUserCrafts(false);\n      props.setUserCraftLogin(null);\n      userCraft.clear().then(function () {\n        // Run this code once the database has been entirely deleted.\n        firebase.auth().signOut().then(() => console.log('Logged out'));\n      }).catch(function (err) {\n        // This code runs if there were any errors\n        console.log(err);\n      });\n    })\n\n  }\n\n // console.log(userCrafts, userCraftLogin);\n\n\n\n  return <Button variant={savingUserCrafts ? \"outline-secondary\" : \"outline-secondary\"} size=\"sm\" onClick={doLogout}>{savingUserCrafts ? \"Deleting data, saving in cloud\" : \"Delete local data and Logout\"}</Button>\n}\n\n\n\n\n\n"],"sourceRoot":""}