!function(){"use strict";!function(){const e={NODE_ENV:"production"};try{if(process)return process.env=Object.assign({},process.env),void Object.assign(process.env,e)}catch(e){}globalThis.process={env:e}}();const e=!1,t="${JSCORE_VERSION}",n=function(e,t){if(!e)throw r(t)},r=function(e){return new Error("Firebase Database ("+t+") INTERNAL ASSERT FAILED: "+e)},i=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296==(64512&i)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},s={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let t=0;t<e.length;t+=3){const i=e[t],s=t+1<e.length,o=s?e[t+1]:0,a=t+2<e.length,c=a?e[t+2]:0,l=i>>2,u=(3&i)<<4|o>>4;let h=(15&o)<<2|c>>6,d=63&c;a||(d=64,s||(h=64)),r.push(n[l],n[u],n[h],n[d])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(i(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){const i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const s=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))}else{const s=e[n++],o=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let t=0;t<e.length;){const i=n[e.charAt(t++)],s=t<e.length?n[e.charAt(t)]:0;++t;const a=t<e.length?n[e.charAt(t)]:64;++t;const c=t<e.length?n[e.charAt(t)]:64;if(++t,null==i||null==s||null==a||null==c)throw new o;const l=i<<2|s>>4;if(r.push(l),64!==a){const e=s<<4&240|a>>2;if(r.push(e),64!==c){const e=a<<6&192|c;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class o extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const a=function(e){const t=i(e);return s.encodeByteArray(t,!0)},c=function(e){return a(e).replace(/\./g,"")},l=function(e){try{return s.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function u(e){return h(void 0,e)}function h(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(const n in t)t.hasOwnProperty(n)&&"__proto__"!==n&&(e[n]=h(e[n],t[n]));return e}const d=()=>function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__,p=()=>{try{return d()||(()=>{if("undefined"==typeof process||void 0===process.env)return;const e=process.env.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}const t=e&&l(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},f=e=>{const t=(e=>{var t,n;return null===(n=null===(t=p())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]})(e);if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const r=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),r]:[t.substring(0,n),r]},_=()=>{var e;return null===(e=p())||void 0===e?void 0:e.config};class m{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,n))}}}function g(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test("undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:"")}function y(){return!0===e}class v extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,v.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,b.prototype.create)}}class b{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},r=`${this.service}/${e}`,i=this.errors[e],s=i?function(e,t){return e.replace(w,((e,n)=>{const r=t[n];return null!=r?String(r):`<${n}?>`}))}(i,n):"Error",o=`${this.serviceName}: ${s} (${r}).`;return new v(r,o,n)}}const w=/\{\$([^}]+)}/g;function C(e){return JSON.parse(e)}function E(e){return JSON.stringify(e)}const I=function(e){let t={},n={},r={},i="";try{const s=e.split(".");t=C(l(s[0])||""),n=C(l(s[1])||""),i=s[2],r=n.d||{},delete n.d}catch(e){}return{header:t,claims:n,data:r,signature:i}};function T(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function S(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0}function N(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function k(e,t,n){const r={};for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=t.call(n,e[i],i,e));return r}function P(e,t){if(e===t)return!0;const n=Object.keys(e),r=Object.keys(t);for(const i of n){if(!r.includes(i))return!1;const n=e[i],s=t[i];if(x(n)&&x(s)){if(!P(n,s))return!1}else if(n!==s)return!1}for(const e of r)if(!n.includes(e))return!1;return!0}function x(e){return null!==e&&"object"==typeof e}class D{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const n=this.W_;if("string"==typeof e)for(let r=0;r<16;r++)n[r]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let r=0;r<16;r++)n[r]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let e=16;e<80;e++){const t=n[e-3]^n[e-8]^n[e-14]^n[e-16];n[e]=4294967295&(t<<1|t>>>31)}let r,i,s=this.chain_[0],o=this.chain_[1],a=this.chain_[2],c=this.chain_[3],l=this.chain_[4];for(let e=0;e<80;e++){e<40?e<20?(r=c^o&(a^c),i=1518500249):(r=o^a^c,i=1859775393):e<60?(r=o&a|c&(o|a),i=2400959708):(r=o^a^c,i=3395469782);const t=(s<<5|s>>>27)+r+l+i+n[e]&4294967295;l=c,c=a,a=4294967295&(o<<30|o>>>2),o=s,s=t}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+o&4294967295,this.chain_[2]=this.chain_[2]+a&4294967295,this.chain_[3]=this.chain_[3]+c&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295}update(e,t){if(null==e)return;void 0===t&&(t=e.length);const n=t-this.blockSize;let r=0;const i=this.buf_;let s=this.inbuf_;for(;r<t;){if(0===s)for(;r<=n;)this.compress_(e,r),r+=this.blockSize;if("string"==typeof e){for(;r<t;)if(i[s]=e.charCodeAt(r),++s,++r,s===this.blockSize){this.compress_(i),s=0;break}}else for(;r<t;)if(i[s]=e[r],++s,++r,s===this.blockSize){this.compress_(i),s=0;break}}this.inbuf_=s,this.total_+=t}digest(){const e=[];let t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let e=this.blockSize-1;e>=56;e--)this.buf_[e]=255&t,t/=256;this.compress_(this.buf_);let n=0;for(let t=0;t<5;t++)for(let r=24;r>=0;r-=8)e[n]=this.chain_[t]>>r&255,++n;return e}}function R(e,t){return`${e} failed: ${t} argument `}const O=function(e){let t=0;for(let n=0;n<e.length;n++){const r=e.charCodeAt(n);r<128?t++:r<2048?t+=2:r>=55296&&r<=56319?(t+=4,n++):t+=3}return t};function A(e){return e&&e._delegate?e._delegate:e}class M{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const q="[DEFAULT]";class j{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new m;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),r=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(r)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:q})}catch(e){}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=q){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}isComponentSet(){return null!=this.component}isInitialized(e=q){return this.instances.has(e)}getOptions(e=q){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[e,t]of this.instancesDeferred.entries()){n===this.normalizeInstanceIdentifier(e)&&t.resolve(r)}return r}onInit(e,t){var n;const r=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);const s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e,r===q?void 0:r),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}var r;return n||null}normalizeInstanceIdentifier(e=q){return this.component?this.component.multipleInstances?e:q:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class L{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new j(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}var F;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(F||(F={}));const V={debug:F.DEBUG,verbose:F.VERBOSE,info:F.INFO,warn:F.WARN,error:F.ERROR,silent:F.SILENT},U=F.INFO,z={[F.DEBUG]:"log",[F.VERBOSE]:"log",[F.INFO]:"info",[F.WARN]:"warn",[F.ERROR]:"error"},B=(e,t,...n)=>{if(t<e.logLevel)return;const r=(new Date).toISOString(),i=z[t];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[i](`[${r}]  ${e.name}:`,...n)};class ${constructor(e){this.name=e,this._logLevel=U,this._logHandler=B,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in F))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?V[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,F.DEBUG,...e),this._logHandler(this,F.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,F.VERBOSE,...e),this._logHandler(this,F.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,F.INFO,...e),this._logHandler(this,F.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,F.WARN,...e),this._logHandler(this,F.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,F.ERROR,...e),this._logHandler(this,F.ERROR,...e)}}const W=(e,t)=>t.some((t=>e instanceof t));let H,Q;const K=new WeakMap,Y=new WeakMap,G=new WeakMap,J=new WeakMap,X=new WeakMap;let Z={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return Y.get(e);if("objectStoreNames"===t)return e.objectStoreNames||G.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return ne(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function ee(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(Q||(Q=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(re(this),t),ne(K.get(this))}:function(...t){return ne(e.apply(re(this),t))}:function(t,...n){const r=e.call(re(this),t,...n);return G.set(r,t.sort?t.sort():[t]),ne(r)}}function te(e){return"function"==typeof e?ee(e):(e instanceof IDBTransaction&&function(e){if(Y.has(e))return;const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),r()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)}));Y.set(e,t)}(e),W(e,H||(H=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,Z):e)}function ne(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(ne(e.result)),r()},s=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",s)}));return t.then((t=>{t instanceof IDBCursor&&K.set(t,e)})).catch((()=>{})),X.set(t,e),t}(e);if(J.has(e))return J.get(e);const t=te(e);return t!==e&&(J.set(e,t),X.set(t,e)),t}const re=e=>X.get(e);const ie=["get","getKey","getAll","getAllKeys","count"],se=["put","add","delete","clear"],oe=new Map;function ae(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(oe.get(t))return oe.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,i=se.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!ie.includes(n))return;const s=async function(e,...t){const s=this.transaction(e,i?"readwrite":"readonly");let o=s.store;return r&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),i&&s.done]))[0]};return oe.set(t,s),s}Z=(e=>({...e,get:(t,n,r)=>ae(t,n)||e.get(t,n,r),has:(t,n)=>!!ae(t,n)||e.has(t,n)}))(Z);class ce{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null})).filter((e=>e)).join(" ")}}const le="@firebase/app",ue="0.10.9",he=new $("@firebase/app"),de="@firebase/app-compat",pe="@firebase/analytics-compat",fe="@firebase/analytics",_e="@firebase/app-check-compat",me="@firebase/app-check",ge="@firebase/auth",ye="@firebase/auth-compat",ve="@firebase/database",be="@firebase/database-compat",we="@firebase/functions",Ce="@firebase/functions-compat",Ee="@firebase/installations",Ie="@firebase/installations-compat",Te="@firebase/messaging",Se="@firebase/messaging-compat",Ne="@firebase/performance",ke="@firebase/performance-compat",Pe="@firebase/remote-config",xe="@firebase/remote-config-compat",De="@firebase/storage",Re="@firebase/storage-compat",Oe="@firebase/firestore",Ae="@firebase/vertexai-preview",Me="@firebase/firestore-compat",qe="firebase",je="[DEFAULT]",Le={[le]:"fire-core",[de]:"fire-core-compat",[fe]:"fire-analytics",[pe]:"fire-analytics-compat",[me]:"fire-app-check",[_e]:"fire-app-check-compat",[ge]:"fire-auth",[ye]:"fire-auth-compat",[ve]:"fire-rtdb",[be]:"fire-rtdb-compat",[we]:"fire-fn",[Ce]:"fire-fn-compat",[Ee]:"fire-iid",[Ie]:"fire-iid-compat",[Te]:"fire-fcm",[Se]:"fire-fcm-compat",[Ne]:"fire-perf",[ke]:"fire-perf-compat",[Pe]:"fire-rc",[xe]:"fire-rc-compat",[De]:"fire-gcs",[Re]:"fire-gcs-compat",[Oe]:"fire-fst",[Me]:"fire-fst-compat",[Ae]:"fire-vertex","fire-js":"fire-js",[qe]:"fire-js-all"},Fe=new Map,Ve=new Map,Ue=new Map;function ze(e,t){try{e.container.addComponent(t)}catch(n){he.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function Be(e){const t=e.name;if(Ue.has(t))return he.debug(`There were multiple attempts to register component ${t}.`),!1;Ue.set(t,e);for(const t of Fe.values())ze(t,e);for(const t of Ve.values())ze(t,e);return!0}const $e=new b("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class We{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new M("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw $e.create("app-deleted",{appName:this._name})}}function He(e,t={}){let n=e;if("object"!=typeof t){t={name:t}}const r=Object.assign({name:je,automaticDataCollectionEnabled:!1},t),i=r.name;if("string"!=typeof i||!i)throw $e.create("bad-app-name",{appName:String(i)});if(n||(n=_()),!n)throw $e.create("no-options");const s=Fe.get(i);if(s){if(P(n,s.options)&&P(r,s.config))return s;throw $e.create("duplicate-app",{appName:i})}const o=new L(i);for(const e of Ue.values())o.addComponent(e);const a=new We(n,r,o);return Fe.set(i,a),a}function Qe(e,t,n){var r;let i=null!==(r=Le[e])&&void 0!==r?r:e;n&&(i+=`-${n}`);const s=i.match(/\s|\//),o=t.match(/\s|\//);if(s||o){const e=[`Unable to register library "${i}" with version "${t}":`];return s&&e.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&e.push("and"),o&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void he.warn(e.join(" "))}Be(new M(`${i}-version`,(()=>({library:i,version:t})),"VERSION"))}const Ke="firebase-heartbeat-database",Ye=1,Ge="firebase-heartbeat-store";let Je=null;function Xe(){return Je||(Je=function(e,t,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(e,t),a=ne(o);return r&&o.addEventListener("upgradeneeded",(e=>{r(ne(o.result),e.oldVersion,e.newVersion,ne(o.transaction),e)})),n&&o.addEventListener("blocked",(e=>n(e.oldVersion,e.newVersion,e))),a.then((e=>{s&&e.addEventListener("close",(()=>s())),i&&e.addEventListener("versionchange",(e=>i(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),a}(Ke,Ye,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(Ge)}catch(e){console.warn(e)}}}).catch((e=>{throw $e.create("idb-open",{originalErrorMessage:e.message})}))),Je}async function Ze(e,t){try{const n=(await Xe()).transaction(Ge,"readwrite"),r=n.objectStore(Ge);await r.put(t,et(e)),await n.done}catch(e){if(e instanceof v)he.warn(e.message);else{const t=$e.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});he.warn(t.message)}}}function et(e){return`${e.name}!${e.options.appId}`}class tt{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new rt(t),this._heartbeatsCachePromise=this._storage.read().then((e=>(this._heartbeatsCache=e,e)))}async triggerHeartbeat(){var e,t,n;try{const r=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=nt();if(console.log("heartbeats",null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats),null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)&&(this._heartbeatsCache=await this._heartbeatsCachePromise,null==(null===(n=this._heartbeatsCache)||void 0===n?void 0:n.heartbeats)))return;if(this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some((e=>e.date===i)))return;return this._heartbeatsCache.heartbeats.push({date:i,agent:r}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((e=>{const t=new Date(e.date).valueOf();return Date.now()-t<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}catch(e){he.warn(e)}}async getHeartbeatsHeader(){var e;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=nt(),{heartbeatsToSend:n,unsentEntries:r}=function(e,t=1024){const n=[];let r=e.slice();for(const i of e){const e=n.find((e=>e.agent===i.agent));if(e){if(e.dates.push(i.date),it(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),it(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),i=c(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return he.warn(e),""}}}function nt(){return(new Date).toISOString().substring(0,10)}class rt{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!function(){try{return"object"==typeof indexedDB}catch(e){return!1}}()&&new Promise(((e,t)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}})).then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await Xe()).transaction(Ge),n=await t.objectStore(Ge).get(et(e));return await t.done,n}catch(e){if(e instanceof v)he.warn(e.message);else{const t=$e.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});he.warn(t.message)}}}(this.app);return(null==e?void 0:e.heartbeats)?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Ze(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Ze(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function it(e){return c(JSON.stringify({version:2,heartbeats:e})).length}var st;st="",Be(new M("platform-logger",(e=>new ce(e)),"PRIVATE")),Be(new M("heartbeat",(e=>new tt(e)),"PRIVATE")),Qe(le,ue,st),Qe(le,ue,"esm2017"),Qe("fire-js","");Qe("firebase","10.13.0","app");const ot="@firebase/database",at="1.0.7";let ct="";class lt{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),E(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:C(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class ut{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return T(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const ht=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){const t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new lt(t)}}catch(e){}return new ut},dt=ht("localStorage"),pt=ht("sessionStorage"),ft=new $("@firebase/database"),_t=function(){let e=1;return function(){return e++}}(),mt=function(e){const t=function(e){const t=[];let r=0;for(let i=0;i<e.length;i++){let s=e.charCodeAt(i);if(s>=55296&&s<=56319){const t=s-55296;i++,n(i<e.length,"Surrogate pair missing trail surrogate."),s=65536+(t<<10)+(e.charCodeAt(i)-56320)}s<128?t[r++]=s:s<2048?(t[r++]=s>>6|192,t[r++]=63&s|128):s<65536?(t[r++]=s>>12|224,t[r++]=s>>6&63|128,t[r++]=63&s|128):(t[r++]=s>>18|240,t[r++]=s>>12&63|128,t[r++]=s>>6&63|128,t[r++]=63&s|128)}return t}(e),r=new D;r.update(t);const i=r.digest();return s.encodeByteArray(i)},gt=function(...e){let t="";for(let n=0;n<e.length;n++){const r=e[n];Array.isArray(r)||r&&"object"==typeof r&&"number"==typeof r.length?t+=gt.apply(null,r):t+="object"==typeof r?E(r):r,t+=" "}return t};let yt=null,vt=!0;const bt=function(...e){var t;if(!0===vt&&(vt=!1,null===yt&&!0===pt.get("logging_enabled")&&(n(!t,"Can't turn on custom loggers persistently."),ft.logLevel=F.VERBOSE,yt=ft.log.bind(ft))),yt){const t=gt.apply(null,e);yt(t)}},wt=function(e){return function(...t){bt(e,...t)}},Ct=function(...e){const t="FIREBASE INTERNAL ERROR: "+gt(...e);ft.error(t)},Et=function(...e){const t=`FIREBASE FATAL ERROR: ${gt(...e)}`;throw ft.error(t),new Error(t)},It=function(...e){const t="FIREBASE WARNING: "+gt(...e);ft.warn(t)},Tt=function(e){return"number"==typeof e&&(e!=e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},St="[MIN_NAME]",Nt="[MAX_NAME]",kt=function(e,t){if(e===t)return 0;if(e===St||t===Nt)return-1;if(t===St||e===Nt)return 1;{const n=qt(e),r=qt(t);return null!==n?null!==r?n-r==0?e.length-t.length:n-r:-1:null!==r?1:e<t?-1:1}},Pt=function(e,t){return e===t?0:e<t?-1:1},xt=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+E(t))},Dt=function(e){if("object"!=typeof e||null===e)return E(e);const t=[];for(const n in e)t.push(n);t.sort();let n="{";for(let r=0;r<t.length;r++)0!==r&&(n+=","),n+=E(t[r]),n+=":",n+=Dt(e[t[r]]);return n+="}",n},Rt=function(e,t){const n=e.length;if(n<=t)return[e];const r=[];for(let i=0;i<n;i+=t)i+t>n?r.push(e.substring(i,n)):r.push(e.substring(i,i+t));return r};function Ot(e,t){for(const n in e)e.hasOwnProperty(n)&&t(n,e[n])}const At=function(e){n(!Tt(e),"Invalid JSON number");const t=1023;let r,i,s,o,a;0===e?(i=0,s=0,r=1/e==-1/0?1:0):(r=e<0,(e=Math.abs(e))>=Math.pow(2,-1022)?(o=Math.min(Math.floor(Math.log(e)/Math.LN2),t),i=o+t,s=Math.round(e*Math.pow(2,52-o)-Math.pow(2,52))):(i=0,s=Math.round(e/Math.pow(2,-1074))));const c=[];for(a=52;a;a-=1)c.push(s%2?1:0),s=Math.floor(s/2);for(a=11;a;a-=1)c.push(i%2?1:0),i=Math.floor(i/2);c.push(r?1:0),c.reverse();const l=c.join("");let u="";for(a=0;a<64;a+=8){let e=parseInt(l.substr(a,8),2).toString(16);1===e.length&&(e="0"+e),u+=e}return u.toLowerCase()};const Mt=new RegExp("^-?(0*)\\d{1,10}$"),qt=function(e){if(Mt.test(e)){const t=Number(e);if(t>=-2147483648&&t<=2147483647)return t}return null},jt=function(e){try{e()}catch(e){setTimeout((()=>{const t=e.stack||"";throw It("Exception was thrown by user callback.",t),e}),Math.floor(0))}},Lt=function(e,t){const n=setTimeout(e,t);return"number"==typeof n&&"undefined"!=typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(n):"object"==typeof n&&n.unref&&n.unref(),n};class Ft{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null==t||t.get().then((e=>this.appCheck=e))}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise(((t,n)=>{setTimeout((()=>{this.appCheck?this.getToken(e).then(t,n):t(null)}),0)}))}addTokenChangeListener(e){var t;null===(t=this.appCheckProvider)||void 0===t||t.get().then((t=>t.addTokenListener(e)))}notifyForInvalidToken(){It(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}class Vt{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit((e=>this.auth_=e))}getToken(e){return this.auth_?this.auth_.getToken(e).catch((e=>e&&"auth/token-not-initialized"===e.code?(bt("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e))):new Promise(((t,n)=>{setTimeout((()=>{this.auth_?this.getToken(e).then(t,n):t(null)}),0)}))}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then((t=>t.addAuthTokenListener(e)))}removeTokenChangeListener(e){this.authProvider_.get().then((t=>t.removeAuthTokenListener(e)))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',It(e)}}class Ut{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}Ut.OWNER="owner";const zt=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Bt="ac",$t="websocket",Wt="long_polling";class Ht{constructor(e,t,n,r,i=!1,s="",o=!1,a=!1){this.secure=t,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=i,this.persistenceKey=s,this.includeNamespaceInQueryParams=o,this.isUsingEmulator=a,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=dt.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&dt.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function Qt(e,t,r){let i;if(n("string"==typeof t,"typeof type must == string"),n("object"==typeof r,"typeof params must == object"),t===$t)i=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if(t!==Wt)throw new Error("Unknown connection type: "+t);i=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}(function(e){return e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams})(e)&&(r.ns=e.namespace);const s=[];return Ot(r,((e,t)=>{s.push(e+"="+t)})),i+s.join("&")}class Kt{constructor(){this.counters_={}}incrementCounter(e,t=1){T(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return u(this.counters_)}}const Yt={},Gt={};function Jt(e){const t=e.toString();return Yt[t]||(Yt[t]=new Kt),Yt[t]}class Xt{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const e=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let t=0;t<e.length;++t)e[t]&&jt((()=>{this.onMessage_(e[t])}));if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}const Zt="start";class en{constructor(e,t,n,r,i,s,o){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.transportSessionId=s,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=wt(e),this.stats_=Jt(t),this.urlFn=e=>(this.appCheckToken&&(e[Bt]=this.appCheckToken),Qt(t,Wt,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Xt(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout((()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null}),Math.floor(3e4)),function(e){if("complete"===document.readyState)e();else{let t=!1;const n=function(){document.body?t||(t=!0,e()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",(()=>{"complete"===document.readyState&&n()})),window.attachEvent("onload",n))}}((()=>{if(this.isClosed_)return;this.scriptTagHolder=new tn(((...e)=>{const[t,n,r,i,s]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,t===Zt)this.id=n,this.password=r;else{if("close"!==t)throw new Error("Unrecognized command received: "+t);n?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(n,(()=>{this.onClosed_()}))):this.onClosed_()}}),((...e)=>{const[t,n]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,n)}),(()=>{this.onClosed_()}),this.urlFn);const e={};e[Zt]="t",e.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=this.scriptTagHolder.uniqueCallbackIdentifier),e.v="5",this.transportSessionId&&(e.s=this.transportSessionId),this.lastSessionId&&(e.ls=this.lastSessionId),this.applicationId&&(e.p=this.applicationId),this.appCheckToken&&(e[Bt]=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&zt.test(location.hostname)&&(e.r="f");const t=this.urlFn(e);this.log_("Connecting via long-poll to "+t),this.scriptTagHolder.addTag(t,(()=>{}))}))}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){en.forceAllow_=!0}static forceDisallow(){en.forceDisallow_=!0}static isAvailable(){return!!en.forceAllow_||!(en.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI)}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=E(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=a(t),r=Rt(n,1840);for(let e=0;e<r.length;e++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[e]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const n={dframe:"t"};n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=E(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class tn{constructor(e,t,n,r){this.onDisconnect=n,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=_t(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=tn.createIFrame_();let n="";if(this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)){n='<script>document.domain="'+document.domain+'";<\/script>'}const r="<html><body>"+n+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(r),this.myIFrame.doc.close()}catch(e){bt("frame writing exception"),e.stack&&bt(e.stack),bt(e)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||bt("No IE domain setting required")}catch(t){const n=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout((()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)}),Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),n="",r=0;for(;this.pendingSegs.length>0;){if(!(this.pendingSegs[0].d.length+30+n.length<=1870))break;{const e=this.pendingSegs.shift();n=n+"&seg"+r+"="+e.seg+"&ts"+r+"="+e.ts+"&d"+r+"="+e.d,r++}}return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}return!1}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},r=setTimeout(n,Math.floor(25e3));this.addTag(e,(()=>{clearTimeout(r),n()}))}addTag(e,t){setTimeout((()=>{try{if(!this.sendNewPolls)return;const n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){const e=n.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),t())},n.onerror=()=>{bt("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch(e){}}),Math.floor(1))}}let nn=null;"undefined"!=typeof MozWebSocket?nn=MozWebSocket:"undefined"!=typeof WebSocket&&(nn=WebSocket);class rn{constructor(e,t,n,r,i,s,o){this.connId=e,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=wt(this.connId),this.stats_=Jt(t),this.connURL=rn.connectionURL_(t,s,o,r,n),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,n,r,i){const s={v:"5"};return"undefined"!=typeof location&&location.hostname&&zt.test(location.hostname)&&(s.r="f"),t&&(s.s=t),n&&(s.ls=n),r&&(s[Bt]=r),i&&(s.p=i),Qt(e,$t,s)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,dt.set("previous_websocket_failure",!0);try{let e;y(),this.mySock=new nn(this.connURL,[],e)}catch(e){this.log_("Error instantiating WebSocket.");const t=e.message||e.data;return t&&this.log_(t),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");const t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){rn.forceDisallow_=!0}static isAvailable(){let e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,n=navigator.userAgent.match(t);n&&n.length>1&&parseFloat(n[1])<4.4&&(e=!0)}return!e&&null!==nn&&!rn.forceDisallow_}static previouslyFailed(){return dt.isInMemoryStorage||!0===dt.get("previous_websocket_failure")}markConnectionHealthy(){dt.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const e=this.frames.join("");this.frames=null;const t=C(e);this.onMessage(t)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(n(null===this.frames,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(null===this.mySock)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{const e=this.extractFrameCount_(t);null!==e&&this.appendFrame_(e)}}send(e){this.resetKeepAlive();const t=E(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=Rt(t,16384);n.length>1&&this.sendString_(String(n.length));for(let e=0;e<n.length;e++)this.sendString_(n[e])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval((()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()}),Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}rn.responsesRequiredToBeHealthy=2,rn.healthyTimeout=3e4;class sn{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[en,rn]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(e){const t=rn&&rn.isAvailable();let n=t&&!rn.previouslyFailed();if(e.webSocketOnly&&(t||It("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[rn];else{const e=this.transports_=[];for(const t of sn.ALL_TRANSPORTS)t&&t.isAvailable()&&e.push(t);sn.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}sn.globalTransportInitialized_=!1;class on{constructor(e,t,n,r,i,s,o,a,c,l){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=r,this.authToken_=i,this.onMessage_=s,this.onReady_=o,this.onDisconnect_=a,this.onKill_=c,this.lastSessionId=l,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=wt("c:"+this.id+":"),this.transportManager_=new sn(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout((()=>{this.conn_&&this.conn_.open(t,n)}),Math.floor(0));const r=e.healthyTimeout||0;r>0&&(this.healthyTimeout_=Lt((()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))}),Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){const t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=xt("t",e),n=xt("d",e);if("c"===t)this.onSecondaryControl_(n);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(n)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=xt("t",e),n=xt("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=xt("t",e);if("d"in e){const n=e.d;if("h"===t){const e=Object.assign({},n);this.repoInfo_.isUsingEmulator&&(e.h=this.repoInfo_.host),this.onHandshake_(e)}else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?Ct("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Ct("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==n&&It("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),Lt((()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())}),Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Lt((()=>{this.sendPingOnPrimaryIfNecessary_()}),Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(dt.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class an{put(e,t,n,r){}merge(e,t,n,r){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}class cn{constructor(e){this.allowedEvents_=e,this.listeners_={},n(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const n=[...this.listeners_[e]];for(let e=0;e<n.length;e++)n[e].callback.apply(n[e].context,t)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});const r=this.getInitialEvent(e);r&&t.apply(n,r)}off(e,t,n){this.validateEventType_(e);const r=this.listeners_[e]||[];for(let e=0;e<r.length;e++)if(r[e].callback===t&&(!n||n===r[e].context))return void r.splice(e,1)}validateEventType_(e){n(this.allowedEvents_.find((t=>t===e)),"Unknown event: "+e)}}class ln extends cn{constructor(){super(["online"]),this.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||g()||(window.addEventListener("online",(()=>{this.online_||(this.online_=!0,this.trigger("online",!0))}),!1),window.addEventListener("offline",(()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))}),!1))}static getInstance(){return new ln}getInitialEvent(e){return n("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}const un=32,hn=768;class dn{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let e=0;e<this.pieces_.length;e++)this.pieces_[e].length>0&&(this.pieces_[t]=this.pieces_[e],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function pn(){return new dn("")}function fn(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function _n(e){return e.pieces_.length-e.pieceNum_}function mn(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new dn(e.pieces_,t)}function gn(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function yn(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function vn(e){if(e.pieceNum_>=e.pieces_.length)return null;const t=[];for(let n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new dn(t,0)}function bn(e,t){const n=[];for(let t=e.pieceNum_;t<e.pieces_.length;t++)n.push(e.pieces_[t]);if(t instanceof dn)for(let e=t.pieceNum_;e<t.pieces_.length;e++)n.push(t.pieces_[e]);else{const e=t.split("/");for(let t=0;t<e.length;t++)e[t].length>0&&n.push(e[t])}return new dn(n,0)}function wn(e){return e.pieceNum_>=e.pieces_.length}function Cn(e,t){const n=fn(e),r=fn(t);if(null===n)return t;if(n===r)return Cn(mn(e),mn(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function En(e,t){const n=yn(e,0),r=yn(t,0);for(let e=0;e<n.length&&e<r.length;e++){const t=kt(n[e],r[e]);if(0!==t)return t}return n.length===r.length?0:n.length<r.length?-1:1}function In(e,t){if(_n(e)!==_n(t))return!1;for(let n=e.pieceNum_,r=t.pieceNum_;n<=e.pieces_.length;n++,r++)if(e.pieces_[n]!==t.pieces_[r])return!1;return!0}function Tn(e,t){let n=e.pieceNum_,r=t.pieceNum_;if(_n(e)>_n(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[r])return!1;++n,++r}return!0}class Sn{constructor(e,t){this.errorPrefix_=t,this.parts_=yn(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let e=0;e<this.parts_.length;e++)this.byteLength_+=O(this.parts_[e]);Nn(this)}}function Nn(e){if(e.byteLength_>hn)throw new Error(e.errorPrefix_+"has a key path longer than "+hn+" bytes ("+e.byteLength_+").");if(e.parts_.length>un)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+un+") or object contains a cycle "+kn(e))}function kn(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class Pn extends cn{constructor(){let e,t;super(["visible"]),"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,(()=>{const t=!document[e];t!==this.visible_&&(this.visible_=t,this.trigger("visible",t))}),!1)}static getInstance(){return new Pn}getInitialEvent(e){return n("visible"===e,"Unknown event type: "+e),[this.visible_]}}const xn=1e3;class Dn extends an{constructor(e,t,n,r,i,s,o,a){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=n,this.onConnectStatus_=r,this.onServerInfoUpdate_=i,this.authTokenProvider_=s,this.appCheckTokenProvider_=o,this.authOverride_=a,this.id=Dn.nextPersistentConnectionId_++,this.log_=wt("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=xn,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,a&&!y())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Pn.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&ln.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,r){const i=++this.requestNumber_,s={r:i,a:e,b:t};this.log_(E(s)),n(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(s),r&&(this.requestCBHash_[i]=r)}get(e){this.initConnection_();const t=new m,n={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:e=>{const n=e.d;"ok"===e.s?t.resolve(n):t.reject(n)}};this.outstandingGets_.push(n),this.outstandingGetCount_++;const r=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(r),t.promise}listen(e,t,r,i){this.initConnection_();const s=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+s),this.listens.has(o)||this.listens.set(o,new Map),n(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),n(!this.listens.get(o).has(s),"listen() called twice for same path/queryId.");const a={onComplete:i,hashFn:t,query:e,tag:r};this.listens.get(o).set(s,a),this.connected_&&this.sendListen_(a)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,(n=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(n)}))}sendListen_(e){const t=e.query,n=t._path.toString(),r=t._queryIdentifier;this.log_("Listen on "+n+" for "+r);const i={p:n};e.tag&&(i.q=t._queryObject,i.t=e.tag),i.h=e.hashFn(),this.sendRequest("q",i,(i=>{const s=i.d,o=i.s;Dn.warnOnListenWarnings_(s,t);(this.listens.get(n)&&this.listens.get(n).get(r))===e&&(this.log_("listen response",i),"ok"!==o&&this.removeListen_(n,r),e.onComplete&&e.onComplete(o,s))}))}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&T(e,"w")){const n=S(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){const e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',n=t._path.toString();It(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${e} at ${n} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},(()=>{})),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||function(e){const t=I(e).claims;return"object"==typeof t&&!0===t.admin}(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},(()=>{}))}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=function(e){const t=I(e).claims;return!!t&&"object"==typeof t&&t.hasOwnProperty("iat")}(e)?"auth":"gauth",n={cred:e};null===this.authOverride_?n.noauth=!0:"object"==typeof this.authOverride_&&(n.authvar=this.authOverride_),this.sendRequest(t,n,(t=>{const n=t.s,r=t.d||"error";this.authToken_===e&&("ok"===n?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(n,r))}))}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},(e=>{const t=e.s,n=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,n)}))}unlisten(e,t){const r=e._path.toString(),i=e._queryIdentifier;this.log_("Unlisten called for "+r+" "+i),n(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query");this.removeListen_(r,i)&&this.connected_&&this.sendUnlisten_(r,i,e._queryObject,t)}sendUnlisten_(e,t,n,r){this.log_("Unlisten on "+e+" for "+t);const i={p:e};r&&(i.q=n,i.t=r),this.sendRequest("n",i)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,r){const i={p:t,d:n};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,(e=>{r&&setTimeout((()=>{r(e.s,e.d)}),Math.floor(0))}))}put(e,t,n,r){this.putInternal("p",e,t,n,r)}merge(e,t,n,r){this.putInternal("m",e,t,n,r)}putInternal(e,t,n,r,i){this.initConnection_();const s={p:t,d:n};void 0!==i&&(s.h=i),this.outstandingPuts_.push({action:e,request:s,onComplete:r}),this.outstandingPutCount_++;const o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,n=this.outstandingPuts_[e].request,r=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,n,(n=>{this.log_(t+" response",n),delete this.outstandingPuts_[e],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),r&&r(n.s,n.d)}))}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,(e=>{if("ok"!==e.s){const t=e.d;this.log_("reportStats","Error sending stats: "+t)}}))}}onDataMessage_(e){if("r"in e){this.log_("from server: "+E(e));const t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):Ct("Unrecognized action received from server: "+E(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){n(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout((()=>{this.establishConnectionTimer_=null,this.establishConnection_()}),Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=xn,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=xn,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){if(this.visible_){if(this.lastConnectionEstablishedTime_){(new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=xn),this.lastConnectionEstablishedTime_=null}}else this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime();const e=(new Date).getTime()-this.lastConnectionAttemptTime_;let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),i=this.id+":"+Dn.nextConnectionId_++,s=this.lastSessionId;let o=!1,a=null;const c=function(){a?a.close():(o=!0,r())},l=function(e){n(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(e)};this.realtime_={close:c,sendRequest:l};const u=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[n,c]=await Promise.all([this.authTokenProvider_.getToken(u),this.appCheckTokenProvider_.getToken(u)]);o?bt("getToken() completed but was canceled"):(bt("getToken() completed. Creating connection."),this.authToken_=n&&n.accessToken,this.appCheckToken_=c&&c.token,a=new on(i,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,r,(e=>{It(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")}),s))}catch(e){this.log_("Failed to get token: "+e),o||(this.repoInfo_.nodeAdmin&&It(e),c())}}}interrupt(e){bt("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){bt("Resuming connection for reason: "+e),delete this.interruptReasons_[e],N(this.interruptReasons_)&&(this.reconnectDelay_=xn,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;n=t?t.map((e=>Dt(e))).join("$"):"default";const r=this.removeListen_(e,n);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(e,t){const n=new dn(e).toString();let r;if(this.listens.has(n)){const e=this.listens.get(n);r=e.get(t),e.delete(t),0===e.size&&this.listens.delete(n)}else r=void 0;return r}onAuthRevoked_(e,t){bt("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){bt("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};e["sdk.js."+ct.replace(/\./g,"-")]=1,g()?e["framework.cordova"]=1:"object"==typeof navigator&&"ReactNative"===navigator.product&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=ln.getInstance().currentlyOnline();return N(this.interruptReasons_)&&e}}Dn.nextPersistentConnectionId_=0,Dn.nextConnectionId_=0;class Rn{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new Rn(e,t)}}class On{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const n=new Rn(St,e),r=new Rn(St,t);return 0!==this.compare(n,r)}minPost(){return Rn.MIN}}let An;class Mn extends On{static get __EMPTY_NODE(){return An}static set __EMPTY_NODE(e){An=e}compare(e,t){return kt(e.name,t.name)}isDefinedOn(e){throw r("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return Rn.MIN}maxPost(){return new Rn(Nt,An)}makePost(e,t){return n("string"==typeof e,"KeyIndex indexValue must always be a string."),new Rn(e,An)}toString(){return".key"}}const qn=new Mn;class jn{constructor(e,t,n,r,i=null){this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,r&&(s*=-1),s<0)e=this.isReverse_?e.left:e.right;else{if(0===s){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}getNext(){if(0===this.nodeStack_.length)return null;let e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class Ln{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:Ln.RED,this.left=null!=r?r:Fn.EMPTY_NODE,this.right=null!=i?i:Fn.EMPTY_NODE}copy(e,t,n,r,i){return new Ln(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return Fn.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let n,r;if(n=this,t(e,n.key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return Fn.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,Ln.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,Ln.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}Ln.RED=!0,Ln.BLACK=!1;class Fn{constructor(e,t=Fn.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new Fn(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Ln.BLACK,null,null))}remove(e){return new Fn(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Ln.BLACK,null,null))}get(e){let t,n=this.root_;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t)return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,r=null;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(r=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new jn(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new jn(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new jn(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new jn(this.root_,null,this.comparator_,!0,e)}}function Vn(e,t){return kt(e.name,t.name)}function Un(e,t){return kt(e,t)}let zn;Fn.EMPTY_NODE=new class{copy(e,t,n,r,i){return this}insert(e,t,n){return new Ln(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};const Bn=function(e){return"number"==typeof e?"number:"+At(e):"string:"+e},$n=function(e){if(e.isLeafNode()){const t=e.val();n("string"==typeof t||"number"==typeof t||"object"==typeof t&&T(t,".sv"),"Priority must be a string or number.")}else n(e===zn||e.isEmpty(),"priority of unexpected type.");n(e===zn||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let Wn,Hn,Qn;class Kn{constructor(e,t=Kn.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,n(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),$n(this.priorityNode_)}static set __childrenNodeConstructor(e){Wn=e}static get __childrenNodeConstructor(){return Wn}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new Kn(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:Kn.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return wn(e)?this:".priority"===fn(e)?this.priorityNode_:Kn.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:Kn.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const r=fn(e);return null===r?t:t.isEmpty()&&".priority"!==r?this:(n(".priority"!==r||1===_n(e),".priority must be the last token in a path"),this.updateImmediateChild(r,Kn.__childrenNodeConstructor.EMPTY_NODE.updateChild(mn(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+Bn(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",e+="number"===t?At(this.value_):this.value_,this.lazyHash_=mt(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===Kn.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof Kn.__childrenNodeConstructor?-1:(n(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,r=typeof this.value_,i=Kn.VALUE_TYPE_ORDER.indexOf(t),s=Kn.VALUE_TYPE_ORDER.indexOf(r);return n(i>=0,"Unknown leaf type: "+t),n(s>=0,"Unknown leaf type: "+r),i===s?"object"===r?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:s-i}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}return!1}}Kn.VALUE_TYPE_ORDER=["object","boolean","number","string"];const Yn=new class extends On{compare(e,t){const n=e.node.getPriority(),r=t.node.getPriority(),i=n.compareTo(r);return 0===i?kt(e.name,t.name):i}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return Rn.MIN}maxPost(){return new Rn(Nt,new Kn("[PRIORITY-POST]",Qn))}makePost(e,t){const n=Hn(e);return new Rn(t,new Kn("[PRIORITY-POST]",n))}toString(){return".priority"}},Gn=Math.log(2);class Jn{constructor(e){var t;this.count=(t=e+1,parseInt(Math.log(t)/Gn,10)),this.current_=this.count-1;const n=(r=this.count,parseInt(Array(r+1).join("1"),2));var r;this.bits_=e+1&n}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Xn=function(e,t,n,r){e.sort(t);const i=function(t,r){const s=r-t;let o,a;if(0===s)return null;if(1===s)return o=e[t],a=n?n(o):o,new Ln(a,o.node,Ln.BLACK,null,null);{const c=parseInt(s/2,10)+t,l=i(t,c),u=i(c+1,r);return o=e[c],a=n?n(o):o,new Ln(a,o.node,Ln.BLACK,l,u)}},s=function(t){let r=null,s=null,o=e.length;const a=function(t,r){const s=o-t,a=o;o-=t;const l=i(s+1,a),u=e[s],h=n?n(u):u;c(new Ln(h,u.node,r,null,l))},c=function(e){r?(r.left=e,r=e):(s=e,r=e)};for(let e=0;e<t.count;++e){const n=t.nextBitIsOne(),r=Math.pow(2,t.count-(e+1));n?a(r,Ln.BLACK):(a(r,Ln.BLACK),a(r,Ln.RED))}return s}(new Jn(e.length));return new Fn(r||t,s)};let Zn;const er={};class tr{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return n(er&&Yn,"ChildrenNode.ts has not been loaded"),Zn=Zn||new tr({".priority":er},{".priority":Yn}),Zn}get(e){const t=S(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof Fn?t:null}hasIndex(e){return T(this.indexSet_,e.toString())}addIndex(e,t){n(e!==qn,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const r=[];let i=!1;const s=t.getIterator(Rn.Wrap);let o,a=s.getNext();for(;a;)i=i||e.isDefinedOn(a.node),r.push(a),a=s.getNext();o=i?Xn(r,e.getCompare()):er;const c=e.toString(),l=Object.assign({},this.indexSet_);l[c]=e;const u=Object.assign({},this.indexes_);return u[c]=o,new tr(u,l)}addToIndexes(e,t){const r=k(this.indexes_,((r,i)=>{const s=S(this.indexSet_,i);if(n(s,"Missing index implementation for "+i),r===er){if(s.isDefinedOn(e.node)){const n=[],r=t.getIterator(Rn.Wrap);let i=r.getNext();for(;i;)i.name!==e.name&&n.push(i),i=r.getNext();return n.push(e),Xn(n,s.getCompare())}return er}{const n=t.get(e.name);let i=r;return n&&(i=i.remove(new Rn(e.name,n))),i.insert(e,e.node)}}));return new tr(r,this.indexSet_)}removeFromIndexes(e,t){const n=k(this.indexes_,(n=>{if(n===er)return n;{const r=t.get(e.name);return r?n.remove(new Rn(e.name,r)):n}}));return new tr(n,this.indexSet_)}}let nr;class rr{constructor(e,t,r){this.children_=e,this.priorityNode_=t,this.indexMap_=r,this.lazyHash_=null,this.priorityNode_&&$n(this.priorityNode_),this.children_.isEmpty()&&n(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return nr||(nr=new rr(new Fn(Un),null,tr.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||nr}updatePriority(e){return this.children_.isEmpty()?this:new rr(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();{const t=this.children_.get(e);return null===t?nr:t}}getChild(e){const t=fn(e);return null===t?this:this.getImmediateChild(t).getChild(mn(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(e,t){if(n(t,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(t);{const n=new Rn(e,t);let r,i;t.isEmpty()?(r=this.children_.remove(e),i=this.indexMap_.removeFromIndexes(n,this.children_)):(r=this.children_.insert(e,t),i=this.indexMap_.addToIndexes(n,this.children_));const s=r.isEmpty()?nr:this.priorityNode_;return new rr(r,s,i)}}updateChild(e,t){const r=fn(e);if(null===r)return t;{n(".priority"!==fn(e)||1===_n(e),".priority must be the last token in a path");const i=this.getImmediateChild(r).updateChild(mn(e),t);return this.updateImmediateChild(r,i)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let n=0,r=0,i=!0;if(this.forEachChild(Yn,((s,o)=>{t[s]=o.val(e),n++,i&&rr.INTEGER_REGEXP_.test(s)?r=Math.max(r,Number(s)):i=!1})),!e&&i&&r<2*n){const e=[];for(const n in t)e[n]=t[n];return e}return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(null===this.lazyHash_){let e="";this.getPriority().isEmpty()||(e+="priority:"+Bn(this.getPriority().val())+":"),this.forEachChild(Yn,((t,n)=>{const r=n.hash();""!==r&&(e+=":"+t+":"+r)})),this.lazyHash_=""===e?"":mt(e)}return this.lazyHash_}getPredecessorChildName(e,t,n){const r=this.resolveIndex_(n);if(r){const n=r.getPredecessorKey(new Rn(e,t));return n?n.name:null}return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.minKey();return e&&e.name}return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new Rn(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.maxKey();return e&&e.name}return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new Rn(t,this.children_.get(t)):null}forEachChild(e,t){const n=this.resolveIndex_(e);return n?n.inorderTraversal((e=>t(e.name,e.node))):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,(e=>e));{const n=this.children_.getIteratorFrom(e.name,Rn.Wrap);let r=n.peek();for(;null!=r&&t.compare(r,e)<0;)n.getNext(),r=n.peek();return n}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,(e=>e));{const n=this.children_.getReverseIteratorFrom(e.name,Rn.Wrap);let r=n.peek();for(;null!=r&&t.compare(r,e)>0;)n.getNext(),r=n.peek();return n}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===ir?-1:0}withIndex(e){if(e===qn||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new rr(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===qn||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority())){if(this.children_.count()===t.children_.count()){const e=this.getIterator(Yn),n=t.getIterator(Yn);let r=e.getNext(),i=n.getNext();for(;r&&i;){if(r.name!==i.name||!r.node.equals(i.node))return!1;r=e.getNext(),i=n.getNext()}return null===r&&null===i}return!1}return!1}}resolveIndex_(e){return e===qn?null:this.indexMap_.get(e.toString())}}rr.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;const ir=new class extends rr{constructor(){super(new Fn(Un),rr.EMPTY_NODE,tr.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return rr.EMPTY_NODE}isEmpty(){return!1}};Object.defineProperties(Rn,{MIN:{value:new Rn(St,rr.EMPTY_NODE)},MAX:{value:new Rn(Nt,ir)}}),Mn.__EMPTY_NODE=rr.EMPTY_NODE,Kn.__childrenNodeConstructor=rr,zn=ir,function(e){Qn=e}(ir);const sr=!0;function or(e,t=null){if(null===e)return rr.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),n(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e){return new Kn(e,or(t))}if(e instanceof Array||!sr){let n=rr.EMPTY_NODE;return Ot(e,((t,r)=>{if(T(e,t)&&"."!==t.substring(0,1)){const e=or(r);!e.isLeafNode()&&e.isEmpty()||(n=n.updateImmediateChild(t,e))}})),n.updatePriority(or(t))}{const n=[];let r=!1;if(Ot(e,((e,t)=>{if("."!==e.substring(0,1)){const i=or(t);i.isEmpty()||(r=r||!i.getPriority().isEmpty(),n.push(new Rn(e,i)))}})),0===n.length)return rr.EMPTY_NODE;const i=Xn(n,Vn,(e=>e.name),Un);if(r){const e=Xn(n,Yn.getCompare());return new rr(i,or(t),new tr({".priority":e},{".priority":Yn}))}return new rr(i,or(t),tr.Default)}}!function(e){Hn=e}(or);class ar extends On{constructor(e){super(),this.indexPath_=e,n(!wn(e)&&".priority"!==fn(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const n=this.extractChild(e.node),r=this.extractChild(t.node),i=n.compareTo(r);return 0===i?kt(e.name,t.name):i}makePost(e,t){const n=or(e),r=rr.EMPTY_NODE.updateChild(this.indexPath_,n);return new Rn(t,r)}maxPost(){const e=rr.EMPTY_NODE.updateChild(this.indexPath_,ir);return new Rn(Nt,e)}toString(){return yn(this.indexPath_,0).join("/")}}const cr=new class extends On{compare(e,t){const n=e.node.compareTo(t.node);return 0===n?kt(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return Rn.MIN}maxPost(){return Rn.MAX}makePost(e,t){const n=or(e);return new Rn(t,n)}toString(){return".value"}};function lr(e){return{type:"value",snapshotNode:e}}function ur(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function hr(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function dr(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}class pr{constructor(e){this.index_=e}updateChild(e,t,r,i,s,o){n(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(t);return a.getChild(i).equals(r.getChild(i))&&a.isEmpty()===r.isEmpty()?e:(null!=o&&(r.isEmpty()?e.hasChild(t)?o.trackChildChange(hr(t,a)):n(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(ur(t,r)):o.trackChildChange(dr(t,r,a))),e.isLeafNode()&&r.isEmpty()?e:e.updateImmediateChild(t,r).withIndex(this.index_))}updateFullNode(e,t,n){return null!=n&&(e.isLeafNode()||e.forEachChild(Yn,((e,r)=>{t.hasChild(e)||n.trackChildChange(hr(e,r))})),t.isLeafNode()||t.forEachChild(Yn,((t,r)=>{if(e.hasChild(t)){const i=e.getImmediateChild(t);i.equals(r)||n.trackChildChange(dr(t,r,i))}else n.trackChildChange(ur(t,r))}))),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?rr.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class fr{constructor(e){this.indexedFilter_=new pr(e.getIndex()),this.index_=e.getIndex(),this.startPost_=fr.getStartPost_(e),this.endPost_=fr.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,n=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&n}updateChild(e,t,n,r,i,s){return this.matches(new Rn(t,n))||(n=rr.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,r,i,s)}updateFullNode(e,t,n){t.isLeafNode()&&(t=rr.EMPTY_NODE);let r=t.withIndex(this.index_);r=r.updatePriority(rr.EMPTY_NODE);const i=this;return t.forEachChild(Yn,((e,t)=>{i.matches(new Rn(e,t))||(r=r.updateImmediateChild(e,rr.EMPTY_NODE))})),this.indexedFilter_.updateFullNode(e,r,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()}}class _r{constructor(e){this.withinDirectionalStart=e=>this.reverse_?this.withinEndPost(e):this.withinStartPost(e),this.withinDirectionalEnd=e=>this.reverse_?this.withinStartPost(e):this.withinEndPost(e),this.withinStartPost=e=>{const t=this.index_.compare(this.rangedFilter_.getStartPost(),e);return this.startIsInclusive_?t<=0:t<0},this.withinEndPost=e=>{const t=this.index_.compare(e,this.rangedFilter_.getEndPost());return this.endIsInclusive_?t<=0:t<0},this.rangedFilter_=new fr(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,n,r,i,s){return this.rangedFilter_.matches(new Rn(t,n))||(n=rr.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,r,i,s):this.fullLimitUpdateChild_(e,t,n,i,s)}updateFullNode(e,t,n){let r;if(t.isLeafNode()||t.isEmpty())r=rr.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){let e;r=rr.EMPTY_NODE.withIndex(this.index_),e=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let n=0;for(;e.hasNext()&&n<this.limit_;){const t=e.getNext();if(this.withinDirectionalStart(t)){if(!this.withinDirectionalEnd(t))break;r=r.updateImmediateChild(t.name,t.node),n++}}}else{let e;r=t.withIndex(this.index_),r=r.updatePriority(rr.EMPTY_NODE),e=this.reverse_?r.getReverseIterator(this.index_):r.getIterator(this.index_);let n=0;for(;e.hasNext();){const t=e.getNext();n<this.limit_&&this.withinDirectionalStart(t)&&this.withinDirectionalEnd(t)?n++:r=r.updateImmediateChild(t.name,rr.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,r,i,s){let o;if(this.reverse_){const e=this.index_.getCompare();o=(t,n)=>e(n,t)}else o=this.index_.getCompare();const a=e;n(a.numChildren()===this.limit_,"");const c=new Rn(t,r),l=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),u=this.rangedFilter_.matches(c);if(a.hasChild(t)){const e=a.getImmediateChild(t);let n=i.getChildAfterChild(this.index_,l,this.reverse_);for(;null!=n&&(n.name===t||a.hasChild(n.name));)n=i.getChildAfterChild(this.index_,n,this.reverse_);const h=null==n?1:o(n,c);if(u&&!r.isEmpty()&&h>=0)return null!=s&&s.trackChildChange(dr(t,r,e)),a.updateImmediateChild(t,r);{null!=s&&s.trackChildChange(hr(t,e));const r=a.updateImmediateChild(t,rr.EMPTY_NODE);return null!=n&&this.rangedFilter_.matches(n)?(null!=s&&s.trackChildChange(ur(n.name,n.node)),r.updateImmediateChild(n.name,n.node)):r}}return r.isEmpty()?e:u&&o(l,c)>=0?(null!=s&&(s.trackChildChange(hr(l.name,l.node)),s.trackChildChange(ur(t,r))),a.updateImmediateChild(t,r).updateImmediateChild(l.name,rr.EMPTY_NODE)):e}}class mr{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Yn}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return n(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return n(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:St}hasEnd(){return this.endSet_}getIndexEndValue(){return n(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return n(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Nt}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return n(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Yn}copy(){const e=new mr;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function gr(e){const t={};if(e.isDefault())return t;let r;if(e.index_===Yn?r="$priority":e.index_===cr?r="$value":e.index_===qn?r="$key":(n(e.index_ instanceof ar,"Unrecognized index type!"),r=e.index_.toString()),t.orderBy=E(r),e.startSet_){const n=e.startAfterSet_?"startAfter":"startAt";t[n]=E(e.indexStartValue_),e.startNameSet_&&(t[n]+=","+E(e.indexStartName_))}if(e.endSet_){const n=e.endBeforeSet_?"endBefore":"endAt";t[n]=E(e.indexEndValue_),e.endNameSet_&&(t[n]+=","+E(e.indexEndName_))}return e.limitSet_&&(e.isViewFromLeft()?t.limitToFirst=e.limit_:t.limitToLast=e.limit_),t}function yr(e){const t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_),t.sin=!e.startAfterSet_),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_),t.ein=!e.endBeforeSet_),e.limitSet_){t.l=e.limit_;let n=e.viewFrom_;""===n&&(n=e.isViewFromLeft()?"l":"r"),t.vf=n}return e.index_!==Yn&&(t.i=e.index_.toString()),t}class vr extends an{constructor(e,t,n,r){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=r,this.log_=wt("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(n(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,n,r){const i=e._path.toString();this.log_("Listen called for "+i+" "+e._queryIdentifier);const s=vr.getListenId_(e,n),o={};this.listens_[s]=o;const a=gr(e._queryParams);this.restRequest_(i+".json",a,((e,t)=>{let a=t;if(404===e&&(a=null,e=null),null===e&&this.onDataUpdate_(i,a,!1,n),S(this.listens_,s)===o){let t;t=e?401===e?"permission_denied":"rest_error:"+e:"ok",r(t,null)}}))}unlisten(e,t){const n=vr.getListenId_(e,t);delete this.listens_[n]}get(e){const t=gr(e._queryParams),n=e._path.toString(),r=new m;return this.restRequest_(n+".json",t,((e,t)=>{let i=t;404===e&&(i=null,e=null),null===e?(this.onDataUpdate_(n,i,!1,null),r.resolve(i)):r.reject(new Error(i))})),r.promise}refreshAuthToken(e){}restRequest_(e,t={},n){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then((([r,i])=>{r&&r.accessToken&&(t.auth=r.accessToken),i&&i.token&&(t.ac=i.token);const s=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+function(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach((e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}(t);this.log_("Sending REST request for "+s);const o=new XMLHttpRequest;o.onreadystatechange=()=>{if(n&&4===o.readyState){this.log_("REST Response for "+s+" received. status:",o.status,"response:",o.responseText);let e=null;if(o.status>=200&&o.status<300){try{e=C(o.responseText)}catch(e){It("Failed to parse JSON response for "+s+": "+o.responseText)}n(null,e)}else 401!==o.status&&404!==o.status&&It("Got unsuccessful REST response for "+s+" Status: "+o.status),n(o.status);n=null}},o.open("GET",s,!0),o.send()}))}}class br{constructor(){this.rootNode_=rr.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function wr(){return{value:null,children:new Map}}function Cr(e,t,n){if(wn(t))e.value=n,e.children.clear();else if(null!==e.value)e.value=e.value.updateChild(t,n);else{const r=fn(t);e.children.has(r)||e.children.set(r,wr());Cr(e.children.get(r),t=mn(t),n)}}function Er(e,t,n){null!==e.value?n(t,e.value):function(e,t){e.children.forEach(((e,n)=>{t(n,e)}))}(e,((e,r)=>{Er(r,new dn(t.toString()+"/"+e),n)}))}class Ir{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=Object.assign({},e);return this.last_&&Ot(this.last_,((e,n)=>{t[e]=t[e]-n})),this.last_=e,t}}class Tr{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Ir(e);const n=1e4+2e4*Math.random();Lt(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){const e=this.statsListener_.get(),t={};let n=!1;Ot(e,((e,r)=>{r>0&&T(this.statsToReport_,e)&&(t[e]=r,n=!0)})),n&&this.server_.reportStats(t),Lt(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}var Sr;function Nr(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}!function(e){e[e.OVERWRITE=0]="OVERWRITE",e[e.MERGE=1]="MERGE",e[e.ACK_USER_WRITE=2]="ACK_USER_WRITE",e[e.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(Sr||(Sr={}));class kr{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=Sr.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}operationForChild(e){if(wn(this.path)){if(null!=this.affectedTree.value)return n(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new dn(e));return new kr(pn(),t,this.revert)}}return n(fn(this.path)===e,"operationForChild called for unrelated child."),new kr(mn(this.path),this.affectedTree,this.revert)}}class Pr{constructor(e,t){this.source=e,this.path=t,this.type=Sr.LISTEN_COMPLETE}operationForChild(e){return wn(this.path)?new Pr(this.source,pn()):new Pr(this.source,mn(this.path))}}class xr{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=Sr.OVERWRITE}operationForChild(e){return wn(this.path)?new xr(this.source,pn(),this.snap.getImmediateChild(e)):new xr(this.source,mn(this.path),this.snap)}}class Dr{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=Sr.MERGE}operationForChild(e){if(wn(this.path)){const t=this.children.subtree(new dn(e));return t.isEmpty()?null:t.value?new xr(this.source,pn(),t.value):new Dr(this.source,pn(),t)}return n(fn(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Dr(this.source,mn(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class Rr{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(wn(e))return this.isFullyInitialized()&&!this.filtered_;const t=fn(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class Or{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function Ar(e,t,n,i,s,o){const a=i.filter((e=>e.type===n));a.sort(((t,n)=>function(e,t,n){if(null==t.childName||null==n.childName)throw r("Should only compare child_ events.");const i=new Rn(t.childName,t.snapshotNode),s=new Rn(n.childName,n.snapshotNode);return e.index_.compare(i,s)}(e,t,n))),a.forEach((n=>{const r=function(e,t,n){return"value"===t.type||"child_removed"===t.type||(t.prevName=n.getPredecessorChildName(t.childName,t.snapshotNode,e.index_)),t}(e,n,o);s.forEach((i=>{i.respondsTo(n.type)&&t.push(i.createEvent(r,e.query_))}))}))}function Mr(e,t){return{eventCache:e,serverCache:t}}function qr(e,t,n,r){return Mr(new Rr(t,n,r),e.serverCache)}function jr(e,t,n,r){return Mr(e.eventCache,new Rr(t,n,r))}function Lr(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function Fr(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}let Vr;class Ur{constructor(e,t=(()=>(Vr||(Vr=new Fn(Pt)),Vr))()){this.value=e,this.children=t}static fromObject(e){let t=new Ur(null);return Ot(e,((e,n)=>{t=t.set(new dn(e),n)})),t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:pn(),value:this.value};if(wn(e))return null;{const n=fn(e),r=this.children.get(n);if(null!==r){const i=r.findRootMostMatchingPathAndValue(mn(e),t);if(null!=i){return{path:bn(new dn(n),i.path),value:i.value}}return null}return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,(()=>!0))}subtree(e){if(wn(e))return this;{const t=fn(e),n=this.children.get(t);return null!==n?n.subtree(mn(e)):new Ur(null)}}set(e,t){if(wn(e))return new Ur(t,this.children);{const n=fn(e),r=(this.children.get(n)||new Ur(null)).set(mn(e),t),i=this.children.insert(n,r);return new Ur(this.value,i)}}remove(e){if(wn(e))return this.children.isEmpty()?new Ur(null):new Ur(null,this.children);{const t=fn(e),n=this.children.get(t);if(n){const r=n.remove(mn(e));let i;return i=r.isEmpty()?this.children.remove(t):this.children.insert(t,r),null===this.value&&i.isEmpty()?new Ur(null):new Ur(this.value,i)}return this}}get(e){if(wn(e))return this.value;{const t=fn(e),n=this.children.get(t);return n?n.get(mn(e)):null}}setTree(e,t){if(wn(e))return t;{const n=fn(e),r=(this.children.get(n)||new Ur(null)).setTree(mn(e),t);let i;return i=r.isEmpty()?this.children.remove(n):this.children.insert(n,r),new Ur(this.value,i)}}fold(e){return this.fold_(pn(),e)}fold_(e,t){const n={};return this.children.inorderTraversal(((r,i)=>{n[r]=i.fold_(bn(e,r),t)})),t(e,this.value,n)}findOnPath(e,t){return this.findOnPath_(e,pn(),t)}findOnPath_(e,t,n){const r=!!this.value&&n(t,this.value);if(r)return r;if(wn(e))return null;{const r=fn(e),i=this.children.get(r);return i?i.findOnPath_(mn(e),bn(t,r),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,pn(),t)}foreachOnPath_(e,t,n){if(wn(e))return this;{this.value&&n(t,this.value);const r=fn(e),i=this.children.get(r);return i?i.foreachOnPath_(mn(e),bn(t,r),n):new Ur(null)}}foreach(e){this.foreach_(pn(),e)}foreach_(e,t){this.children.inorderTraversal(((n,r)=>{r.foreach_(bn(e,n),t)})),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal(((t,n)=>{n.value&&e(t,n.value)}))}}class zr{constructor(e){this.writeTree_=e}static empty(){return new zr(new Ur(null))}}function Br(e,t,n){if(wn(t))return new zr(new Ur(n));{const r=e.writeTree_.findRootMostValueAndPath(t);if(null!=r){const i=r.path;let s=r.value;const o=Cn(i,t);return s=s.updateChild(o,n),new zr(e.writeTree_.set(i,s))}{const r=new Ur(n),i=e.writeTree_.setTree(t,r);return new zr(i)}}}function $r(e,t,n){let r=e;return Ot(n,((e,n)=>{r=Br(r,bn(t,e),n)})),r}function Wr(e,t){if(wn(t))return zr.empty();{const n=e.writeTree_.setTree(t,new Ur(null));return new zr(n)}}function Hr(e,t){return null!=Qr(e,t)}function Qr(e,t){const n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(Cn(n.path,t)):null}function Kr(e){const t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(Yn,((e,n)=>{t.push(new Rn(e,n))})):e.writeTree_.children.inorderTraversal(((e,n)=>{null!=n.value&&t.push(new Rn(e,n.value))})),t}function Yr(e,t){if(wn(t))return e;{const n=Qr(e,t);return new zr(null!=n?new Ur(n):e.writeTree_.subtree(t))}}function Gr(e){return e.writeTree_.isEmpty()}function Jr(e,t){return Xr(pn(),e.writeTree_,t)}function Xr(e,t,r){if(null!=t.value)return r.updateChild(e,t.value);{let i=null;return t.children.inorderTraversal(((t,s)=>{".priority"===t?(n(null!==s.value,"Priority writes must always be leaf nodes"),i=s.value):r=Xr(bn(e,t),s,r)})),r.getChild(e).isEmpty()||null===i||(r=r.updateChild(bn(e,".priority"),i)),r}}function Zr(e,t){return di(t,e)}function ei(e,t){const r=e.allWrites.findIndex((e=>e.writeId===t));n(r>=0,"removeWrite called with nonexistent writeId.");const i=e.allWrites[r];e.allWrites.splice(r,1);let s=i.visible,o=!1,a=e.allWrites.length-1;for(;s&&a>=0;){const t=e.allWrites[a];t.visible&&(a>=r&&ti(t,i.path)?s=!1:Tn(i.path,t.path)&&(o=!0)),a--}if(s){if(o)return function(e){e.visibleWrites=ri(e.allWrites,ni,pn()),e.allWrites.length>0?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1}(e),!0;if(i.snap)e.visibleWrites=Wr(e.visibleWrites,i.path);else{Ot(i.children,(t=>{e.visibleWrites=Wr(e.visibleWrites,bn(i.path,t))}))}return!0}return!1}function ti(e,t){if(e.snap)return Tn(e.path,t);for(const n in e.children)if(e.children.hasOwnProperty(n)&&Tn(bn(e.path,n),t))return!0;return!1}function ni(e){return e.visible}function ri(e,t,n){let i=zr.empty();for(let s=0;s<e.length;++s){const o=e[s];if(t(o)){const e=o.path;let t;if(o.snap)Tn(n,e)?(t=Cn(n,e),i=Br(i,t,o.snap)):Tn(e,n)&&(t=Cn(e,n),i=Br(i,pn(),o.snap.getChild(t)));else{if(!o.children)throw r("WriteRecord should have .snap or .children");if(Tn(n,e))t=Cn(n,e),i=$r(i,t,o.children);else if(Tn(e,n))if(t=Cn(e,n),wn(t))i=$r(i,pn(),o.children);else{const e=S(o.children,fn(t));if(e){const n=e.getChild(mn(t));i=Br(i,pn(),n)}}}}}return i}function ii(e,t,n,r,i){if(r||i){const s=Yr(e.visibleWrites,t);if(!i&&Gr(s))return n;if(i||null!=n||Hr(s,pn())){const s=function(e){return(e.visible||i)&&(!r||!~r.indexOf(e.writeId))&&(Tn(e.path,t)||Tn(t,e.path))};return Jr(ri(e.allWrites,s,t),n||rr.EMPTY_NODE)}return null}{const r=Qr(e.visibleWrites,t);if(null!=r)return r;{const r=Yr(e.visibleWrites,t);if(Gr(r))return n;if(null!=n||Hr(r,pn())){return Jr(r,n||rr.EMPTY_NODE)}return null}}}function si(e,t,n,r){return ii(e.writeTree,e.treePath,t,n,r)}function oi(e,t){return function(e,t,n){let r=rr.EMPTY_NODE;const i=Qr(e.visibleWrites,t);if(i)return i.isLeafNode()||i.forEachChild(Yn,((e,t)=>{r=r.updateImmediateChild(e,t)})),r;if(n){const i=Yr(e.visibleWrites,t);return n.forEachChild(Yn,((e,t)=>{const n=Jr(Yr(i,new dn(e)),t);r=r.updateImmediateChild(e,n)})),Kr(i).forEach((e=>{r=r.updateImmediateChild(e.name,e.node)})),r}return Kr(Yr(e.visibleWrites,t)).forEach((e=>{r=r.updateImmediateChild(e.name,e.node)})),r}(e.writeTree,e.treePath,t)}function ai(e,t,r,i){return function(e,t,r,i,s){n(i||s,"Either existingEventSnap or existingServerSnap must exist");const o=bn(t,r);if(Hr(e.visibleWrites,o))return null;{const t=Yr(e.visibleWrites,o);return Gr(t)?s.getChild(r):Jr(t,s.getChild(r))}}(e.writeTree,e.treePath,t,r,i)}function ci(e,t){return function(e,t){return Qr(e.visibleWrites,t)}(e.writeTree,bn(e.treePath,t))}function li(e,t,n,r,i,s){return function(e,t,n,r,i,s,o){let a;const c=Yr(e.visibleWrites,t),l=Qr(c,pn());if(null!=l)a=l;else{if(null==n)return[];a=Jr(c,n)}if(a=a.withIndex(o),a.isEmpty()||a.isLeafNode())return[];{const e=[],t=o.getCompare(),n=s?a.getReverseIteratorFrom(r,o):a.getIteratorFrom(r,o);let c=n.getNext();for(;c&&e.length<i;)0!==t(c,r)&&e.push(c),c=n.getNext();return e}}(e.writeTree,e.treePath,t,n,r,i,s)}function ui(e,t,n){return function(e,t,n,r){const i=bn(t,n),s=Qr(e.visibleWrites,i);if(null!=s)return s;if(r.isCompleteForChild(n))return Jr(Yr(e.visibleWrites,i),r.getNode().getImmediateChild(n));return null}(e.writeTree,e.treePath,t,n)}function hi(e,t){return di(bn(e.treePath,t),e.writeTree)}function di(e,t){return{treePath:e,writeTree:t}}class pi{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,i=e.childName;n("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),n(".priority"!==i,"Only non-priority child changes can be tracked.");const s=this.changeMap.get(i);if(s){const n=s.type;if("child_added"===t&&"child_removed"===n)this.changeMap.set(i,dr(i,e.snapshotNode,s.snapshotNode));else if("child_removed"===t&&"child_added"===n)this.changeMap.delete(i);else if("child_removed"===t&&"child_changed"===n)this.changeMap.set(i,hr(i,s.oldSnap));else if("child_changed"===t&&"child_added"===n)this.changeMap.set(i,ur(i,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==n)throw r("Illegal combination of changes: "+e+" occurred after "+s);this.changeMap.set(i,dr(i,e.snapshotNode,s.oldSnap))}}else this.changeMap.set(i,e)}getChanges(){return Array.from(this.changeMap.values())}}const fi=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}};class _i{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const t=null!=this.optCompleteServerCache_?new Rr(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return ui(this.writes_,e,t)}}getChildAfterChild(e,t,n){const r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:Fr(this.viewCache_),i=li(this.writes_,r,t,1,n,e);return 0===i.length?null:i[0]}}function mi(e,t,i,s,o){const a=new pi;let c,l;if(i.type===Sr.OVERWRITE){const r=i;r.source.fromUser?c=vi(e,t,r.path,r.snap,s,o,a):(n(r.source.fromServer,"Unknown source."),l=r.source.tagged||t.serverCache.isFiltered()&&!wn(r.path),c=yi(e,t,r.path,r.snap,s,o,l,a))}else if(i.type===Sr.MERGE){const r=i;r.source.fromUser?c=function(e,t,n,r,i,s,o){let a=t;return r.foreach(((r,c)=>{const l=bn(n,r);bi(t,fn(l))&&(a=vi(e,a,l,c,i,s,o))})),r.foreach(((r,c)=>{const l=bn(n,r);bi(t,fn(l))||(a=vi(e,a,l,c,i,s,o))})),a}(e,t,r.path,r.children,s,o,a):(n(r.source.fromServer,"Unknown source."),l=r.source.tagged||t.serverCache.isFiltered(),c=Ci(e,t,r.path,r.children,s,o,l,a))}else if(i.type===Sr.ACK_USER_WRITE){const r=i;c=r.revert?function(e,t,r,i,s,o){let a;if(null!=ci(i,r))return t;{const c=new _i(i,t,s),l=t.eventCache.getNode();let u;if(wn(r)||".priority"===fn(r)){let r;if(t.serverCache.isFullyInitialized())r=si(i,Fr(t));else{const e=t.serverCache.getNode();n(e instanceof rr,"serverChildren would be complete if leaf node"),r=oi(i,e)}u=e.filter.updateFullNode(l,r,o)}else{const n=fn(r);let s=ui(i,n,t.serverCache);null==s&&t.serverCache.isCompleteForChild(n)&&(s=l.getImmediateChild(n)),u=null!=s?e.filter.updateChild(l,n,s,mn(r),c,o):t.eventCache.getNode().hasChild(n)?e.filter.updateChild(l,n,rr.EMPTY_NODE,mn(r),c,o):l,u.isEmpty()&&t.serverCache.isFullyInitialized()&&(a=si(i,Fr(t)),a.isLeafNode()&&(u=e.filter.updateFullNode(u,a,o)))}return a=t.serverCache.isFullyInitialized()||null!=ci(i,pn()),qr(t,u,a,e.filter.filtersNodes())}}(e,t,r.path,s,o,a):function(e,t,n,r,i,s,o){if(null!=ci(i,n))return t;const a=t.serverCache.isFiltered(),c=t.serverCache;if(null!=r.value){if(wn(n)&&c.isFullyInitialized()||c.isCompleteForPath(n))return yi(e,t,n,c.getNode().getChild(n),i,s,a,o);if(wn(n)){let r=new Ur(null);return c.getNode().forEachChild(qn,((e,t)=>{r=r.set(new dn(e),t)})),Ci(e,t,n,r,i,s,a,o)}return t}{let l=new Ur(null);return r.foreach(((e,t)=>{const r=bn(n,e);c.isCompleteForPath(r)&&(l=l.set(e,c.getNode().getChild(r)))})),Ci(e,t,n,l,i,s,a,o)}}(e,t,r.path,r.affectedTree,s,o,a)}else{if(i.type!==Sr.LISTEN_COMPLETE)throw r("Unknown operation type: "+i.type);c=function(e,t,n,r,i){const s=t.serverCache,o=jr(t,s.getNode(),s.isFullyInitialized()||wn(n),s.isFiltered());return gi(e,o,n,r,fi,i)}(e,t,i.path,s,a)}const u=a.getChanges();return function(e,t,n){const r=t.eventCache;if(r.isFullyInitialized()){const i=r.getNode().isLeafNode()||r.getNode().isEmpty(),s=Lr(e);(n.length>0||!e.eventCache.isFullyInitialized()||i&&!r.getNode().equals(s)||!r.getNode().getPriority().equals(s.getPriority()))&&n.push(lr(Lr(t)))}}(t,c,u),{viewCache:c,changes:u}}function gi(e,t,r,i,s,o){const a=t.eventCache;if(null!=ci(i,r))return t;{let c,l;if(wn(r))if(n(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){const n=Fr(t),r=oi(i,n instanceof rr?n:rr.EMPTY_NODE);c=e.filter.updateFullNode(t.eventCache.getNode(),r,o)}else{const n=si(i,Fr(t));c=e.filter.updateFullNode(t.eventCache.getNode(),n,o)}else{const u=fn(r);if(".priority"===u){n(1===_n(r),"Can't have a priority with additional path components");const s=a.getNode();l=t.serverCache.getNode();const o=ai(i,r,s,l);c=null!=o?e.filter.updatePriority(s,o):a.getNode()}else{const n=mn(r);let h;if(a.isCompleteForChild(u)){l=t.serverCache.getNode();const e=ai(i,r,a.getNode(),l);h=null!=e?a.getNode().getImmediateChild(u).updateChild(n,e):a.getNode().getImmediateChild(u)}else h=ui(i,u,t.serverCache);c=null!=h?e.filter.updateChild(a.getNode(),u,h,n,s,o):a.getNode()}}return qr(t,c,a.isFullyInitialized()||wn(r),e.filter.filtersNodes())}}function yi(e,t,n,r,i,s,o,a){const c=t.serverCache;let l;const u=o?e.filter:e.filter.getIndexedFilter();if(wn(n))l=u.updateFullNode(c.getNode(),r,null);else if(u.filtersNodes()&&!c.isFiltered()){const e=c.getNode().updateChild(n,r);l=u.updateFullNode(c.getNode(),e,null)}else{const e=fn(n);if(!c.isCompleteForPath(n)&&_n(n)>1)return t;const i=mn(n),s=c.getNode().getImmediateChild(e).updateChild(i,r);l=".priority"===e?u.updatePriority(c.getNode(),s):u.updateChild(c.getNode(),e,s,i,fi,null)}const h=jr(t,l,c.isFullyInitialized()||wn(n),u.filtersNodes());return gi(e,h,n,i,new _i(i,h,s),a)}function vi(e,t,n,r,i,s,o){const a=t.eventCache;let c,l;const u=new _i(i,t,s);if(wn(n))l=e.filter.updateFullNode(t.eventCache.getNode(),r,o),c=qr(t,l,!0,e.filter.filtersNodes());else{const i=fn(n);if(".priority"===i)l=e.filter.updatePriority(t.eventCache.getNode(),r),c=qr(t,l,a.isFullyInitialized(),a.isFiltered());else{const s=mn(n),l=a.getNode().getImmediateChild(i);let h;if(wn(s))h=r;else{const e=u.getCompleteChild(i);h=null!=e?".priority"===gn(s)&&e.getChild(vn(s)).isEmpty()?e:e.updateChild(s,r):rr.EMPTY_NODE}if(l.equals(h))c=t;else{c=qr(t,e.filter.updateChild(a.getNode(),i,h,s,u,o),a.isFullyInitialized(),e.filter.filtersNodes())}}}return c}function bi(e,t){return e.eventCache.isCompleteForChild(t)}function wi(e,t,n){return n.foreach(((e,n)=>{t=t.updateChild(e,n)})),t}function Ci(e,t,n,r,i,s,o,a){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let c,l=t;c=wn(n)?r:new Ur(null).setTree(n,r);const u=t.serverCache.getNode();return c.children.inorderTraversal(((n,r)=>{if(u.hasChild(n)){const c=wi(0,t.serverCache.getNode().getImmediateChild(n),r);l=yi(e,l,new dn(n),c,i,s,o,a)}})),c.children.inorderTraversal(((n,r)=>{const c=!t.serverCache.isCompleteForChild(n)&&null===r.value;if(!u.hasChild(n)&&!c){const c=wi(0,t.serverCache.getNode().getImmediateChild(n),r);l=yi(e,l,new dn(n),c,i,s,o,a)}})),l}class Ei{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const n=this.query_._queryParams,r=new pr(n.getIndex()),i=(s=n).loadsAllData()?new pr(s.getIndex()):s.hasLimit()?new _r(s):new fr(s);var s;this.processor_=function(e){return{filter:e}}(i);const o=t.serverCache,a=t.eventCache,c=r.updateFullNode(rr.EMPTY_NODE,o.getNode(),null),l=i.updateFullNode(rr.EMPTY_NODE,a.getNode(),null),u=new Rr(c,o.isFullyInitialized(),r.filtersNodes()),h=new Rr(l,a.isFullyInitialized(),i.filtersNodes());this.viewCache_=Mr(h,u),this.eventGenerator_=new Or(this.query_)}get query(){return this.query_}}function Ii(e,t){const n=Fr(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!wn(t)&&!n.getImmediateChild(fn(t)).isEmpty())?n.getChild(t):null}function Ti(e){return 0===e.eventRegistrations_.length}function Si(e,t,r){const i=[];if(r){n(null==t,"A cancel should cancel all event registrations.");const s=e.query._path;e.eventRegistrations_.forEach((e=>{const t=e.createCancelEvent(r,s);t&&i.push(t)}))}if(t){let n=[];for(let r=0;r<e.eventRegistrations_.length;++r){const i=e.eventRegistrations_[r];if(i.matches(t)){if(t.hasAnyCallback()){n=n.concat(e.eventRegistrations_.slice(r+1));break}}else n.push(i)}e.eventRegistrations_=n}else e.eventRegistrations_=[];return i}function Ni(e,t,r,i){t.type===Sr.MERGE&&null!==t.source.queryId&&(n(Fr(e.viewCache_),"We should always have a full cache before handling merges"),n(Lr(e.viewCache_),"Missing event cache, even though we have a server cache"));const s=e.viewCache_,o=mi(e.processor_,s,t,r,i);var a,c;return a=e.processor_,c=o.viewCache,n(c.eventCache.getNode().isIndexed(a.filter.getIndex()),"Event snap not indexed"),n(c.serverCache.getNode().isIndexed(a.filter.getIndex()),"Server snap not indexed"),n(o.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=o.viewCache,ki(e,o.changes,o.viewCache.eventCache.getNode(),null)}function ki(e,t,n,r){const i=r?[r]:e.eventRegistrations_;return function(e,t,n,r){const i=[],s=[];return t.forEach((t=>{var n;"child_changed"===t.type&&e.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&s.push((n=t.childName,{type:"child_moved",snapshotNode:t.snapshotNode,childName:n}))})),Ar(e,i,"child_removed",t,r,n),Ar(e,i,"child_added",t,r,n),Ar(e,i,"child_moved",s,r,n),Ar(e,i,"child_changed",t,r,n),Ar(e,i,"value",t,r,n),i}(e.eventGenerator_,t,n,i)}let Pi,xi;class Di{constructor(){this.views=new Map}}function Ri(e,t,r,i){const s=t.source.queryId;if(null!==s){const o=e.views.get(s);return n(null!=o,"SyncTree gave us an op for an invalid query."),Ni(o,t,r,i)}{let n=[];for(const s of e.views.values())n=n.concat(Ni(s,t,r,i));return n}}function Oi(e,t,n,r,i){const s=t._queryIdentifier,o=e.views.get(s);if(!o){let e=si(n,i?r:null),s=!1;e?s=!0:r instanceof rr?(e=oi(n,r),s=!1):(e=rr.EMPTY_NODE,s=!1);const o=Mr(new Rr(e,s,!1),new Rr(r,i,!1));return new Ei(t,o)}return o}function Ai(e,t,n,r,i,s){const o=Oi(e,t,r,i,s);return e.views.has(t._queryIdentifier)||e.views.set(t._queryIdentifier,o),function(e,t){e.eventRegistrations_.push(t)}(o,n),function(e,t){const n=e.viewCache_.eventCache,r=[];n.getNode().isLeafNode()||n.getNode().forEachChild(Yn,((e,t)=>{r.push(ur(e,t))}));return n.isFullyInitialized()&&r.push(lr(n.getNode())),ki(e,r,n.getNode(),t)}(o,n)}function Mi(e,t,r,i){const s=t._queryIdentifier,o=[];let a=[];const c=Vi(e);if("default"===s)for(const[t,n]of e.views.entries())a=a.concat(Si(n,r,i)),Ti(n)&&(e.views.delete(t),n.query._queryParams.loadsAllData()||o.push(n.query));else{const t=e.views.get(s);t&&(a=a.concat(Si(t,r,i)),Ti(t)&&(e.views.delete(s),t.query._queryParams.loadsAllData()||o.push(t.query)))}return c&&!Vi(e)&&o.push(new(n(Pi,"Reference.ts has not been loaded"),Pi)(t._repo,t._path)),{removed:o,events:a}}function qi(e){const t=[];for(const n of e.views.values())n.query._queryParams.loadsAllData()||t.push(n);return t}function ji(e,t){let n=null;for(const r of e.views.values())n=n||Ii(r,t);return n}function Li(e,t){if(t._queryParams.loadsAllData())return Ui(e);{const n=t._queryIdentifier;return e.views.get(n)}}function Fi(e,t){return null!=Li(e,t)}function Vi(e){return null!=Ui(e)}function Ui(e){for(const t of e.views.values())if(t.query._queryParams.loadsAllData())return t;return null}let zi=1;class Bi{constructor(e){this.listenProvider_=e,this.syncPointTree_=new Ur(null),this.pendingWriteTree_={visibleWrites:zr.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function $i(e,t,r,i,s){return function(e,t,r,i,s){n(i>e.lastWriteId,"Stacking an older write on top of newer ones"),void 0===s&&(s=!0),e.allWrites.push({path:t,snap:r,writeId:i,visible:s}),s&&(e.visibleWrites=Br(e.visibleWrites,t,r)),e.lastWriteId=i}(e.pendingWriteTree_,t,r,i,s),s?Zi(e,new xr({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},t,r)):[]}function Wi(e,t,r,i){!function(e,t,r,i){n(i>e.lastWriteId,"Stacking an older merge on top of newer ones"),e.allWrites.push({path:t,children:r,writeId:i,visible:!0}),e.visibleWrites=$r(e.visibleWrites,t,r),e.lastWriteId=i}(e.pendingWriteTree_,t,r,i);const s=Ur.fromObject(r);return Zi(e,new Dr({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},t,s))}function Hi(e,t,n=!1){const r=function(e,t){for(let n=0;n<e.allWrites.length;n++){const r=e.allWrites[n];if(r.writeId===t)return r}return null}(e.pendingWriteTree_,t);if(ei(e.pendingWriteTree_,t)){let t=new Ur(null);return null!=r.snap?t=t.set(pn(),!0):Ot(r.children,(e=>{t=t.set(new dn(e),!0)})),Zi(e,new kr(r.path,t,n))}return[]}function Qi(e,t,n){return Zi(e,new xr({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,n))}function Ki(e,t,n,r,i=!1){const s=t._path,o=e.syncPointTree_.get(s);let a=[];if(o&&("default"===t._queryIdentifier||Fi(o,t))){const c=Mi(o,t,n,r);0===o.views.size&&(e.syncPointTree_=e.syncPointTree_.remove(s));const l=c.removed;if(a=c.events,!i){const n=-1!==l.findIndex((e=>e._queryParams.loadsAllData())),i=e.syncPointTree_.findOnPath(s,((e,t)=>Vi(t)));if(n&&!i){const t=e.syncPointTree_.subtree(s);if(!t.isEmpty()){const n=function(e){return e.fold(((e,t,n)=>{if(t&&Vi(t)){return[Ui(t)]}{let e=[];return t&&(e=qi(t)),Ot(n,((t,n)=>{e=e.concat(n)})),e}}))}(t);for(let t=0;t<n.length;++t){const r=n[t],i=r.query,s=ns(e,r);e.listenProvider_.startListening(cs(i),rs(e,i),s.hashFn,s.onComplete)}}}if(!i&&l.length>0&&!r)if(n){const n=null;e.listenProvider_.stopListening(cs(t),n)}else l.forEach((t=>{const n=e.queryToTagMap.get(is(t));e.listenProvider_.stopListening(cs(t),n)}))}!function(e,t){for(let n=0;n<t.length;++n){const r=t[n];if(!r._queryParams.loadsAllData()){const t=is(r),n=e.queryToTagMap.get(t);e.queryToTagMap.delete(t),e.tagToQueryMap.delete(n)}}}(e,l)}return a}function Yi(e,t,n,r){const i=ss(e,r);if(null!=i){const r=os(i),s=r.path,o=r.queryId,a=Cn(s,t);return as(e,s,new xr(Nr(o),a,n))}return[]}function Gi(e,t,r,i=!1){const s=t._path;let o=null,a=!1;e.syncPointTree_.foreachOnPath(s,((e,t)=>{const n=Cn(e,s);o=o||ji(t,n),a=a||Vi(t)}));let c,l=e.syncPointTree_.get(s);if(l?(a=a||Vi(l),o=o||ji(l,pn())):(l=new Di,e.syncPointTree_=e.syncPointTree_.set(s,l)),null!=o)c=!0;else{c=!1,o=rr.EMPTY_NODE;e.syncPointTree_.subtree(s).foreachChild(((e,t)=>{const n=ji(t,pn());n&&(o=o.updateImmediateChild(e,n))}))}const u=Fi(l,t);if(!u&&!t._queryParams.loadsAllData()){const r=is(t);n(!e.queryToTagMap.has(r),"View does not exist, but we have a tag");const i=zi++;e.queryToTagMap.set(r,i),e.tagToQueryMap.set(i,r)}let h=Ai(l,t,r,Zr(e.pendingWriteTree_,s),o,c);if(!u&&!a&&!i){const r=Li(l,t);h=h.concat(function(e,t,r){const i=t._path,s=rs(e,t),o=ns(e,r),a=e.listenProvider_.startListening(cs(t),s,o.hashFn,o.onComplete),c=e.syncPointTree_.subtree(i);if(s)n(!Vi(c.value),"If we're adding a query, it shouldn't be shadowed");else{const t=c.fold(((e,t,n)=>{if(!wn(e)&&t&&Vi(t))return[Ui(t).query];{let e=[];return t&&(e=e.concat(qi(t).map((e=>e.query)))),Ot(n,((t,n)=>{e=e.concat(n)})),e}}));for(let n=0;n<t.length;++n){const r=t[n];e.listenProvider_.stopListening(cs(r),rs(e,r))}}return a}(e,t,r))}return h}function Ji(e,t,n){const r=e.pendingWriteTree_,i=e.syncPointTree_.findOnPath(t,((e,n)=>{const r=ji(n,Cn(e,t));if(r)return r}));return ii(r,t,i,n,!0)}function Xi(e,t){const n=t._path;let r=null;e.syncPointTree_.foreachOnPath(n,((e,t)=>{const i=Cn(e,n);r=r||ji(t,i)}));let i=e.syncPointTree_.get(n);i?r=r||ji(i,pn()):(i=new Di,e.syncPointTree_=e.syncPointTree_.set(n,i));const s=null!=r,o=s?new Rr(r,!0,!1):null;return function(e){return Lr(e.viewCache_)}(Oi(i,t,Zr(e.pendingWriteTree_,t._path),s?o.getNode():rr.EMPTY_NODE,s))}function Zi(e,t){return es(t,e.syncPointTree_,null,Zr(e.pendingWriteTree_,pn()))}function es(e,t,n,r){if(wn(e.path))return ts(e,t,n,r);{const i=t.get(pn());null==n&&null!=i&&(n=ji(i,pn()));let s=[];const o=fn(e.path),a=e.operationForChild(o),c=t.children.get(o);if(c&&a){const e=n?n.getImmediateChild(o):null,t=hi(r,o);s=s.concat(es(a,c,e,t))}return i&&(s=s.concat(Ri(i,e,r,n))),s}}function ts(e,t,n,r){const i=t.get(pn());null==n&&null!=i&&(n=ji(i,pn()));let s=[];return t.children.inorderTraversal(((t,i)=>{const o=n?n.getImmediateChild(t):null,a=hi(r,t),c=e.operationForChild(t);c&&(s=s.concat(ts(c,i,o,a)))})),i&&(s=s.concat(Ri(i,e,r,n))),s}function ns(e,t){const n=t.query,r=rs(e,n);return{hashFn:()=>{const e=function(e){return e.viewCache_.serverCache.getNode()}(t)||rr.EMPTY_NODE;return e.hash()},onComplete:t=>{if("ok"===t)return r?function(e,t,n){const r=ss(e,n);if(r){const n=os(r),i=n.path,s=n.queryId,o=Cn(i,t);return as(e,i,new Pr(Nr(s),o))}return[]}(e,n._path,r):function(e,t){return Zi(e,new Pr({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t))}(e,n._path);{const r=function(e,t){let n="Unknown Error";"too_big"===e?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===e?n="Client doesn't have permission to access the desired data.":"unavailable"===e&&(n="The service is unavailable");const r=new Error(e+" at "+t._path.toString()+": "+n);return r.code=e.toUpperCase(),r}(t,n);return Ki(e,n,null,r)}}}}function rs(e,t){const n=is(t);return e.queryToTagMap.get(n)}function is(e){return e._path.toString()+"$"+e._queryIdentifier}function ss(e,t){return e.tagToQueryMap.get(t)}function os(e){const t=e.indexOf("$");return n(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new dn(e.substr(0,t))}}function as(e,t,r){const i=e.syncPointTree_.get(t);n(i,"Missing sync point for query tag that we're tracking");return Ri(i,r,Zr(e.pendingWriteTree_,t),null)}function cs(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?new(n(xi,"Reference.ts has not been loaded"),xi)(e._repo,e._path):e}class ls{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new ls(t)}node(){return this.node_}}class us{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=bn(this.path_,e);return new us(this.syncTree_,t)}node(){return Ji(this.syncTree_,this.path_)}}const hs=function(e){return(e=e||{}).timestamp=e.timestamp||(new Date).getTime(),e},ds=function(e,t,r){return e&&"object"==typeof e?(n(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"]?ps(e[".sv"],t,r):"object"==typeof e[".sv"]?fs(e[".sv"],t):void n(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e},ps=function(e,t,r){if("timestamp"===e)return r.timestamp;n(!1,"Unexpected server value: "+e)},fs=function(e,t,r){e.hasOwnProperty("increment")||n(!1,"Unexpected server value: "+JSON.stringify(e,null,2));const i=e.increment;"number"!=typeof i&&n(!1,"Unexpected increment value: "+i);const s=t.node();if(n(null!=s,"Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return i;const o=s.getValue();return"number"!=typeof o?i:o+i},_s=function(e,t,n,r){return gs(t,new us(n,e),r)},ms=function(e,t,n){return gs(e,new ls(t),n)};function gs(e,t,n){const r=e.getPriority().val(),i=ds(r,t.getImmediateChild(".priority"),n);let s;if(e.isLeafNode()){const r=e,s=ds(r.getValue(),t,n);return s!==r.getValue()||i!==r.getPriority().val()?new Kn(s,or(i)):e}{const r=e;return s=r,i!==r.getPriority().val()&&(s=s.updatePriority(new Kn(i))),r.forEachChild(Yn,((e,r)=>{const i=gs(r,t.getImmediateChild(e),n);i!==r&&(s=s.updateImmediateChild(e,i))})),s}}class ys{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}}function vs(e,t){let n=t instanceof dn?t:new dn(t),r=e,i=fn(n);for(;null!==i;){const e=S(r.node.children,i)||{children:{},childCount:0};r=new ys(i,r,e),n=mn(n),i=fn(n)}return r}function bs(e){return e.node.value}function ws(e,t){e.node.value=t,Ss(e)}function Cs(e){return e.node.childCount>0}function Es(e,t){Ot(e.node.children,((n,r)=>{t(new ys(n,e,r))}))}function Is(e,t,n,r){n&&!r&&t(e),Es(e,(e=>{Is(e,t,!0,r)})),n&&r&&t(e)}function Ts(e){return new dn(null===e.parent?e.name:Ts(e.parent)+"/"+e.name)}function Ss(e){null!==e.parent&&function(e,t,n){const r=function(e){return void 0===bs(e)&&!Cs(e)}(n),i=T(e.node.children,t);r&&i?(delete e.node.children[t],e.node.childCount--,Ss(e)):r||i||(e.node.children[t]=n.node,e.node.childCount++,Ss(e))}(e.parent,e.name,e)}const Ns=/[\[\].#$\/\u0000-\u001F\u007F]/,ks=/[\[\].#$\u0000-\u001F\u007F]/,Ps=10485760,xs=function(e){return"string"==typeof e&&0!==e.length&&!Ns.test(e)},Ds=function(e){return"string"==typeof e&&0!==e.length&&!ks.test(e)},Rs=function(e,t,n,r){},Os=function(e,t,n){const r=n instanceof dn?new Sn(n,e):n;if(void 0===t)throw new Error(e+"contains undefined "+kn(r));if("function"==typeof t)throw new Error(e+"contains a function "+kn(r)+" with contents = "+t.toString());if(Tt(t))throw new Error(e+"contains "+t.toString()+" "+kn(r));if("string"==typeof t&&t.length>Ps/3&&O(t)>Ps)throw new Error(e+"contains a string greater than "+Ps+" utf8 bytes "+kn(r)+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){let n=!1,i=!1;if(Ot(t,((t,s)=>{if(".value"===t)n=!0;else if(".priority"!==t&&".sv"!==t&&(i=!0,!xs(t)))throw new Error(e+" contains an invalid key ("+t+") "+kn(r)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');!function(e,t){e.parts_.length>0&&(e.byteLength_+=1),e.parts_.push(t),e.byteLength_+=O(t),Nn(e)}(r,t),Os(e,s,r),function(e){const t=e.parts_.pop();e.byteLength_-=O(t),e.parts_.length>0&&(e.byteLength_-=1)}(r)})),n&&i)throw new Error(e+' contains ".value" child '+kn(r)+" in addition to actual children.")}},As=function(e,t,n,r){const i=R(e,"values");if(!t||"object"!=typeof t||Array.isArray(t))throw new Error(i+" must be an object containing the children to replace.");const s=[];Ot(t,((e,t)=>{const r=new dn(e);if(Os(i,t,bn(n,r)),".priority"===gn(r)&&!(null===(o=t)||"string"==typeof o||"number"==typeof o&&!Tt(o)||o&&"object"==typeof o&&T(o,".sv")))throw new Error(i+"contains an invalid value for '"+r.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");var o;s.push(r)})),function(e,t){let n,r;for(n=0;n<t.length;n++){r=t[n];const i=yn(r);for(let t=0;t<i.length;t++)if(".priority"===i[t]&&t===i.length-1);else if(!xs(i[t]))throw new Error(e+"contains an invalid key ("+i[t]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}t.sort(En);let i=null;for(n=0;n<t.length;n++){if(r=t[n],null!==i&&Tn(i,r))throw new Error(e+"contains a path "+i.toString()+" that is ancestor of another path "+r.toString());i=r}}(i,s)},Ms=function(e,t,n,r){if(!Ds(n))throw new Error(R(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},qs=function(e,t,n,r){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),Ms(e,t,n)},js=function(e,t){if(".info"===fn(t))throw new Error(e+" failed = Can't modify data under /.info/")},Ls=function(e,t){const n=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!xs(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==n.length&&!function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),Ds(e)}(n))throw new Error(R(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class Fs{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Vs(e,t){let n=null;for(let r=0;r<t.length;r++){const i=t[r],s=i.getPath();null===n||In(s,n.path)||(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:s}),n.events.push(i)}n&&e.eventLists_.push(n)}function Us(e,t,n){Vs(e,n),function(e,t){e.recursionDepth_++;let n=!0;for(let r=0;r<e.eventLists_.length;r++){const i=e.eventLists_[r];if(i){t(i.path)?(zs(e.eventLists_[r]),e.eventLists_[r]=null):n=!1}}n&&(e.eventLists_=[]);e.recursionDepth_--}(e,(e=>Tn(e,t)||Tn(t,e)))}function zs(e){for(let t=0;t<e.events.length;t++){const n=e.events[t];if(null!==n){e.events[t]=null;const r=n.getEventRunner();yt&&bt("event: "+n.toString()),jt(r)}}}const Bs="repo_interrupt",$s=25;class Ws{constructor(e,t,n,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Fs,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=wr(),this.transactionQueueTree_=new ys,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function Hs(e,t,n){if(e.stats_=Jt(e.repoInfo_),e.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)e.server_=new vr(e.repoInfo_,((t,n,r,i)=>{Ys(e,t,n,r,i)}),e.authTokenProvider_,e.appCheckProvider_),setTimeout((()=>Gs(e,!0)),0);else{if(null!=n){if("object"!=typeof n)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{E(n)}catch(e){throw new Error("Invalid authOverride provided: "+e)}}e.persistentConnection_=new Dn(e.repoInfo_,t,((t,n,r,i)=>{Ys(e,t,n,r,i)}),(t=>{Gs(e,t)}),(t=>{!function(e,t){Ot(t,((t,n)=>{Js(e,t,n)}))}(e,t)}),e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener((t=>{e.server_.refreshAuthToken(t)})),e.appCheckProvider_.addTokenChangeListener((t=>{e.server_.refreshAppCheckToken(t.token)})),e.statsReporter_=function(e,t){const n=e.toString();return Gt[n]||(Gt[n]=t()),Gt[n]}(e.repoInfo_,(()=>new Tr(e.stats_,e.server_))),e.infoData_=new br,e.infoSyncTree_=new Bi({startListening:(t,n,r,i)=>{let s=[];const o=e.infoData_.getNode(t._path);return o.isEmpty()||(s=Qi(e.infoSyncTree_,t._path,o),setTimeout((()=>{i("ok")}),0)),s},stopListening:()=>{}}),Js(e,"connected",!1),e.serverSyncTree_=new Bi({startListening:(t,n,r,i)=>(e.server_.listen(t,r,n,((n,r)=>{const s=i(n,r);Us(e.eventQueue_,t._path,s)})),[]),stopListening:(t,n)=>{e.server_.unlisten(t,n)}})}function Qs(e){const t=e.infoData_.getNode(new dn(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t}function Ks(e){return hs({timestamp:Qs(e)})}function Ys(e,t,n,r,i){e.dataUpdateCount++;const s=new dn(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;let o=[];if(i)if(r){const t=k(n,(e=>or(e)));o=function(e,t,n,r){const i=ss(e,r);if(i){const r=os(i),s=r.path,o=r.queryId,a=Cn(s,t),c=Ur.fromObject(n);return as(e,s,new Dr(Nr(o),a,c))}return[]}(e.serverSyncTree_,s,t,i)}else{const t=or(n);o=Yi(e.serverSyncTree_,s,t,i)}else if(r){const t=k(n,(e=>or(e)));o=function(e,t,n){const r=Ur.fromObject(n);return Zi(e,new Dr({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,r))}(e.serverSyncTree_,s,t)}else{const t=or(n);o=Qi(e.serverSyncTree_,s,t)}let a=s;o.length>0&&(a=ro(e,s)),Us(e.eventQueue_,a,o)}function Gs(e,t){Js(e,"connected",t),!1===t&&function(e){Zs(e,"onDisconnectEvents");const t=Ks(e),n=wr();Er(e.onDisconnect_,pn(),((r,i)=>{const s=_s(r,i,e.serverSyncTree_,t);Cr(n,r,s)}));let r=[];Er(n,pn(),((t,n)=>{r=r.concat(Qi(e.serverSyncTree_,t,n));const i=co(e,t);ro(e,i)})),e.onDisconnect_=wr(),Us(e.eventQueue_,pn(),r)}(e)}function Js(e,t,n){const r=new dn("/.info/"+t),i=or(n);e.infoData_.updateSnapshot(r,i);const s=Qi(e.infoSyncTree_,r,i);Us(e.eventQueue_,r,s)}function Xs(e){return e.nextWriteId_++}function Zs(e,...t){let n="";e.persistentConnection_&&(n=e.persistentConnection_.id+":"),bt(n,...t)}function eo(e,t,n,r){t&&jt((()=>{if("ok"===n)t(null);else{const e=(n||"error").toUpperCase();let i=e;r&&(i+=": "+r);const s=new Error(i);s.code=e,t(s)}}))}function to(e,t,n){return Ji(e.serverSyncTree_,t,n)||rr.EMPTY_NODE}function no(e,t=e.transactionQueueTree_){if(t||ao(e,t),bs(t)){const r=so(e,t);n(r.length>0,"Sending zero length transaction queue");r.every((e=>0===e.status))&&function(e,t,r){const i=r.map((e=>e.currentWriteId)),s=to(e,t,i);let o=s;const a=s.hash();for(let e=0;e<r.length;e++){const i=r[e];n(0===i.status,"tryToSendTransactionQueue_: items in queue should all be run."),i.status=1,i.retryCount++;const s=Cn(t,i.path);o=o.updateChild(s,i.currentOutputSnapshotRaw)}const c=o.val(!0),l=t;e.server_.put(l.toString(),c,(n=>{Zs(e,"transaction put response",{path:l.toString(),status:n});let i=[];if("ok"===n){const n=[];for(let t=0;t<r.length;t++)r[t].status=2,i=i.concat(Hi(e.serverSyncTree_,r[t].currentWriteId)),r[t].onComplete&&n.push((()=>r[t].onComplete(null,!0,r[t].currentOutputSnapshotResolved))),r[t].unwatcher();ao(e,vs(e.transactionQueueTree_,t)),no(e,e.transactionQueueTree_),Us(e.eventQueue_,t,i);for(let e=0;e<n.length;e++)jt(n[e])}else{if("datastale"===n)for(let e=0;e<r.length;e++)3===r[e].status?r[e].status=4:r[e].status=0;else{It("transaction at "+l.toString()+" failed: "+n);for(let e=0;e<r.length;e++)r[e].status=4,r[e].abortReason=n}ro(e,t)}}),a)}(e,Ts(t),r)}else Cs(t)&&Es(t,(t=>{no(e,t)}))}function ro(e,t){const r=io(e,t),i=Ts(r);return function(e,t,r){if(0===t.length)return;const i=[];let s=[];const o=t.filter((e=>0===e.status)),a=o.map((e=>e.currentWriteId));for(let o=0;o<t.length;o++){const l=t[o],u=Cn(r,l.path);let h,d=!1;if(n(null!==u,"rerunTransactionsUnderNode_: relativePath should not be null."),4===l.status)d=!0,h=l.abortReason,s=s.concat(Hi(e.serverSyncTree_,l.currentWriteId,!0));else if(0===l.status)if(l.retryCount>=$s)d=!0,h="maxretry",s=s.concat(Hi(e.serverSyncTree_,l.currentWriteId,!0));else{const n=to(e,l.path,a);l.currentInputSnapshot=n;const r=t[o].update(n.val());if(void 0!==r){Os("transaction failed: Data returned ",r,l.path);let t=or(r);"object"==typeof r&&null!=r&&T(r,".priority")||(t=t.updatePriority(n.getPriority()));const i=l.currentWriteId,o=Ks(e),c=ms(t,n,o);l.currentOutputSnapshotRaw=t,l.currentOutputSnapshotResolved=c,l.currentWriteId=Xs(e),a.splice(a.indexOf(i),1),s=s.concat($i(e.serverSyncTree_,l.path,c,l.currentWriteId,l.applyLocally)),s=s.concat(Hi(e.serverSyncTree_,i,!0))}else d=!0,h="nodata",s=s.concat(Hi(e.serverSyncTree_,l.currentWriteId,!0))}Us(e.eventQueue_,r,s),s=[],d&&(t[o].status=2,c=t[o].unwatcher,setTimeout(c,Math.floor(0)),t[o].onComplete&&("nodata"===h?i.push((()=>t[o].onComplete(null,!1,t[o].currentInputSnapshot))):i.push((()=>t[o].onComplete(new Error(h),!1,null)))))}var c;ao(e,e.transactionQueueTree_);for(let e=0;e<i.length;e++)jt(i[e]);no(e,e.transactionQueueTree_)}(e,so(e,r),i),i}function io(e,t){let n,r=e.transactionQueueTree_;for(n=fn(t);null!==n&&void 0===bs(r);)r=vs(r,n),n=fn(t=mn(t));return r}function so(e,t){const n=[];return oo(e,t,n),n.sort(((e,t)=>e.order-t.order)),n}function oo(e,t,n){const r=bs(t);if(r)for(let e=0;e<r.length;e++)n.push(r[e]);Es(t,(t=>{oo(e,t,n)}))}function ao(e,t){const n=bs(t);if(n){let e=0;for(let t=0;t<n.length;t++)2!==n[t].status&&(n[e]=n[t],e++);n.length=e,ws(t,n.length>0?n:void 0)}Es(t,(t=>{ao(e,t)}))}function co(e,t){const n=Ts(io(e,t)),r=vs(e.transactionQueueTree_,t);return function(e,t){let n=e.parent;for(;null!==n;){if(t(n))return!0;n=n.parent}}(r,(t=>{lo(e,t)})),lo(e,r),Is(r,(t=>{lo(e,t)})),n}function lo(e,t){const r=bs(t);if(r){const i=[];let s=[],o=-1;for(let t=0;t<r.length;t++)3===r[t].status||(1===r[t].status?(n(o===t-1,"All SENT items should be at beginning of queue."),o=t,r[t].status=3,r[t].abortReason="set"):(n(0===r[t].status,"Unexpected transaction status in abort"),r[t].unwatcher(),s=s.concat(Hi(e.serverSyncTree_,r[t].currentWriteId,!0)),r[t].onComplete&&i.push(r[t].onComplete.bind(null,new Error("set"),!1,null))));-1===o?ws(t,void 0):r.length=o+1,Us(e.eventQueue_,Ts(t),s);for(let e=0;e<i.length;e++)jt(i[e])}}const uo=function(e,t){const n=ho(e),r=n.namespace;"firebase.com"===n.domain&&Et(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),r&&"undefined"!==r||"localhost"===n.domain||Et("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&It("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");const i="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new Ht(n.host,n.secure,r,i,t,"",r!==n.subdomain),path:new dn(n.pathString)}},ho=function(e){let t="",n="",r="",i="",s="",o=!0,a="https",c=443;if("string"==typeof e){let l=e.indexOf("//");l>=0&&(a=e.substring(0,l-1),e=e.substring(l+2));let u=e.indexOf("/");-1===u&&(u=e.length);let h=e.indexOf("?");-1===h&&(h=e.length),t=e.substring(0,Math.min(u,h)),u<h&&(i=function(e){let t="";const n=e.split("/");for(let e=0;e<n.length;e++)if(n[e].length>0){let r=n[e];try{r=decodeURIComponent(r.replace(/\+/g," "))}catch(e){}t+="/"+r}return t}(e.substring(u,h)));const d=function(e){const t={};"?"===e.charAt(0)&&(e=e.substring(1));for(const n of e.split("&")){if(0===n.length)continue;const r=n.split("=");2===r.length?t[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):It(`Invalid query segment '${n}' in query '${e}'`)}return t}(e.substring(Math.min(e.length,h)));l=t.indexOf(":"),l>=0?(o="https"===a||"wss"===a,c=parseInt(t.substring(l+1),10)):l=t.length;const p=t.slice(0,l);if("localhost"===p.toLowerCase())n="localhost";else if(p.split(".").length<=2)n=p;else{const e=t.indexOf(".");r=t.substring(0,e).toLowerCase(),n=t.substring(e+1),s=r}"ns"in d&&(s=d.ns)}return{host:t,port:c,domain:n,subdomain:r,secure:o,scheme:a,pathString:i,namespace:s}},po="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",fo=function(){let e=0;const t=[];return function(r){const i=r===e;let s;e=r;const o=new Array(8);for(s=7;s>=0;s--)o[s]=po.charAt(r%64),r=Math.floor(r/64);n(0===r,"Cannot push at time == 0");let a=o.join("");if(i){for(s=11;s>=0&&63===t[s];s--)t[s]=0;t[s]++}else for(s=0;s<12;s++)t[s]=Math.floor(64*Math.random());for(s=0;s<12;s++)a+=po.charAt(t[s]);return n(20===a.length,"nextPushId: Length should be 20."),a}}();class _o{constructor(e,t,n,r){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=r}getPath(){const e=this.snapshot.ref;return"value"===this.eventType?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+E(this.snapshot.exportVal())}}class mo{constructor(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class go{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return n(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class yo{constructor(e,t,n,r){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=r}get key(){return wn(this._path)?null:gn(this._path)}get ref(){return new vo(this._repo,this._path)}get _queryIdentifier(){const e=yr(this._queryParams),t=Dt(e);return"{}"===t?"default":t}get _queryObject(){return yr(this._queryParams)}isEqual(e){if(!((e=A(e))instanceof yo))return!1;const t=this._repo===e._repo,n=In(this._path,e._path),r=this._queryIdentifier===e._queryIdentifier;return t&&n&&r}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(e){let t="";for(let n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}(this._path)}}class vo extends yo{constructor(e,t){super(e,t,new mr,!1)}get parent(){const e=vn(this._path);return null===e?null:new vo(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class bo{constructor(e,t,n){this._node=e,this.ref=t,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new dn(e),n=Co(this.ref,e);return new bo(this._node.getChild(t),n,Yn)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){if(this._node.isLeafNode())return!1;return!!this._node.forEachChild(this._index,((t,n)=>e(new bo(n,Co(this.ref,t),Yn))))}hasChild(e){const t=new dn(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function wo(e,t){return(e=A(e))._checkNotDeleted("ref"),void 0!==t?Co(e._root,t):e._root}function Co(e,t){return null===fn((e=A(e))._path)?qs("child","path",t):Ms("child","path",t),new vo(e._repo,bn(e._path,t))}function Eo(e,t){As("update",t,e._path);const n=new m;return function(e,t,n,r){Zs(e,"update",{path:t.toString(),value:n});let i=!0;const s=Ks(e),o={};if(Ot(n,((n,r)=>{i=!1,o[n]=_s(bn(t,n),or(r),e.serverSyncTree_,s)})),i)bt("update() called with empty data.  Don't do anything."),eo(0,r,"ok",void 0);else{const i=Xs(e),s=Wi(e.serverSyncTree_,t,o,i);Vs(e.eventQueue_,s),e.server_.merge(t.toString(),n,((n,s)=>{const o="ok"===n;o||It("update at "+t+" failed: "+n);const a=Hi(e.serverSyncTree_,i,!o),c=a.length>0?ro(e,t):t;Us(e.eventQueue_,c,a),eo(0,r,n,s)})),Ot(n,(n=>{const r=co(e,bn(t,n));ro(e,r)})),Us(e.eventQueue_,t,[])}}(e._repo,e._path,t,n.wrapCallback((()=>{}))),n.promise}function Io(e){e=A(e);const t=new go((()=>{})),n=new To(t);return function(e,t,n){const r=Xi(e.serverSyncTree_,t);return null!=r?Promise.resolve(r):e.server_.get(t).then((r=>{const i=or(r).withIndex(t._queryParams.getIndex());let s;if(Gi(e.serverSyncTree_,t,n,!0),t._queryParams.loadsAllData())s=Qi(e.serverSyncTree_,t._path,i);else{const n=rs(e.serverSyncTree_,t);s=Yi(e.serverSyncTree_,t._path,i,n)}return Us(e.eventQueue_,t._path,s),Ki(e.serverSyncTree_,t,n,null,!0),i}),(n=>(Zs(e,"get for query "+E(t)+" failed: "+n),Promise.reject(new Error(n)))))}(e._repo,e,n).then((t=>new bo(t,new vo(e._repo,e._path),e._queryParams.getIndex())))}class To{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){const n=t._queryParams.getIndex();return new _o("value",this,new bo(e.snapshotNode,new vo(t._repo,t._path),n))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new mo(this,e,t):null}matches(e){return e instanceof To&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}!function(e){n(!Pi,"__referenceConstructor has already been defined"),Pi=e}(vo),function(e){n(!xi,"__referenceConstructor has already been defined"),xi=e}(vo);const So="FIREBASE_DATABASE_EMULATOR_HOST",No={};let ko=!1;function Po(e,t,n,r,i){let s=r||e.options.databaseURL;void 0===s&&(e.options.projectId||Et("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),bt("Using default host for project ",e.options.projectId),s=`${e.options.projectId}-default-rtdb.firebaseio.com`);let o,a=uo(s,i),c=a.repoInfo;"undefined"!=typeof process&&process.env&&(o=process.env[So]),o?(s=`http://${o}?ns=${c.namespace}`,a=uo(s,i),c=a.repoInfo):a.repoInfo.secure;const l=new Vt(e.name,e.options,t);Ls("Invalid Firebase Database URL",a),wn(a.path)||Et("Database URL must point to the root of a Firebase Database (not including a child path).");const u=function(e,t,n,r){let i=No[t.name];i||(i={},No[t.name]=i);let s=i[e.toURLString()];s&&Et("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call.");return s=new Ws(e,ko,n,r),i[e.toURLString()]=s,s}(c,e,l,new Ft(e.name,n));return new Do(u,e)}function xo(e,t){const n=No[t];n&&n[e.key]===e||Et(`Database ${t}(${e.repoInfo_}) has already been deleted.`),function(e){e.persistentConnection_&&e.persistentConnection_.interrupt(Bs)}(e),delete n[e.key]}class Do{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(Hs(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new vo(this._repo,pn())),this._rootInternal}_delete(){return null!==this._rootInternal&&(xo(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&Et("Cannot call "+e+" on a deleted database.")}}Dn.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},Dn.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)},function(e){!function(e){ct=e}("10.13.0"),Be(new M("database",((e,{instanceIdentifier:t})=>Po(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t)),"PUBLIC").setMultipleInstances(!0)),Qe(ot,at,e),Qe(ot,at,"esm2017")}();function Ro(e){return`Minified Redux error #${e}; visit https://redux.js.org/Errors?code=${e} for the full message or use the non-minified dev environment for full errors. `}var Oo=(()=>"function"==typeof Symbol&&Symbol.observable||"@@observable")(),Ao=()=>Math.random().toString(36).substring(7).split("").join("."),Mo={INIT:`@@redux/INIT${Ao()}`,REPLACE:`@@redux/REPLACE${Ao()}`,PROBE_UNKNOWN_ACTION:()=>`@@redux/PROBE_UNKNOWN_ACTION${Ao()}`};function qo(e){if("object"!=typeof e||null===e)return!1;let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t||null===Object.getPrototypeOf(e)}function jo(e){if(void 0===e)return"undefined";if(null===e)return"null";const t=typeof e;switch(t){case"boolean":case"string":case"number":case"symbol":case"function":return t}if(Array.isArray(e))return"array";if(function(e){return e instanceof Date||"function"==typeof e.toDateString&&"function"==typeof e.getDate&&"function"==typeof e.setDate}(e))return"date";if(function(e){return e instanceof Error||"string"==typeof e.message&&e.constructor&&"number"==typeof e.constructor.stackTraceLimit}(e))return"error";const n=function(e){return"function"==typeof e.constructor?e.constructor.name:null}(e);switch(n){case"Symbol":case"Promise":case"WeakMap":case"WeakSet":case"Map":case"Set":return n}return Object.prototype.toString.call(e).slice(8,-1).toLowerCase().replace(/\s/g,"")}function Lo(e){let t=typeof e;return"production"!==process.env.NODE_ENV&&(t=jo(e)),t}function Fo(e,t,n){if("function"!=typeof e)throw new Error("production"===process.env.NODE_ENV?Ro(2):`Expected the root reducer to be a function. Instead, received: '${Lo(e)}'`);if("function"==typeof t&&"function"==typeof n||"function"==typeof n&&"function"==typeof arguments[3])throw new Error("production"===process.env.NODE_ENV?Ro(0):"It looks like you are passing several store enhancers to createStore(). This is not supported. Instead, compose them together to a single function. See https://redux.js.org/tutorials/fundamentals/part-4-store#creating-a-store-with-enhancers for an example.");if("function"==typeof t&&void 0===n&&(n=t,t=void 0),void 0!==n){if("function"!=typeof n)throw new Error("production"===process.env.NODE_ENV?Ro(1):`Expected the enhancer to be a function. Instead, received: '${Lo(n)}'`);return n(Fo)(e,t)}let r=e,i=t,s=new Map,o=s,a=0,c=!1;function l(){o===s&&(o=new Map,s.forEach(((e,t)=>{o.set(t,e)})))}function u(){if(c)throw new Error("production"===process.env.NODE_ENV?Ro(3):"You may not call store.getState() while the reducer is executing. The reducer has already received the state as an argument. Pass it down from the top reducer instead of reading it from the store.");return i}function h(e){if("function"!=typeof e)throw new Error("production"===process.env.NODE_ENV?Ro(4):`Expected the listener to be a function. Instead, received: '${Lo(e)}'`);if(c)throw new Error("production"===process.env.NODE_ENV?Ro(5):"You may not call store.subscribe() while the reducer is executing. If you would like to be notified after the store has been updated, subscribe from a component and invoke store.getState() in the callback to access the latest state. See https://redux.js.org/api/store#subscribelistener for more details.");let t=!0;l();const n=a++;return o.set(n,e),function(){if(t){if(c)throw new Error("production"===process.env.NODE_ENV?Ro(6):"You may not unsubscribe from a store listener while the reducer is executing. See https://redux.js.org/api/store#subscribelistener for more details.");t=!1,l(),o.delete(n),s=null}}}function d(e){if(!qo(e))throw new Error("production"===process.env.NODE_ENV?Ro(7):`Actions must be plain objects. Instead, the actual type was: '${Lo(e)}'. You may need to add middleware to your store setup to handle dispatching other values, such as 'redux-thunk' to handle dispatching functions. See https://redux.js.org/tutorials/fundamentals/part-4-store#middleware and https://redux.js.org/tutorials/fundamentals/part-6-async-logic#using-the-redux-thunk-middleware for examples.`);if(void 0===e.type)throw new Error("production"===process.env.NODE_ENV?Ro(8):'Actions may not have an undefined "type" property. You may have misspelled an action type string constant.');if("string"!=typeof e.type)throw new Error("production"===process.env.NODE_ENV?Ro(17):`Action "type" property must be a string. Instead, the actual type was: '${Lo(e.type)}'. Value was: '${e.type}' (stringified)`);if(c)throw new Error("production"===process.env.NODE_ENV?Ro(9):"Reducers may not dispatch actions.");try{c=!0,i=r(i,e)}finally{c=!1}return(s=o).forEach((e=>{e()})),e}d({type:Mo.INIT});return{dispatch:d,subscribe:h,getState:u,replaceReducer:function(e){if("function"!=typeof e)throw new Error("production"===process.env.NODE_ENV?Ro(10):`Expected the nextReducer to be a function. Instead, received: '${Lo(e)}`);r=e,d({type:Mo.REPLACE})},[Oo]:function(){const e=h;return{subscribe(t){if("object"!=typeof t||null===t)throw new Error("production"===process.env.NODE_ENV?Ro(11):`Expected the observer to be an object. Instead, received: '${Lo(t)}'`);function n(){const e=t;e.next&&e.next(u())}n();return{unsubscribe:e(n)}},[Oo](){return this}}}}}function Vo(e){"undefined"!=typeof console&&"function"==typeof console.error&&console.error(e);try{throw new Error(e)}catch(e){}}function Uo(e){const t=Object.keys(e),n={};for(let r=0;r<t.length;r++){const i=t[r];"production"!==process.env.NODE_ENV&&void 0===e[i]&&Vo(`No reducer provided for key "${i}"`),"function"==typeof e[i]&&(n[i]=e[i])}const r=Object.keys(n);let i,s;"production"!==process.env.NODE_ENV&&(i={});try{!function(e){Object.keys(e).forEach((t=>{const n=e[t];if(void 0===n(void 0,{type:Mo.INIT}))throw new Error("production"===process.env.NODE_ENV?Ro(12):`The slice reducer for key "${t}" returned undefined during initialization. If the state passed to the reducer is undefined, you must explicitly return the initial state. The initial state may not be undefined. If you don't want to set a value for this reducer, you can use null instead of undefined.`);if(void 0===n(void 0,{type:Mo.PROBE_UNKNOWN_ACTION()}))throw new Error("production"===process.env.NODE_ENV?Ro(13):`The slice reducer for key "${t}" returned undefined when probed with a random type. Don't try to handle '${Mo.INIT}' or other actions in "redux/*" namespace. They are considered private. Instead, you must return the current state for any unknown actions, unless it is undefined, in which case you must return the initial state, regardless of the action type. The initial state may not be undefined, but can be null.`)}))}(n)}catch(e){s=e}return function(e={},t){if(s)throw s;if("production"!==process.env.NODE_ENV){const r=function(e,t,n,r){const i=Object.keys(t),s=n&&n.type===Mo.INIT?"preloadedState argument passed to createStore":"previous state received by the reducer";if(0===i.length)return"Store does not have a valid reducer. Make sure the argument passed to combineReducers is an object whose values are reducers.";if(!qo(e))return`The ${s} has unexpected type of "${Lo(e)}". Expected argument to be an object with the following keys: "${i.join('", "')}"`;const o=Object.keys(e).filter((e=>!t.hasOwnProperty(e)&&!r[e]));return o.forEach((e=>{r[e]=!0})),n&&n.type===Mo.REPLACE?void 0:o.length>0?`Unexpected ${o.length>1?"keys":"key"} "${o.join('", "')}" found in ${s}. Expected to find one of the known reducer keys instead: "${i.join('", "')}". Unexpected keys will be ignored.`:void 0}(e,n,t,i);r&&Vo(r)}let o=!1;const a={};for(let i=0;i<r.length;i++){const s=r[i],c=n[s],l=e[s],u=c(l,t);if(void 0===u){const e=t&&t.type;throw new Error("production"===process.env.NODE_ENV?Ro(14):`When called with an action of type ${e?`"${String(e)}"`:"(unknown type)"}, the slice reducer for key "${s}" returned undefined. To ignore an action, you must explicitly return the previous state. If you want this reducer to hold no value, you can return null instead of undefined.`)}a[s]=u,o=o||u!==l}return o=o||r.length!==Object.keys(e).length,o?a:e}}function zo(...e){return 0===e.length?e=>e:1===e.length?e[0]:e.reduce(((e,t)=>(...n)=>e(t(...n))))}function Bo(e){return qo(e)&&"type"in e&&"string"==typeof e.type}var $o=Symbol.for("immer-nothing"),Wo=Symbol.for("immer-draftable"),Ho=Symbol.for("immer-state"),Qo="production"!==process.env.NODE_ENV?[function(e){return`The plugin for '${e}' has not been loaded into Immer. To enable the plugin, import and call \`enable${e}()\` when initializing your application.`},function(e){return`produce can only be called on things that are draftable: plain objects, arrays, Map, Set or classes that are marked with '[immerable]: true'. Got '${e}'`},"This object has been frozen and should not be mutated",function(e){return"Cannot use a proxy that has been revoked. Did you pass an object from inside an immer function to an async process? "+e},"An immer producer returned a new value *and* modified its draft. Either return a new value *or* modify the draft.","Immer forbids circular references","The first or second argument to `produce` must be a function","The third argument to `produce` must be a function or undefined","First argument to `createDraft` must be a plain object, an array, or an immerable object","First argument to `finishDraft` must be a draft returned by `createDraft`",function(e){return`'current' expects a draft, got: ${e}`},"Object.defineProperty() cannot be used on an Immer draft","Object.setPrototypeOf() cannot be used on an Immer draft","Immer only supports deleting array indices","Immer only supports setting array indices and the 'length' property",function(e){return`'original' expects a draft, got: ${e}`}]:[];function Ko(e,...t){if("production"!==process.env.NODE_ENV){const n=Qo[e],r="function"==typeof n?n.apply(null,t):n;throw new Error(`[Immer] ${r}`)}throw new Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var Yo=Object.getPrototypeOf;function Go(e){return!!e&&!!e[Ho]}function Jo(e){return!!e&&(Zo(e)||Array.isArray(e)||!!e[Wo]||!!e.constructor?.[Wo]||sa(e)||oa(e))}var Xo=Object.prototype.constructor.toString();function Zo(e){if(!e||"object"!=typeof e)return!1;const t=Yo(e);if(null===t)return!0;const n=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return n===Object||"function"==typeof n&&Function.toString.call(n)===Xo}function ea(e,t){0===ta(e)?Reflect.ownKeys(e).forEach((n=>{t(n,e[n],e)})):e.forEach(((n,r)=>t(r,n,e)))}function ta(e){const t=e[Ho];return t?t.type_:Array.isArray(e)?1:sa(e)?2:oa(e)?3:0}function na(e,t){return 2===ta(e)?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function ra(e,t){return 2===ta(e)?e.get(t):e[t]}function ia(e,t,n){const r=ta(e);2===r?e.set(t,n):3===r?e.add(n):e[t]=n}function sa(e){return e instanceof Map}function oa(e){return e instanceof Set}function aa(e){return e.copy_||e.base_}function ca(e,t){if(sa(e))return new Map(e);if(oa(e))return new Set(e);if(Array.isArray(e))return Array.prototype.slice.call(e);const n=Zo(e);if(!0===t||"class_only"===t&&!n){const t=Object.getOwnPropertyDescriptors(e);delete t[Ho];let n=Reflect.ownKeys(t);for(let r=0;r<n.length;r++){const i=n[r],s=t[i];!1===s.writable&&(s.writable=!0,s.configurable=!0),(s.get||s.set)&&(t[i]={configurable:!0,writable:!0,enumerable:s.enumerable,value:e[i]})}return Object.create(Yo(e),t)}{const t=Yo(e);if(null!==t&&n)return{...e};const r=Object.create(t);return Object.assign(r,e)}}function la(e,t=!1){return ha(e)||Go(e)||!Jo(e)||(ta(e)>1&&(e.set=e.add=e.clear=e.delete=ua),Object.freeze(e),t&&Object.entries(e).forEach((([e,t])=>la(t,!0)))),e}function ua(){Ko(2)}function ha(e){return Object.isFrozen(e)}var da,pa={};function fa(e){const t=pa[e];return t||Ko(0,e),t}function _a(){return da}function ma(e,t){t&&(fa("Patches"),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function ga(e){ya(e),e.drafts_.forEach(ba),e.drafts_=null}function ya(e){e===da&&(da=e.parent_)}function va(e){return da={drafts_:[],parent_:da,immer_:e,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function ba(e){const t=e[Ho];0===t.type_||1===t.type_?t.revoke_():t.revoked_=!0}function wa(e,t){t.unfinalizedDrafts_=t.drafts_.length;const n=t.drafts_[0];return void 0!==e&&e!==n?(n[Ho].modified_&&(ga(t),Ko(4)),Jo(e)&&(e=Ca(t,e),t.parent_||Ia(t,e)),t.patches_&&fa("Patches").generateReplacementPatches_(n[Ho].base_,e,t.patches_,t.inversePatches_)):e=Ca(t,n,[]),ga(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==$o?e:void 0}function Ca(e,t,n){if(ha(t))return t;const r=t[Ho];if(!r)return ea(t,((i,s)=>Ea(e,r,t,i,s,n))),t;if(r.scope_!==e)return t;if(!r.modified_)return Ia(e,r.base_,!0),r.base_;if(!r.finalized_){r.finalized_=!0,r.scope_.unfinalizedDrafts_--;const t=r.copy_;let i=t,s=!1;3===r.type_&&(i=new Set(t),t.clear(),s=!0),ea(i,((i,o)=>Ea(e,r,t,i,o,n,s))),Ia(e,t,!1),n&&e.patches_&&fa("Patches").generatePatches_(r,n,e.patches_,e.inversePatches_)}return r.copy_}function Ea(e,t,n,r,i,s,o){if("production"!==process.env.NODE_ENV&&i===n&&Ko(5),Go(i)){const o=Ca(e,i,s&&t&&3!==t.type_&&!na(t.assigned_,r)?s.concat(r):void 0);if(ia(n,r,o),!Go(o))return;e.canAutoFreeze_=!1}else o&&n.add(i);if(Jo(i)&&!ha(i)){if(!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1)return;Ca(e,i),t&&t.scope_.parent_||"symbol"==typeof r||!Object.prototype.propertyIsEnumerable.call(n,r)||Ia(e,i)}}function Ia(e,t,n=!1){!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&la(t,n)}var Ta={get(e,t){if(t===Ho)return e;const n=aa(e);if(!na(n,t))return function(e,t,n){const r=ka(t,n);return r?"value"in r?r.value:r.get?.call(e.draft_):void 0}(e,n,t);const r=n[t];return e.finalized_||!Jo(r)?r:r===Na(e.base_,t)?(xa(e),e.copy_[t]=Da(r,e)):r},has:(e,t)=>t in aa(e),ownKeys:e=>Reflect.ownKeys(aa(e)),set(e,t,n){const r=ka(aa(e),t);if(r?.set)return r.set.call(e.draft_,n),!0;if(!e.modified_){const r=Na(aa(e),t),o=r?.[Ho];if(o&&o.base_===n)return e.copy_[t]=n,e.assigned_[t]=!1,!0;if(((i=n)===(s=r)?0!==i||1/i==1/s:i!=i&&s!=s)&&(void 0!==n||na(e.base_,t)))return!0;xa(e),Pa(e)}var i,s;return e.copy_[t]===n&&(void 0!==n||t in e.copy_)||Number.isNaN(n)&&Number.isNaN(e.copy_[t])||(e.copy_[t]=n,e.assigned_[t]=!0),!0},deleteProperty:(e,t)=>(void 0!==Na(e.base_,t)||t in e.base_?(e.assigned_[t]=!1,xa(e),Pa(e)):delete e.assigned_[t],e.copy_&&delete e.copy_[t],!0),getOwnPropertyDescriptor(e,t){const n=aa(e),r=Reflect.getOwnPropertyDescriptor(n,t);return r?{writable:!0,configurable:1!==e.type_||"length"!==t,enumerable:r.enumerable,value:n[t]}:r},defineProperty(){Ko(11)},getPrototypeOf:e=>Yo(e.base_),setPrototypeOf(){Ko(12)}},Sa={};function Na(e,t){const n=e[Ho];return(n?aa(n):e)[t]}function ka(e,t){if(!(t in e))return;let n=Yo(e);for(;n;){const e=Object.getOwnPropertyDescriptor(n,t);if(e)return e;n=Yo(n)}}function Pa(e){e.modified_||(e.modified_=!0,e.parent_&&Pa(e.parent_))}function xa(e){e.copy_||(e.copy_=ca(e.base_,e.scope_.immer_.useStrictShallowCopy_))}ea(Ta,((e,t)=>{Sa[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}})),Sa.deleteProperty=function(e,t){return"production"!==process.env.NODE_ENV&&isNaN(parseInt(t))&&Ko(13),Sa.set.call(this,e,t,void 0)},Sa.set=function(e,t,n){return"production"!==process.env.NODE_ENV&&"length"!==t&&isNaN(parseInt(t))&&Ko(14),Ta.set.call(this,e[0],t,n,e[0])};function Da(e,t){const n=sa(e)?fa("MapSet").proxyMap_(e,t):oa(e)?fa("MapSet").proxySet_(e,t):function(e,t){const n=Array.isArray(e),r={type_:n?1:0,scope_:t?t.scope_:_a(),modified_:!1,finalized_:!1,assigned_:{},parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1};let i=r,s=Ta;n&&(i=[r],s=Sa);const{revoke:o,proxy:a}=Proxy.revocable(i,s);return r.draft_=a,r.revoke_=o,a}(e,t);return(t?t.scope_:_a()).drafts_.push(n),n}function Ra(e){if(!Jo(e)||ha(e))return e;const t=e[Ho];let n;if(t){if(!t.modified_)return t.base_;t.finalized_=!0,n=ca(e,t.scope_.immer_.useStrictShallowCopy_)}else n=ca(e,!0);return ea(n,((e,t)=>{ia(n,e,Ra(t))})),t&&(t.finalized_=!1),n}function Oa(){"production"!==process.env.NODE_ENV&&Qo.push('Sets cannot have "replace" patches.',(function(e){return"Unsupported patch operation: "+e}),(function(e){return"Cannot apply patch, path doesn't resolve: "+e}),"Patching reserved attributes like __proto__, prototype and constructor is not allowed");const e="replace",t="add",n="remove";function r(e){if(!Jo(e))return e;if(Array.isArray(e))return e.map(r);if(sa(e))return new Map(Array.from(e.entries()).map((([e,t])=>[e,r(t)])));if(oa(e))return new Set(Array.from(e).map(r));const t=Object.create(Yo(e));for(const n in e)t[n]=r(e[n]);return na(e,Wo)&&(t[Wo]=e[Wo]),t}function i(e){return Go(e)?r(e):e}var s,o;o={applyPatches_:function(i,s){return s.forEach((s=>{const{path:o,op:a}=s;let c=i;for(let e=0;e<o.length-1;e++){const t=ta(c);let n=o[e];"string"!=typeof n&&"number"!=typeof n&&(n=""+n),0!==t&&1!==t||"__proto__"!==n&&"constructor"!==n||Ko(19),"function"==typeof c&&"prototype"===n&&Ko(19),c=ra(c,n),"object"!=typeof c&&Ko(18,o.join("/"))}const l=ta(c),u=r(s.value),h=o[o.length-1];switch(a){case e:switch(l){case 2:return c.set(h,u);case 3:Ko(16);default:return c[h]=u}case t:switch(l){case 1:return"-"===h?c.push(u):c.splice(h,0,u);case 2:return c.set(h,u);case 3:return c.add(u);default:return c[h]=u}case n:switch(l){case 1:return c.splice(h,1);case 2:return c.delete(h);case 3:return c.delete(s.value);default:return delete c[h]}default:Ko(17,a)}})),i},generatePatches_:function(r,s,o,a){switch(r.type_){case 0:case 2:return function(r,s,o,a){const{base_:c,copy_:l}=r;ea(r.assigned_,((r,u)=>{const h=ra(c,r),d=ra(l,r),p=u?na(c,r)?e:t:n;if(h===d&&p===e)return;const f=s.concat(r);o.push(p===n?{op:p,path:f}:{op:p,path:f,value:d}),a.push(p===t?{op:n,path:f}:p===n?{op:t,path:f,value:i(h)}:{op:e,path:f,value:i(h)})}))}(r,s,o,a);case 1:return function(r,s,o,a){let{base_:c,assigned_:l}=r,u=r.copy_;u.length<c.length&&([c,u]=[u,c],[o,a]=[a,o]);for(let t=0;t<c.length;t++)if(l[t]&&u[t]!==c[t]){const n=s.concat([t]);o.push({op:e,path:n,value:i(u[t])}),a.push({op:e,path:n,value:i(c[t])})}for(let e=c.length;e<u.length;e++){const n=s.concat([e]);o.push({op:t,path:n,value:i(u[e])})}for(let e=u.length-1;c.length<=e;--e){const t=s.concat([e]);a.push({op:n,path:t})}}(r,s,o,a);case 3:return function(e,r,i,s){let{base_:o,copy_:a}=e,c=0;o.forEach((e=>{if(!a.has(e)){const o=r.concat([c]);i.push({op:n,path:o,value:e}),s.unshift({op:t,path:o,value:e})}c++})),c=0,a.forEach((e=>{if(!o.has(e)){const o=r.concat([c]);i.push({op:t,path:o,value:e}),s.unshift({op:n,path:o,value:e})}c++}))}(r,s,o,a)}},generateReplacementPatches_:function(t,n,r,i){r.push({op:e,path:[],value:n===$o?void 0:n}),i.push({op:e,path:[],value:t})}},pa[s="Patches"]||(pa[s]=o)}var Aa=new class{constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(e,t,n)=>{if("function"==typeof e&&"function"!=typeof t){const n=t;t=e;const r=this;return function(e=n,...i){return r.produce(e,(e=>t.call(this,e,...i)))}}let r;if("function"!=typeof t&&Ko(6),void 0!==n&&"function"!=typeof n&&Ko(7),Jo(e)){const i=va(this),s=Da(e,void 0);let o=!0;try{r=t(s),o=!1}finally{o?ga(i):ya(i)}return ma(i,n),wa(r,i)}if(!e||"object"!=typeof e){if(r=t(e),void 0===r&&(r=e),r===$o&&(r=void 0),this.autoFreeze_&&la(r,!0),n){const t=[],i=[];fa("Patches").generateReplacementPatches_(e,r,t,i),n(t,i)}return r}Ko(1,e)},this.produceWithPatches=(e,t)=>{if("function"==typeof e)return(t,...n)=>this.produceWithPatches(t,(t=>e(t,...n)));let n,r;return[this.produce(e,t,((e,t)=>{n=e,r=t})),n,r]},"boolean"==typeof e?.autoFreeze&&this.setAutoFreeze(e.autoFreeze),"boolean"==typeof e?.useStrictShallowCopy&&this.setUseStrictShallowCopy(e.useStrictShallowCopy)}createDraft(e){Jo(e)||Ko(8),Go(e)&&(e=function(e){Go(e)||Ko(10,e);return Ra(e)}(e));const t=va(this),n=Da(e,void 0);return n[Ho].isManual_=!0,ya(t),n}finishDraft(e,t){const n=e&&e[Ho];n&&n.isManual_||Ko(9);const{scope_:r}=n;return ma(r,t),wa(void 0,r)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}applyPatches(e,t){let n;for(n=t.length-1;n>=0;n--){const r=t[n];if(0===r.path.length&&"replace"===r.op){e=r.value;break}}n>-1&&(t=t.slice(n+1));const r=fa("Patches").applyPatches_;return Go(e)?r(e,t):this.produce(e,(e=>r(e,t)))}},Ma=Aa.produce,qa=Aa.produceWithPatches.bind(Aa);Aa.setAutoFreeze.bind(Aa),Aa.setUseStrictShallowCopy.bind(Aa);var ja=Aa.applyPatches.bind(Aa);Aa.createDraft.bind(Aa),Aa.finishDraft.bind(Aa);var La=(e,t,n)=>{if(1===t.length&&t[0]===n){let t=!1;try{const n={};e(n)===n&&(t=!0)}catch{}if(t){let e;try{throw new Error}catch(t){({stack:e}=t)}console.warn("The result function returned its own inputs without modification. e.g\n`createSelector([state => state.todos], todos => todos)`\nThis could lead to inefficient memoization and unnecessary re-renders.\nEnsure transformation logic is in the result function, and extraction logic is in the input selectors.",{stack:e})}}},Fa=(e,t,n)=>{const{memoize:r,memoizeOptions:i}=t,{inputSelectorResults:s,inputSelectorResultsCopy:o}=e,a=r((()=>({})),...i);if(!(a.apply(null,s)===a.apply(null,o))){let e;try{throw new Error}catch(t){({stack:e}=t)}console.warn("An input selector returned a different result when passed same arguments.\nThis means your output selector will likely run more frequently than intended.\nAvoid returning a new reference inside your input selector, e.g.\n`createSelector([state => state.todos.map(todo => todo.id)], todoIds => todoIds.length)`",{arguments:n,firstInputs:s,secondInputs:o,stack:e})}},Va={inputStabilityCheck:"once",identityFunctionCheck:"once"};var Ua=e=>Array.isArray(e)?e:[e];function za(e){const t=Array.isArray(e[0])?e[0]:e;return function(e,t="expected all items to be functions, instead received the following types: "){if(!e.every((e=>"function"==typeof e))){const n=e.map((e=>"function"==typeof e?`function ${e.name||"unnamed"}()`:typeof e)).join(", ");throw new TypeError(`${t}[${n}]`)}}(t,"createSelector expects all input-selectors to be functions, but received the following types: "),t}function Ba(e,t){const n=[],{length:r}=e;for(let i=0;i<r;i++)n.push(e[i].apply(null,t));return n}var $a="undefined"!=typeof WeakRef?WeakRef:class{constructor(e){this.value=e}deref(){return this.value}},Wa=0,Ha=1;function Qa(){return{s:Wa,v:void 0,o:null,p:null}}function Ka(e,t={}){let n=Qa();const{resultEqualityCheck:r}=t;let i,s=0;function o(){let t=n;const{length:o}=arguments;for(let e=0,n=o;e<n;e++){const n=arguments[e];if("function"==typeof n||"object"==typeof n&&null!==n){let e=t.o;null===e&&(t.o=e=new WeakMap);const r=e.get(n);void 0===r?(t=Qa(),e.set(n,t)):t=r}else{let e=t.p;null===e&&(t.p=e=new Map);const r=e.get(n);void 0===r?(t=Qa(),e.set(n,t)):t=r}}const a=t;let c;if(t.s===Ha)c=t.v;else if(c=e.apply(null,arguments),s++,r){const e=i?.deref?.()??i;null!=e&&r(e,c)&&(c=e,0!==s&&s--);i="object"==typeof c&&null!==c||"function"==typeof c?new $a(c):c}return a.s=Ha,a.v=c,c}return o.clearCache=()=>{n=Qa(),o.resetResultsCount()},o.resultsCount=()=>s,o.resetResultsCount=()=>{s=0},o}function Ya(e,...t){const n="function"==typeof e?{memoize:e,memoizeOptions:t}:e,r=(...e)=>{let t,r=0,i=0,s={},o=e.pop();"object"==typeof o&&(s=o,o=e.pop()),function(e,t="expected a function, instead received "+typeof e){if("function"!=typeof e)throw new TypeError(t)}(o,`createSelector expects an output function after the inputs, but received: [${typeof o}]`);const a={...n,...s},{memoize:c,memoizeOptions:l=[],argsMemoize:u=Ka,argsMemoizeOptions:h=[],devModeChecks:d={}}=a,p=Ua(l),f=Ua(h),_=za(e),m=c((function(){return r++,o.apply(null,arguments)}),...p);let g=!0;const y=u((function(){i++;const e=Ba(_,arguments);if(t=m.apply(null,e),"production"!==process.env.NODE_ENV){const{identityFunctionCheck:n,inputStabilityCheck:r}=((e,t)=>{const{identityFunctionCheck:n,inputStabilityCheck:r}={...Va,...t};return{identityFunctionCheck:{shouldRun:"always"===n||"once"===n&&e,run:La},inputStabilityCheck:{shouldRun:"always"===r||"once"===r&&e,run:Fa}}})(g,d);if(n.shouldRun&&n.run(o,e,t),r.shouldRun){const t=Ba(_,arguments);r.run({inputSelectorResults:e,inputSelectorResultsCopy:t},{memoize:c,memoizeOptions:p},arguments)}g&&(g=!1)}return t}),...f);return Object.assign(y,{resultFunc:o,memoizedResultFunc:m,dependencies:_,dependencyRecomputations:()=>i,resetDependencyRecomputations:()=>{i=0},lastResult:()=>t,recomputations:()=>r,resetRecomputations:()=>{r=0},memoize:c,argsMemoize:u})};return Object.assign(r,{withTypes:()=>r}),r}var Ga=Ya(Ka),Ja=Object.assign(((e,t=Ga)=>{!function(e,t="expected an object, instead received "+typeof e){if("object"!=typeof e)throw new TypeError(t)}(e,"createStructuredSelector expects first argument to be an object where each property is a selector, instead received a "+typeof e);const n=Object.keys(e);return t(n.map((t=>e[t])),((...e)=>e.reduce(((e,t,r)=>(e[n[r]]=t,e)),{})))}),{withTypes:()=>Ja});function Xa(e){return({dispatch:t,getState:n})=>r=>i=>"function"==typeof i?i(t,n,e):r(i)}var Za=Xa(),ec=Xa,tc="undefined"!=typeof window&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(0!==arguments.length)return"object"==typeof arguments[0]?zo:zo.apply(null,arguments)},nc=e=>e&&"function"==typeof e.match;function rc(e,t){function n(...n){if(t){let r=t(...n);if(!r)throw new Error("production"===process.env.NODE_ENV?Qc(0):"prepareAction did not return an object");return{type:e,payload:r.payload,..."meta"in r&&{meta:r.meta},..."error"in r&&{error:r.error}}}return{type:e,payload:n[0]}}return n.toString=()=>`${e}`,n.type=e,n.match=t=>Bo(t)&&t.type===e,n}function ic(e){return"function"==typeof e&&"type"in e&&nc(e)}function sc(e,t){let n=0;return{measureTime(e){const t=Date.now();try{return e()}finally{const e=Date.now();n+=e-t}},warnIfExceeded(){n>e&&console.warn(`${t} took ${n}ms, which is more than the warning threshold of ${e}ms. \nIf your state or actions are very large, you may want to disable the middleware as it might cause too much of a slowdown in development mode. See https://redux-toolkit.js.org/api/getDefaultMiddleware for instructions.\nIt is disabled in production builds, so you don't need to worry about that.`)}}}var oc=class e extends Array{constructor(...t){super(...t),Object.setPrototypeOf(this,e.prototype)}static get[Symbol.species](){return e}concat(...e){return super.concat.apply(this,e)}prepend(...t){return 1===t.length&&Array.isArray(t[0])?new e(...t[0].concat(this)):new e(...t.concat(this))}};function ac(e){return Jo(e)?Ma(e,(()=>{})):e}function cc(e,t,n){if(e.has(t)){let r=e.get(t);return n.update&&(r=n.update(r,t,e),e.set(t,r)),r}if(!n.insert)throw new Error("production"===process.env.NODE_ENV?Qc(10):"No insert provided for key not already in map");const r=n.insert(t,e);return e.set(t,r),r}function lc(e){return"object"!=typeof e||null==e||Object.isFrozen(e)}function uc(e,t,n){const r=hc(e,t,n);return{detectMutations:()=>dc(e,t,r,n)}}function hc(e,t=[],n,r="",i=new Set){const s={value:n};if(!e(n)&&!i.has(n)){i.add(n),s.children={};for(const i in n){const o=r?r+"."+i:i;t.length&&-1!==t.indexOf(o)||(s.children[i]=hc(e,t,n[i],o))}}return s}function dc(e,t=[],n,r,i=!1,s=""){const o=n?n.value:void 0,a=o===r;if(i&&!a&&!Number.isNaN(r))return{wasMutated:!0,path:s};if(e(o)||e(r))return{wasMutated:!1};const c={};for(let e in n.children)c[e]=!0;for(let e in r)c[e]=!0;const l=t.length>0;for(let i in c){const o=s?s+"."+i:i;if(l){if(t.some((e=>e instanceof RegExp?e.test(o):o===e)))continue}const c=dc(e,t,n.children[i],r[i],a,o);if(c.wasMutated)return c}return{wasMutated:!1}}function pc(e){const t=typeof e;return null==e||"string"===t||"boolean"===t||"number"===t||Array.isArray(e)||qo(e)}function fc(e,t="",n=pc,r,i=[],s){let o;if(!n(e))return{keyPath:t||"<root>",value:e};if("object"!=typeof e||null===e)return!1;if(s?.has(e))return!1;const a=null!=r?r(e):Object.entries(e),c=i.length>0;for(const[e,l]of a){const a=t?t+"."+e:e;if(c){if(i.some((e=>e instanceof RegExp?e.test(a):a===e)))continue}if(!n(l))return{keyPath:a,value:l};if("object"==typeof l&&(o=fc(l,a,n,r,i,s),o))return o}return s&&_c(e)&&s.add(e),!1}function _c(e){if(!Object.isFrozen(e))return!1;for(const t of Object.values(e))if("object"==typeof t&&null!==t&&!_c(t))return!1;return!0}function mc(e){return"boolean"==typeof e}var gc=()=>function(e){const{thunk:t=!0,immutableCheck:n=!0,serializableCheck:r=!0,actionCreatorCheck:i=!0}=e??{};let s=new oc;if(t&&(mc(t)?s.push(Za):s.push(ec(t.extraArgument))),"production"!==process.env.NODE_ENV){if(n){let e={};mc(n)||(e=n),s.unshift(function(e={}){if("production"===process.env.NODE_ENV)return()=>e=>t=>e(t);{let t=function(e,t,r,i){return JSON.stringify(e,n(t,i),r)},n=function(e,t){let n=[],r=[];return t||(t=function(e,t){return n[0]===t?"[Circular ~]":"[Circular ~."+r.slice(0,n.indexOf(t)).join(".")+"]"}),function(i,s){if(n.length>0){var o=n.indexOf(this);~o?n.splice(o+1):n.push(this),~o?r.splice(o,1/0,i):r.push(i),~n.indexOf(s)&&(s=t.call(this,i,s))}else n.push(s);return null==e?s:e.call(this,i,s)}},{isImmutable:r=lc,ignoredPaths:i,warnAfter:s=32}=e;const o=uc.bind(null,r,i);return({getState:e})=>{let n,r=e(),i=o(r);return a=>c=>{const l=sc(s,"ImmutableStateInvariantMiddleware");l.measureTime((()=>{if(r=e(),n=i.detectMutations(),i=o(r),n.wasMutated)throw new Error("production"===process.env.NODE_ENV?Qc(19):`A state mutation was detected between dispatches, in the path '${n.path||""}'.  This may cause incorrect behavior. (https://redux.js.org/style-guide/style-guide#do-not-mutate-state)`)}));const u=a(c);return l.measureTime((()=>{if(r=e(),n=i.detectMutations(),i=o(r),n.wasMutated)throw new Error("production"===process.env.NODE_ENV?Qc(20):`A state mutation was detected inside a dispatch, in the path: ${n.path||""}. Take a look at the reducer(s) handling the action ${t(c)}. (https://redux.js.org/style-guide/style-guide#do-not-mutate-state)`)})),l.warnIfExceeded(),u}}}}(e))}if(r){let e={};mc(r)||(e=r),s.push(function(e={}){if("production"===process.env.NODE_ENV)return()=>e=>t=>e(t);{const{isSerializable:t=pc,getEntries:n,ignoredActions:r=[],ignoredActionPaths:i=["meta.arg","meta.baseQueryMeta"],ignoredPaths:s=[],warnAfter:o=32,ignoreState:a=!1,ignoreActions:c=!1,disableCache:l=!1}=e,u=!l&&WeakSet?new WeakSet:void 0;return e=>l=>h=>{if(!Bo(h))return l(h);const d=l(h),p=sc(o,"SerializableStateInvariantMiddleware");return c||r.length&&-1!==r.indexOf(h.type)||p.measureTime((()=>{const e=fc(h,"",t,n,i,u);if(e){const{keyPath:t,value:n}=e;console.error(`A non-serializable value was detected in an action, in the path: \`${t}\`. Value:`,n,"\nTake a look at the logic that dispatched this action: ",h,"\n(See https://redux.js.org/faq/actions#why-should-type-be-a-string-or-at-least-serializable-why-should-my-action-types-be-constants)","\n(To allow non-serializable values see: https://redux-toolkit.js.org/usage/usage-guide#working-with-non-serializable-data)")}})),a||(p.measureTime((()=>{const r=fc(e.getState(),"",t,n,s,u);if(r){const{keyPath:e,value:t}=r;console.error(`A non-serializable value was detected in the state, in the path: \`${e}\`. Value:`,t,`\nTake a look at the reducer(s) handling this action type: ${h.type}.\n(See https://redux.js.org/faq/organizing-state#can-i-put-functions-promises-or-other-non-serializable-items-in-my-store-state)`)}})),p.warnIfExceeded()),d}}}(e))}if(i){let e={};mc(i)||(e=i),s.unshift(function(e={}){if("production"===process.env.NODE_ENV)return()=>e=>t=>e(t);const{isActionCreator:t=ic}=e;return()=>e=>n=>(t(n)&&console.warn(function(e){const t=e?`${e}`.split("/"):[],n=t[t.length-1]||"actionCreator";return`Detected an action creator with type "${e||"unknown"}" being dispatched. \nMake sure you're calling the action creator before dispatching, i.e. \`dispatch(${n}())\` instead of \`dispatch(${n})\`. This is necessary even if the action has no payload.`}(n.type)),e(n))}(e))}}return s},yc="RTK_autoBatch",vc=()=>e=>({payload:e,meta:{[yc]:!0}}),bc=e=>t=>{setTimeout(t,e)},wc="undefined"!=typeof window&&window.requestAnimationFrame?window.requestAnimationFrame:bc(10),Cc=e=>function(t){const{autoBatch:n=!0}=t??{};let r=new oc(e);return n&&r.push(((e={type:"raf"})=>t=>(...n)=>{const r=t(...n);let i=!0,s=!1,o=!1;const a=new Set,c="tick"===e.type?queueMicrotask:"raf"===e.type?wc:"callback"===e.type?e.queueNotification:bc(e.timeout),l=()=>{o=!1,s&&(s=!1,a.forEach((e=>e())))};return Object.assign({},r,{subscribe(e){const t=r.subscribe((()=>i&&e()));return a.add(e),()=>{t(),a.delete(e)}},dispatch(e){try{return i=!e?.meta?.[yc],s=!i,s&&(o||(o=!0,c(l))),r.dispatch(e)}finally{i=!0}}})})("object"==typeof n?n:void 0)),r};function Ec(e){const t={},n=[];let r;const i={addCase(e,s){if("production"!==process.env.NODE_ENV){if(n.length>0)throw new Error("production"===process.env.NODE_ENV?Qc(26):"`builder.addCase` should only be called before calling `builder.addMatcher`");if(r)throw new Error("production"===process.env.NODE_ENV?Qc(27):"`builder.addCase` should only be called before calling `builder.addDefaultCase`")}const o="string"==typeof e?e:e.type;if(!o)throw new Error("production"===process.env.NODE_ENV?Qc(28):"`builder.addCase` cannot be called with an empty action type");if(o in t)throw new Error("production"===process.env.NODE_ENV?Qc(29):`\`builder.addCase\` cannot be called with two reducers for the same action type '${o}'`);return t[o]=s,i},addMatcher(e,t){if("production"!==process.env.NODE_ENV&&r)throw new Error("production"===process.env.NODE_ENV?Qc(30):"`builder.addMatcher` should only be called before calling `builder.addDefaultCase`");return n.push({matcher:e,reducer:t}),i},addDefaultCase(e){if("production"!==process.env.NODE_ENV&&r)throw new Error("production"===process.env.NODE_ENV?Qc(31):"`builder.addDefaultCase` can only be called once");return r=e,i}};return e(i),[t,n,r]}var Ic=(e,t)=>nc(e)?e.match(t):e(t);function Tc(...e){return t=>e.some((e=>Ic(e,t)))}function Sc(...e){return t=>e.every((e=>Ic(e,t)))}function Nc(e,t){if(!e||!e.meta)return!1;const n="string"==typeof e.meta.requestId,r=t.indexOf(e.meta.requestStatus)>-1;return n&&r}function kc(e){return"function"==typeof e[0]&&"pending"in e[0]&&"fulfilled"in e[0]&&"rejected"in e[0]}function Pc(...e){return 0===e.length?e=>Nc(e,["pending"]):kc(e)?Tc(...e.map((e=>e.pending))):Pc()(e[0])}function xc(...e){return 0===e.length?e=>Nc(e,["rejected"]):kc(e)?Tc(...e.map((e=>e.rejected))):xc()(e[0])}function Dc(...e){const t=e=>e&&e.meta&&e.meta.rejectedWithValue;return 0===e.length||kc(e)?Sc(xc(...e),t):Dc()(e[0])}function Rc(...e){return 0===e.length?e=>Nc(e,["fulfilled"]):kc(e)?Tc(...e.map((e=>e.fulfilled))):Rc()(e[0])}function Oc(...e){return 0===e.length?e=>Nc(e,["pending","fulfilled","rejected"]):kc(e)?Tc(...e.flatMap((e=>[e.pending,e.rejected,e.fulfilled]))):Oc()(e[0])}var Ac=(e=21)=>{let t="",n=e;for(;n--;)t+="ModuleSymbhasOwnPr-0123456789ABCDEFGHNRVfgctiUvz_KqYTJkLxpZXIjQW"[64*Math.random()|0];return t},Mc=["name","message","stack","code"],qc=class{constructor(e,t){this.payload=e,this.meta=t}_type},jc=class{constructor(e,t){this.payload=e,this.meta=t}_type},Lc=e=>{if("object"==typeof e&&null!==e){const t={};for(const n of Mc)"string"==typeof e[n]&&(t[n]=e[n]);return t}return{message:String(e)}},Fc=(()=>{function e(e,t,n){const r=rc(e+"/fulfilled",((e,t,n,r)=>({payload:e,meta:{...r||{},arg:n,requestId:t,requestStatus:"fulfilled"}}))),i=rc(e+"/pending",((e,t,n)=>({payload:void 0,meta:{...n||{},arg:t,requestId:e,requestStatus:"pending"}}))),s=rc(e+"/rejected",((e,t,r,i,s)=>({payload:i,error:(n&&n.serializeError||Lc)(e||"Rejected"),meta:{...s||{},arg:r,requestId:t,rejectedWithValue:!!i,requestStatus:"rejected",aborted:"AbortError"===e?.name,condition:"ConditionError"===e?.name}})));return Object.assign((function(e){return(o,a,c)=>{const l=n?.idGenerator?n.idGenerator(e):Ac(),u=new AbortController;let h,d;function p(e){d=e,u.abort()}const f=async function(){let f;try{let s=n?.condition?.(e,{getState:a,extra:c});if(null!==(_=s)&&"object"==typeof _&&"function"==typeof _.then&&(s=await s),!1===s||u.signal.aborted)throw{name:"ConditionError",message:"Aborted due to condition callback returning false."};const m=new Promise(((e,t)=>{h=()=>{t({name:"AbortError",message:d||"Aborted"})},u.signal.addEventListener("abort",h)}));o(i(l,e,n?.getPendingMeta?.({requestId:l,arg:e},{getState:a,extra:c}))),f=await Promise.race([m,Promise.resolve(t(e,{dispatch:o,getState:a,extra:c,requestId:l,signal:u.signal,abort:p,rejectWithValue:(e,t)=>new qc(e,t),fulfillWithValue:(e,t)=>new jc(e,t)})).then((t=>{if(t instanceof qc)throw t;return t instanceof jc?r(t.payload,l,e,t.meta):r(t,l,e)}))])}catch(t){f=t instanceof qc?s(null,l,e,t.payload,t.meta):s(t,l,e)}finally{h&&u.signal.removeEventListener("abort",h)}var _;return n&&!n.dispatchConditionRejection&&s.match(f)&&f.meta.condition||o(f),f}();return Object.assign(f,{abort:p,requestId:l,arg:e,unwrap:()=>f.then(Vc)})}}),{pending:i,rejected:s,fulfilled:r,settled:Tc(s,r),typePrefix:e})}return e.withTypes=()=>e,e})();function Vc(e){if(e.meta&&e.meta.rejectedWithValue)throw e.payload;if(e.error)throw e.error;return e.payload}var Uc=Symbol.for("rtk-slice-createasyncthunk");function zc(e,t){return`${e}/${t}`}function Bc({creators:e}={}){const t=e?.asyncThunk?.[Uc];return function(e){const{name:n,reducerPath:r=n}=e;if(!n)throw new Error("production"===process.env.NODE_ENV?Qc(11):"`name` is a required option for createSlice");"undefined"!=typeof process&&"development"===process.env.NODE_ENV&&void 0===e.initialState&&console.error("You must provide an `initialState` value that is not `undefined`. You may have misspelled `initialState`");const i=("function"==typeof e.reducers?e.reducers(function(){function e(e,t){return{_reducerDefinitionType:"asyncThunk",payloadCreator:e,...t}}return e.withTypes=()=>e,{reducer:e=>Object.assign({[e.name]:(...t)=>e(...t)}[e.name],{_reducerDefinitionType:"reducer"}),preparedReducer:(e,t)=>({_reducerDefinitionType:"reducerWithPrepare",prepare:e,reducer:t}),asyncThunk:e}}()):e.reducers)||{},s=Object.keys(i),o={sliceCaseReducersByName:{},sliceCaseReducersByType:{},actionCreators:{},sliceMatchers:[]},a={addCase(e,t){const n="string"==typeof e?e:e.type;if(!n)throw new Error("production"===process.env.NODE_ENV?Qc(12):"`context.addCase` cannot be called with an empty action type");if(n in o.sliceCaseReducersByType)throw new Error("production"===process.env.NODE_ENV?Qc(13):"`context.addCase` cannot be called with two reducers for the same action type: "+n);return o.sliceCaseReducersByType[n]=t,a},addMatcher:(e,t)=>(o.sliceMatchers.push({matcher:e,reducer:t}),a),exposeAction:(e,t)=>(o.actionCreators[e]=t,a),exposeCaseReducer:(e,t)=>(o.sliceCaseReducersByName[e]=t,a)};function c(){if("production"!==process.env.NODE_ENV&&"object"==typeof e.extraReducers)throw new Error("production"===process.env.NODE_ENV?Qc(14):"The object notation for `createSlice.extraReducers` has been removed. Please use the 'builder callback' notation instead: https://redux-toolkit.js.org/api/createSlice");const[t={},n=[],r]="function"==typeof e.extraReducers?Ec(e.extraReducers):[e.extraReducers],i={...t,...o.sliceCaseReducersByType};return function(e,t){if("production"!==process.env.NODE_ENV&&"object"==typeof t)throw new Error("production"===process.env.NODE_ENV?Qc(8):"The object notation for `createReducer` has been removed. Please use the 'builder callback' notation instead: https://redux-toolkit.js.org/api/createReducer");let n,[r,i,s]=Ec(t);if("function"==typeof e)n=()=>ac(e());else{const t=ac(e);n=()=>t}function o(e=n(),t){let o=[r[t.type],...i.filter((({matcher:e})=>e(t))).map((({reducer:e})=>e))];return 0===o.filter((e=>!!e)).length&&(o=[s]),o.reduce(((e,n)=>{if(n){if(Go(e)){const r=n(e,t);return void 0===r?e:r}if(Jo(e))return Ma(e,(e=>n(e,t)));{const r=n(e,t);if(void 0===r){if(null===e)return e;throw new Error("production"===process.env.NODE_ENV?Qc(9):"A case reducer on a non-draftable value must not return undefined")}return r}}return e}),e)}return o.getInitialState=n,o}(e.initialState,(e=>{for(let t in i)e.addCase(t,i[t]);for(let t of o.sliceMatchers)e.addMatcher(t.matcher,t.reducer);for(let t of n)e.addMatcher(t.matcher,t.reducer);r&&e.addDefaultCase(r)}))}s.forEach((r=>{const s=i[r],o={reducerName:r,type:zc(n,r),createNotation:"function"==typeof e.reducers};!function(e){return"asyncThunk"===e._reducerDefinitionType}(s)?function({type:e,reducerName:t,createNotation:n},r,i){let s,o;if("reducer"in r){if(n&&!function(e){return"reducerWithPrepare"===e._reducerDefinitionType}(r))throw new Error("production"===process.env.NODE_ENV?Qc(17):"Please use the `create.preparedReducer` notation for prepared action creators with the `create` notation.");s=r.reducer,o=r.prepare}else s=r;i.addCase(e,s).exposeCaseReducer(t,s).exposeAction(t,o?rc(e,o):rc(e))}(o,s,a):function({type:e,reducerName:t},n,r,i){if(!i)throw new Error("production"===process.env.NODE_ENV?Qc(18):"Cannot use `create.asyncThunk` in the built-in `createSlice`. Use `buildCreateSlice({ creators: { asyncThunk: asyncThunkCreator } })` to create a customised version of `createSlice`.");const{payloadCreator:s,fulfilled:o,pending:a,rejected:c,settled:l,options:u}=n,h=i(e,s,u);r.exposeAction(t,h),o&&r.addCase(h.fulfilled,o);a&&r.addCase(h.pending,a);c&&r.addCase(h.rejected,c);l&&r.addMatcher(h.settled,l);r.exposeCaseReducer(t,{fulfilled:o||Hc,pending:a||Hc,rejected:c||Hc,settled:l||Hc})}(o,s,a,t)}));const l=e=>e,u=new Map;let h;function d(e,t){return h||(h=c()),h(e,t)}function p(){return h||(h=c()),h.getInitialState()}function f(t,n=!1){function r(e){let r=e[t];if(void 0===r)if(n)r=p();else if("production"!==process.env.NODE_ENV)throw new Error("production"===process.env.NODE_ENV?Qc(15):"selectSlice returned undefined for an uninjected slice reducer");return r}function i(t=l){const r=cc(u,n,{insert:()=>new WeakMap});return cc(r,t,{insert:()=>{const r={};for(const[i,s]of Object.entries(e.selectors??{}))r[i]=$c(s,t,p,n);return r}})}return{reducerPath:t,getSelectors:i,get selectors(){return i(r)},selectSlice:r}}const _={name:n,reducer:d,actions:o.actionCreators,caseReducers:o.sliceCaseReducersByName,getInitialState:p,...f(r),injectInto(e,{reducerPath:t,...n}={}){const i=t??r;return e.inject({reducerPath:i,reducer:d},n),{..._,...f(i,!0)}}};return _}}function $c(e,t,n,r){function i(i,...s){let o=t(i);if(void 0===o)if(r)o=n();else if("production"!==process.env.NODE_ENV)throw new Error("production"===process.env.NODE_ENV?Qc(16):"selectState returned undefined for an uninjected slice reducer");return e(o,...s)}return i.unwrapped=e,i}var Wc=Bc();function Hc(){}function Qc(e){return`Minified Redux Toolkit error #${e}; visit https://redux-toolkit.js.org/Errors?code=${e} for the full message or use the non-minified dev environment for full errors. `}var Kc=qo;function Yc(e,t){if(e===t||!(Kc(e)&&Kc(t)||Array.isArray(e)&&Array.isArray(t)))return t;const n=Object.keys(t),r=Object.keys(e);let i=n.length===r.length;const s=Array.isArray(t)?[]:{};for(const r of n)s[r]=Yc(e[r],t[r]),i&&(i=e[r]===s[r]);return i?e:s}function Gc(e){let t=0;for(const n in e)t++;return t}var Jc=e=>[].concat(...e);function Xc(e){return null!=e}var Zc=class{constructor(e,t=void 0){this.value=e,this.meta=t}},el=rc("__rtkq/focused"),tl=rc("__rtkq/unfocused"),nl=rc("__rtkq/online"),rl=rc("__rtkq/offline"),il=!1;function sl(e){return"query"===e.type}function ol(e,t,n,r,i,s){return"function"==typeof e?e(t,n,r,i).map(al).map(s):Array.isArray(e)?e.map(al).map(s):[]}function al(e){return"string"==typeof e?{type:e}:e}var cl=Symbol("forceQueryFn"),ll=e=>"function"==typeof e[cl];function ul(e){return e}function hl(e,t,n,r){return ol(n[e.meta.arg.endpointName][t],Rc(e)?e.payload:void 0,Dc(e)?e.payload:void 0,e.meta.arg.originalArgs,"baseQueryMeta"in e.meta?e.meta.baseQueryMeta:void 0,r)}function dl(e,t,n){const r=e[t];r&&n(r)}function pl(e){return("arg"in e?e.arg.fixedCacheKey:e.fixedCacheKey)??e.requestId}function fl(e,t,n){const r=e[pl(t)];r&&n(r)}var _l={};function ml({reducerPath:e,queryThunk:t,mutationThunk:n,context:{endpointDefinitions:r,apiUid:i,extractRehydrationInfo:s,hasRehydrationInfo:o},assertTagType:a,config:c}){const l=rc(`${e}/resetApiState`),u=Wc({name:`${e}/queries`,initialState:_l,reducers:{removeQueryResult:{reducer(e,{payload:{queryCacheKey:t}}){delete e[t]},prepare:vc()},queryResultPatched:{reducer(e,{payload:{queryCacheKey:t,patches:n}}){dl(e,t,(e=>{e.data=ja(e.data,n.concat())}))},prepare:vc()}},extraReducers(e){e.addCase(t.pending,((e,{meta:t,meta:{arg:n}})=>{const r=ll(n);e[n.queryCacheKey]??={status:"uninitialized",endpointName:n.endpointName},dl(e,n.queryCacheKey,(e=>{e.status="pending",e.requestId=r&&e.requestId?e.requestId:t.requestId,void 0!==n.originalArgs&&(e.originalArgs=n.originalArgs),e.startedTimeStamp=t.startedTimeStamp}))})).addCase(t.fulfilled,((e,{meta:t,payload:n})=>{dl(e,t.arg.queryCacheKey,(e=>{if(e.requestId!==t.requestId&&!ll(t.arg))return;const{merge:i}=r[t.arg.endpointName];if(e.status="fulfilled",i)if(void 0!==e.data){const{fulfilledTimeStamp:r,arg:s,baseQueryMeta:o,requestId:a}=t;let c=Ma(e.data,(e=>i(e,n,{arg:s.originalArgs,baseQueryMeta:o,fulfilledTimeStamp:r,requestId:a})));e.data=c}else e.data=n;else e.data=r[t.arg.endpointName].structuralSharing??1?Yc(Go(e.data)?(Go(s=e.data)||Ko(15,s),s[Ho].base_):e.data,n):n;var s;delete e.error,e.fulfilledTimeStamp=t.fulfilledTimeStamp}))})).addCase(t.rejected,((e,{meta:{condition:t,arg:n,requestId:r},error:i,payload:s})=>{dl(e,n.queryCacheKey,(e=>{if(t);else{if(e.requestId!==r)return;e.status="rejected",e.error=s??i}}))})).addMatcher(o,((e,t)=>{const{queries:n}=s(t);for(const[t,r]of Object.entries(n))"fulfilled"!==r?.status&&"rejected"!==r?.status||(e[t]=r)}))}}),h=Wc({name:`${e}/mutations`,initialState:_l,reducers:{removeMutationResult:{reducer(e,{payload:t}){const n=pl(t);n in e&&delete e[n]},prepare:vc()}},extraReducers(e){e.addCase(n.pending,((e,{meta:t,meta:{requestId:n,arg:r,startedTimeStamp:i}})=>{r.track&&(e[pl(t)]={requestId:n,status:"pending",endpointName:r.endpointName,startedTimeStamp:i})})).addCase(n.fulfilled,((e,{payload:t,meta:n})=>{n.arg.track&&fl(e,n,(e=>{e.requestId===n.requestId&&(e.status="fulfilled",e.data=t,e.fulfilledTimeStamp=n.fulfilledTimeStamp)}))})).addCase(n.rejected,((e,{payload:t,error:n,meta:r})=>{r.arg.track&&fl(e,r,(e=>{e.requestId===r.requestId&&(e.status="rejected",e.error=t??n)}))})).addMatcher(o,((e,t)=>{const{mutations:n}=s(t);for(const[t,r]of Object.entries(n))"fulfilled"!==r?.status&&"rejected"!==r?.status||t===r?.requestId||(e[t]=r)}))}}),d=Wc({name:`${e}/invalidation`,initialState:_l,reducers:{updateProvidedBy:{reducer(e,t){const{queryCacheKey:n,providedTags:r}=t.payload;for(const t of Object.values(e))for(const e of Object.values(t)){const t=e.indexOf(n);-1!==t&&e.splice(t,1)}for(const{type:t,id:i}of r){const r=(e[t]??={})[i||"__internal_without_id"]??=[];r.includes(n)||r.push(n)}},prepare:vc()}},extraReducers(e){e.addCase(u.actions.removeQueryResult,((e,{payload:{queryCacheKey:t}})=>{for(const n of Object.values(e))for(const e of Object.values(n)){const n=e.indexOf(t);-1!==n&&e.splice(n,1)}})).addMatcher(o,((e,t)=>{const{provided:n}=s(t);for(const[t,r]of Object.entries(n))for(const[n,i]of Object.entries(r)){const r=(e[t]??={})[n||"__internal_without_id"]??=[];for(const e of i){r.includes(e)||r.push(e)}}})).addMatcher(Tc(Rc(t),Dc(t)),((e,t)=>{const n=hl(t,"providesTags",r,a),{queryCacheKey:i}=t.meta.arg;d.caseReducers.updateProvidedBy(e,d.actions.updateProvidedBy({queryCacheKey:i,providedTags:n}))}))}}),p=Wc({name:`${e}/subscriptions`,initialState:_l,reducers:{updateSubscriptionOptions(e,t){},unsubscribeQueryResult(e,t){},internal_getRTKQSubscriptions(){}}}),f=Wc({name:`${e}/internalSubscriptions`,initialState:_l,reducers:{subscriptionsUpdated:{reducer:(e,t)=>ja(e,t.payload),prepare:vc()}}}),_=Wc({name:`${e}/config`,initialState:{online:"undefined"==typeof navigator||void 0===navigator.onLine||navigator.onLine,focused:"undefined"==typeof document||"hidden"!==document.visibilityState,middlewareRegistered:!1,...c},reducers:{middlewareRegistered(e,{payload:t}){e.middlewareRegistered="conflict"!==e.middlewareRegistered&&i===t||"conflict"}},extraReducers:e=>{e.addCase(nl,(e=>{e.online=!0})).addCase(rl,(e=>{e.online=!1})).addCase(el,(e=>{e.focused=!0})).addCase(tl,(e=>{e.focused=!1})).addMatcher(o,(e=>({...e})))}}),m=Uo({queries:u.reducer,mutations:h.reducer,provided:d.reducer,subscriptions:f.reducer,config:_.reducer});return{reducer:(e,t)=>m(l.match(t)?void 0:e,t),actions:{..._.actions,...u.actions,...p.actions,...f.actions,...h.actions,...d.actions,resetApiState:l}}}var gl=Symbol.for("RTKQ/skipToken"),yl={status:"uninitialized"},vl=Ma(yl,(()=>{})),bl=Ma(yl,(()=>{}));var wl=WeakMap?new WeakMap:void 0,Cl=({endpointName:e,queryArgs:t})=>{let n="";const r=wl?.get(t);if("string"==typeof r)n=r;else{const e=JSON.stringify(t,((e,t)=>t=qo(t="bigint"==typeof t?{$bigint:t.toString()}:t)?Object.keys(t).sort().reduce(((e,n)=>(e[n]=t[n],e)),{}):t));qo(t)&&wl?.set(t,e),n=e}return`${e}(${n})`};function El(...e){return function(t){const n=Ka((e=>t.extractRehydrationInfo?.(e,{reducerPath:t.reducerPath??"api"}))),r={reducerPath:"api",keepUnusedDataFor:60,refetchOnMountOrArgChange:!1,refetchOnFocus:!1,refetchOnReconnect:!1,invalidationBehavior:"delayed",...t,extractRehydrationInfo:n,serializeQueryArgs(e){let n=Cl;if("serializeQueryArgs"in e.endpointDefinition){const t=e.endpointDefinition.serializeQueryArgs;n=e=>{const n=t(e);return"string"==typeof n?n:Cl({...e,queryArgs:n})}}else t.serializeQueryArgs&&(n=t.serializeQueryArgs);return n(e)},tagTypes:[...t.tagTypes||[]]},i={endpointDefinitions:{},batch(e){e()},apiUid:Ac(),extractRehydrationInfo:n,hasRehydrationInfo:Ka((e=>null!=n(e)))},s={injectEndpoints:function(e){const t=e.endpoints({query:e=>({...e,type:"query"}),mutation:e=>({...e,type:"mutation"})});for(const[n,r]of Object.entries(t))if(!0!==e.overrideExisting&&n in i.endpointDefinitions){if("throw"===e.overrideExisting)throw new Error("production"===process.env.NODE_ENV?Qc(39):`called \`injectEndpoints\` to override already-existing endpointName ${n} without specifying \`overrideExisting: true\``);"undefined"!=typeof process&&"development"===process.env.NODE_ENV&&console.error(`called \`injectEndpoints\` to override already-existing endpointName ${n} without specifying \`overrideExisting: true\``)}else{i.endpointDefinitions[n]=r;for(const e of o)e.injectEndpoint(n,r)}return s},enhanceEndpoints({addTagTypes:e,endpoints:t}){if(e)for(const t of e)r.tagTypes.includes(t)||r.tagTypes.push(t);if(t)for(const[e,n]of Object.entries(t))"function"==typeof n?n(i.endpointDefinitions[e]):Object.assign(i.endpointDefinitions[e]||{},n);return s}},o=e.map((e=>e.init(s,r,i)));return s.injectEndpoints({endpoints:t.endpoints})}}function Il(e,...t){return Object.assign(e,...t)}var Tl=({api:e,queryThunk:t,internalState:n})=>{const r=`${e.reducerPath}/subscriptions`;let i=null,s=null;const{updateSubscriptionOptions:o,unsubscribeQueryResult:a}=e.internalActions,c=()=>n.currentSubscriptions,l={getSubscriptions:c,getSubscriptionCount:e=>Gc(c()[e]??{}),isRequestSubscribed:(e,t)=>{const n=c();return!!n?.[e]?.[t]}};return(c,u)=>{if(i||(i=JSON.parse(JSON.stringify(n.currentSubscriptions))),e.util.resetApiState.match(c))return i=n.currentSubscriptions={},s=null,[!0,!1];if(e.internalActions.internal_getRTKQSubscriptions.match(c))return[!1,l];const h=((n,r)=>{if(o.match(r)){const{queryCacheKey:e,requestId:t,options:i}=r.payload;return n?.[e]?.[t]&&(n[e][t]=i),!0}if(a.match(r)){const{queryCacheKey:e,requestId:t}=r.payload;return n[e]&&delete n[e][t],!0}if(e.internalActions.removeQueryResult.match(r))return delete n[r.payload.queryCacheKey],!0;if(t.pending.match(r)){const{meta:{arg:e,requestId:t}}=r,i=n[e.queryCacheKey]??={};return i[`${t}_running`]={},e.subscribe&&(i[t]=e.subscriptionOptions??i[t]??{}),!0}let i=!1;if(t.fulfilled.match(r)||t.rejected.match(r)){const e=n[r.meta.arg.queryCacheKey]||{},t=`${r.meta.requestId}_running`;i||=!!e[t],delete e[t]}if(t.rejected.match(r)){const{meta:{condition:e,arg:t,requestId:s}}=r;if(e&&t.subscribe){const e=n[t.queryCacheKey]??={};e[s]=t.subscriptionOptions??e[s]??{},i=!0}}return i})(n.currentSubscriptions,c);let d=!0;if(h){s||(s=setTimeout((()=>{const t=JSON.parse(JSON.stringify(n.currentSubscriptions)),[,r]=qa(i,(()=>t));u.next(e.internalActions.subscriptionsUpdated(r)),i=t,s=null}),500));const o="string"==typeof c.type&&!!c.type.startsWith(r),a=t.rejected.match(c)&&c.meta.condition&&!!c.meta.arg.subscribe;d=!o&&!a}return[d,!1]}};var Sl=({reducerPath:e,api:t,queryThunk:n,context:r,internalState:i})=>{const{removeQueryResult:s,unsubscribeQueryResult:o}=t.internalActions,a=Tc(o.match,n.fulfilled,n.rejected);function c(e){const t=i.currentSubscriptions[e];return!!t&&!function(e){for(const t in e)return!1;return!0}(t)}const l={};function u(e,t,n,i){const o=r.endpointDefinitions[t],a=o?.keepUnusedDataFor??i.keepUnusedDataFor;if(a===1/0)return;const u=Math.max(0,Math.min(a,2147482.647));if(!c(e)){const t=l[e];t&&clearTimeout(t),l[e]=setTimeout((()=>{c(e)||n.dispatch(s({queryCacheKey:e})),delete l[e]}),1e3*u)}}return(n,i,s)=>{if(a(n)){const t=i.getState()[e],{queryCacheKey:r}=o.match(n)?n.payload:n.meta.arg;u(r,t.queries[r]?.endpointName,i,t.config)}if(t.util.resetApiState.match(n))for(const[e,t]of Object.entries(l))t&&clearTimeout(t),delete l[e];if(r.hasRehydrationInfo(n)){const t=i.getState()[e],{queries:s}=r.extractRehydrationInfo(n);for(const[e,n]of Object.entries(s))u(e,n?.endpointName,i,t.config)}}},Nl=new Error("Promise never resolved before cacheEntryRemoved."),kl=({api:e,reducerPath:t,context:n,queryThunk:r,mutationThunk:i,internalState:s})=>{const o=Oc(r),a=Oc(i),c=Rc(r,i),l={};function u(t,r,i,s,o){const a=n.endpointDefinitions[t],c=a?.onCacheEntryAdded;if(!c)return;const u={},h=new Promise((e=>{u.cacheEntryRemoved=e})),d=Promise.race([new Promise((e=>{u.valueResolved=e})),h.then((()=>{throw Nl}))]);d.catch((()=>{})),l[i]=u;const p=e.endpoints[t].select("query"===a.type?r:i),f=s.dispatch(((e,t,n)=>n)),_={...s,getCacheEntry:()=>p(s.getState()),requestId:o,extra:f,updateCachedData:"query"===a.type?n=>s.dispatch(e.util.updateQueryData(t,r,n)):void 0,cacheDataLoaded:d,cacheEntryRemoved:h},m=c(r,_);Promise.resolve(m).catch((e=>{if(e!==Nl)throw e}))}return(n,s,h)=>{const d=function(t){if(o(t))return t.meta.arg.queryCacheKey;if(a(t))return t.meta.arg.fixedCacheKey??t.meta.requestId;return e.internalActions.removeQueryResult.match(t)?t.payload.queryCacheKey:e.internalActions.removeMutationResult.match(t)?pl(t.payload):""}(n);if(r.pending.match(n)){const e=h[t].queries[d],r=s.getState()[t].queries[d];!e&&r&&u(n.meta.arg.endpointName,n.meta.arg.originalArgs,d,s,n.meta.requestId)}else if(i.pending.match(n)){s.getState()[t].mutations[d]&&u(n.meta.arg.endpointName,n.meta.arg.originalArgs,d,s,n.meta.requestId)}else if(c(n)){const e=l[d];e?.valueResolved&&(e.valueResolved({data:n.payload,meta:n.meta.baseQueryMeta}),delete e.valueResolved)}else if(e.internalActions.removeQueryResult.match(n)||e.internalActions.removeMutationResult.match(n)){const e=l[d];e&&(delete l[d],e.cacheEntryRemoved())}else if(e.util.resetApiState.match(n))for(const[e,t]of Object.entries(l))delete l[e],t.cacheEntryRemoved()}},Pl=({api:e,context:{apiUid:t},reducerPath:n})=>(r,i)=>{e.util.resetApiState.match(r)&&i.dispatch(e.internalActions.middlewareRegistered(t)),"undefined"!=typeof process&&"development"===process.env.NODE_ENV&&e.internalActions.middlewareRegistered.match(r)&&r.payload===t&&"conflict"===i.getState()[n]?.config?.middlewareRegistered&&console.warn(`There is a mismatch between slice and middleware for the reducerPath "${n}".\nYou can only have one api per reducer path, this will lead to crashes in various situations!${"api"===n?"\nIf you have multiple apis, you *have* to specify the reducerPath option when using createApi!":""}`)},xl=({reducerPath:e,context:t,context:{endpointDefinitions:n},mutationThunk:r,queryThunk:i,api:s,assertTagType:o,refetchQuery:a,internalState:c})=>{const{removeQueryResult:l}=s.internalActions,u=Tc(Rc(r),Dc(r)),h=Tc(Rc(r,i),xc(r,i));let d=[];function p(n,r){const i=r.getState(),o=i[e];if(d.push(...n),"delayed"===o.config.invalidationBehavior&&function(e){for(const t in e.queries)if("pending"===e.queries[t]?.status)return!0;for(const t in e.mutations)if("pending"===e.mutations[t]?.status)return!0;return!1}(o))return;const u=d;if(d=[],0===u.length)return;const h=s.util.selectInvalidatedBy(i,u);t.batch((()=>{const e=Array.from(h.values());for(const{queryCacheKey:t}of e){const e=o.queries[t],n=c.currentSubscriptions[t]??{};e&&(0===Gc(n)?r.dispatch(l({queryCacheKey:t})):"uninitialized"!==e.status&&r.dispatch(a(e,t)))}}))}return(e,t)=>{u(e)?p(hl(e,"invalidatesTags",n,o),t):h(e)?p([],t):s.util.invalidateTags.match(e)&&p(ol(e.payload,void 0,void 0,void 0,void 0,o),t)}},Dl=({reducerPath:e,queryThunk:t,api:n,refetchQuery:r,internalState:i})=>{const s={};function o({queryCacheKey:t},n){const a=n.getState()[e],c=a.queries[t],u=i.currentSubscriptions[t];if(!c||"uninitialized"===c.status)return;const{lowestPollingInterval:h,skipPollingIfUnfocused:d}=l(u);if(!Number.isFinite(h))return;const p=s[t];p?.timeout&&(clearTimeout(p.timeout),p.timeout=void 0);const f=Date.now()+h;s[t]={nextPollTimestamp:f,pollingInterval:h,timeout:setTimeout((()=>{!a.config.focused&&d||n.dispatch(r(c,t)),o({queryCacheKey:t},n)}),h)}}function a({queryCacheKey:t},n){const r=n.getState()[e].queries[t],a=i.currentSubscriptions[t];if(!r||"uninitialized"===r.status)return;const{lowestPollingInterval:u}=l(a);if(!Number.isFinite(u))return void c(t);const h=s[t],d=Date.now()+u;(!h||d<h.nextPollTimestamp)&&o({queryCacheKey:t},n)}function c(e){const t=s[e];t?.timeout&&clearTimeout(t.timeout),delete s[e]}function l(e={}){let t=!1,n=Number.POSITIVE_INFINITY;for(let r in e)e[r].pollingInterval&&(n=Math.min(e[r].pollingInterval,n),t=e[r].skipPollingIfUnfocused||t);return{lowestPollingInterval:n,skipPollingIfUnfocused:t}}return(e,r)=>{(n.internalActions.updateSubscriptionOptions.match(e)||n.internalActions.unsubscribeQueryResult.match(e))&&a(e.payload,r),(t.pending.match(e)||t.rejected.match(e)&&e.meta.condition)&&a(e.meta.arg,r),(t.fulfilled.match(e)||t.rejected.match(e)&&!e.meta.condition)&&o(e.meta.arg,r),n.util.resetApiState.match(e)&&function(){for(const e of Object.keys(s))c(e)}()}},Rl=({api:e,context:t,queryThunk:n,mutationThunk:r})=>{const i=Pc(n,r),s=xc(n,r),o=Rc(n,r),a={};return(n,r)=>{if(i(n)){const{requestId:i,arg:{endpointName:s,originalArgs:o}}=n.meta,c=t.endpointDefinitions[s],l=c?.onQueryStarted;if(l){const t={},n=new Promise(((e,n)=>{t.resolve=e,t.reject=n}));n.catch((()=>{})),a[i]=t;const u=e.endpoints[s].select("query"===c.type?o:i),h=r.dispatch(((e,t,n)=>n)),d={...r,getCacheEntry:()=>u(r.getState()),requestId:i,extra:h,updateCachedData:"query"===c.type?t=>r.dispatch(e.util.updateQueryData(s,o,t)):void 0,queryFulfilled:n};l(o,d)}}else if(o(n)){const{requestId:e,baseQueryMeta:t}=n.meta;a[e]?.resolve({data:n.payload,meta:t}),delete a[e]}else if(s(n)){const{requestId:e,rejectedWithValue:t,baseQueryMeta:r}=n.meta;a[e]?.reject({error:n.payload??n.error,isUnhandledError:!t,meta:r}),delete a[e]}}};function Ol(e){const{reducerPath:t,queryThunk:n,api:r,context:i}=e,{apiUid:s}=i,o={invalidateTags:rc(`${t}/invalidateTags`)},a=e=>e.type.startsWith(`${t}/`),c=[Pl,Sl,xl,Dl,kl,Rl];return{middleware:n=>{let o=!1;const u={...e,internalState:{currentSubscriptions:{}},refetchQuery:l,isThisApiSliceAction:a},h=c.map((e=>e(u))),d=Tl(u),p=(({reducerPath:e,context:t,api:n,refetchQuery:r,internalState:i})=>{const{removeQueryResult:s}=n.internalActions;function o(n,o){const a=n.getState()[e],c=a.queries,l=i.currentSubscriptions;t.batch((()=>{for(const e of Object.keys(l)){const t=c[e],i=l[e];i&&t&&((Object.values(i).some((e=>!0===e[o]))||Object.values(i).every((e=>void 0===e[o]))&&a.config[o])&&(0===Gc(i)?n.dispatch(s({queryCacheKey:e})):"uninitialized"!==t.status&&n.dispatch(r(t,e))))}}))}return(e,t)=>{el.match(e)&&o(t,"refetchOnFocus"),nl.match(e)&&o(t,"refetchOnReconnect")}})(u);return e=>c=>{if(!Bo(c))return e(c);o||(o=!0,n.dispatch(r.internalActions.middlewareRegistered(s)));const l={...n,next:e},u=n.getState(),[f,_]=d(c,l,u);let m;if(m=f?e(c):_,n.getState()[t]&&(p(c,l,u),a(c)||i.hasRehydrationInfo(c)))for(const e of h)e(c,l,u);return m}},actions:o};function l(e,t,r={}){return n({type:"query",endpointName:e.endpointName,originalArgs:e.originalArgs,subscribe:!1,forceRefetch:!0,queryCacheKey:t,...r})}}var Al=Symbol(),Ml=El((({createSelector:e=Ga}={})=>({name:Al,init(t,{baseQuery:n,tagTypes:r,reducerPath:i,serializeQueryArgs:s,keepUnusedDataFor:o,refetchOnMountOrArgChange:a,refetchOnFocus:c,refetchOnReconnect:l,invalidationBehavior:u},h){Oa();const d=e=>("undefined"!=typeof process&&"development"===process.env.NODE_ENV&&(r.includes(e.type)||console.error(`Tag type '${e.type}' was used, but not specified in \`tagTypes\`!`)),e);Object.assign(t,{reducerPath:i,endpoints:{},internalActions:{onOnline:nl,onOffline:rl,onFocus:el,onFocusLost:tl},util:{}});const{queryThunk:p,mutationThunk:f,patchQueryData:_,updateQueryData:m,upsertQueryData:g,prefetch:y,buildMatchThunkActions:v}=function({reducerPath:e,baseQuery:t,context:{endpointDefinitions:n},serializeQueryArgs:r,api:i,assertTagType:s}){const o=async(e,{signal:r,abort:i,rejectWithValue:s,fulfillWithValue:o,dispatch:c,getState:l,extra:u})=>{const h=n[e.endpointName];try{let n,s=ul;const d={signal:r,abort:i,dispatch:c,getState:l,extra:u,endpoint:e.endpointName,type:e.type,forced:"query"===e.type?a(e,l()):void 0},p="query"===e.type?e[cl]:void 0;if(p?n=p():h.query?(n=await t(h.query(e.originalArgs),d,h.extraOptions),h.transformResponse&&(s=h.transformResponse)):n=await h.queryFn(e.originalArgs,d,h.extraOptions,(e=>t(e,d,h.extraOptions))),"undefined"!=typeof process&&"development"===process.env.NODE_ENV){const t=h.query?"`baseQuery`":"`queryFn`";let r;if(n){if("object"!=typeof n)r=`${t} did not return an object.`;else if(n.error&&n.data)r=`${t} returned an object containing both \`error\` and \`result\`.`;else if(void 0===n.error&&void 0===n.data)r=`${t} returned an object containing neither a valid \`error\` and \`result\`. At least one of them should not be \`undefined\``;else for(const e of Object.keys(n))if("error"!==e&&"data"!==e&&"meta"!==e){r=`The object returned by ${t} has the unknown property ${e}.`;break}}else r=`${t} did not return anything.`;r&&console.error(`Error encountered handling the endpoint ${e.endpointName}.\n              ${r}\n              It needs to return an object with either the shape \`{ data: <value> }\` or \`{ error: <value> }\` that may contain an optional \`meta\` property.\n              Object returned was:`,n)}if(n.error)throw new Zc(n.error,n.meta);return o(await s(n.data,n.meta,e.originalArgs),{fulfilledTimeStamp:Date.now(),baseQueryMeta:n.meta,[yc]:!0})}catch(t){let n=t;if(n instanceof Zc){let t=ul;h.query&&h.transformErrorResponse&&(t=h.transformErrorResponse);try{return s(await t(n.value,n.meta,e.originalArgs),{baseQueryMeta:n.meta,[yc]:!0})}catch(e){n=e}}throw"undefined"!=typeof process&&"production"!==process.env.NODE_ENV?console.error(`An unhandled error occurred processing a request for the endpoint "${e.endpointName}".\nIn the case of an unhandled error, no tags will be "provided" or "invalidated".`,n):console.error(n),n}};function a(t,n){const r=n[e]?.queries?.[t.queryCacheKey],i=n[e]?.config.refetchOnMountOrArgChange,s=r?.fulfilledTimeStamp,o=t.forceRefetch??(t.subscribe&&i);return!!o&&(!0===o||(Number(new Date)-Number(s))/1e3>=o)}const c=Fc(`${e}/executeQuery`,o,{getPendingMeta:()=>({startedTimeStamp:Date.now(),[yc]:!0}),condition(t,{getState:r}){const i=r(),s=i[e]?.queries?.[t.queryCacheKey],o=s?.fulfilledTimeStamp,c=t.originalArgs,l=s?.originalArgs,u=n[t.endpointName];return!(!ll(t)&&("pending"===s?.status||!a(t,i)&&(!sl(u)||!u?.forceRefetch?.({currentArg:c,previousArg:l,endpointState:s,state:i}))&&o))},dispatchConditionRejection:!0}),l=Fc(`${e}/executeMutation`,o,{getPendingMeta:()=>({startedTimeStamp:Date.now(),[yc]:!0})});function u(e){return t=>t?.meta?.arg?.endpointName===e}return{queryThunk:c,mutationThunk:l,prefetch:(e,t,n)=>(r,s)=>{const o=(e=>"force"in e)(n)&&n.force,a=(e=>"ifOlderThan"in e)(n)&&n.ifOlderThan,c=(n=!0)=>{const r={forceRefetch:n,isPrefetch:!0};return i.endpoints[e].initiate(t,r)},l=i.endpoints[e].select(t)(s());if(o)r(c());else if(a){const e=l?.fulfilledTimeStamp;if(!e)return void r(c());(Number(new Date)-Number(new Date(e)))/1e3>=a&&r(c())}else r(c(!1))},updateQueryData:(e,t,n,r=!0)=>(s,o)=>{const a=i.endpoints[e].select(t)(o()),c={patches:[],inversePatches:[],undo:()=>s(i.util.patchQueryData(e,t,c.inversePatches,r))};if("uninitialized"===a.status)return c;let l;if("data"in a)if(Jo(a.data)){const[e,t,r]=qa(a.data,n);c.patches.push(...t),c.inversePatches.push(...r),l=e}else l=n(a.data),c.patches.push({op:"replace",path:[],value:l}),c.inversePatches.push({op:"replace",path:[],value:a.data});return 0===c.patches.length||s(i.util.patchQueryData(e,t,c.patches,r)),c},upsertQueryData:(e,t,n)=>r=>r(i.endpoints[e].initiate(t,{subscribe:!1,forceRefetch:!0,[cl]:()=>({data:n})})),patchQueryData:(e,t,o,a)=>(c,l)=>{const u=n[e],h=r({queryArgs:t,endpointDefinition:u,endpointName:e});if(c(i.internalActions.queryResultPatched({queryCacheKey:h,patches:o})),!a)return;const d=i.endpoints[e].select(t)(l()),p=ol(u.providesTags,d.data,void 0,t,{},s);c(i.internalActions.updateProvidedBy({queryCacheKey:h,providedTags:p}))},buildMatchThunkActions:function(e,t){return{matchPending:Sc(Pc(e),u(t)),matchFulfilled:Sc(Rc(e),u(t)),matchRejected:Sc(xc(e),u(t))}}}}({baseQuery:n,reducerPath:i,context:h,api:t,serializeQueryArgs:s,assertTagType:d}),{reducer:b,actions:w}=ml({context:h,queryThunk:p,mutationThunk:f,reducerPath:i,assertTagType:d,config:{refetchOnFocus:c,refetchOnReconnect:l,refetchOnMountOrArgChange:a,keepUnusedDataFor:o,reducerPath:i,invalidationBehavior:u}});Il(t.util,{patchQueryData:_,updateQueryData:m,upsertQueryData:g,prefetch:y,resetApiState:w.resetApiState}),Il(t.internalActions,w);const{middleware:C,actions:E}=Ol({reducerPath:i,context:h,queryThunk:p,mutationThunk:f,api:t,assertTagType:d});Il(t.util,E),Il(t,{reducer:b,middleware:C});const{buildQuerySelector:I,buildMutationSelector:T,selectInvalidatedBy:S,selectCachedArgsForQuery:N}=function({serializeQueryArgs:e,reducerPath:t,createSelector:n}){const r=e=>vl,i=e=>bl;return{buildQuerySelector:function(t,i){return a=>{const c=e({queryArgs:a,endpointDefinition:i,endpointName:t});return n(a===gl?r:e=>o(e)?.queries?.[c]??vl,s)}},buildMutationSelector:function(){return e=>{let t;return t="object"==typeof e?pl(e)??gl:e,n(t===gl?i:e=>o(e)?.mutations?.[t]??bl,s)}},selectInvalidatedBy:function(e,n){const r=e[t],i=new Set;for(const e of n.map(al)){const t=r.provided[e.type];if(!t)continue;let n=(void 0!==e.id?t[e.id]:Jc(Object.values(t)))??[];for(const e of n)i.add(e)}return Jc(Array.from(i.values()).map((e=>{const t=r.queries[e];return t?[{queryCacheKey:e,endpointName:t.endpointName,originalArgs:t.originalArgs}]:[]})))},selectCachedArgsForQuery:function(e,n){return Object.values(e[t].queries).filter((e=>e?.endpointName===n&&"uninitialized"!==e.status)).map((e=>e.originalArgs))}};function s(e){return{...e,...(t=e.status,{status:t,isUninitialized:"uninitialized"===t,isLoading:"pending"===t,isSuccess:"fulfilled"===t,isError:"rejected"===t})};var t}function o(e){const n=e[t];if("production"!==process.env.NODE_ENV&&!n){if(o.triggered)return n;o.triggered=!0,console.error(`Error: No data found at \`state.${t}\`. Did you forget to add the reducer to the store?`)}return n}}({serializeQueryArgs:s,reducerPath:i,createSelector:e});Il(t.util,{selectInvalidatedBy:S,selectCachedArgsForQuery:N});const{buildInitiateQuery:k,buildInitiateMutation:P,getRunningMutationThunk:x,getRunningMutationsThunk:D,getRunningQueriesThunk:R,getRunningQueryThunk:O}=function({serializeQueryArgs:e,queryThunk:t,mutationThunk:n,api:r,context:i}){const s=new Map,o=new Map,{unsubscribeQueryResult:a,removeMutationResult:c,updateSubscriptionOptions:l}=r.internalActions;return{buildInitiateQuery:function(n,i){const o=(c,{subscribe:h=!0,forceRefetch:d,subscriptionOptions:p,[cl]:f,..._}={})=>(m,g)=>{const y=e({queryArgs:c,endpointDefinition:i,endpointName:n}),v=t({..._,type:"query",subscribe:h,forceRefetch:d,subscriptionOptions:p,endpointName:n,originalArgs:c,queryCacheKey:y,[cl]:f}),b=r.endpoints[n].select(c),w=m(v),C=b(g());u(m);const{requestId:E,abort:I}=w,T=C.requestId!==E,S=s.get(m)?.[y],N=()=>b(g()),k=Object.assign(f?w.then(N):T&&!S?Promise.resolve(C):Promise.all([S,w]).then(N),{arg:c,requestId:E,subscriptionOptions:p,queryCacheKey:y,abort:I,async unwrap(){const e=await k;if(e.isError)throw e.error;return e.data},refetch:()=>m(o(c,{subscribe:!1,forceRefetch:!0})),unsubscribe(){h&&m(a({queryCacheKey:y,requestId:E}))},updateSubscriptionOptions(e){k.subscriptionOptions=e,m(l({endpointName:n,requestId:E,queryCacheKey:y,options:e}))}});if(!S&&!T&&!f){const e=s.get(m)||{};e[y]=k,s.set(m,e),k.then((()=>{delete e[y],Gc(e)||s.delete(m)}))}return k};return o},buildInitiateMutation:function(e){return(t,{track:r=!0,fixedCacheKey:i}={})=>(s,a)=>{const l=n({type:"mutation",endpointName:e,originalArgs:t,track:r,fixedCacheKey:i}),h=s(l);u(s);const{requestId:d,abort:p,unwrap:f}=h,_=(m=e=>({error:e}),h.unwrap().then((e=>({data:e}))).catch(m));var m;const g=Object.assign(_,{arg:h.arg,requestId:d,abort:p,unwrap:f,reset:()=>{s(c({requestId:d,fixedCacheKey:i}))}}),y=o.get(s)||{};return o.set(s,y),y[d]=g,g.then((()=>{delete y[d],Gc(y)||o.delete(s)})),i&&(y[i]=g,g.then((()=>{y[i]===g&&(delete y[i],Gc(y)||o.delete(s))}))),g}},getRunningQueryThunk:function(t,n){return r=>{const o=i.endpointDefinitions[t],a=e({queryArgs:n,endpointDefinition:o,endpointName:t});return s.get(r)?.[a]}},getRunningMutationThunk:function(e,t){return e=>o.get(e)?.[t]},getRunningQueriesThunk:function(){return e=>Object.values(s.get(e)||{}).filter(Xc)},getRunningMutationsThunk:function(){return e=>Object.values(o.get(e)||{}).filter(Xc)}};function u(e){if("production"!==process.env.NODE_ENV){if(u.triggered)return;const t=e(r.internalActions.internal_getRTKQSubscriptions());if(u.triggered=!0,"object"!=typeof t||"string"==typeof t?.type)throw new Error("production"===process.env.NODE_ENV?Qc(34):`Warning: Middleware for RTK-Query API at reducerPath "${r.reducerPath}" has not been added to the store.\nYou must add the middleware for RTK-Query to function correctly!`)}}}({queryThunk:p,mutationThunk:f,api:t,serializeQueryArgs:s,context:h});return Il(t.util,{getRunningMutationThunk:x,getRunningMutationsThunk:D,getRunningQueryThunk:O,getRunningQueriesThunk:R}),{name:Al,injectEndpoint(e,n){const r=t;r.endpoints[e]??={},sl(n)?Il(r.endpoints[e],{name:e,select:I(e,n),initiate:k(e,n)},v(p,e)):"mutation"===n.type&&Il(r.endpoints[e],{name:e,select:T(),initiate:P(e)},v(f,e))}}}}))());const ql=document.getElementById("useremailform"),jl=document.getElementById("useremail"),Ll=document.getElementById("saveemail"),Fl=document.getElementById("buttongroup"),Vl=document.getElementById("savenotebutton"),Ul=document.getElementById("noteid"),zl=document.getElementById("chapter"),Bl=document.getElementById("section"),$l=document.getElementById("paragraph"),Wl=document.getElementById("sentence"),Hl=document.getElementById("url"),Ql=document.getElementById("mynote"),Kl=document.getElementById("comment"),Yl=document.getElementById("newnotebutton"),Gl=document.getElementById("documentbutton"),Jl=document.getElementById("templatesbutton"),Xl=document.getElementById("editbutton"),Zl=document.getElementById("documentview"),eu=document.getElementById("newnoteview"),tu=document.getElementById("templateview"),nu=document.getElementById("editview");let ru=He({apiKey:"AIzaSyDUamZR2aXuP2rFG1AFpb1Ni8aZA5uhSj4",authDomain:"fincalculations.firebaseapp.com",databaseURL:"https://fincalculations.firebaseio.com",projectId:"fincalculations",storageBucket:"fincalculations.appspot.com",messagingSenderId:"892270777573",appId:"1:892270777573:web:bdc13e9b47334b4319700c"});console.log(ru);const iu=function(e=function(e=je){const t=Fe.get(e);if(!t&&e===je&&_())return He();if(!t)throw $e.create("no-app",{appName:e});return t}(),t){const n=function(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}(e,"database").getImmediate({identifier:t});if(!n._instanceStarted){const e=f("database");e&&function(e,t,n,r={}){e=A(e),e._checkNotDeleted("useEmulator"),e._instanceStarted&&Et("Cannot call useEmulator() after instance has already been initialized.");const i=e._repoInternal;let s;if(i.repoInfo_.nodeAdmin)r.mockUserToken&&Et('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),s=new Ut(Ut.OWNER);else if(r.mockUserToken){const t="string"==typeof r.mockUserToken?r.mockUserToken:function(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const s=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[c(JSON.stringify({alg:"none",type:"JWT"})),c(JSON.stringify(s)),""].join(".")}(r.mockUserToken,e.app.options.projectId);s=new Ut(t)}!function(e,t,n,r){e.repoInfo_=new Ht(`${t}:${n}`,!1,e.repoInfo_.namespace,e.repoInfo_.webSocketOnly,e.repoInfo_.nodeAdmin,e.repoInfo_.persistenceKey,e.repoInfo_.includeNamespaceInQueryParams,!0),r&&(e.authTokenProvider_=r)}(i,t,n,s)}(n,...e)}return n}();async function su({url:e="crafts/temp_gmail_com/posts/-Ml6DEjYhdnjuW6HiHB7",type:t="array"}){try{let n=await Io(wo(iu,e));if(n.exists()){let e=n.val();return"array"===t?Object.keys(e).map((t=>e[t])):e}return"array"===t?[]:null}catch(e){return console.log(e),"array"===t?[]:{}}}console.log(iu);async function ou(e={temp:"temp"}){try{return console.log(e),await Eo(wo(iu),e),e}catch(e){return console.error(e),e}}function au(e){return function(e,t){e=A(e),js("push",e._path),Rs("push",t,e._path);const n=Qs(e._repo),r=fo(n),i=Co(e,r),s=Co(e,r);let o;return o=Promise.resolve(s),i.then=o.then.bind(o),i.catch=o.then.bind(o,void 0),i}(Co(wo(iu),e+"/")).key}const cu=Ml({reducerPath:"api",tagTypes:["Task","Note","UserEmail"],baseQuery:function(){throw new Error("production"===process.env.NODE_ENV?Qc(33):"When using `fakeBaseQuery`, all queries & mutations must use the `queryFn` definition syntax.")},endpoints:e=>({fetchUserEmail:e.query({async queryFn(){try{let e=await(()=>{try{const e=localStorage.getItem("econolabs");if(null===e)return;return JSON.parse(e)}catch(e){return}})();return console.log(e),{data:e?e?.email.replace(/[^a-zA-Z0-9]/g,"_"):null}}catch(e){return console.log(e),{data:null,error:e}}},providesTags:"UserEmail"}),updateUserEmail:e.mutation({queryFn:async e=>((e=>{try{const t=JSON.stringify(e);console.log(t),localStorage.setItem("econolabs",t)}catch(e){console.log(e)}})({email:e}),e),invalidatesTags:["UserEmail"]}),fetchUserNotes:e.query({async queryFn(e){try{return{data:await su({url:"usersCraft/"+e+"/notes",type:"array"})}}catch(e){return console.log(e),{error:e}}},providesTags:(e,t,n)=>[{type:"Note",id:n}]}),fetchUserBooks:e.query({async queryFn(e){try{return{data:await su({url:"usersCraft/"+e+"/books/default",type:"array"})}}catch(e){return console.log(e),{error:e}}},providesTags:(e,t,n)=>[{type:"Note",id:n}]}),fetchOpenMediaTasks:e.query({async queryFn(e){try{let t=await su({url:"usersCraft/"+e+"/tasks",type:"array"});console.log(t);let n=await async function(e){console.log(e);let t=[];for(const n of e)for(const e of Object.keys(n.templates))(await su({url:"openmediadata/"+e,type:"object"})).paragraphs.forEach(((r,i)=>{let s=i>9?""+i:"0"+i;t.push({id:e+"___"+n?.chapter+n?.section+n?.paragraph+s,title:n.templates[e]?.title+n?.chapter+n?.section+n?.paragraph+s,content:r,chapter:n?.chapter,section:n?.section,paragraph:n?.paragraph,sentence:s,templatetitle:n.templates[e]?.title,templatecomment:n.templates[e]?.comment})}));return t}(t);return{data:n}}catch(e){return console.log(e),{data:[],error:e}}},providesTags:(e,t,n)=>[{type:"Task",id:n}]}),updateUserNotes:e.mutation({async queryFn({base:e="openavatars",updates:t={temp_google_com:{id:"temp_google_com",avatarUrl:"https://images.unsplash.com/photo-1438761681033-6461ffad8d80?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3wxODU2NzR8MHwxfGNvbGxlY3Rpb258MjB8YUg5OGRoZWI1ME18fHx8fDJ8fDE3MDAxMzYxMjN8&ixlib=rb-4.0.3&q=80&w=200",user:"Ha Ha"}}}){let n={};Object.keys(t).forEach((r=>{n[e+"/"+r]=t[r]})),console.log(n);try{await ou(n)}catch(e){return console.log(e),{error:e}}return{updates:n}},invalidatesTags:["Note"]}),updateUserTasks:e.mutation({async queryFn({base:e="openavatars",updates:t={temp_google_com:{id:"temp_google_com",avatarUrl:"https://images.unsplash.com/photo-1438761681033-6461ffad8d80?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3wxODU2NzR8MHwxfGNvbGxlY3Rpb258MjB8YUg5OGRoZWI1ME18fHx8fDJ8fDE3MDAxMzYxMjN8&ixlib=rb-4.0.3&q=80&w=200",user:"Ha Ha"}}}){let n={};Object.keys(t).forEach((r=>{n[e+"/"+r]=t[r]})),console.log(n);try{await ou(n)}catch(e){return console.log(e),{error:e}}return{updates:n}},invalidatesTags:["Task"]})})}),lu=function(e){const t=gc(),{reducer:n,middleware:r,devTools:i=!0,preloadedState:s,enhancers:o}=e||{};let a,c;if("function"==typeof n)a=n;else{if(!qo(n))throw new Error("production"===process.env.NODE_ENV?Qc(1):"`reducer` is a required argument, and must be a function or an object of functions that can be passed to combineReducers");a=Uo(n)}if("production"!==process.env.NODE_ENV&&r&&"function"!=typeof r)throw new Error("production"===process.env.NODE_ENV?Qc(2):"`middleware` field must be a callback");if("function"==typeof r){if(c=r(t),"production"!==process.env.NODE_ENV&&!Array.isArray(c))throw new Error("production"===process.env.NODE_ENV?Qc(3):"when using a middleware builder function, an array of middleware must be returned")}else c=t();if("production"!==process.env.NODE_ENV&&c.some((e=>"function"!=typeof e)))throw new Error("production"===process.env.NODE_ENV?Qc(4):"each middleware provided to configureStore must be a function");let l=zo;i&&(l=tc({trace:"production"!==process.env.NODE_ENV,..."object"==typeof i&&i}));const u=function(...e){return t=>(n,r)=>{const i=t(n,r);let s=()=>{throw new Error("production"===process.env.NODE_ENV?Ro(15):"Dispatching while constructing your middleware is not allowed. Other middleware would not be applied to this dispatch.")};const o={getState:i.getState,dispatch:(e,...t)=>s(e,...t)},a=e.map((e=>e(o)));return s=zo(...a)(i.dispatch),{...i,dispatch:s}}}(...c),h=Cc(u);if("production"!==process.env.NODE_ENV&&o&&"function"!=typeof o)throw new Error("production"===process.env.NODE_ENV?Qc(5):"`enhancers` field must be a callback");let d="function"==typeof o?o(h):h();if("production"!==process.env.NODE_ENV&&!Array.isArray(d))throw new Error("production"===process.env.NODE_ENV?Qc(6):"`enhancers` callback must return an array");if("production"!==process.env.NODE_ENV&&d.some((e=>"function"!=typeof e)))throw new Error("production"===process.env.NODE_ENV?Qc(7):"each enhancer provided to configureStore must be a function");return"production"!==process.env.NODE_ENV&&c.length&&!d.includes(u)&&console.error("middlewares were provided, but middleware enhancer was not included in final enhancers - make sure to call `getDefaultEnhancers`"),Fo(a,s,l(...d))}({reducer:{[cu.reducerPath]:cu.reducer},middleware:e=>e().concat(cu.middleware)});var uu;let hu,du,pu;uu=lu.dispatch,function(){const e=()=>uu(el()),t=()=>uu(nl()),n=()=>uu(rl()),r=()=>{"visible"===window.document.visibilityState?e():uu(tl())};il||"undefined"!=typeof window&&window.addEventListener&&(window.addEventListener("visibilitychange",r,!1),window.addEventListener("focus",e,!1),window.addEventListener("online",t,!1),window.addEventListener("offline",n,!1),il=!0)}();const fu=(_u=function(e){let{data:t}=pu,n=e.target.id,r=e.target.id;lu.dispatch(cu.endpoints.updateUserNotes.initiate({base:"usersCraft/"+t,updates:{["notes/"+r]:{id:r,chapter:r.substring(0,2),section:r.substring(2,2),paragraph:r.substring(4,2),sentence:r.substring(6,2),comment:e.target.id,orderby:n,content:e.target.value},["books/default/"+n]:e.target.value}})).then((e=>{console.log("Done ")}))},mu=1500,function(...e){let t=this.lastCall;this.lastCall=Date.now(),t&&this.lastCall-t<=mu&&clearTimeout(this.lastCallTimer),this.lastCallTimer=setTimeout((()=>_u(...e)),mu)});var _u,mu;function gu(e){let{data:t}=hu,n=t.find((t=>t.id===e.target.id));console.log(n),zl.value=n.chapter,Bl.value=n.section,$l.value=n.paragraph,Wl.value=n.sentence,Hl.value=n.url,Ql.value=n.content,Ul.innerText=n.id,nu.style.display="none",Xl.classList="btn btn-outline-secondary",nu.innerHTML="",Yl.classList="btn btn-outline-secondary",eu.style.display="block"}function yu(e){let{data:t}=hu,{data:n}=pu,r=t.find((t=>t.id===e.target.id));lu.dispatch(cu.endpoints.updateUserNotes.initiate({base:"usersCraft/"+n,updates:{["notes/"+e.target.id]:null,["books/default/"+r.orderby]:null}})).then((()=>window.location.reload()))}Vl.addEventListener("click",(function(){let{data:e}=pu;Vl.disabled=!0;let t=Ul.innerText.length>0?Ul.innerText:au(["usersCraft/"+e+"/notes"]),n=("0"+Number(zl.value)).slice(-2)+("0"+Number(Bl.value)).slice(-2)+("0"+Number($l.value)).slice(-2)+("0"+Number(Wl.value)).slice(-2);lu.dispatch(cu.endpoints.updateUserNotes.initiate({base:"usersCraft/"+e,updates:{["notes/"+t]:{id:t,chapter:zl.value,section:Bl.value,paragraph:$l.value,sentence:Wl.value,content:Ql.value,comment:Kl.value?.value&&Kl.value?.value.length>0?Kl.value.value:n,orderby:n,url:Hl.value},["books/default/"+n]:Kl.value?.value&&Kl.value?.value.length>0?Kl.value.value:n}})).then((e=>{Ul.innerText=t,Vl.disabled=!1,console.log("Done ")}))}),!1),Gl.addEventListener("click",(function(){eu.style.display="none",Yl.classList="btn btn-outline-secondary",Jl.classList="btn btn-outline-secondary",tu.style.display="none",Xl.classList="btn btn-outline-secondary",nu.style.display="none",Gl.classList="btn btn-outline-primary";let{data:e}=hu,t=[...e].sort(((e,t)=>e.orderby.localeCompare(t.orderby))).map((e=>(console.log(e),`\n            <div class="card shadow m-1">\n                <div class="card-body">\n                    <div class="row">                                 \n                        <div class="col-xs-12 col-md-4 col-lg-1">\n                          <small class="text-muted">${e?.orderby}</small>                         \n                        </div>\n                        <div class="col-xs-12 col-md-8 col-lg-11">\n                            <div style="margin: auto;">${e?.content}</div>\n                        </div>                        \n                    </div>    \n                </div>\n            </div>`))).join("");Zl.innerHTML=t,Zl.style.display="block"}),!1),Yl.addEventListener("click",(function(){Zl.innerHTML="",Jl.classList="btn btn-outline-secondary",tu.style.display="none",Gl.classList="btn btn-outline-secondary",Zl.style.display="none",Xl.classList="btn btn-outline-secondary",nu.style.display="none",zl.value="",Bl.value="",$l.value="",Wl.value="",Hl.value="",Ql.value="",Ul.innerText="",Yl.classList="btn btn-outline-secondary",eu.style.display="block"}),!1),Jl.addEventListener("click",(function(){Zl.innerHTML="",Zl.style.display="none",Gl.classList="btn btn-outline-secondary",eu.style.display="none",Yl.classList="btn btn-outline-secondary",Xl.classList="btn btn-outline-secondary",nu.style.display="none",Jl.classList="btn btn-outline-primary";let{data:e}=du,t=e.map((e=>{let t=e?.id?e?.id.split("___")[1]:"xxx";return`\n            <div class="card shadow m-1">\n            <div class="card-header">\n            ${e?.title}\n  </div>\n                <div class="card-body">\n                    <div class="row">                                 \n                        <div class="col-xs-12 col-lg-6">\n                            <div class="input-group">\n                              <span class="input-group-text"> </span>\n                              <textarea  class="form-control updatesentence" aria-label="With textarea" id=${t} ></textarea>\n                            </div>\n                        </div>\n                        <div class="col-xs-12 col-lg-6">\n                         <small class="text-muted" style="width: 100%">${e?.content}</small>\n                        </div>                        \n                    </div>    \n                    <small class="text-muted" style="width: 100%">${t}</small>\n                </div>\n            </div>`})).join("");tu.innerHTML=t;for(var n=0;n<document.getElementsByClassName("updatesentence").length;n++)document.getElementsByClassName("updatesentence")[n].addEventListener("input",fu);tu.style.display="block"}),!1),Xl.addEventListener("click",(function(){Zl.innerHTML="",Jl.classList="btn btn-outline-secondary",tu.style.display="none",Gl.classList="btn btn-outline-secondary",Zl.style.display="none",Yl.classList="btn btn-outline-secondary",eu.style.display="none",Xl.classList="btn btn-outline-primary";let{data:e}=hu;console.log(e);let t=e.map((e=>`\n            <div class="card shadow m-1">\n                <div class="card-body">\n                     <div class="row">                                 \n                        <div class="col-xs-12 col-md-4 col-lg-1">\n                          <small class="text-muted">${e?.orderby}</small>                         \n                        </div>\n                        <div class="col-xs-12 col-md-8 col-lg-11">\n                            <div style="margin: auto;">${e?.content}</div>\n                        </div>                        \n                    </div>    \n                    <button type="button" class="btn btn-outline-secondary btn-sm editnote" id="${e?.id}"></button> \n                    <button type="button" class="btn btn-outline-danger btn-sm deletenote" id="${e?.id}"></button>  \n                </div>\n            </div>`)).join("");nu.innerHTML=t;for(var n=0;n<document.getElementsByClassName("editnote").length;n++)document.getElementsByClassName("editnote")[n].addEventListener("click",gu);for(n=0;n<document.getElementsByClassName("deletenote").length;n++)document.getElementsByClassName("deletenote")[n].addEventListener("click",yu);nu.style.display="block"}),!1),Ll.addEventListener("click",(function(e){e.preventDefault(),lu.dispatch(cu.endpoints.updateUserEmail.initiate(jl.value)).then((e=>{console.log(e),window.location.reload()}))}),!1),async function(){return pu=await lu.dispatch(cu.endpoints.fetchUserEmail.initiate()),pu.data?(ql.style.display="none",Fl.style.display="none",eu.style.display="none",hu=await lu.dispatch(cu.endpoints.fetchUserNotes.initiate(pu.data)),await lu.dispatch(cu.endpoints.fetchUserBooks.initiate(pu.data)),du=await lu.dispatch(cu.endpoints.fetchOpenMediaTasks.initiate(pu.data)),Fl.style.display="block",eu.style.display="block"):(console.log("Need Ident"),eu.style.display="none",Fl.style.display="none",ql.style.display="block"),!0}().then((e=>console.log(e))),lu.subscribe((()=>{console.log(lu.getState())}))}();
