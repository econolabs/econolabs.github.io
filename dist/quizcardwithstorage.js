!function(){"use strict";!function(){const e={NODE_ENV:"production"};try{if(process)return process.env=Object.assign({},process.env),void Object.assign(process.env,e)}catch(e){}globalThis.process={env:e}}();const e=document.querySelector.bind(document);const t=document.querySelector.bind(document);var n="object"==typeof global&&global&&global.Object===Object&&global,r="object"==typeof self&&self&&self.Object===Object&&self,i=n||r||Function("return this")(),s=i.Symbol,o=Object.prototype,a=o.hasOwnProperty,c=o.toString,l=s?s.toStringTag:void 0;var u=Object.prototype.toString;var h=s?s.toStringTag:void 0;function d(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":h&&h in Object(e)?function(e){var t=a.call(e,l),n=e[l];try{e[l]=void 0;var r=!0}catch(e){}var i=c.call(e);return r&&(t?e[l]=n:delete e[l]),i}(e):function(e){return u.call(e)}(e)}var p=/\s/;var f=/^\s+/;function m(e){return e?e.slice(0,function(e){for(var t=e.length;t--&&p.test(e.charAt(t)););return t}(e)+1).replace(f,""):e}function _(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}var g=/^[-+]0x[0-9a-f]+$/i,y=/^0b[01]+$/i,v=/^0o[0-7]+$/i,b=parseInt;function w(e){if("number"==typeof e)return e;if(function(e){return"symbol"==typeof e||function(e){return null!=e&&"object"==typeof e}(e)&&"[object Symbol]"==d(e)}(e))return NaN;if(_(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=_(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=m(e);var n=y.test(e);return n||v.test(e)?b(e.slice(2),n?2:8):g.test(e)?NaN:+e}var C=function(){return i.Date.now()},E=Math.max,S=Math.min;function T(e,t,n){var r,i,s,o,a,c,l=0,u=!1,h=!1,d=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function p(t){var n=r,s=i;return r=i=void 0,l=t,o=e.apply(s,n)}function f(e){var n=e-c;return void 0===c||n>=t||n<0||h&&e-l>=s}function m(){var e=C();if(f(e))return g(e);a=setTimeout(m,function(e){var n=t-(e-c);return h?S(n,s-(e-l)):n}(e))}function g(e){return a=void 0,d&&r?p(e):(r=i=void 0,o)}function y(){var e=C(),n=f(e);if(r=arguments,i=this,c=e,n){if(void 0===a)return function(e){return l=e,a=setTimeout(m,t),u?p(e):o}(c);if(h)return clearTimeout(a),a=setTimeout(m,t),p(c)}return void 0===a&&(a=setTimeout(m,t)),o}return t=w(t)||0,_(n)&&(u=!!n.leading,s=(h="maxWait"in n)?E(w(n.maxWait)||0,t):s,d="trailing"in n?!!n.trailing:d),y.cancel=function(){void 0!==a&&clearTimeout(a),l=0,r=c=i=a=void 0},y.flush=function(){return void 0===a?o:g(C())},y}const I=!1,N="${JSCORE_VERSION}",k=function(e,t){if(!e)throw P(t)},P=function(e){return new Error("Firebase Database ("+N+") INTERNAL ASSERT FAILED: "+e)},x=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296==(64512&i)&&r+1<e.length&&56320==(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},O={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let t=0;t<e.length;t+=3){const i=e[t],s=t+1<e.length,o=s?e[t+1]:0,a=t+2<e.length,c=a?e[t+2]:0,l=i>>2,u=(3&i)<<4|o>>4;let h=(15&o)<<2|c>>6,d=63&c;a||(d=64,s||(h=64)),r.push(n[l],n[u],n[h],n[d])}return r.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(x(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,r=0;for(;n<e.length;){const i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const s=((7&i)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(s>>10)),t[r++]=String.fromCharCode(56320+(1023&s))}else{const s=e[n++],o=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let t=0;t<e.length;){const i=n[e.charAt(t++)],s=t<e.length?n[e.charAt(t)]:0;++t;const o=t<e.length?n[e.charAt(t)]:64;++t;const a=t<e.length?n[e.charAt(t)]:64;if(++t,null==i||null==s||null==o||null==a)throw new D;const c=i<<2|s>>4;if(r.push(c),64!==o){const e=s<<4&240|o>>2;if(r.push(e),64!==a){const e=o<<6&192|a;r.push(e)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class D extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const R=function(e){const t=x(e);return O.encodeByteArray(t,!0)},A=function(e){return R(e).replace(/\./g,"")},q=function(e){try{return O.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function M(e){return j(void 0,e)}function j(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(const n in t)t.hasOwnProperty(n)&&"__proto__"!==n&&(e[n]=j(e[n],t[n]));return e}const F=()=>function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__,L=()=>{try{return F()||(()=>{if("undefined"==typeof process||void 0===process.env)return;const e=process.env.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}const t=e&&q(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},z=e=>{const t=(e=>{var t,n;return null===(n=null===(t=L())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]})(e);if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const r=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),r]:[t.substring(0,n),r]},$=()=>{var e;return null===(e=L())||void 0===e?void 0:e.config};class V{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,n))}}}function U(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test("undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:"")}function W(){return!0===I}class B extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,B.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,H.prototype.create)}}class H{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},r=`${this.service}/${e}`,i=this.errors[e],s=i?function(e,t){return e.replace(Q,((e,n)=>{const r=t[n];return null!=r?String(r):`<${n}?>`}))}(i,n):"Error",o=`${this.serviceName}: ${s} (${r}).`;return new B(r,o,n)}}const Q=/\{\$([^}]+)}/g;function K(e){return JSON.parse(e)}function Y(e){return JSON.stringify(e)}const G=function(e){let t={},n={},r={},i="";try{const s=e.split(".");t=K(q(s[0])||""),n=K(q(s[1])||""),i=s[2],r=n.d||{},delete n.d}catch(e){}return{header:t,claims:n,data:r,signature:i}};function J(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function X(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0}function Z(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function ee(e,t,n){const r={};for(const i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=t.call(n,e[i],i,e));return r}function te(e,t){if(e===t)return!0;const n=Object.keys(e),r=Object.keys(t);for(const i of n){if(!r.includes(i))return!1;const n=e[i],s=t[i];if(ne(n)&&ne(s)){if(!te(n,s))return!1}else if(n!==s)return!1}for(const e of r)if(!n.includes(e))return!1;return!0}function ne(e){return null!==e&&"object"==typeof e}class re{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const n=this.W_;if("string"==typeof e)for(let r=0;r<16;r++)n[r]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let r=0;r<16;r++)n[r]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let e=16;e<80;e++){const t=n[e-3]^n[e-8]^n[e-14]^n[e-16];n[e]=4294967295&(t<<1|t>>>31)}let r,i,s=this.chain_[0],o=this.chain_[1],a=this.chain_[2],c=this.chain_[3],l=this.chain_[4];for(let e=0;e<80;e++){e<40?e<20?(r=c^o&(a^c),i=1518500249):(r=o^a^c,i=1859775393):e<60?(r=o&a|c&(o|a),i=2400959708):(r=o^a^c,i=3395469782);const t=(s<<5|s>>>27)+r+l+i+n[e]&4294967295;l=c,c=a,a=4294967295&(o<<30|o>>>2),o=s,s=t}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+o&4294967295,this.chain_[2]=this.chain_[2]+a&4294967295,this.chain_[3]=this.chain_[3]+c&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295}update(e,t){if(null==e)return;void 0===t&&(t=e.length);const n=t-this.blockSize;let r=0;const i=this.buf_;let s=this.inbuf_;for(;r<t;){if(0===s)for(;r<=n;)this.compress_(e,r),r+=this.blockSize;if("string"==typeof e){for(;r<t;)if(i[s]=e.charCodeAt(r),++s,++r,s===this.blockSize){this.compress_(i),s=0;break}}else for(;r<t;)if(i[s]=e[r],++s,++r,s===this.blockSize){this.compress_(i),s=0;break}}this.inbuf_=s,this.total_+=t}digest(){const e=[];let t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let e=this.blockSize-1;e>=56;e--)this.buf_[e]=255&t,t/=256;this.compress_(this.buf_);let n=0;for(let t=0;t<5;t++)for(let r=24;r>=0;r-=8)e[n]=this.chain_[t]>>r&255,++n;return e}}function ie(e,t){return`${e} failed: ${t} argument `}const se=function(e){let t=0;for(let n=0;n<e.length;n++){const r=e.charCodeAt(n);r<128?t++:r<2048?t+=2:r>=55296&&r<=56319?(t+=4,n++):t+=3}return t};function oe(e){return e&&e._delegate?e._delegate:e}class ae{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const ce="[DEFAULT]";class le{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new V;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),r=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(r)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:ce})}catch(e){}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=ce){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}isComponentSet(){return null!=this.component}isInitialized(e=ce){return this.instances.has(e)}getOptions(e=ce){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[e,t]of this.instancesDeferred.entries()){n===this.normalizeInstanceIdentifier(e)&&t.resolve(r)}return r}onInit(e,t){var n;const r=this.normalizeInstanceIdentifier(t),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(e),this.onInitCallbacks.set(r,i);const s=this.instances.get(r);return s&&e(s,r),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const r of n)try{r(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e,r===ce?void 0:r),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}var r;return n||null}normalizeInstanceIdentifier(e=ce){return this.component?this.component.multipleInstances?e:ce:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class ue{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new le(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}var he;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(he||(he={}));const de={debug:he.DEBUG,verbose:he.VERBOSE,info:he.INFO,warn:he.WARN,error:he.ERROR,silent:he.SILENT},pe=he.INFO,fe={[he.DEBUG]:"log",[he.VERBOSE]:"log",[he.INFO]:"info",[he.WARN]:"warn",[he.ERROR]:"error"},me=(e,t,...n)=>{if(t<e.logLevel)return;const r=(new Date).toISOString(),i=fe[t];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[i](`[${r}]  ${e.name}:`,...n)};class _e{constructor(e){this.name=e,this._logLevel=pe,this._logHandler=me,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in he))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?de[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,he.DEBUG,...e),this._logHandler(this,he.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,he.VERBOSE,...e),this._logHandler(this,he.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,he.INFO,...e),this._logHandler(this,he.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,he.WARN,...e),this._logHandler(this,he.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,he.ERROR,...e),this._logHandler(this,he.ERROR,...e)}}let ge,ye;const ve=new WeakMap,be=new WeakMap,we=new WeakMap,Ce=new WeakMap,Ee=new WeakMap;let Se={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return be.get(e);if("objectStoreNames"===t)return e.objectStoreNames||we.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Ne(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function Te(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(ye||(ye=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(ke(this),t),Ne(ve.get(this))}:function(...t){return Ne(e.apply(ke(this),t))}:function(t,...n){const r=e.call(ke(this),t,...n);return we.set(r,t.sort?t.sort():[t]),Ne(r)}}function Ie(e){return"function"==typeof e?Te(e):(e instanceof IDBTransaction&&function(e){if(be.has(e))return;const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),r()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)}));be.set(e,t)}(e),t=e,(ge||(ge=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((e=>t instanceof e))?new Proxy(e,Se):e);var t}function Ne(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const r=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(Ne(e.result)),r()},s=()=>{n(e.error),r()};e.addEventListener("success",i),e.addEventListener("error",s)}));return t.then((t=>{t instanceof IDBCursor&&ve.set(t,e)})).catch((()=>{})),Ee.set(t,e),t}(e);if(Ce.has(e))return Ce.get(e);const t=Ie(e);return t!==e&&(Ce.set(e,t),Ee.set(t,e)),t}const ke=e=>Ee.get(e);const Pe=["get","getKey","getAll","getAllKeys","count"],xe=["put","add","delete","clear"],Oe=new Map;function De(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(Oe.get(t))return Oe.get(t);const n=t.replace(/FromIndex$/,""),r=t!==n,i=xe.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!Pe.includes(n))return;const s=async function(e,...t){const s=this.transaction(e,i?"readwrite":"readonly");let o=s.store;return r&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),i&&s.done]))[0]};return Oe.set(t,s),s}Se=(e=>({...e,get:(t,n,r)=>De(t,n)||e.get(t,n,r),has:(t,n)=>!!De(t,n)||e.has(t,n)}))(Se);class Re{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null})).filter((e=>e)).join(" ")}}const Ae="@firebase/app",qe="0.10.15",Me=new _e("@firebase/app"),je="@firebase/app-compat",Fe="@firebase/analytics-compat",Le="@firebase/analytics",ze="@firebase/app-check-compat",$e="@firebase/app-check",Ve="@firebase/auth",Ue="@firebase/auth-compat",We="@firebase/database",Be="@firebase/data-connect",He="@firebase/database-compat",Qe="@firebase/functions",Ke="@firebase/functions-compat",Ye="@firebase/installations",Ge="@firebase/installations-compat",Je="@firebase/messaging",Xe="@firebase/messaging-compat",Ze="@firebase/performance",et="@firebase/performance-compat",tt="@firebase/remote-config",nt="@firebase/remote-config-compat",rt="@firebase/storage",it="@firebase/storage-compat",st="@firebase/firestore",ot="@firebase/vertexai",at="@firebase/firestore-compat",ct="firebase",lt="[DEFAULT]",ut={[Ae]:"fire-core",[je]:"fire-core-compat",[Le]:"fire-analytics",[Fe]:"fire-analytics-compat",[$e]:"fire-app-check",[ze]:"fire-app-check-compat",[Ve]:"fire-auth",[Ue]:"fire-auth-compat",[We]:"fire-rtdb",[Be]:"fire-data-connect",[He]:"fire-rtdb-compat",[Qe]:"fire-fn",[Ke]:"fire-fn-compat",[Ye]:"fire-iid",[Ge]:"fire-iid-compat",[Je]:"fire-fcm",[Xe]:"fire-fcm-compat",[Ze]:"fire-perf",[et]:"fire-perf-compat",[tt]:"fire-rc",[nt]:"fire-rc-compat",[rt]:"fire-gcs",[it]:"fire-gcs-compat",[st]:"fire-fst",[at]:"fire-fst-compat",[ot]:"fire-vertex","fire-js":"fire-js",[ct]:"fire-js-all"},ht=new Map,dt=new Map,pt=new Map;function ft(e,t){try{e.container.addComponent(t)}catch(n){Me.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function mt(e){const t=e.name;if(pt.has(t))return Me.debug(`There were multiple attempts to register component ${t}.`),!1;pt.set(t,e);for(const t of ht.values())ft(t,e);for(const t of dt.values())ft(t,e);return!0}const _t=new H("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class gt{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new ae("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw _t.create("app-deleted",{appName:this._name})}}function yt(e,t={}){let n=e;if("object"!=typeof t){t={name:t}}const r=Object.assign({name:lt,automaticDataCollectionEnabled:!1},t),i=r.name;if("string"!=typeof i||!i)throw _t.create("bad-app-name",{appName:String(i)});if(n||(n=$()),!n)throw _t.create("no-options");const s=ht.get(i);if(s){if(te(n,s.options)&&te(r,s.config))return s;throw _t.create("duplicate-app",{appName:i})}const o=new ue(i);for(const e of pt.values())o.addComponent(e);const a=new gt(n,r,o);return ht.set(i,a),a}function vt(){return Array.from(ht.values())}function bt(e,t,n){var r;let i=null!==(r=ut[e])&&void 0!==r?r:e;n&&(i+=`-${n}`);const s=i.match(/\s|\//),o=t.match(/\s|\//);if(s||o){const e=[`Unable to register library "${i}" with version "${t}":`];return s&&e.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&e.push("and"),o&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void Me.warn(e.join(" "))}mt(new ae(`${i}-version`,(()=>({library:i,version:t})),"VERSION"))}const wt="firebase-heartbeat-store";let Ct=null;function Et(){return Ct||(Ct=function(e,t,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(e,t),a=Ne(o);return r&&o.addEventListener("upgradeneeded",(e=>{r(Ne(o.result),e.oldVersion,e.newVersion,Ne(o.transaction),e)})),n&&o.addEventListener("blocked",(e=>n(e.oldVersion,e.newVersion,e))),a.then((e=>{s&&e.addEventListener("close",(()=>s())),i&&e.addEventListener("versionchange",(e=>i(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),a}("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(wt)}catch(e){console.warn(e)}}}).catch((e=>{throw _t.create("idb-open",{originalErrorMessage:e.message})}))),Ct}async function St(e,t){try{const n=(await Et()).transaction(wt,"readwrite"),r=n.objectStore(wt);await r.put(t,Tt(e)),await n.done}catch(e){if(e instanceof B)Me.warn(e.message);else{const t=_t.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});Me.warn(t.message)}}}function Tt(e){return`${e.name}!${e.options.appId}`}class It{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new kt(t),this._heartbeatsCachePromise=this._storage.read().then((e=>(this._heartbeatsCache=e,e)))}async triggerHeartbeat(){var e,t;try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=Nt();if(null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)&&(this._heartbeatsCache=await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)))return;if(this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some((e=>e.date===r)))return;return this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((e=>{const t=new Date(e.date).valueOf();return Date.now()-t<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}catch(e){Me.warn(e)}}async getHeartbeatsHeader(){var e;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=Nt(),{heartbeatsToSend:n,unsentEntries:r}=function(e,t=1024){const n=[];let r=e.slice();for(const i of e){const e=n.find((e=>e.agent===i.agent));if(e){if(e.dates.push(i.date),Pt(n)>t){e.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),Pt(n)>t){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),i=A(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(e){return Me.warn(e),""}}}function Nt(){return(new Date).toISOString().substring(0,10)}class kt{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!function(){try{return"object"==typeof indexedDB}catch(e){return!1}}()&&new Promise(((e,t)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}})).then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await Et()).transaction(wt),n=await t.objectStore(wt).get(Tt(e));return await t.done,n}catch(e){if(e instanceof B)Me.warn(e.message);else{const t=_t.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});Me.warn(t.message)}}}(this.app);return(null==e?void 0:e.heartbeats)?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return St(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return St(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function Pt(e){return A(JSON.stringify({version:2,heartbeats:e})).length}var xt;xt="",mt(new ae("platform-logger",(e=>new Re(e)),"PRIVATE")),mt(new ae("heartbeat",(e=>new It(e)),"PRIVATE")),bt(Ae,qe,xt),bt(Ae,qe,"esm2017"),bt("fire-js","");bt("firebase","11.0.1","app");const Ot="@firebase/database",Dt="1.0.9";let Rt="";class At{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Y(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:K(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class qt{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return J(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const Mt=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){const t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new At(t)}}catch(e){}return new qt},jt=Mt("localStorage"),Ft=Mt("sessionStorage"),Lt=new _e("@firebase/database"),zt=function(){let e=1;return function(){return e++}}(),$t=function(e){const t=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let i=e.charCodeAt(r);if(i>=55296&&i<=56319){const t=i-55296;r++,k(r<e.length,"Surrogate pair missing trail surrogate."),i=65536+(t<<10)+(e.charCodeAt(r)-56320)}i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):i<65536?(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t}(e),n=new re;n.update(t);const r=n.digest();return O.encodeByteArray(r)},Vt=function(...e){let t="";for(let n=0;n<e.length;n++){const r=e[n];Array.isArray(r)||r&&"object"==typeof r&&"number"==typeof r.length?t+=Vt.apply(null,r):t+="object"==typeof r?Y(r):r,t+=" "}return t};let Ut=null,Wt=!0;const Bt=function(...e){var t;if(!0===Wt&&(Wt=!1,null===Ut&&!0===Ft.get("logging_enabled")&&(k(!t,"Can't turn on custom loggers persistently."),Lt.logLevel=he.VERBOSE,Ut=Lt.log.bind(Lt))),Ut){const t=Vt.apply(null,e);Ut(t)}},Ht=function(e){return function(...t){Bt(e,...t)}},Qt=function(...e){const t="FIREBASE INTERNAL ERROR: "+Vt(...e);Lt.error(t)},Kt=function(...e){const t=`FIREBASE FATAL ERROR: ${Vt(...e)}`;throw Lt.error(t),new Error(t)},Yt=function(...e){const t="FIREBASE WARNING: "+Vt(...e);Lt.warn(t)},Gt=function(e){return"number"==typeof e&&(e!=e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},Jt="[MIN_NAME]",Xt="[MAX_NAME]",Zt=function(e,t){if(e===t)return 0;if(e===Jt||t===Xt)return-1;if(t===Jt||e===Xt)return 1;{const n=cn(e),r=cn(t);return null!==n?null!==r?n-r==0?e.length-t.length:n-r:-1:null!==r?1:e<t?-1:1}},en=function(e,t){return e===t?0:e<t?-1:1},tn=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+Y(t))},nn=function(e){if("object"!=typeof e||null===e)return Y(e);const t=[];for(const n in e)t.push(n);t.sort();let n="{";for(let r=0;r<t.length;r++)0!==r&&(n+=","),n+=Y(t[r]),n+=":",n+=nn(e[t[r]]);return n+="}",n},rn=function(e,t){const n=e.length;if(n<=t)return[e];const r=[];for(let i=0;i<n;i+=t)i+t>n?r.push(e.substring(i,n)):r.push(e.substring(i,i+t));return r};function sn(e,t){for(const n in e)e.hasOwnProperty(n)&&t(n,e[n])}const on=function(e){k(!Gt(e),"Invalid JSON number");const t=1023;let n,r,i,s,o;0===e?(r=0,i=0,n=1/e==-1/0?1:0):(n=e<0,(e=Math.abs(e))>=Math.pow(2,-1022)?(s=Math.min(Math.floor(Math.log(e)/Math.LN2),t),r=s+t,i=Math.round(e*Math.pow(2,52-s)-Math.pow(2,52))):(r=0,i=Math.round(e/Math.pow(2,-1074))));const a=[];for(o=52;o;o-=1)a.push(i%2?1:0),i=Math.floor(i/2);for(o=11;o;o-=1)a.push(r%2?1:0),r=Math.floor(r/2);a.push(n?1:0),a.reverse();const c=a.join("");let l="";for(o=0;o<64;o+=8){let e=parseInt(c.substr(o,8),2).toString(16);1===e.length&&(e="0"+e),l+=e}return l.toLowerCase()};const an=new RegExp("^-?(0*)\\d{1,10}$"),cn=function(e){if(an.test(e)){const t=Number(e);if(t>=-2147483648&&t<=2147483647)return t}return null},ln=function(e){try{e()}catch(e){setTimeout((()=>{const t=e.stack||"";throw Yt("Exception was thrown by user callback.",t),e}),Math.floor(0))}},un=function(e,t){const n=setTimeout(e,t);return"number"==typeof n&&"undefined"!=typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(n):"object"==typeof n&&n.unref&&n.unref(),n};class hn{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null==t||t.get().then((e=>this.appCheck=e))}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise(((t,n)=>{setTimeout((()=>{this.appCheck?this.getToken(e).then(t,n):t(null)}),0)}))}addTokenChangeListener(e){var t;null===(t=this.appCheckProvider)||void 0===t||t.get().then((t=>t.addTokenListener(e)))}notifyForInvalidToken(){Yt(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}class dn{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit((e=>this.auth_=e))}getToken(e){return this.auth_?this.auth_.getToken(e).catch((e=>e&&"auth/token-not-initialized"===e.code?(Bt("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e))):new Promise(((t,n)=>{setTimeout((()=>{this.auth_?this.getToken(e).then(t,n):t(null)}),0)}))}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then((t=>t.addAuthTokenListener(e)))}removeTokenChangeListener(e){this.authProvider_.get().then((t=>t.removeAuthTokenListener(e)))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',Yt(e)}}class pn{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}pn.OWNER="owner";const fn=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,mn="ac",_n="websocket",gn="long_polling";class yn{constructor(e,t,n,r,i=!1,s="",o=!1,a=!1){this.secure=t,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=i,this.persistenceKey=s,this.includeNamespaceInQueryParams=o,this.isUsingEmulator=a,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=jt.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&jt.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function vn(e,t,n){let r;if(k("string"==typeof t,"typeof type must == string"),k("object"==typeof n,"typeof params must == object"),t===_n)r=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if(t!==gn)throw new Error("Unknown connection type: "+t);r=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}(function(e){return e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams})(e)&&(n.ns=e.namespace);const i=[];return sn(n,((e,t)=>{i.push(e+"="+t)})),r+i.join("&")}class bn{constructor(){this.counters_={}}incrementCounter(e,t=1){J(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return M(this.counters_)}}const wn={},Cn={};function En(e){const t=e.toString();return wn[t]||(wn[t]=new bn),wn[t]}class Sn{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const e=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let t=0;t<e.length;++t)e[t]&&ln((()=>{this.onMessage_(e[t])}));if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}const Tn="start";class In{constructor(e,t,n,r,i,s,o){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.transportSessionId=s,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=Ht(e),this.stats_=En(t),this.urlFn=e=>(this.appCheckToken&&(e[mn]=this.appCheckToken),vn(t,gn,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Sn(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout((()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null}),Math.floor(3e4)),function(e){if("complete"===document.readyState)e();else{let t=!1;const n=function(){document.body?t||(t=!0,e()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",(()=>{"complete"===document.readyState&&n()})),window.attachEvent("onload",n))}}((()=>{if(this.isClosed_)return;this.scriptTagHolder=new Nn(((...e)=>{const[t,n,r,i,s]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,t===Tn)this.id=n,this.password=r;else{if("close"!==t)throw new Error("Unrecognized command received: "+t);n?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(n,(()=>{this.onClosed_()}))):this.onClosed_()}}),((...e)=>{const[t,n]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,n)}),(()=>{this.onClosed_()}),this.urlFn);const e={};e[Tn]="t",e.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=this.scriptTagHolder.uniqueCallbackIdentifier),e.v="5",this.transportSessionId&&(e.s=this.transportSessionId),this.lastSessionId&&(e.ls=this.lastSessionId),this.applicationId&&(e.p=this.applicationId),this.appCheckToken&&(e[mn]=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&fn.test(location.hostname)&&(e.r="f");const t=this.urlFn(e);this.log_("Connecting via long-poll to "+t),this.scriptTagHolder.addTag(t,(()=>{}))}))}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){In.forceAllow_=!0}static forceDisallow(){In.forceDisallow_=!0}static isAvailable(){return!!In.forceAllow_||!(In.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI)}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=Y(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=R(t),r=rn(n,1840);for(let e=0;e<r.length;e++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[e]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const n={dframe:"t"};n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=Y(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class Nn{constructor(e,t,n,r){this.onDisconnect=n,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=zt(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=Nn.createIFrame_();let n="";if(this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)){n='<script>document.domain="'+document.domain+'";<\/script>'}const r="<html><body>"+n+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(r),this.myIFrame.doc.close()}catch(e){Bt("frame writing exception"),e.stack&&Bt(e.stack),Bt(e)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||Bt("No IE domain setting required")}catch(t){const n=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout((()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)}),Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),n="",r=0;for(;this.pendingSegs.length>0;){if(!(this.pendingSegs[0].d.length+30+n.length<=1870))break;{const e=this.pendingSegs.shift();n=n+"&seg"+r+"="+e.seg+"&ts"+r+"="+e.ts+"&d"+r+"="+e.d,r++}}return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}return!1}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},r=setTimeout(n,Math.floor(25e3));this.addTag(e,(()=>{clearTimeout(r),n()}))}addTag(e,t){setTimeout((()=>{try{if(!this.sendNewPolls)return;const n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){const e=n.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),t())},n.onerror=()=>{Bt("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch(e){}}),Math.floor(1))}}let kn=null;"undefined"!=typeof MozWebSocket?kn=MozWebSocket:"undefined"!=typeof WebSocket&&(kn=WebSocket);class Pn{constructor(e,t,n,r,i,s,o){this.connId=e,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=Ht(this.connId),this.stats_=En(t),this.connURL=Pn.connectionURL_(t,s,o,r,n),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,n,r,i){const s={v:"5"};return"undefined"!=typeof location&&location.hostname&&fn.test(location.hostname)&&(s.r="f"),t&&(s.s=t),n&&(s.ls=n),r&&(s[mn]=r),i&&(s.p=i),vn(e,_n,s)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,jt.set("previous_websocket_failure",!0);try{let e;W(),this.mySock=new kn(this.connURL,[],e)}catch(e){this.log_("Error instantiating WebSocket.");const t=e.message||e.data;return t&&this.log_(t),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");const t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){Pn.forceDisallow_=!0}static isAvailable(){let e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,n=navigator.userAgent.match(t);n&&n.length>1&&parseFloat(n[1])<4.4&&(e=!0)}return!e&&null!==kn&&!Pn.forceDisallow_}static previouslyFailed(){return jt.isInMemoryStorage||!0===jt.get("previous_websocket_failure")}markConnectionHealthy(){jt.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const e=this.frames.join("");this.frames=null;const t=K(e);this.onMessage(t)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(k(null===this.frames,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(null===this.mySock)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{const e=this.extractFrameCount_(t);null!==e&&this.appendFrame_(e)}}send(e){this.resetKeepAlive();const t=Y(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=rn(t,16384);n.length>1&&this.sendString_(String(n.length));for(let e=0;e<n.length;e++)this.sendString_(n[e])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval((()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()}),Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Pn.responsesRequiredToBeHealthy=2,Pn.healthyTimeout=3e4;class xn{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[In,Pn]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(e){const t=Pn&&Pn.isAvailable();let n=t&&!Pn.previouslyFailed();if(e.webSocketOnly&&(t||Yt("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[Pn];else{const e=this.transports_=[];for(const t of xn.ALL_TRANSPORTS)t&&t.isAvailable()&&e.push(t);xn.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}xn.globalTransportInitialized_=!1;class On{constructor(e,t,n,r,i,s,o,a,c,l){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=r,this.authToken_=i,this.onMessage_=s,this.onReady_=o,this.onDisconnect_=a,this.onKill_=c,this.lastSessionId=l,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=Ht("c:"+this.id+":"),this.transportManager_=new xn(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout((()=>{this.conn_&&this.conn_.open(t,n)}),Math.floor(0));const r=e.healthyTimeout||0;r>0&&(this.healthyTimeout_=un((()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))}),Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){const t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=tn("t",e),n=tn("d",e);if("c"===t)this.onSecondaryControl_(n);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(n)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=tn("t",e),n=tn("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=tn("t",e);if("d"in e){const n=e.d;if("h"===t){const e=Object.assign({},n);this.repoInfo_.isUsingEmulator&&(e.h=this.repoInfo_.host),this.onHandshake_(e)}else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?Qt("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Qt("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==n&&Yt("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),un((()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())}),Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):un((()=>{this.sendPingOnPrimaryIfNecessary_()}),Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(jt.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class Dn{put(e,t,n,r){}merge(e,t,n,r){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}class Rn{constructor(e){this.allowedEvents_=e,this.listeners_={},k(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const n=[...this.listeners_[e]];for(let e=0;e<n.length;e++)n[e].callback.apply(n[e].context,t)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});const r=this.getInitialEvent(e);r&&t.apply(n,r)}off(e,t,n){this.validateEventType_(e);const r=this.listeners_[e]||[];for(let e=0;e<r.length;e++)if(r[e].callback===t&&(!n||n===r[e].context))return void r.splice(e,1)}validateEventType_(e){k(this.allowedEvents_.find((t=>t===e)),"Unknown event: "+e)}}class An extends Rn{constructor(){super(["online"]),this.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||U()||(window.addEventListener("online",(()=>{this.online_||(this.online_=!0,this.trigger("online",!0))}),!1),window.addEventListener("offline",(()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))}),!1))}static getInstance(){return new An}getInitialEvent(e){return k("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}class qn{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let e=0;e<this.pieces_.length;e++)this.pieces_[e].length>0&&(this.pieces_[t]=this.pieces_[e],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function Mn(){return new qn("")}function jn(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function Fn(e){return e.pieces_.length-e.pieceNum_}function Ln(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new qn(e.pieces_,t)}function zn(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function $n(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function Vn(e){if(e.pieceNum_>=e.pieces_.length)return null;const t=[];for(let n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new qn(t,0)}function Un(e,t){const n=[];for(let t=e.pieceNum_;t<e.pieces_.length;t++)n.push(e.pieces_[t]);if(t instanceof qn)for(let e=t.pieceNum_;e<t.pieces_.length;e++)n.push(t.pieces_[e]);else{const e=t.split("/");for(let t=0;t<e.length;t++)e[t].length>0&&n.push(e[t])}return new qn(n,0)}function Wn(e){return e.pieceNum_>=e.pieces_.length}function Bn(e,t){const n=jn(e),r=jn(t);if(null===n)return t;if(n===r)return Bn(Ln(e),Ln(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function Hn(e,t){const n=$n(e,0),r=$n(t,0);for(let e=0;e<n.length&&e<r.length;e++){const t=Zt(n[e],r[e]);if(0!==t)return t}return n.length===r.length?0:n.length<r.length?-1:1}function Qn(e,t){if(Fn(e)!==Fn(t))return!1;for(let n=e.pieceNum_,r=t.pieceNum_;n<=e.pieces_.length;n++,r++)if(e.pieces_[n]!==t.pieces_[r])return!1;return!0}function Kn(e,t){let n=e.pieceNum_,r=t.pieceNum_;if(Fn(e)>Fn(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[r])return!1;++n,++r}return!0}class Yn{constructor(e,t){this.errorPrefix_=t,this.parts_=$n(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let e=0;e<this.parts_.length;e++)this.byteLength_+=se(this.parts_[e]);Gn(this)}}function Gn(e){if(e.byteLength_>768)throw new Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(e.parts_.length>32)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+Jn(e))}function Jn(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class Xn extends Rn{constructor(){let e,t;super(["visible"]),"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,(()=>{const t=!document[e];t!==this.visible_&&(this.visible_=t,this.trigger("visible",t))}),!1)}static getInstance(){return new Xn}getInitialEvent(e){return k("visible"===e,"Unknown event type: "+e),[this.visible_]}}const Zn=1e3;class er extends Dn{constructor(e,t,n,r,i,s,o,a){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=n,this.onConnectStatus_=r,this.onServerInfoUpdate_=i,this.authTokenProvider_=s,this.appCheckTokenProvider_=o,this.authOverride_=a,this.id=er.nextPersistentConnectionId_++,this.log_=Ht("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Zn,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,a&&!W())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Xn.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&An.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,n){const r=++this.requestNumber_,i={r:r,a:e,b:t};this.log_(Y(i)),k(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)}get(e){this.initConnection_();const t=new V,n={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:e=>{const n=e.d;"ok"===e.s?t.resolve(n):t.reject(n)}};this.outstandingGets_.push(n),this.outstandingGetCount_++;const r=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(r),t.promise}listen(e,t,n,r){this.initConnection_();const i=e._queryIdentifier,s=e._path.toString();this.log_("Listen called for "+s+" "+i),this.listens.has(s)||this.listens.set(s,new Map),k(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),k(!this.listens.get(s).has(i),"listen() called twice for same path/queryId.");const o={onComplete:r,hashFn:t,query:e,tag:n};this.listens.get(s).set(i,o),this.connected_&&this.sendListen_(o)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,(n=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(n)}))}sendListen_(e){const t=e.query,n=t._path.toString(),r=t._queryIdentifier;this.log_("Listen on "+n+" for "+r);const i={p:n};e.tag&&(i.q=t._queryObject,i.t=e.tag),i.h=e.hashFn(),this.sendRequest("q",i,(i=>{const s=i.d,o=i.s;er.warnOnListenWarnings_(s,t);(this.listens.get(n)&&this.listens.get(n).get(r))===e&&(this.log_("listen response",i),"ok"!==o&&this.removeListen_(n,r),e.onComplete&&e.onComplete(o,s))}))}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&J(e,"w")){const n=X(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){const e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',n=t._path.toString();Yt(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${e} at ${n} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},(()=>{})),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||function(e){const t=G(e).claims;return"object"==typeof t&&!0===t.admin}(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},(()=>{}))}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=function(e){const t=G(e).claims;return!!t&&"object"==typeof t&&t.hasOwnProperty("iat")}(e)?"auth":"gauth",n={cred:e};null===this.authOverride_?n.noauth=!0:"object"==typeof this.authOverride_&&(n.authvar=this.authOverride_),this.sendRequest(t,n,(t=>{const n=t.s,r=t.d||"error";this.authToken_===e&&("ok"===n?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(n,r))}))}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},(e=>{const t=e.s,n=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,n)}))}unlisten(e,t){const n=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+r),k(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query");this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,e._queryObject,t)}sendUnlisten_(e,t,n,r){this.log_("Unlisten on "+e+" for "+t);const i={p:e};r&&(i.q=n,i.t=r),this.sendRequest("n",i)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,r){const i={p:t,d:n};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,(e=>{r&&setTimeout((()=>{r(e.s,e.d)}),Math.floor(0))}))}put(e,t,n,r){this.putInternal("p",e,t,n,r)}merge(e,t,n,r){this.putInternal("m",e,t,n,r)}putInternal(e,t,n,r,i){this.initConnection_();const s={p:t,d:n};void 0!==i&&(s.h=i),this.outstandingPuts_.push({action:e,request:s,onComplete:r}),this.outstandingPutCount_++;const o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,n=this.outstandingPuts_[e].request,r=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,n,(n=>{this.log_(t+" response",n),delete this.outstandingPuts_[e],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),r&&r(n.s,n.d)}))}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,(e=>{if("ok"!==e.s){const t=e.d;this.log_("reportStats","Error sending stats: "+t)}}))}}onDataMessage_(e){if("r"in e){this.log_("from server: "+Y(e));const t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):Qt("Unrecognized action received from server: "+Y(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){k(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout((()=>{this.establishConnectionTimer_=null,this.establishConnection_()}),Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Zn,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Zn,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){if(this.visible_){if(this.lastConnectionEstablishedTime_){(new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=Zn),this.lastConnectionEstablishedTime_=null}}else this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime();const e=(new Date).getTime()-this.lastConnectionAttemptTime_;let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+er.nextConnectionId_++,i=this.lastSessionId;let s=!1,o=null;const a=function(){o?o.close():(s=!0,n())},c=function(e){k(o,"sendRequest call when we're not connected not allowed."),o.sendRequest(e)};this.realtime_={close:a,sendRequest:c};const l=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[a,c]=await Promise.all([this.authTokenProvider_.getToken(l),this.appCheckTokenProvider_.getToken(l)]);s?Bt("getToken() completed but was canceled"):(Bt("getToken() completed. Creating connection."),this.authToken_=a&&a.accessToken,this.appCheckToken_=c&&c.token,o=new On(r,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,n,(e=>{Yt(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")}),i))}catch(e){this.log_("Failed to get token: "+e),s||(this.repoInfo_.nodeAdmin&&Yt(e),a())}}}interrupt(e){Bt("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){Bt("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Z(this.interruptReasons_)&&(this.reconnectDelay_=Zn,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;n=t?t.map((e=>nn(e))).join("$"):"default";const r=this.removeListen_(e,n);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(e,t){const n=new qn(e).toString();let r;if(this.listens.has(n)){const e=this.listens.get(n);r=e.get(t),e.delete(t),0===e.size&&this.listens.delete(n)}else r=void 0;return r}onAuthRevoked_(e,t){Bt("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){Bt("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};e["sdk.js."+Rt.replace(/\./g,"-")]=1,U()?e["framework.cordova"]=1:"object"==typeof navigator&&"ReactNative"===navigator.product&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=An.getInstance().currentlyOnline();return Z(this.interruptReasons_)&&e}}er.nextPersistentConnectionId_=0,er.nextConnectionId_=0;class tr{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new tr(e,t)}}class nr{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const n=new tr(Jt,e),r=new tr(Jt,t);return 0!==this.compare(n,r)}minPost(){return tr.MIN}}let rr;class ir extends nr{static get __EMPTY_NODE(){return rr}static set __EMPTY_NODE(e){rr=e}compare(e,t){return Zt(e.name,t.name)}isDefinedOn(e){throw P("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return tr.MIN}maxPost(){return new tr(Xt,rr)}makePost(e,t){return k("string"==typeof e,"KeyIndex indexValue must always be a string."),new tr(e,rr)}toString(){return".key"}}const sr=new ir;class or{constructor(e,t,n,r,i=null){this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,r&&(s*=-1),s<0)e=this.isReverse_?e.left:e.right;else{if(0===s){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}getNext(){if(0===this.nodeStack_.length)return null;let e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class ar{constructor(e,t,n,r,i){this.key=e,this.value=t,this.color=null!=n?n:ar.RED,this.left=null!=r?r:cr.EMPTY_NODE,this.right=null!=i?i:cr.EMPTY_NODE}copy(e,t,n,r,i){return new ar(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let r=this;const i=n(e,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return cr.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let n,r;if(n=this,t(e,n.key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return cr.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,ar.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,ar.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}ar.RED=!0,ar.BLACK=!1;class cr{constructor(e,t=cr.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new cr(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,ar.BLACK,null,null))}remove(e){return new cr(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,ar.BLACK,null,null))}get(e){let t,n=this.root_;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t)return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,r=null;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(r=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new or(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new or(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new or(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new or(this.root_,null,this.comparator_,!0,e)}}function lr(e,t){return Zt(e.name,t.name)}function ur(e,t){return Zt(e,t)}let hr;cr.EMPTY_NODE=new class{copy(e,t,n,r,i){return this}insert(e,t,n){return new ar(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};const dr=function(e){return"number"==typeof e?"number:"+on(e):"string:"+e},pr=function(e){if(e.isLeafNode()){const t=e.val();k("string"==typeof t||"number"==typeof t||"object"==typeof t&&J(t,".sv"),"Priority must be a string or number.")}else k(e===hr||e.isEmpty(),"priority of unexpected type.");k(e===hr||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let fr,mr,_r;class gr{constructor(e,t=gr.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,k(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),pr(this.priorityNode_)}static set __childrenNodeConstructor(e){fr=e}static get __childrenNodeConstructor(){return fr}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new gr(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:gr.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return Wn(e)?this:".priority"===jn(e)?this.priorityNode_:gr.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:gr.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const n=jn(e);return null===n?t:t.isEmpty()&&".priority"!==n?this:(k(".priority"!==n||1===Fn(e),".priority must be the last token in a path"),this.updateImmediateChild(n,gr.__childrenNodeConstructor.EMPTY_NODE.updateChild(Ln(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+dr(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",e+="number"===t?on(this.value_):this.value_,this.lazyHash_=$t(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===gr.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof gr.__childrenNodeConstructor?-1:(k(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,n=typeof this.value_,r=gr.VALUE_TYPE_ORDER.indexOf(t),i=gr.VALUE_TYPE_ORDER.indexOf(n);return k(r>=0,"Unknown leaf type: "+t),k(i>=0,"Unknown leaf type: "+n),r===i?"object"===n?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:i-r}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}return!1}}gr.VALUE_TYPE_ORDER=["object","boolean","number","string"];const yr=new class extends nr{compare(e,t){const n=e.node.getPriority(),r=t.node.getPriority(),i=n.compareTo(r);return 0===i?Zt(e.name,t.name):i}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return tr.MIN}maxPost(){return new tr(Xt,new gr("[PRIORITY-POST]",_r))}makePost(e,t){const n=mr(e);return new tr(t,new gr("[PRIORITY-POST]",n))}toString(){return".priority"}},vr=Math.log(2);class br{constructor(e){var t;this.count=(t=e+1,parseInt(Math.log(t)/vr,10)),this.current_=this.count-1;const n=(r=this.count,parseInt(Array(r+1).join("1"),2));var r;this.bits_=e+1&n}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const wr=function(e,t,n,r){e.sort(t);const i=function(t,r){const s=r-t;let o,a;if(0===s)return null;if(1===s)return o=e[t],a=n?n(o):o,new ar(a,o.node,ar.BLACK,null,null);{const c=parseInt(s/2,10)+t,l=i(t,c),u=i(c+1,r);return o=e[c],a=n?n(o):o,new ar(a,o.node,ar.BLACK,l,u)}},s=function(t){let r=null,s=null,o=e.length;const a=function(t,r){const s=o-t,a=o;o-=t;const l=i(s+1,a),u=e[s],h=n?n(u):u;c(new ar(h,u.node,r,null,l))},c=function(e){r?(r.left=e,r=e):(s=e,r=e)};for(let e=0;e<t.count;++e){const n=t.nextBitIsOne(),r=Math.pow(2,t.count-(e+1));n?a(r,ar.BLACK):(a(r,ar.BLACK),a(r,ar.RED))}return s}(new br(e.length));return new cr(r||t,s)};let Cr;const Er={};class Sr{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return k(Er&&yr,"ChildrenNode.ts has not been loaded"),Cr=Cr||new Sr({".priority":Er},{".priority":yr}),Cr}get(e){const t=X(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof cr?t:null}hasIndex(e){return J(this.indexSet_,e.toString())}addIndex(e,t){k(e!==sr,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const n=[];let r=!1;const i=t.getIterator(tr.Wrap);let s,o=i.getNext();for(;o;)r=r||e.isDefinedOn(o.node),n.push(o),o=i.getNext();s=r?wr(n,e.getCompare()):Er;const a=e.toString(),c=Object.assign({},this.indexSet_);c[a]=e;const l=Object.assign({},this.indexes_);return l[a]=s,new Sr(l,c)}addToIndexes(e,t){const n=ee(this.indexes_,((n,r)=>{const i=X(this.indexSet_,r);if(k(i,"Missing index implementation for "+r),n===Er){if(i.isDefinedOn(e.node)){const n=[],r=t.getIterator(tr.Wrap);let s=r.getNext();for(;s;)s.name!==e.name&&n.push(s),s=r.getNext();return n.push(e),wr(n,i.getCompare())}return Er}{const r=t.get(e.name);let i=n;return r&&(i=i.remove(new tr(e.name,r))),i.insert(e,e.node)}}));return new Sr(n,this.indexSet_)}removeFromIndexes(e,t){const n=ee(this.indexes_,(n=>{if(n===Er)return n;{const r=t.get(e.name);return r?n.remove(new tr(e.name,r)):n}}));return new Sr(n,this.indexSet_)}}let Tr;class Ir{constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&pr(this.priorityNode_),this.children_.isEmpty()&&k(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return Tr||(Tr=new Ir(new cr(ur),null,Sr.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Tr}updatePriority(e){return this.children_.isEmpty()?this:new Ir(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();{const t=this.children_.get(e);return null===t?Tr:t}}getChild(e){const t=jn(e);return null===t?this:this.getImmediateChild(t).getChild(Ln(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(e,t){if(k(t,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(t);{const n=new tr(e,t);let r,i;t.isEmpty()?(r=this.children_.remove(e),i=this.indexMap_.removeFromIndexes(n,this.children_)):(r=this.children_.insert(e,t),i=this.indexMap_.addToIndexes(n,this.children_));const s=r.isEmpty()?Tr:this.priorityNode_;return new Ir(r,s,i)}}updateChild(e,t){const n=jn(e);if(null===n)return t;{k(".priority"!==jn(e)||1===Fn(e),".priority must be the last token in a path");const r=this.getImmediateChild(n).updateChild(Ln(e),t);return this.updateImmediateChild(n,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let n=0,r=0,i=!0;if(this.forEachChild(yr,((s,o)=>{t[s]=o.val(e),n++,i&&Ir.INTEGER_REGEXP_.test(s)?r=Math.max(r,Number(s)):i=!1})),!e&&i&&r<2*n){const e=[];for(const n in t)e[n]=t[n];return e}return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(null===this.lazyHash_){let e="";this.getPriority().isEmpty()||(e+="priority:"+dr(this.getPriority().val())+":"),this.forEachChild(yr,((t,n)=>{const r=n.hash();""!==r&&(e+=":"+t+":"+r)})),this.lazyHash_=""===e?"":$t(e)}return this.lazyHash_}getPredecessorChildName(e,t,n){const r=this.resolveIndex_(n);if(r){const n=r.getPredecessorKey(new tr(e,t));return n?n.name:null}return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.minKey();return e&&e.name}return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new tr(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.maxKey();return e&&e.name}return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new tr(t,this.children_.get(t)):null}forEachChild(e,t){const n=this.resolveIndex_(e);return n?n.inorderTraversal((e=>t(e.name,e.node))):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,(e=>e));{const n=this.children_.getIteratorFrom(e.name,tr.Wrap);let r=n.peek();for(;null!=r&&t.compare(r,e)<0;)n.getNext(),r=n.peek();return n}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,(e=>e));{const n=this.children_.getReverseIteratorFrom(e.name,tr.Wrap);let r=n.peek();for(;null!=r&&t.compare(r,e)>0;)n.getNext(),r=n.peek();return n}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Nr?-1:0}withIndex(e){if(e===sr||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new Ir(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===sr||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority())){if(this.children_.count()===t.children_.count()){const e=this.getIterator(yr),n=t.getIterator(yr);let r=e.getNext(),i=n.getNext();for(;r&&i;){if(r.name!==i.name||!r.node.equals(i.node))return!1;r=e.getNext(),i=n.getNext()}return null===r&&null===i}return!1}return!1}}resolveIndex_(e){return e===sr?null:this.indexMap_.get(e.toString())}}Ir.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;const Nr=new class extends Ir{constructor(){super(new cr(ur),Ir.EMPTY_NODE,Sr.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return Ir.EMPTY_NODE}isEmpty(){return!1}};Object.defineProperties(tr,{MIN:{value:new tr(Jt,Ir.EMPTY_NODE)},MAX:{value:new tr(Xt,Nr)}}),ir.__EMPTY_NODE=Ir.EMPTY_NODE,gr.__childrenNodeConstructor=Ir,hr=Nr,function(e){_r=e}(Nr);function kr(e,t=null){if(null===e)return Ir.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),k(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e){return new gr(e,kr(t))}if(e instanceof Array){let n=Ir.EMPTY_NODE;return sn(e,((t,r)=>{if(J(e,t)&&"."!==t.substring(0,1)){const e=kr(r);!e.isLeafNode()&&e.isEmpty()||(n=n.updateImmediateChild(t,e))}})),n.updatePriority(kr(t))}{const n=[];let r=!1;if(sn(e,((e,t)=>{if("."!==e.substring(0,1)){const i=kr(t);i.isEmpty()||(r=r||!i.getPriority().isEmpty(),n.push(new tr(e,i)))}})),0===n.length)return Ir.EMPTY_NODE;const i=wr(n,lr,(e=>e.name),ur);if(r){const e=wr(n,yr.getCompare());return new Ir(i,kr(t),new Sr({".priority":e},{".priority":yr}))}return new Ir(i,kr(t),Sr.Default)}}!function(e){mr=e}(kr);class Pr extends nr{constructor(e){super(),this.indexPath_=e,k(!Wn(e)&&".priority"!==jn(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const n=this.extractChild(e.node),r=this.extractChild(t.node),i=n.compareTo(r);return 0===i?Zt(e.name,t.name):i}makePost(e,t){const n=kr(e),r=Ir.EMPTY_NODE.updateChild(this.indexPath_,n);return new tr(t,r)}maxPost(){const e=Ir.EMPTY_NODE.updateChild(this.indexPath_,Nr);return new tr(Xt,e)}toString(){return $n(this.indexPath_,0).join("/")}}const xr=new class extends nr{compare(e,t){const n=e.node.compareTo(t.node);return 0===n?Zt(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return tr.MIN}maxPost(){return tr.MAX}makePost(e,t){const n=kr(e);return new tr(t,n)}toString(){return".value"}};function Or(e){return{type:"value",snapshotNode:e}}function Dr(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function Rr(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function Ar(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}class qr{constructor(e){this.index_=e}updateChild(e,t,n,r,i,s){k(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const o=e.getImmediateChild(t);return o.getChild(r).equals(n.getChild(r))&&o.isEmpty()===n.isEmpty()?e:(null!=s&&(n.isEmpty()?e.hasChild(t)?s.trackChildChange(Rr(t,o)):k(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):o.isEmpty()?s.trackChildChange(Dr(t,n)):s.trackChildChange(Ar(t,n,o))),e.isLeafNode()&&n.isEmpty()?e:e.updateImmediateChild(t,n).withIndex(this.index_))}updateFullNode(e,t,n){return null!=n&&(e.isLeafNode()||e.forEachChild(yr,((e,r)=>{t.hasChild(e)||n.trackChildChange(Rr(e,r))})),t.isLeafNode()||t.forEachChild(yr,((t,r)=>{if(e.hasChild(t)){const i=e.getImmediateChild(t);i.equals(r)||n.trackChildChange(Ar(t,r,i))}else n.trackChildChange(Dr(t,r))}))),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?Ir.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class Mr{constructor(e){this.indexedFilter_=new qr(e.getIndex()),this.index_=e.getIndex(),this.startPost_=Mr.getStartPost_(e),this.endPost_=Mr.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,n=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&n}updateChild(e,t,n,r,i,s){return this.matches(new tr(t,n))||(n=Ir.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,r,i,s)}updateFullNode(e,t,n){t.isLeafNode()&&(t=Ir.EMPTY_NODE);let r=t.withIndex(this.index_);r=r.updatePriority(Ir.EMPTY_NODE);const i=this;return t.forEachChild(yr,((e,t)=>{i.matches(new tr(e,t))||(r=r.updateImmediateChild(e,Ir.EMPTY_NODE))})),this.indexedFilter_.updateFullNode(e,r,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()}}class jr{constructor(e){this.withinDirectionalStart=e=>this.reverse_?this.withinEndPost(e):this.withinStartPost(e),this.withinDirectionalEnd=e=>this.reverse_?this.withinStartPost(e):this.withinEndPost(e),this.withinStartPost=e=>{const t=this.index_.compare(this.rangedFilter_.getStartPost(),e);return this.startIsInclusive_?t<=0:t<0},this.withinEndPost=e=>{const t=this.index_.compare(e,this.rangedFilter_.getEndPost());return this.endIsInclusive_?t<=0:t<0},this.rangedFilter_=new Mr(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,n,r,i,s){return this.rangedFilter_.matches(new tr(t,n))||(n=Ir.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,r,i,s):this.fullLimitUpdateChild_(e,t,n,i,s)}updateFullNode(e,t,n){let r;if(t.isLeafNode()||t.isEmpty())r=Ir.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){let e;r=Ir.EMPTY_NODE.withIndex(this.index_),e=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let n=0;for(;e.hasNext()&&n<this.limit_;){const t=e.getNext();if(this.withinDirectionalStart(t)){if(!this.withinDirectionalEnd(t))break;r=r.updateImmediateChild(t.name,t.node),n++}}}else{let e;r=t.withIndex(this.index_),r=r.updatePriority(Ir.EMPTY_NODE),e=this.reverse_?r.getReverseIterator(this.index_):r.getIterator(this.index_);let n=0;for(;e.hasNext();){const t=e.getNext();n<this.limit_&&this.withinDirectionalStart(t)&&this.withinDirectionalEnd(t)?n++:r=r.updateImmediateChild(t.name,Ir.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,n,r,i){let s;if(this.reverse_){const e=this.index_.getCompare();s=(t,n)=>e(n,t)}else s=this.index_.getCompare();const o=e;k(o.numChildren()===this.limit_,"");const a=new tr(t,n),c=this.reverse_?o.getFirstChild(this.index_):o.getLastChild(this.index_),l=this.rangedFilter_.matches(a);if(o.hasChild(t)){const e=o.getImmediateChild(t);let u=r.getChildAfterChild(this.index_,c,this.reverse_);for(;null!=u&&(u.name===t||o.hasChild(u.name));)u=r.getChildAfterChild(this.index_,u,this.reverse_);const h=null==u?1:s(u,a);if(l&&!n.isEmpty()&&h>=0)return null!=i&&i.trackChildChange(Ar(t,n,e)),o.updateImmediateChild(t,n);{null!=i&&i.trackChildChange(Rr(t,e));const n=o.updateImmediateChild(t,Ir.EMPTY_NODE);return null!=u&&this.rangedFilter_.matches(u)?(null!=i&&i.trackChildChange(Dr(u.name,u.node)),n.updateImmediateChild(u.name,u.node)):n}}return n.isEmpty()?e:l&&s(c,a)>=0?(null!=i&&(i.trackChildChange(Rr(c.name,c.node)),i.trackChildChange(Dr(t,n))),o.updateImmediateChild(t,n).updateImmediateChild(c.name,Ir.EMPTY_NODE)):e}}class Fr{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=yr}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return k(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return k(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:Jt}hasEnd(){return this.endSet_}getIndexEndValue(){return k(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return k(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Xt}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return k(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===yr}copy(){const e=new Fr;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function Lr(e){const t={};if(e.isDefault())return t;let n;if(e.index_===yr?n="$priority":e.index_===xr?n="$value":e.index_===sr?n="$key":(k(e.index_ instanceof Pr,"Unrecognized index type!"),n=e.index_.toString()),t.orderBy=Y(n),e.startSet_){const n=e.startAfterSet_?"startAfter":"startAt";t[n]=Y(e.indexStartValue_),e.startNameSet_&&(t[n]+=","+Y(e.indexStartName_))}if(e.endSet_){const n=e.endBeforeSet_?"endBefore":"endAt";t[n]=Y(e.indexEndValue_),e.endNameSet_&&(t[n]+=","+Y(e.indexEndName_))}return e.limitSet_&&(e.isViewFromLeft()?t.limitToFirst=e.limit_:t.limitToLast=e.limit_),t}function zr(e){const t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_),t.sin=!e.startAfterSet_),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_),t.ein=!e.endBeforeSet_),e.limitSet_){t.l=e.limit_;let n=e.viewFrom_;""===n&&(n=e.isViewFromLeft()?"l":"r"),t.vf=n}return e.index_!==yr&&(t.i=e.index_.toString()),t}class $r extends Dn{constructor(e,t,n,r){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=r,this.log_=Ht("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(k(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,n,r){const i=e._path.toString();this.log_("Listen called for "+i+" "+e._queryIdentifier);const s=$r.getListenId_(e,n),o={};this.listens_[s]=o;const a=Lr(e._queryParams);this.restRequest_(i+".json",a,((e,t)=>{let a=t;if(404===e&&(a=null,e=null),null===e&&this.onDataUpdate_(i,a,!1,n),X(this.listens_,s)===o){let t;t=e?401===e?"permission_denied":"rest_error:"+e:"ok",r(t,null)}}))}unlisten(e,t){const n=$r.getListenId_(e,t);delete this.listens_[n]}get(e){const t=Lr(e._queryParams),n=e._path.toString(),r=new V;return this.restRequest_(n+".json",t,((e,t)=>{let i=t;404===e&&(i=null,e=null),null===e?(this.onDataUpdate_(n,i,!1,null),r.resolve(i)):r.reject(new Error(i))})),r.promise}refreshAuthToken(e){}restRequest_(e,t={},n){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then((([r,i])=>{r&&r.accessToken&&(t.auth=r.accessToken),i&&i.token&&(t.ac=i.token);const s=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+function(e){const t=[];for(const[n,r]of Object.entries(e))Array.isArray(r)?r.forEach((e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(r));return t.length?"&"+t.join("&"):""}(t);this.log_("Sending REST request for "+s);const o=new XMLHttpRequest;o.onreadystatechange=()=>{if(n&&4===o.readyState){this.log_("REST Response for "+s+" received. status:",o.status,"response:",o.responseText);let e=null;if(o.status>=200&&o.status<300){try{e=K(o.responseText)}catch(e){Yt("Failed to parse JSON response for "+s+": "+o.responseText)}n(null,e)}else 401!==o.status&&404!==o.status&&Yt("Got unsuccessful REST response for "+s+" Status: "+o.status),n(o.status);n=null}},o.open("GET",s,!0),o.send()}))}}class Vr{constructor(){this.rootNode_=Ir.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function Ur(){return{value:null,children:new Map}}function Wr(e,t,n){if(Wn(t))e.value=n,e.children.clear();else if(null!==e.value)e.value=e.value.updateChild(t,n);else{const r=jn(t);e.children.has(r)||e.children.set(r,Ur());Wr(e.children.get(r),t=Ln(t),n)}}function Br(e,t,n){null!==e.value?n(t,e.value):function(e,t){e.children.forEach(((e,n)=>{t(n,e)}))}(e,((e,r)=>{Br(r,new qn(t.toString()+"/"+e),n)}))}class Hr{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=Object.assign({},e);return this.last_&&sn(this.last_,((e,n)=>{t[e]=t[e]-n})),this.last_=e,t}}class Qr{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Hr(e);const n=1e4+2e4*Math.random();un(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){const e=this.statsListener_.get(),t={};let n=!1;sn(e,((e,r)=>{r>0&&J(this.statsToReport_,e)&&(t[e]=r,n=!0)})),n&&this.server_.reportStats(t),un(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}var Kr;function Yr(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}!function(e){e[e.OVERWRITE=0]="OVERWRITE",e[e.MERGE=1]="MERGE",e[e.ACK_USER_WRITE=2]="ACK_USER_WRITE",e[e.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(Kr||(Kr={}));class Gr{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=Kr.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}operationForChild(e){if(Wn(this.path)){if(null!=this.affectedTree.value)return k(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new qn(e));return new Gr(Mn(),t,this.revert)}}return k(jn(this.path)===e,"operationForChild called for unrelated child."),new Gr(Ln(this.path),this.affectedTree,this.revert)}}class Jr{constructor(e,t){this.source=e,this.path=t,this.type=Kr.LISTEN_COMPLETE}operationForChild(e){return Wn(this.path)?new Jr(this.source,Mn()):new Jr(this.source,Ln(this.path))}}class Xr{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=Kr.OVERWRITE}operationForChild(e){return Wn(this.path)?new Xr(this.source,Mn(),this.snap.getImmediateChild(e)):new Xr(this.source,Ln(this.path),this.snap)}}class Zr{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=Kr.MERGE}operationForChild(e){if(Wn(this.path)){const t=this.children.subtree(new qn(e));return t.isEmpty()?null:t.value?new Xr(this.source,Mn(),t.value):new Zr(this.source,Mn(),t)}return k(jn(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new Zr(this.source,Ln(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class ei{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(Wn(e))return this.isFullyInitialized()&&!this.filtered_;const t=jn(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class ti{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function ni(e,t,n,r,i,s){const o=r.filter((e=>e.type===n));o.sort(((t,n)=>function(e,t,n){if(null==t.childName||null==n.childName)throw P("Should only compare child_ events.");const r=new tr(t.childName,t.snapshotNode),i=new tr(n.childName,n.snapshotNode);return e.index_.compare(r,i)}(e,t,n))),o.forEach((n=>{const r=function(e,t,n){return"value"===t.type||"child_removed"===t.type||(t.prevName=n.getPredecessorChildName(t.childName,t.snapshotNode,e.index_)),t}(e,n,s);i.forEach((i=>{i.respondsTo(n.type)&&t.push(i.createEvent(r,e.query_))}))}))}function ri(e,t){return{eventCache:e,serverCache:t}}function ii(e,t,n,r){return ri(new ei(t,n,r),e.serverCache)}function si(e,t,n,r){return ri(e.eventCache,new ei(t,n,r))}function oi(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function ai(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}let ci;class li{constructor(e,t=(()=>(ci||(ci=new cr(en)),ci))()){this.value=e,this.children=t}static fromObject(e){let t=new li(null);return sn(e,((e,n)=>{t=t.set(new qn(e),n)})),t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:Mn(),value:this.value};if(Wn(e))return null;{const n=jn(e),r=this.children.get(n);if(null!==r){const i=r.findRootMostMatchingPathAndValue(Ln(e),t);if(null!=i){return{path:Un(new qn(n),i.path),value:i.value}}return null}return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,(()=>!0))}subtree(e){if(Wn(e))return this;{const t=jn(e),n=this.children.get(t);return null!==n?n.subtree(Ln(e)):new li(null)}}set(e,t){if(Wn(e))return new li(t,this.children);{const n=jn(e),r=(this.children.get(n)||new li(null)).set(Ln(e),t),i=this.children.insert(n,r);return new li(this.value,i)}}remove(e){if(Wn(e))return this.children.isEmpty()?new li(null):new li(null,this.children);{const t=jn(e),n=this.children.get(t);if(n){const r=n.remove(Ln(e));let i;return i=r.isEmpty()?this.children.remove(t):this.children.insert(t,r),null===this.value&&i.isEmpty()?new li(null):new li(this.value,i)}return this}}get(e){if(Wn(e))return this.value;{const t=jn(e),n=this.children.get(t);return n?n.get(Ln(e)):null}}setTree(e,t){if(Wn(e))return t;{const n=jn(e),r=(this.children.get(n)||new li(null)).setTree(Ln(e),t);let i;return i=r.isEmpty()?this.children.remove(n):this.children.insert(n,r),new li(this.value,i)}}fold(e){return this.fold_(Mn(),e)}fold_(e,t){const n={};return this.children.inorderTraversal(((r,i)=>{n[r]=i.fold_(Un(e,r),t)})),t(e,this.value,n)}findOnPath(e,t){return this.findOnPath_(e,Mn(),t)}findOnPath_(e,t,n){const r=!!this.value&&n(t,this.value);if(r)return r;if(Wn(e))return null;{const r=jn(e),i=this.children.get(r);return i?i.findOnPath_(Ln(e),Un(t,r),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,Mn(),t)}foreachOnPath_(e,t,n){if(Wn(e))return this;{this.value&&n(t,this.value);const r=jn(e),i=this.children.get(r);return i?i.foreachOnPath_(Ln(e),Un(t,r),n):new li(null)}}foreach(e){this.foreach_(Mn(),e)}foreach_(e,t){this.children.inorderTraversal(((n,r)=>{r.foreach_(Un(e,n),t)})),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal(((t,n)=>{n.value&&e(t,n.value)}))}}class ui{constructor(e){this.writeTree_=e}static empty(){return new ui(new li(null))}}function hi(e,t,n){if(Wn(t))return new ui(new li(n));{const r=e.writeTree_.findRootMostValueAndPath(t);if(null!=r){const i=r.path;let s=r.value;const o=Bn(i,t);return s=s.updateChild(o,n),new ui(e.writeTree_.set(i,s))}{const r=new li(n),i=e.writeTree_.setTree(t,r);return new ui(i)}}}function di(e,t,n){let r=e;return sn(n,((e,n)=>{r=hi(r,Un(t,e),n)})),r}function pi(e,t){if(Wn(t))return ui.empty();{const n=e.writeTree_.setTree(t,new li(null));return new ui(n)}}function fi(e,t){return null!=mi(e,t)}function mi(e,t){const n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(Bn(n.path,t)):null}function _i(e){const t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(yr,((e,n)=>{t.push(new tr(e,n))})):e.writeTree_.children.inorderTraversal(((e,n)=>{null!=n.value&&t.push(new tr(e,n.value))})),t}function gi(e,t){if(Wn(t))return e;{const n=mi(e,t);return new ui(null!=n?new li(n):e.writeTree_.subtree(t))}}function yi(e){return e.writeTree_.isEmpty()}function vi(e,t){return bi(Mn(),e.writeTree_,t)}function bi(e,t,n){if(null!=t.value)return n.updateChild(e,t.value);{let r=null;return t.children.inorderTraversal(((t,i)=>{".priority"===t?(k(null!==i.value,"Priority writes must always be leaf nodes"),r=i.value):n=bi(Un(e,t),i,n)})),n.getChild(e).isEmpty()||null===r||(n=n.updateChild(Un(e,".priority"),r)),n}}function wi(e,t){return Ai(t,e)}function Ci(e,t){const n=e.allWrites.findIndex((e=>e.writeId===t));k(n>=0,"removeWrite called with nonexistent writeId.");const r=e.allWrites[n];e.allWrites.splice(n,1);let i=r.visible,s=!1,o=e.allWrites.length-1;for(;i&&o>=0;){const t=e.allWrites[o];t.visible&&(o>=n&&Ei(t,r.path)?i=!1:Kn(r.path,t.path)&&(s=!0)),o--}if(i){if(s)return function(e){e.visibleWrites=Ti(e.allWrites,Si,Mn()),e.allWrites.length>0?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1}(e),!0;if(r.snap)e.visibleWrites=pi(e.visibleWrites,r.path);else{sn(r.children,(t=>{e.visibleWrites=pi(e.visibleWrites,Un(r.path,t))}))}return!0}return!1}function Ei(e,t){if(e.snap)return Kn(e.path,t);for(const n in e.children)if(e.children.hasOwnProperty(n)&&Kn(Un(e.path,n),t))return!0;return!1}function Si(e){return e.visible}function Ti(e,t,n){let r=ui.empty();for(let i=0;i<e.length;++i){const s=e[i];if(t(s)){const e=s.path;let t;if(s.snap)Kn(n,e)?(t=Bn(n,e),r=hi(r,t,s.snap)):Kn(e,n)&&(t=Bn(e,n),r=hi(r,Mn(),s.snap.getChild(t)));else{if(!s.children)throw P("WriteRecord should have .snap or .children");if(Kn(n,e))t=Bn(n,e),r=di(r,t,s.children);else if(Kn(e,n))if(t=Bn(e,n),Wn(t))r=di(r,Mn(),s.children);else{const e=X(s.children,jn(t));if(e){const n=e.getChild(Ln(t));r=hi(r,Mn(),n)}}}}}return r}function Ii(e,t,n,r,i){if(r||i){const s=gi(e.visibleWrites,t);if(!i&&yi(s))return n;if(i||null!=n||fi(s,Mn())){const s=function(e){return(e.visible||i)&&(!r||!~r.indexOf(e.writeId))&&(Kn(e.path,t)||Kn(t,e.path))};return vi(Ti(e.allWrites,s,t),n||Ir.EMPTY_NODE)}return null}{const r=mi(e.visibleWrites,t);if(null!=r)return r;{const r=gi(e.visibleWrites,t);if(yi(r))return n;if(null!=n||fi(r,Mn())){return vi(r,n||Ir.EMPTY_NODE)}return null}}}function Ni(e,t,n,r){return Ii(e.writeTree,e.treePath,t,n,r)}function ki(e,t){return function(e,t,n){let r=Ir.EMPTY_NODE;const i=mi(e.visibleWrites,t);if(i)return i.isLeafNode()||i.forEachChild(yr,((e,t)=>{r=r.updateImmediateChild(e,t)})),r;if(n){const i=gi(e.visibleWrites,t);return n.forEachChild(yr,((e,t)=>{const n=vi(gi(i,new qn(e)),t);r=r.updateImmediateChild(e,n)})),_i(i).forEach((e=>{r=r.updateImmediateChild(e.name,e.node)})),r}return _i(gi(e.visibleWrites,t)).forEach((e=>{r=r.updateImmediateChild(e.name,e.node)})),r}(e.writeTree,e.treePath,t)}function Pi(e,t,n,r){return function(e,t,n,r,i){k(r||i,"Either existingEventSnap or existingServerSnap must exist");const s=Un(t,n);if(fi(e.visibleWrites,s))return null;{const t=gi(e.visibleWrites,s);return yi(t)?i.getChild(n):vi(t,i.getChild(n))}}(e.writeTree,e.treePath,t,n,r)}function xi(e,t){return function(e,t){return mi(e.visibleWrites,t)}(e.writeTree,Un(e.treePath,t))}function Oi(e,t,n,r,i,s){return function(e,t,n,r,i,s,o){let a;const c=gi(e.visibleWrites,t),l=mi(c,Mn());if(null!=l)a=l;else{if(null==n)return[];a=vi(c,n)}if(a=a.withIndex(o),a.isEmpty()||a.isLeafNode())return[];{const e=[],t=o.getCompare(),n=s?a.getReverseIteratorFrom(r,o):a.getIteratorFrom(r,o);let c=n.getNext();for(;c&&e.length<i;)0!==t(c,r)&&e.push(c),c=n.getNext();return e}}(e.writeTree,e.treePath,t,n,r,i,s)}function Di(e,t,n){return function(e,t,n,r){const i=Un(t,n),s=mi(e.visibleWrites,i);if(null!=s)return s;if(r.isCompleteForChild(n))return vi(gi(e.visibleWrites,i),r.getNode().getImmediateChild(n));return null}(e.writeTree,e.treePath,t,n)}function Ri(e,t){return Ai(Un(e.treePath,t),e.writeTree)}function Ai(e,t){return{treePath:e,writeTree:t}}class qi{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,n=e.childName;k("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),k(".priority"!==n,"Only non-priority child changes can be tracked.");const r=this.changeMap.get(n);if(r){const i=r.type;if("child_added"===t&&"child_removed"===i)this.changeMap.set(n,Ar(n,e.snapshotNode,r.snapshotNode));else if("child_removed"===t&&"child_added"===i)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===i)this.changeMap.set(n,Rr(n,r.oldSnap));else if("child_changed"===t&&"child_added"===i)this.changeMap.set(n,Dr(n,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==i)throw P("Illegal combination of changes: "+e+" occurred after "+r);this.changeMap.set(n,Ar(n,e.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}}const Mi=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}};class ji{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const t=null!=this.optCompleteServerCache_?new ei(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Di(this.writes_,e,t)}}getChildAfterChild(e,t,n){const r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:ai(this.viewCache_),i=Oi(this.writes_,r,t,1,n,e);return 0===i.length?null:i[0]}}function Fi(e,t,n,r,i){const s=new qi;let o,a;if(n.type===Kr.OVERWRITE){const c=n;c.source.fromUser?o=$i(e,t,c.path,c.snap,r,i,s):(k(c.source.fromServer,"Unknown source."),a=c.source.tagged||t.serverCache.isFiltered()&&!Wn(c.path),o=zi(e,t,c.path,c.snap,r,i,a,s))}else if(n.type===Kr.MERGE){const c=n;c.source.fromUser?o=function(e,t,n,r,i,s,o){let a=t;return r.foreach(((r,c)=>{const l=Un(n,r);Vi(t,jn(l))&&(a=$i(e,a,l,c,i,s,o))})),r.foreach(((r,c)=>{const l=Un(n,r);Vi(t,jn(l))||(a=$i(e,a,l,c,i,s,o))})),a}(e,t,c.path,c.children,r,i,s):(k(c.source.fromServer,"Unknown source."),a=c.source.tagged||t.serverCache.isFiltered(),o=Wi(e,t,c.path,c.children,r,i,a,s))}else if(n.type===Kr.ACK_USER_WRITE){const a=n;o=a.revert?function(e,t,n,r,i,s){let o;if(null!=xi(r,n))return t;{const a=new ji(r,t,i),c=t.eventCache.getNode();let l;if(Wn(n)||".priority"===jn(n)){let n;if(t.serverCache.isFullyInitialized())n=Ni(r,ai(t));else{const e=t.serverCache.getNode();k(e instanceof Ir,"serverChildren would be complete if leaf node"),n=ki(r,e)}l=e.filter.updateFullNode(c,n,s)}else{const i=jn(n);let u=Di(r,i,t.serverCache);null==u&&t.serverCache.isCompleteForChild(i)&&(u=c.getImmediateChild(i)),l=null!=u?e.filter.updateChild(c,i,u,Ln(n),a,s):t.eventCache.getNode().hasChild(i)?e.filter.updateChild(c,i,Ir.EMPTY_NODE,Ln(n),a,s):c,l.isEmpty()&&t.serverCache.isFullyInitialized()&&(o=Ni(r,ai(t)),o.isLeafNode()&&(l=e.filter.updateFullNode(l,o,s)))}return o=t.serverCache.isFullyInitialized()||null!=xi(r,Mn()),ii(t,l,o,e.filter.filtersNodes())}}(e,t,a.path,r,i,s):function(e,t,n,r,i,s,o){if(null!=xi(i,n))return t;const a=t.serverCache.isFiltered(),c=t.serverCache;if(null!=r.value){if(Wn(n)&&c.isFullyInitialized()||c.isCompleteForPath(n))return zi(e,t,n,c.getNode().getChild(n),i,s,a,o);if(Wn(n)){let r=new li(null);return c.getNode().forEachChild(sr,((e,t)=>{r=r.set(new qn(e),t)})),Wi(e,t,n,r,i,s,a,o)}return t}{let l=new li(null);return r.foreach(((e,t)=>{const r=Un(n,e);c.isCompleteForPath(r)&&(l=l.set(e,c.getNode().getChild(r)))})),Wi(e,t,n,l,i,s,a,o)}}(e,t,a.path,a.affectedTree,r,i,s)}else{if(n.type!==Kr.LISTEN_COMPLETE)throw P("Unknown operation type: "+n.type);o=function(e,t,n,r,i){const s=t.serverCache,o=si(t,s.getNode(),s.isFullyInitialized()||Wn(n),s.isFiltered());return Li(e,o,n,r,Mi,i)}(e,t,n.path,r,s)}const c=s.getChanges();return function(e,t,n){const r=t.eventCache;if(r.isFullyInitialized()){const i=r.getNode().isLeafNode()||r.getNode().isEmpty(),s=oi(e);(n.length>0||!e.eventCache.isFullyInitialized()||i&&!r.getNode().equals(s)||!r.getNode().getPriority().equals(s.getPriority()))&&n.push(Or(oi(t)))}}(t,o,c),{viewCache:o,changes:c}}function Li(e,t,n,r,i,s){const o=t.eventCache;if(null!=xi(r,n))return t;{let a,c;if(Wn(n))if(k(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){const n=ai(t),i=ki(r,n instanceof Ir?n:Ir.EMPTY_NODE);a=e.filter.updateFullNode(t.eventCache.getNode(),i,s)}else{const n=Ni(r,ai(t));a=e.filter.updateFullNode(t.eventCache.getNode(),n,s)}else{const l=jn(n);if(".priority"===l){k(1===Fn(n),"Can't have a priority with additional path components");const i=o.getNode();c=t.serverCache.getNode();const s=Pi(r,n,i,c);a=null!=s?e.filter.updatePriority(i,s):o.getNode()}else{const u=Ln(n);let h;if(o.isCompleteForChild(l)){c=t.serverCache.getNode();const e=Pi(r,n,o.getNode(),c);h=null!=e?o.getNode().getImmediateChild(l).updateChild(u,e):o.getNode().getImmediateChild(l)}else h=Di(r,l,t.serverCache);a=null!=h?e.filter.updateChild(o.getNode(),l,h,u,i,s):o.getNode()}}return ii(t,a,o.isFullyInitialized()||Wn(n),e.filter.filtersNodes())}}function zi(e,t,n,r,i,s,o,a){const c=t.serverCache;let l;const u=o?e.filter:e.filter.getIndexedFilter();if(Wn(n))l=u.updateFullNode(c.getNode(),r,null);else if(u.filtersNodes()&&!c.isFiltered()){const e=c.getNode().updateChild(n,r);l=u.updateFullNode(c.getNode(),e,null)}else{const e=jn(n);if(!c.isCompleteForPath(n)&&Fn(n)>1)return t;const i=Ln(n),s=c.getNode().getImmediateChild(e).updateChild(i,r);l=".priority"===e?u.updatePriority(c.getNode(),s):u.updateChild(c.getNode(),e,s,i,Mi,null)}const h=si(t,l,c.isFullyInitialized()||Wn(n),u.filtersNodes());return Li(e,h,n,i,new ji(i,h,s),a)}function $i(e,t,n,r,i,s,o){const a=t.eventCache;let c,l;const u=new ji(i,t,s);if(Wn(n))l=e.filter.updateFullNode(t.eventCache.getNode(),r,o),c=ii(t,l,!0,e.filter.filtersNodes());else{const i=jn(n);if(".priority"===i)l=e.filter.updatePriority(t.eventCache.getNode(),r),c=ii(t,l,a.isFullyInitialized(),a.isFiltered());else{const s=Ln(n),l=a.getNode().getImmediateChild(i);let h;if(Wn(s))h=r;else{const e=u.getCompleteChild(i);h=null!=e?".priority"===zn(s)&&e.getChild(Vn(s)).isEmpty()?e:e.updateChild(s,r):Ir.EMPTY_NODE}if(l.equals(h))c=t;else{c=ii(t,e.filter.updateChild(a.getNode(),i,h,s,u,o),a.isFullyInitialized(),e.filter.filtersNodes())}}}return c}function Vi(e,t){return e.eventCache.isCompleteForChild(t)}function Ui(e,t,n){return n.foreach(((e,n)=>{t=t.updateChild(e,n)})),t}function Wi(e,t,n,r,i,s,o,a){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let c,l=t;c=Wn(n)?r:new li(null).setTree(n,r);const u=t.serverCache.getNode();return c.children.inorderTraversal(((n,r)=>{if(u.hasChild(n)){const c=Ui(0,t.serverCache.getNode().getImmediateChild(n),r);l=zi(e,l,new qn(n),c,i,s,o,a)}})),c.children.inorderTraversal(((n,r)=>{const c=!t.serverCache.isCompleteForChild(n)&&null===r.value;if(!u.hasChild(n)&&!c){const c=Ui(0,t.serverCache.getNode().getImmediateChild(n),r);l=zi(e,l,new qn(n),c,i,s,o,a)}})),l}class Bi{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const n=this.query_._queryParams,r=new qr(n.getIndex()),i=(s=n).loadsAllData()?new qr(s.getIndex()):s.hasLimit()?new jr(s):new Mr(s);var s;this.processor_=function(e){return{filter:e}}(i);const o=t.serverCache,a=t.eventCache,c=r.updateFullNode(Ir.EMPTY_NODE,o.getNode(),null),l=i.updateFullNode(Ir.EMPTY_NODE,a.getNode(),null),u=new ei(c,o.isFullyInitialized(),r.filtersNodes()),h=new ei(l,a.isFullyInitialized(),i.filtersNodes());this.viewCache_=ri(h,u),this.eventGenerator_=new ti(this.query_)}get query(){return this.query_}}function Hi(e,t){const n=ai(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!Wn(t)&&!n.getImmediateChild(jn(t)).isEmpty())?n.getChild(t):null}function Qi(e){return 0===e.eventRegistrations_.length}function Ki(e,t,n){const r=[];if(n){k(null==t,"A cancel should cancel all event registrations.");const i=e.query._path;e.eventRegistrations_.forEach((e=>{const t=e.createCancelEvent(n,i);t&&r.push(t)}))}if(t){let n=[];for(let r=0;r<e.eventRegistrations_.length;++r){const i=e.eventRegistrations_[r];if(i.matches(t)){if(t.hasAnyCallback()){n=n.concat(e.eventRegistrations_.slice(r+1));break}}else n.push(i)}e.eventRegistrations_=n}else e.eventRegistrations_=[];return r}function Yi(e,t,n,r){t.type===Kr.MERGE&&null!==t.source.queryId&&(k(ai(e.viewCache_),"We should always have a full cache before handling merges"),k(oi(e.viewCache_),"Missing event cache, even though we have a server cache"));const i=e.viewCache_,s=Fi(e.processor_,i,t,n,r);var o,a;return o=e.processor_,a=s.viewCache,k(a.eventCache.getNode().isIndexed(o.filter.getIndex()),"Event snap not indexed"),k(a.serverCache.getNode().isIndexed(o.filter.getIndex()),"Server snap not indexed"),k(s.viewCache.serverCache.isFullyInitialized()||!i.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=s.viewCache,Gi(e,s.changes,s.viewCache.eventCache.getNode(),null)}function Gi(e,t,n,r){const i=r?[r]:e.eventRegistrations_;return function(e,t,n,r){const i=[],s=[];return t.forEach((t=>{var n;"child_changed"===t.type&&e.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&s.push((n=t.childName,{type:"child_moved",snapshotNode:t.snapshotNode,childName:n}))})),ni(e,i,"child_removed",t,r,n),ni(e,i,"child_added",t,r,n),ni(e,i,"child_moved",s,r,n),ni(e,i,"child_changed",t,r,n),ni(e,i,"value",t,r,n),i}(e.eventGenerator_,t,n,i)}let Ji,Xi;class Zi{constructor(){this.views=new Map}}function es(e,t,n,r){const i=t.source.queryId;if(null!==i){const s=e.views.get(i);return k(null!=s,"SyncTree gave us an op for an invalid query."),Yi(s,t,n,r)}{let i=[];for(const s of e.views.values())i=i.concat(Yi(s,t,n,r));return i}}function ts(e,t,n,r,i){const s=t._queryIdentifier,o=e.views.get(s);if(!o){let e=Ni(n,i?r:null),s=!1;e?s=!0:r instanceof Ir?(e=ki(n,r),s=!1):(e=Ir.EMPTY_NODE,s=!1);const o=ri(new ei(e,s,!1),new ei(r,i,!1));return new Bi(t,o)}return o}function ns(e,t,n,r,i,s){const o=ts(e,t,r,i,s);return e.views.has(t._queryIdentifier)||e.views.set(t._queryIdentifier,o),function(e,t){e.eventRegistrations_.push(t)}(o,n),function(e,t){const n=e.viewCache_.eventCache,r=[];n.getNode().isLeafNode()||n.getNode().forEachChild(yr,((e,t)=>{r.push(Dr(e,t))}));return n.isFullyInitialized()&&r.push(Or(n.getNode())),Gi(e,r,n.getNode(),t)}(o,n)}function rs(e,t,n,r){const i=t._queryIdentifier,s=[];let o=[];const a=cs(e);if("default"===i)for(const[t,i]of e.views.entries())o=o.concat(Ki(i,n,r)),Qi(i)&&(e.views.delete(t),i.query._queryParams.loadsAllData()||s.push(i.query));else{const t=e.views.get(i);t&&(o=o.concat(Ki(t,n,r)),Qi(t)&&(e.views.delete(i),t.query._queryParams.loadsAllData()||s.push(t.query)))}return a&&!cs(e)&&s.push(new(k(Ji,"Reference.ts has not been loaded"),Ji)(t._repo,t._path)),{removed:s,events:o}}function is(e){const t=[];for(const n of e.views.values())n.query._queryParams.loadsAllData()||t.push(n);return t}function ss(e,t){let n=null;for(const r of e.views.values())n=n||Hi(r,t);return n}function os(e,t){if(t._queryParams.loadsAllData())return ls(e);{const n=t._queryIdentifier;return e.views.get(n)}}function as(e,t){return null!=os(e,t)}function cs(e){return null!=ls(e)}function ls(e){for(const t of e.views.values())if(t.query._queryParams.loadsAllData())return t;return null}let us=1;class hs{constructor(e){this.listenProvider_=e,this.syncPointTree_=new li(null),this.pendingWriteTree_={visibleWrites:ui.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function ds(e,t,n,r,i){return function(e,t,n,r,i){k(r>e.lastWriteId,"Stacking an older write on top of newer ones"),void 0===i&&(i=!0),e.allWrites.push({path:t,snap:n,writeId:r,visible:i}),i&&(e.visibleWrites=hi(e.visibleWrites,t,n)),e.lastWriteId=r}(e.pendingWriteTree_,t,n,r,i),i?ws(e,new Xr({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},t,n)):[]}function ps(e,t,n,r){!function(e,t,n,r){k(r>e.lastWriteId,"Stacking an older merge on top of newer ones"),e.allWrites.push({path:t,children:n,writeId:r,visible:!0}),e.visibleWrites=di(e.visibleWrites,t,n),e.lastWriteId=r}(e.pendingWriteTree_,t,n,r);const i=li.fromObject(n);return ws(e,new Zr({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},t,i))}function fs(e,t,n=!1){const r=function(e,t){for(let n=0;n<e.allWrites.length;n++){const r=e.allWrites[n];if(r.writeId===t)return r}return null}(e.pendingWriteTree_,t);if(Ci(e.pendingWriteTree_,t)){let t=new li(null);return null!=r.snap?t=t.set(Mn(),!0):sn(r.children,(e=>{t=t.set(new qn(e),!0)})),ws(e,new Gr(r.path,t,n))}return[]}function ms(e,t,n){return ws(e,new Xr({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,n))}function _s(e,t,n,r,i=!1){const s=t._path,o=e.syncPointTree_.get(s);let a=[];if(o&&("default"===t._queryIdentifier||as(o,t))){const c=rs(o,t,n,r);0===o.views.size&&(e.syncPointTree_=e.syncPointTree_.remove(s));const l=c.removed;if(a=c.events,!i){const n=-1!==l.findIndex((e=>e._queryParams.loadsAllData())),i=e.syncPointTree_.findOnPath(s,((e,t)=>cs(t)));if(n&&!i){const t=e.syncPointTree_.subtree(s);if(!t.isEmpty()){const n=function(e){return e.fold(((e,t,n)=>{if(t&&cs(t)){return[ls(t)]}{let e=[];return t&&(e=is(t)),sn(n,((t,n)=>{e=e.concat(n)})),e}}))}(t);for(let t=0;t<n.length;++t){const r=n[t],i=r.query,s=Ss(e,r);e.listenProvider_.startListening(xs(i),Ts(e,i),s.hashFn,s.onComplete)}}}if(!i&&l.length>0&&!r)if(n){const n=null;e.listenProvider_.stopListening(xs(t),n)}else l.forEach((t=>{const n=e.queryToTagMap.get(Is(t));e.listenProvider_.stopListening(xs(t),n)}))}!function(e,t){for(let n=0;n<t.length;++n){const r=t[n];if(!r._queryParams.loadsAllData()){const t=Is(r),n=e.queryToTagMap.get(t);e.queryToTagMap.delete(t),e.tagToQueryMap.delete(n)}}}(e,l)}return a}function gs(e,t,n,r){const i=Ns(e,r);if(null!=i){const r=ks(i),s=r.path,o=r.queryId,a=Bn(s,t);return Ps(e,s,new Xr(Yr(o),a,n))}return[]}function ys(e,t,n,r=!1){const i=t._path;let s=null,o=!1;e.syncPointTree_.foreachOnPath(i,((e,t)=>{const n=Bn(e,i);s=s||ss(t,n),o=o||cs(t)}));let a,c=e.syncPointTree_.get(i);if(c?(o=o||cs(c),s=s||ss(c,Mn())):(c=new Zi,e.syncPointTree_=e.syncPointTree_.set(i,c)),null!=s)a=!0;else{a=!1,s=Ir.EMPTY_NODE;e.syncPointTree_.subtree(i).foreachChild(((e,t)=>{const n=ss(t,Mn());n&&(s=s.updateImmediateChild(e,n))}))}const l=as(c,t);if(!l&&!t._queryParams.loadsAllData()){const n=Is(t);k(!e.queryToTagMap.has(n),"View does not exist, but we have a tag");const r=us++;e.queryToTagMap.set(n,r),e.tagToQueryMap.set(r,n)}let u=ns(c,t,n,wi(e.pendingWriteTree_,i),s,a);if(!l&&!o&&!r){const n=os(c,t);u=u.concat(function(e,t,n){const r=t._path,i=Ts(e,t),s=Ss(e,n),o=e.listenProvider_.startListening(xs(t),i,s.hashFn,s.onComplete),a=e.syncPointTree_.subtree(r);if(i)k(!cs(a.value),"If we're adding a query, it shouldn't be shadowed");else{const t=a.fold(((e,t,n)=>{if(!Wn(e)&&t&&cs(t))return[ls(t).query];{let e=[];return t&&(e=e.concat(is(t).map((e=>e.query)))),sn(n,((t,n)=>{e=e.concat(n)})),e}}));for(let n=0;n<t.length;++n){const r=t[n];e.listenProvider_.stopListening(xs(r),Ts(e,r))}}return o}(e,t,n))}return u}function vs(e,t,n){const r=e.pendingWriteTree_,i=e.syncPointTree_.findOnPath(t,((e,n)=>{const r=ss(n,Bn(e,t));if(r)return r}));return Ii(r,t,i,n,!0)}function bs(e,t){const n=t._path;let r=null;e.syncPointTree_.foreachOnPath(n,((e,t)=>{const i=Bn(e,n);r=r||ss(t,i)}));let i=e.syncPointTree_.get(n);i?r=r||ss(i,Mn()):(i=new Zi,e.syncPointTree_=e.syncPointTree_.set(n,i));const s=null!=r,o=s?new ei(r,!0,!1):null;return function(e){return oi(e.viewCache_)}(ts(i,t,wi(e.pendingWriteTree_,t._path),s?o.getNode():Ir.EMPTY_NODE,s))}function ws(e,t){return Cs(t,e.syncPointTree_,null,wi(e.pendingWriteTree_,Mn()))}function Cs(e,t,n,r){if(Wn(e.path))return Es(e,t,n,r);{const i=t.get(Mn());null==n&&null!=i&&(n=ss(i,Mn()));let s=[];const o=jn(e.path),a=e.operationForChild(o),c=t.children.get(o);if(c&&a){const e=n?n.getImmediateChild(o):null,t=Ri(r,o);s=s.concat(Cs(a,c,e,t))}return i&&(s=s.concat(es(i,e,r,n))),s}}function Es(e,t,n,r){const i=t.get(Mn());null==n&&null!=i&&(n=ss(i,Mn()));let s=[];return t.children.inorderTraversal(((t,i)=>{const o=n?n.getImmediateChild(t):null,a=Ri(r,t),c=e.operationForChild(t);c&&(s=s.concat(Es(c,i,o,a)))})),i&&(s=s.concat(es(i,e,r,n))),s}function Ss(e,t){const n=t.query,r=Ts(e,n);return{hashFn:()=>{const e=function(e){return e.viewCache_.serverCache.getNode()}(t)||Ir.EMPTY_NODE;return e.hash()},onComplete:t=>{if("ok"===t)return r?function(e,t,n){const r=Ns(e,n);if(r){const n=ks(r),i=n.path,s=n.queryId,o=Bn(i,t);return Ps(e,i,new Jr(Yr(s),o))}return[]}(e,n._path,r):function(e,t){return ws(e,new Jr({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t))}(e,n._path);{const r=function(e,t){let n="Unknown Error";"too_big"===e?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===e?n="Client doesn't have permission to access the desired data.":"unavailable"===e&&(n="The service is unavailable");const r=new Error(e+" at "+t._path.toString()+": "+n);return r.code=e.toUpperCase(),r}(t,n);return _s(e,n,null,r)}}}}function Ts(e,t){const n=Is(t);return e.queryToTagMap.get(n)}function Is(e){return e._path.toString()+"$"+e._queryIdentifier}function Ns(e,t){return e.tagToQueryMap.get(t)}function ks(e){const t=e.indexOf("$");return k(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new qn(e.substr(0,t))}}function Ps(e,t,n){const r=e.syncPointTree_.get(t);k(r,"Missing sync point for query tag that we're tracking");return es(r,n,wi(e.pendingWriteTree_,t),null)}function xs(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?new(k(Xi,"Reference.ts has not been loaded"),Xi)(e._repo,e._path):e}class Os{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new Os(t)}node(){return this.node_}}class Ds{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=Un(this.path_,e);return new Ds(this.syncTree_,t)}node(){return vs(this.syncTree_,this.path_)}}const Rs=function(e,t,n){return e&&"object"==typeof e?(k(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"]?As(e[".sv"],t,n):"object"==typeof e[".sv"]?qs(e[".sv"],t):void k(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e},As=function(e,t,n){if("timestamp"===e)return n.timestamp;k(!1,"Unexpected server value: "+e)},qs=function(e,t,n){e.hasOwnProperty("increment")||k(!1,"Unexpected server value: "+JSON.stringify(e,null,2));const r=e.increment;"number"!=typeof r&&k(!1,"Unexpected increment value: "+r);const i=t.node();if(k(null!=i,"Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;const s=i.getValue();return"number"!=typeof s?r:s+r},Ms=function(e,t,n,r){return Fs(t,new Ds(n,e),r)},js=function(e,t,n){return Fs(e,new Os(t),n)};function Fs(e,t,n){const r=e.getPriority().val(),i=Rs(r,t.getImmediateChild(".priority"),n);let s;if(e.isLeafNode()){const r=e,s=Rs(r.getValue(),t,n);return s!==r.getValue()||i!==r.getPriority().val()?new gr(s,kr(i)):e}{const r=e;return s=r,i!==r.getPriority().val()&&(s=s.updatePriority(new gr(i))),r.forEachChild(yr,((e,r)=>{const i=Fs(r,t.getImmediateChild(e),n);i!==r&&(s=s.updateImmediateChild(e,i))})),s}}class Ls{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}}function zs(e,t){let n=t instanceof qn?t:new qn(t),r=e,i=jn(n);for(;null!==i;){const e=X(r.node.children,i)||{children:{},childCount:0};r=new Ls(i,r,e),n=Ln(n),i=jn(n)}return r}function $s(e){return e.node.value}function Vs(e,t){e.node.value=t,Qs(e)}function Us(e){return e.node.childCount>0}function Ws(e,t){sn(e.node.children,((n,r)=>{t(new Ls(n,e,r))}))}function Bs(e,t,n,r){n&&!r&&t(e),Ws(e,(e=>{Bs(e,t,!0,r)})),n&&r&&t(e)}function Hs(e){return new qn(null===e.parent?e.name:Hs(e.parent)+"/"+e.name)}function Qs(e){null!==e.parent&&function(e,t,n){const r=function(e){return void 0===$s(e)&&!Us(e)}(n),i=J(e.node.children,t);r&&i?(delete e.node.children[t],e.node.childCount--,Qs(e)):r||i||(e.node.children[t]=n.node,e.node.childCount++,Qs(e))}(e.parent,e.name,e)}const Ks=/[\[\].#$\/\u0000-\u001F\u007F]/,Ys=/[\[\].#$\u0000-\u001F\u007F]/,Gs=10485760,Js=function(e){return"string"==typeof e&&0!==e.length&&!Ks.test(e)},Xs=function(e){return"string"==typeof e&&0!==e.length&&!Ys.test(e)},Zs=function(e,t,n){const r=n instanceof qn?new Yn(n,e):n;if(void 0===t)throw new Error(e+"contains undefined "+Jn(r));if("function"==typeof t)throw new Error(e+"contains a function "+Jn(r)+" with contents = "+t.toString());if(Gt(t))throw new Error(e+"contains "+t.toString()+" "+Jn(r));if("string"==typeof t&&t.length>Gs/3&&se(t)>Gs)throw new Error(e+"contains a string greater than "+Gs+" utf8 bytes "+Jn(r)+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){let n=!1,i=!1;if(sn(t,((t,s)=>{if(".value"===t)n=!0;else if(".priority"!==t&&".sv"!==t&&(i=!0,!Js(t)))throw new Error(e+" contains an invalid key ("+t+") "+Jn(r)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');!function(e,t){e.parts_.length>0&&(e.byteLength_+=1),e.parts_.push(t),e.byteLength_+=se(t),Gn(e)}(r,t),Zs(e,s,r),function(e){const t=e.parts_.pop();e.byteLength_-=se(t),e.parts_.length>0&&(e.byteLength_-=1)}(r)})),n&&i)throw new Error(e+' contains ".value" child '+Jn(r)+" in addition to actual children.")}},eo=function(e,t,n,r){const i=ie(e,"values");if(!t||"object"!=typeof t||Array.isArray(t))throw new Error(i+" must be an object containing the children to replace.");const s=[];sn(t,((e,t)=>{const r=new qn(e);if(Zs(i,t,Un(n,r)),".priority"===zn(r)&&!(null===(o=t)||"string"==typeof o||"number"==typeof o&&!Gt(o)||o&&"object"==typeof o&&J(o,".sv")))throw new Error(i+"contains an invalid value for '"+r.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");var o;s.push(r)})),function(e,t){let n,r;for(n=0;n<t.length;n++){r=t[n];const i=$n(r);for(let t=0;t<i.length;t++)if(".priority"===i[t]&&t===i.length-1);else if(!Js(i[t]))throw new Error(e+"contains an invalid key ("+i[t]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}t.sort(Hn);let i=null;for(n=0;n<t.length;n++){if(r=t[n],null!==i&&Kn(i,r))throw new Error(e+"contains a path "+i.toString()+" that is ancestor of another path "+r.toString());i=r}}(i,s)},to=function(e,t,n,r){if(!Xs(n))throw new Error(ie(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},no=function(e,t){const n=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!Js(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==n.length&&!function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),Xs(e)}(n))throw new Error(ie(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class ro{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function io(e,t){let n=null;for(let r=0;r<t.length;r++){const i=t[r],s=i.getPath();null===n||Qn(s,n.path)||(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:s}),n.events.push(i)}n&&e.eventLists_.push(n)}function so(e,t,n){io(e,n),function(e,t){e.recursionDepth_++;let n=!0;for(let r=0;r<e.eventLists_.length;r++){const i=e.eventLists_[r];if(i){t(i.path)?(oo(e.eventLists_[r]),e.eventLists_[r]=null):n=!1}}n&&(e.eventLists_=[]);e.recursionDepth_--}(e,(e=>Kn(e,t)||Kn(t,e)))}function oo(e){for(let t=0;t<e.events.length;t++){const n=e.events[t];if(null!==n){e.events[t]=null;const r=n.getEventRunner();Ut&&Bt("event: "+n.toString()),ln(r)}}}class ao{constructor(e,t,n,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new ro,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Ur(),this.transactionQueueTree_=new Ls,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function co(e,t,n){if(e.stats_=En(e.repoInfo_),e.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)e.server_=new $r(e.repoInfo_,((t,n,r,i)=>{ho(e,t,n,r,i)}),e.authTokenProvider_,e.appCheckProvider_),setTimeout((()=>po(e,!0)),0);else{if(null!=n){if("object"!=typeof n)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Y(n)}catch(e){throw new Error("Invalid authOverride provided: "+e)}}e.persistentConnection_=new er(e.repoInfo_,t,((t,n,r,i)=>{ho(e,t,n,r,i)}),(t=>{po(e,t)}),(t=>{!function(e,t){sn(t,((t,n)=>{fo(e,t,n)}))}(e,t)}),e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener((t=>{e.server_.refreshAuthToken(t)})),e.appCheckProvider_.addTokenChangeListener((t=>{e.server_.refreshAppCheckToken(t.token)})),e.statsReporter_=function(e,t){const n=e.toString();return Cn[n]||(Cn[n]=t()),Cn[n]}(e.repoInfo_,(()=>new Qr(e.stats_,e.server_))),e.infoData_=new Vr,e.infoSyncTree_=new hs({startListening:(t,n,r,i)=>{let s=[];const o=e.infoData_.getNode(t._path);return o.isEmpty()||(s=ms(e.infoSyncTree_,t._path,o),setTimeout((()=>{i("ok")}),0)),s},stopListening:()=>{}}),fo(e,"connected",!1),e.serverSyncTree_=new hs({startListening:(t,n,r,i)=>(e.server_.listen(t,r,n,((n,r)=>{const s=i(n,r);so(e.eventQueue_,t._path,s)})),[]),stopListening:(t,n)=>{e.server_.unlisten(t,n)}})}function lo(e){const t=e.infoData_.getNode(new qn(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t}function uo(e){return(t=(t={timestamp:lo(e)})||{}).timestamp=t.timestamp||(new Date).getTime(),t;var t}function ho(e,t,n,r,i){e.dataUpdateCount++;const s=new qn(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;let o=[];if(i)if(r){const t=ee(n,(e=>kr(e)));o=function(e,t,n,r){const i=Ns(e,r);if(i){const r=ks(i),s=r.path,o=r.queryId,a=Bn(s,t),c=li.fromObject(n);return Ps(e,s,new Zr(Yr(o),a,c))}return[]}(e.serverSyncTree_,s,t,i)}else{const t=kr(n);o=gs(e.serverSyncTree_,s,t,i)}else if(r){const t=ee(n,(e=>kr(e)));o=function(e,t,n){const r=li.fromObject(n);return ws(e,new Zr({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,r))}(e.serverSyncTree_,s,t)}else{const t=kr(n);o=ms(e.serverSyncTree_,s,t)}let a=s;o.length>0&&(a=bo(e,s)),so(e.eventQueue_,a,o)}function po(e,t){fo(e,"connected",t),!1===t&&function(e){_o(e,"onDisconnectEvents");const t=uo(e),n=Ur();Br(e.onDisconnect_,Mn(),((r,i)=>{const s=Ms(r,i,e.serverSyncTree_,t);Wr(n,r,s)}));let r=[];Br(n,Mn(),((t,n)=>{r=r.concat(ms(e.serverSyncTree_,t,n));const i=To(e,t);bo(e,i)})),e.onDisconnect_=Ur(),so(e.eventQueue_,Mn(),r)}(e)}function fo(e,t,n){const r=new qn("/.info/"+t),i=kr(n);e.infoData_.updateSnapshot(r,i);const s=ms(e.infoSyncTree_,r,i);so(e.eventQueue_,r,s)}function mo(e){return e.nextWriteId_++}function _o(e,...t){let n="";e.persistentConnection_&&(n=e.persistentConnection_.id+":"),Bt(n,...t)}function go(e,t,n,r){t&&ln((()=>{if("ok"===n)t(null);else{const e=(n||"error").toUpperCase();let i=e;r&&(i+=": "+r);const s=new Error(i);s.code=e,t(s)}}))}function yo(e,t,n){return vs(e.serverSyncTree_,t,n)||Ir.EMPTY_NODE}function vo(e,t=e.transactionQueueTree_){if(t||So(e,t),$s(t)){const n=Co(e,t);k(n.length>0,"Sending zero length transaction queue");n.every((e=>0===e.status))&&function(e,t,n){const r=n.map((e=>e.currentWriteId)),i=yo(e,t,r);let s=i;const o=i.hash();for(let e=0;e<n.length;e++){const r=n[e];k(0===r.status,"tryToSendTransactionQueue_: items in queue should all be run."),r.status=1,r.retryCount++;const i=Bn(t,r.path);s=s.updateChild(i,r.currentOutputSnapshotRaw)}const a=s.val(!0),c=t;e.server_.put(c.toString(),a,(r=>{_o(e,"transaction put response",{path:c.toString(),status:r});let i=[];if("ok"===r){const r=[];for(let t=0;t<n.length;t++)n[t].status=2,i=i.concat(fs(e.serverSyncTree_,n[t].currentWriteId)),n[t].onComplete&&r.push((()=>n[t].onComplete(null,!0,n[t].currentOutputSnapshotResolved))),n[t].unwatcher();So(e,zs(e.transactionQueueTree_,t)),vo(e,e.transactionQueueTree_),so(e.eventQueue_,t,i);for(let e=0;e<r.length;e++)ln(r[e])}else{if("datastale"===r)for(let e=0;e<n.length;e++)3===n[e].status?n[e].status=4:n[e].status=0;else{Yt("transaction at "+c.toString()+" failed: "+r);for(let e=0;e<n.length;e++)n[e].status=4,n[e].abortReason=r}bo(e,t)}}),o)}(e,Hs(t),n)}else Us(t)&&Ws(t,(t=>{vo(e,t)}))}function bo(e,t){const n=wo(e,t),r=Hs(n);return function(e,t,n){if(0===t.length)return;const r=[];let i=[];const s=t.filter((e=>0===e.status)),o=s.map((e=>e.currentWriteId));for(let s=0;s<t.length;s++){const c=t[s],l=Bn(n,c.path);let u,h=!1;if(k(null!==l,"rerunTransactionsUnderNode_: relativePath should not be null."),4===c.status)h=!0,u=c.abortReason,i=i.concat(fs(e.serverSyncTree_,c.currentWriteId,!0));else if(0===c.status)if(c.retryCount>=25)h=!0,u="maxretry",i=i.concat(fs(e.serverSyncTree_,c.currentWriteId,!0));else{const n=yo(e,c.path,o);c.currentInputSnapshot=n;const r=t[s].update(n.val());if(void 0!==r){Zs("transaction failed: Data returned ",r,c.path);let t=kr(r);"object"==typeof r&&null!=r&&J(r,".priority")||(t=t.updatePriority(n.getPriority()));const s=c.currentWriteId,a=uo(e),l=js(t,n,a);c.currentOutputSnapshotRaw=t,c.currentOutputSnapshotResolved=l,c.currentWriteId=mo(e),o.splice(o.indexOf(s),1),i=i.concat(ds(e.serverSyncTree_,c.path,l,c.currentWriteId,c.applyLocally)),i=i.concat(fs(e.serverSyncTree_,s,!0))}else h=!0,u="nodata",i=i.concat(fs(e.serverSyncTree_,c.currentWriteId,!0))}so(e.eventQueue_,n,i),i=[],h&&(t[s].status=2,a=t[s].unwatcher,setTimeout(a,Math.floor(0)),t[s].onComplete&&("nodata"===u?r.push((()=>t[s].onComplete(null,!1,t[s].currentInputSnapshot))):r.push((()=>t[s].onComplete(new Error(u),!1,null)))))}var a;So(e,e.transactionQueueTree_);for(let e=0;e<r.length;e++)ln(r[e]);vo(e,e.transactionQueueTree_)}(e,Co(e,n),r),r}function wo(e,t){let n,r=e.transactionQueueTree_;for(n=jn(t);null!==n&&void 0===$s(r);)r=zs(r,n),n=jn(t=Ln(t));return r}function Co(e,t){const n=[];return Eo(e,t,n),n.sort(((e,t)=>e.order-t.order)),n}function Eo(e,t,n){const r=$s(t);if(r)for(let e=0;e<r.length;e++)n.push(r[e]);Ws(t,(t=>{Eo(e,t,n)}))}function So(e,t){const n=$s(t);if(n){let e=0;for(let t=0;t<n.length;t++)2!==n[t].status&&(n[e]=n[t],e++);n.length=e,Vs(t,n.length>0?n:void 0)}Ws(t,(t=>{So(e,t)}))}function To(e,t){const n=Hs(wo(e,t)),r=zs(e.transactionQueueTree_,t);return function(e,t){let n=e.parent;for(;null!==n;){if(t(n))return!0;n=n.parent}}(r,(t=>{Io(e,t)})),Io(e,r),Bs(r,(t=>{Io(e,t)})),n}function Io(e,t){const n=$s(t);if(n){const r=[];let i=[],s=-1;for(let t=0;t<n.length;t++)3===n[t].status||(1===n[t].status?(k(s===t-1,"All SENT items should be at beginning of queue."),s=t,n[t].status=3,n[t].abortReason="set"):(k(0===n[t].status,"Unexpected transaction status in abort"),n[t].unwatcher(),i=i.concat(fs(e.serverSyncTree_,n[t].currentWriteId,!0)),n[t].onComplete&&r.push(n[t].onComplete.bind(null,new Error("set"),!1,null))));-1===s?Vs(t,void 0):n.length=s+1,so(e.eventQueue_,Hs(t),i);for(let e=0;e<r.length;e++)ln(r[e])}}const No=function(e,t){const n=ko(e),r=n.namespace;"firebase.com"===n.domain&&Kt(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),r&&"undefined"!==r||"localhost"===n.domain||Kt("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&Yt("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");const i="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new yn(n.host,n.secure,r,i,t,"",r!==n.subdomain),path:new qn(n.pathString)}},ko=function(e){let t="",n="",r="",i="",s="",o=!0,a="https",c=443;if("string"==typeof e){let l=e.indexOf("//");l>=0&&(a=e.substring(0,l-1),e=e.substring(l+2));let u=e.indexOf("/");-1===u&&(u=e.length);let h=e.indexOf("?");-1===h&&(h=e.length),t=e.substring(0,Math.min(u,h)),u<h&&(i=function(e){let t="";const n=e.split("/");for(let e=0;e<n.length;e++)if(n[e].length>0){let r=n[e];try{r=decodeURIComponent(r.replace(/\+/g," "))}catch(e){}t+="/"+r}return t}(e.substring(u,h)));const d=function(e){const t={};"?"===e.charAt(0)&&(e=e.substring(1));for(const n of e.split("&")){if(0===n.length)continue;const r=n.split("=");2===r.length?t[decodeURIComponent(r[0])]=decodeURIComponent(r[1]):Yt(`Invalid query segment '${n}' in query '${e}'`)}return t}(e.substring(Math.min(e.length,h)));l=t.indexOf(":"),l>=0?(o="https"===a||"wss"===a,c=parseInt(t.substring(l+1),10)):l=t.length;const p=t.slice(0,l);if("localhost"===p.toLowerCase())n="localhost";else if(p.split(".").length<=2)n=p;else{const e=t.indexOf(".");r=t.substring(0,e).toLowerCase(),n=t.substring(e+1),s=r}"ns"in d&&(s=d.ns)}return{host:t,port:c,domain:n,subdomain:r,secure:o,scheme:a,pathString:i,namespace:s}};class Po{constructor(e,t,n,r){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=r}getPath(){const e=this.snapshot.ref;return"value"===this.eventType?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+Y(this.snapshot.exportVal())}}class xo{constructor(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class Oo{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return k(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class Do{constructor(e,t,n,r){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=r}get key(){return Wn(this._path)?null:zn(this._path)}get ref(){return new Ro(this._repo,this._path)}get _queryIdentifier(){const e=zr(this._queryParams),t=nn(e);return"{}"===t?"default":t}get _queryObject(){return zr(this._queryParams)}isEqual(e){if(!((e=oe(e))instanceof Do))return!1;const t=this._repo===e._repo,n=Qn(this._path,e._path),r=this._queryIdentifier===e._queryIdentifier;return t&&n&&r}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(e){let t="";for(let n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}(this._path)}}class Ro extends Do{constructor(e,t){super(e,t,new Fr,!1)}get parent(){const e=Vn(this._path);return null===e?null:new Ro(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class Ao{constructor(e,t,n){this._node=e,this.ref=t,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new qn(e),n=Mo(this.ref,e);return new Ao(this._node.getChild(t),n,yr)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){if(this._node.isLeafNode())return!1;return!!this._node.forEachChild(this._index,((t,n)=>e(new Ao(n,Mo(this.ref,t),yr))))}hasChild(e){const t=new qn(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function qo(e,t){return(e=oe(e))._checkNotDeleted("ref"),void 0!==t?Mo(e._root,t):e._root}function Mo(e,t){var n,r,i;return null===jn((e=oe(e))._path)?(n="child",r="path",(i=t)&&(i=i.replace(/^\/*\.info(\/|$)/,"/")),to(n,r,i)):to("child","path",t),new Ro(e._repo,Un(e._path,t))}function jo(e,t){eo("update",t,e._path);const n=new V;return function(e,t,n,r){_o(e,"update",{path:t.toString(),value:n});let i=!0;const s=uo(e),o={};if(sn(n,((n,r)=>{i=!1,o[n]=Ms(Un(t,n),kr(r),e.serverSyncTree_,s)})),i)Bt("update() called with empty data.  Don't do anything."),go(0,r,"ok",void 0);else{const i=mo(e),s=ps(e.serverSyncTree_,t,o,i);io(e.eventQueue_,s),e.server_.merge(t.toString(),n,((n,s)=>{const o="ok"===n;o||Yt("update at "+t+" failed: "+n);const a=fs(e.serverSyncTree_,i,!o),c=a.length>0?bo(e,t):t;so(e.eventQueue_,c,a),go(0,r,n,s)})),sn(n,(n=>{const r=To(e,Un(t,n));bo(e,r)})),so(e.eventQueue_,t,[])}}(e._repo,e._path,t,n.wrapCallback((()=>{}))),n.promise}function Fo(e){e=oe(e);const t=new Oo((()=>{})),n=new Lo(t);return function(e,t,n){const r=bs(e.serverSyncTree_,t);return null!=r?Promise.resolve(r):e.server_.get(t).then((r=>{const i=kr(r).withIndex(t._queryParams.getIndex());let s;if(ys(e.serverSyncTree_,t,n,!0),t._queryParams.loadsAllData())s=ms(e.serverSyncTree_,t._path,i);else{const n=Ts(e.serverSyncTree_,t);s=gs(e.serverSyncTree_,t._path,i,n)}return so(e.eventQueue_,t._path,s),_s(e.serverSyncTree_,t,n,null,!0),i}),(n=>(_o(e,"get for query "+Y(t)+" failed: "+n),Promise.reject(new Error(n)))))}(e._repo,e,n).then((t=>new Ao(t,new Ro(e._repo,e._path),e._queryParams.getIndex())))}class Lo{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){const n=t._queryParams.getIndex();return new Po("value",this,new Ao(e.snapshotNode,new Ro(t._repo,t._path),n))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new xo(this,e,t):null}matches(e){return e instanceof Lo&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}!function(e){k(!Ji,"__referenceConstructor has already been defined"),Ji=e}(Ro),function(e){k(!Xi,"__referenceConstructor has already been defined"),Xi=e}(Ro);const zo={};let $o=!1;function Vo(e,t,n,r,i){let s=r||e.options.databaseURL;void 0===s&&(e.options.projectId||Kt("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),Bt("Using default host for project ",e.options.projectId),s=`${e.options.projectId}-default-rtdb.firebaseio.com`);let o,a=No(s,i),c=a.repoInfo;"undefined"!=typeof process&&process.env&&(o=process.env.FIREBASE_DATABASE_EMULATOR_HOST),o?(s=`http://${o}?ns=${c.namespace}`,a=No(s,i),c=a.repoInfo):a.repoInfo.secure;const l=new dn(e.name,e.options,t);no("Invalid Firebase Database URL",a),Wn(a.path)||Kt("Database URL must point to the root of a Firebase Database (not including a child path).");const u=function(e,t,n,r){let i=zo[t.name];i||(i={},zo[t.name]=i);let s=i[e.toURLString()];s&&Kt("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call.");return s=new ao(e,$o,n,r),i[e.toURLString()]=s,s}(c,e,l,new hn(e.name,n));return new Uo(u,e)}class Uo{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(co(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Ro(this._repo,Mn())),this._rootInternal}_delete(){return null!==this._rootInternal&&(!function(e,t){const n=zo[t];n&&n[e.key]===e||Kt(`Database ${t}(${e.repoInfo_}) has already been deleted.`),function(e){e.persistentConnection_&&e.persistentConnection_.interrupt("repo_interrupt")}(e),delete n[e.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&Kt("Cannot call "+e+" on a deleted database.")}}function Wo(e){return`Minified Redux error #${e}; visit https://redux.js.org/Errors?code=${e} for the full message or use the non-minified dev environment for full errors. `}er.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},er.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)},function(e){!function(e){Rt=e}("11.0.1"),mt(new ae("database",((e,{instanceIdentifier:t})=>Vo(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t)),"PUBLIC").setMultipleInstances(!0)),bt(Ot,Dt,e),bt(Ot,Dt,"esm2017")}();var Bo=(()=>"function"==typeof Symbol&&Symbol.observable||"@@observable")(),Ho=()=>Math.random().toString(36).substring(7).split("").join("."),Qo={INIT:`@@redux/INIT${Ho()}`,REPLACE:`@@redux/REPLACE${Ho()}`,PROBE_UNKNOWN_ACTION:()=>`@@redux/PROBE_UNKNOWN_ACTION${Ho()}`};function Ko(e){if("object"!=typeof e||null===e)return!1;let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t||null===Object.getPrototypeOf(e)}function Yo(e){if(void 0===e)return"undefined";if(null===e)return"null";const t=typeof e;switch(t){case"boolean":case"string":case"number":case"symbol":case"function":return t}if(Array.isArray(e))return"array";if(function(e){return e instanceof Date||"function"==typeof e.toDateString&&"function"==typeof e.getDate&&"function"==typeof e.setDate}(e))return"date";if(function(e){return e instanceof Error||"string"==typeof e.message&&e.constructor&&"number"==typeof e.constructor.stackTraceLimit}(e))return"error";const n=function(e){return"function"==typeof e.constructor?e.constructor.name:null}(e);switch(n){case"Symbol":case"Promise":case"WeakMap":case"WeakSet":case"Map":case"Set":return n}return Object.prototype.toString.call(e).slice(8,-1).toLowerCase().replace(/\s/g,"")}function Go(e){let t=typeof e;return"production"!==process.env.NODE_ENV&&(t=Yo(e)),t}function Jo(e,t,n){if("function"!=typeof e)throw new Error("production"===process.env.NODE_ENV?Wo(2):`Expected the root reducer to be a function. Instead, received: '${Go(e)}'`);if("function"==typeof t&&"function"==typeof n||"function"==typeof n&&"function"==typeof arguments[3])throw new Error("production"===process.env.NODE_ENV?Wo(0):"It looks like you are passing several store enhancers to createStore(). This is not supported. Instead, compose them together to a single function. See https://redux.js.org/tutorials/fundamentals/part-4-store#creating-a-store-with-enhancers for an example.");if("function"==typeof t&&void 0===n&&(n=t,t=void 0),void 0!==n){if("function"!=typeof n)throw new Error("production"===process.env.NODE_ENV?Wo(1):`Expected the enhancer to be a function. Instead, received: '${Go(n)}'`);return n(Jo)(e,t)}let r=e,i=t,s=new Map,o=s,a=0,c=!1;function l(){o===s&&(o=new Map,s.forEach(((e,t)=>{o.set(t,e)})))}function u(){if(c)throw new Error("production"===process.env.NODE_ENV?Wo(3):"You may not call store.getState() while the reducer is executing. The reducer has already received the state as an argument. Pass it down from the top reducer instead of reading it from the store.");return i}function h(e){if("function"!=typeof e)throw new Error("production"===process.env.NODE_ENV?Wo(4):`Expected the listener to be a function. Instead, received: '${Go(e)}'`);if(c)throw new Error("production"===process.env.NODE_ENV?Wo(5):"You may not call store.subscribe() while the reducer is executing. If you would like to be notified after the store has been updated, subscribe from a component and invoke store.getState() in the callback to access the latest state. See https://redux.js.org/api/store#subscribelistener for more details.");let t=!0;l();const n=a++;return o.set(n,e),function(){if(t){if(c)throw new Error("production"===process.env.NODE_ENV?Wo(6):"You may not unsubscribe from a store listener while the reducer is executing. See https://redux.js.org/api/store#subscribelistener for more details.");t=!1,l(),o.delete(n),s=null}}}function d(e){if(!Ko(e))throw new Error("production"===process.env.NODE_ENV?Wo(7):`Actions must be plain objects. Instead, the actual type was: '${Go(e)}'. You may need to add middleware to your store setup to handle dispatching other values, such as 'redux-thunk' to handle dispatching functions. See https://redux.js.org/tutorials/fundamentals/part-4-store#middleware and https://redux.js.org/tutorials/fundamentals/part-6-async-logic#using-the-redux-thunk-middleware for examples.`);if(void 0===e.type)throw new Error("production"===process.env.NODE_ENV?Wo(8):'Actions may not have an undefined "type" property. You may have misspelled an action type string constant.');if("string"!=typeof e.type)throw new Error("production"===process.env.NODE_ENV?Wo(17):`Action "type" property must be a string. Instead, the actual type was: '${Go(e.type)}'. Value was: '${e.type}' (stringified)`);if(c)throw new Error("production"===process.env.NODE_ENV?Wo(9):"Reducers may not dispatch actions.");try{c=!0,i=r(i,e)}finally{c=!1}return(s=o).forEach((e=>{e()})),e}d({type:Qo.INIT});return{dispatch:d,subscribe:h,getState:u,replaceReducer:function(e){if("function"!=typeof e)throw new Error("production"===process.env.NODE_ENV?Wo(10):`Expected the nextReducer to be a function. Instead, received: '${Go(e)}`);r=e,d({type:Qo.REPLACE})},[Bo]:function(){const e=h;return{subscribe(t){if("object"!=typeof t||null===t)throw new Error("production"===process.env.NODE_ENV?Wo(11):`Expected the observer to be an object. Instead, received: '${Go(t)}'`);function n(){const e=t;e.next&&e.next(u())}n();return{unsubscribe:e(n)}},[Bo](){return this}}}}}function Xo(e){"undefined"!=typeof console&&"function"==typeof console.error&&console.error(e);try{throw new Error(e)}catch(e){}}function Zo(e){const t=Object.keys(e),n={};for(let r=0;r<t.length;r++){const i=t[r];"production"!==process.env.NODE_ENV&&void 0===e[i]&&Xo(`No reducer provided for key "${i}"`),"function"==typeof e[i]&&(n[i]=e[i])}const r=Object.keys(n);let i,s;"production"!==process.env.NODE_ENV&&(i={});try{!function(e){Object.keys(e).forEach((t=>{const n=e[t];if(void 0===n(void 0,{type:Qo.INIT}))throw new Error("production"===process.env.NODE_ENV?Wo(12):`The slice reducer for key "${t}" returned undefined during initialization. If the state passed to the reducer is undefined, you must explicitly return the initial state. The initial state may not be undefined. If you don't want to set a value for this reducer, you can use null instead of undefined.`);if(void 0===n(void 0,{type:Qo.PROBE_UNKNOWN_ACTION()}))throw new Error("production"===process.env.NODE_ENV?Wo(13):`The slice reducer for key "${t}" returned undefined when probed with a random type. Don't try to handle '${Qo.INIT}' or other actions in "redux/*" namespace. They are considered private. Instead, you must return the current state for any unknown actions, unless it is undefined, in which case you must return the initial state, regardless of the action type. The initial state may not be undefined, but can be null.`)}))}(n)}catch(e){s=e}return function(e={},t){if(s)throw s;if("production"!==process.env.NODE_ENV){const r=function(e,t,n,r){const i=Object.keys(t),s=n&&n.type===Qo.INIT?"preloadedState argument passed to createStore":"previous state received by the reducer";if(0===i.length)return"Store does not have a valid reducer. Make sure the argument passed to combineReducers is an object whose values are reducers.";if(!Ko(e))return`The ${s} has unexpected type of "${Go(e)}". Expected argument to be an object with the following keys: "${i.join('", "')}"`;const o=Object.keys(e).filter((e=>!t.hasOwnProperty(e)&&!r[e]));return o.forEach((e=>{r[e]=!0})),n&&n.type===Qo.REPLACE?void 0:o.length>0?`Unexpected ${o.length>1?"keys":"key"} "${o.join('", "')}" found in ${s}. Expected to find one of the known reducer keys instead: "${i.join('", "')}". Unexpected keys will be ignored.`:void 0}(e,n,t,i);r&&Xo(r)}let o=!1;const a={};for(let i=0;i<r.length;i++){const s=r[i],c=n[s],l=e[s],u=c(l,t);if(void 0===u){const e=t&&t.type;throw new Error("production"===process.env.NODE_ENV?Wo(14):`When called with an action of type ${e?`"${String(e)}"`:"(unknown type)"}, the slice reducer for key "${s}" returned undefined. To ignore an action, you must explicitly return the previous state. If you want this reducer to hold no value, you can return null instead of undefined.`)}a[s]=u,o=o||u!==l}return o=o||r.length!==Object.keys(e).length,o?a:e}}function ea(...e){return 0===e.length?e=>e:1===e.length?e[0]:e.reduce(((e,t)=>(...n)=>e(t(...n))))}function ta(e){return Ko(e)&&"type"in e&&"string"==typeof e.type}var na=Symbol.for("immer-nothing"),ra=Symbol.for("immer-draftable"),ia=Symbol.for("immer-state"),sa="production"!==process.env.NODE_ENV?[function(e){return`The plugin for '${e}' has not been loaded into Immer. To enable the plugin, import and call \`enable${e}()\` when initializing your application.`},function(e){return`produce can only be called on things that are draftable: plain objects, arrays, Map, Set or classes that are marked with '[immerable]: true'. Got '${e}'`},"This object has been frozen and should not be mutated",function(e){return"Cannot use a proxy that has been revoked. Did you pass an object from inside an immer function to an async process? "+e},"An immer producer returned a new value *and* modified its draft. Either return a new value *or* modify the draft.","Immer forbids circular references","The first or second argument to `produce` must be a function","The third argument to `produce` must be a function or undefined","First argument to `createDraft` must be a plain object, an array, or an immerable object","First argument to `finishDraft` must be a draft returned by `createDraft`",function(e){return`'current' expects a draft, got: ${e}`},"Object.defineProperty() cannot be used on an Immer draft","Object.setPrototypeOf() cannot be used on an Immer draft","Immer only supports deleting array indices","Immer only supports setting array indices and the 'length' property",function(e){return`'original' expects a draft, got: ${e}`}]:[];function oa(e,...t){if("production"!==process.env.NODE_ENV){const n=sa[e],r="function"==typeof n?n.apply(null,t):n;throw new Error(`[Immer] ${r}`)}throw new Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var aa=Object.getPrototypeOf;function ca(e){return!!e&&!!e[ia]}function la(e){return!!e&&(ha(e)||Array.isArray(e)||!!e[ra]||!!e.constructor?.[ra]||ga(e)||ya(e))}var ua=Object.prototype.constructor.toString();function ha(e){if(!e||"object"!=typeof e)return!1;const t=aa(e);if(null===t)return!0;const n=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return n===Object||"function"==typeof n&&Function.toString.call(n)===ua}function da(e,t){0===pa(e)?Reflect.ownKeys(e).forEach((n=>{t(n,e[n],e)})):e.forEach(((n,r)=>t(r,n,e)))}function pa(e){const t=e[ia];return t?t.type_:Array.isArray(e)?1:ga(e)?2:ya(e)?3:0}function fa(e,t){return 2===pa(e)?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function ma(e,t){return 2===pa(e)?e.get(t):e[t]}function _a(e,t,n){const r=pa(e);2===r?e.set(t,n):3===r?e.add(n):e[t]=n}function ga(e){return e instanceof Map}function ya(e){return e instanceof Set}function va(e){return e.copy_||e.base_}function ba(e,t){if(ga(e))return new Map(e);if(ya(e))return new Set(e);if(Array.isArray(e))return Array.prototype.slice.call(e);const n=ha(e);if(!0===t||"class_only"===t&&!n){const t=Object.getOwnPropertyDescriptors(e);delete t[ia];let n=Reflect.ownKeys(t);for(let r=0;r<n.length;r++){const i=n[r],s=t[i];!1===s.writable&&(s.writable=!0,s.configurable=!0),(s.get||s.set)&&(t[i]={configurable:!0,writable:!0,enumerable:s.enumerable,value:e[i]})}return Object.create(aa(e),t)}{const t=aa(e);if(null!==t&&n)return{...e};const r=Object.create(t);return Object.assign(r,e)}}function wa(e,t=!1){return Ea(e)||ca(e)||!la(e)||(pa(e)>1&&(e.set=e.add=e.clear=e.delete=Ca),Object.freeze(e),t&&Object.entries(e).forEach((([e,t])=>wa(t,!0)))),e}function Ca(){oa(2)}function Ea(e){return Object.isFrozen(e)}var Sa,Ta={};function Ia(e){const t=Ta[e];return t||oa(0,e),t}function Na(){return Sa}function ka(e,t){t&&(Ia("Patches"),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function Pa(e){xa(e),e.drafts_.forEach(Da),e.drafts_=null}function xa(e){e===Sa&&(Sa=e.parent_)}function Oa(e){return Sa={drafts_:[],parent_:Sa,immer_:e,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function Da(e){const t=e[ia];0===t.type_||1===t.type_?t.revoke_():t.revoked_=!0}function Ra(e,t){t.unfinalizedDrafts_=t.drafts_.length;const n=t.drafts_[0];return void 0!==e&&e!==n?(n[ia].modified_&&(Pa(t),oa(4)),la(e)&&(e=Aa(t,e),t.parent_||Ma(t,e)),t.patches_&&Ia("Patches").generateReplacementPatches_(n[ia].base_,e,t.patches_,t.inversePatches_)):e=Aa(t,n,[]),Pa(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==na?e:void 0}function Aa(e,t,n){if(Ea(t))return t;const r=t[ia];if(!r)return da(t,((i,s)=>qa(e,r,t,i,s,n))),t;if(r.scope_!==e)return t;if(!r.modified_)return Ma(e,r.base_,!0),r.base_;if(!r.finalized_){r.finalized_=!0,r.scope_.unfinalizedDrafts_--;const t=r.copy_;let i=t,s=!1;3===r.type_&&(i=new Set(t),t.clear(),s=!0),da(i,((i,o)=>qa(e,r,t,i,o,n,s))),Ma(e,t,!1),n&&e.patches_&&Ia("Patches").generatePatches_(r,n,e.patches_,e.inversePatches_)}return r.copy_}function qa(e,t,n,r,i,s,o){if("production"!==process.env.NODE_ENV&&i===n&&oa(5),ca(i)){const o=Aa(e,i,s&&t&&3!==t.type_&&!fa(t.assigned_,r)?s.concat(r):void 0);if(_a(n,r,o),!ca(o))return;e.canAutoFreeze_=!1}else o&&n.add(i);if(la(i)&&!Ea(i)){if(!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1)return;Aa(e,i),t&&t.scope_.parent_||"symbol"==typeof r||!Object.prototype.propertyIsEnumerable.call(n,r)||Ma(e,i)}}function Ma(e,t,n=!1){!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&wa(t,n)}var ja={get(e,t){if(t===ia)return e;const n=va(e);if(!fa(n,t))return function(e,t,n){const r=za(t,n);return r?"value"in r?r.value:r.get?.call(e.draft_):void 0}(e,n,t);const r=n[t];return e.finalized_||!la(r)?r:r===La(e.base_,t)?(Va(e),e.copy_[t]=Ua(r,e)):r},has:(e,t)=>t in va(e),ownKeys:e=>Reflect.ownKeys(va(e)),set(e,t,n){const r=za(va(e),t);if(r?.set)return r.set.call(e.draft_,n),!0;if(!e.modified_){const r=La(va(e),t),o=r?.[ia];if(o&&o.base_===n)return e.copy_[t]=n,e.assigned_[t]=!1,!0;if(((i=n)===(s=r)?0!==i||1/i==1/s:i!=i&&s!=s)&&(void 0!==n||fa(e.base_,t)))return!0;Va(e),$a(e)}var i,s;return e.copy_[t]===n&&(void 0!==n||t in e.copy_)||Number.isNaN(n)&&Number.isNaN(e.copy_[t])||(e.copy_[t]=n,e.assigned_[t]=!0),!0},deleteProperty:(e,t)=>(void 0!==La(e.base_,t)||t in e.base_?(e.assigned_[t]=!1,Va(e),$a(e)):delete e.assigned_[t],e.copy_&&delete e.copy_[t],!0),getOwnPropertyDescriptor(e,t){const n=va(e),r=Reflect.getOwnPropertyDescriptor(n,t);return r?{writable:!0,configurable:1!==e.type_||"length"!==t,enumerable:r.enumerable,value:n[t]}:r},defineProperty(){oa(11)},getPrototypeOf:e=>aa(e.base_),setPrototypeOf(){oa(12)}},Fa={};function La(e,t){const n=e[ia];return(n?va(n):e)[t]}function za(e,t){if(!(t in e))return;let n=aa(e);for(;n;){const e=Object.getOwnPropertyDescriptor(n,t);if(e)return e;n=aa(n)}}function $a(e){e.modified_||(e.modified_=!0,e.parent_&&$a(e.parent_))}function Va(e){e.copy_||(e.copy_=ba(e.base_,e.scope_.immer_.useStrictShallowCopy_))}da(ja,((e,t)=>{Fa[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}})),Fa.deleteProperty=function(e,t){return"production"!==process.env.NODE_ENV&&isNaN(parseInt(t))&&oa(13),Fa.set.call(this,e,t,void 0)},Fa.set=function(e,t,n){return"production"!==process.env.NODE_ENV&&"length"!==t&&isNaN(parseInt(t))&&oa(14),ja.set.call(this,e[0],t,n,e[0])};function Ua(e,t){const n=ga(e)?Ia("MapSet").proxyMap_(e,t):ya(e)?Ia("MapSet").proxySet_(e,t):function(e,t){const n=Array.isArray(e),r={type_:n?1:0,scope_:t?t.scope_:Na(),modified_:!1,finalized_:!1,assigned_:{},parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1};let i=r,s=ja;n&&(i=[r],s=Fa);const{revoke:o,proxy:a}=Proxy.revocable(i,s);return r.draft_=a,r.revoke_=o,a}(e,t);return(t?t.scope_:Na()).drafts_.push(n),n}function Wa(e){if(!la(e)||Ea(e))return e;const t=e[ia];let n;if(t){if(!t.modified_)return t.base_;t.finalized_=!0,n=ba(e,t.scope_.immer_.useStrictShallowCopy_)}else n=ba(e,!0);return da(n,((e,t)=>{_a(n,e,Wa(t))})),t&&(t.finalized_=!1),n}function Ba(){"production"!==process.env.NODE_ENV&&sa.push('Sets cannot have "replace" patches.',(function(e){return"Unsupported patch operation: "+e}),(function(e){return"Cannot apply patch, path doesn't resolve: "+e}),"Patching reserved attributes like __proto__, prototype and constructor is not allowed");const e="replace",t="add",n="remove";function r(e){if(!la(e))return e;if(Array.isArray(e))return e.map(r);if(ga(e))return new Map(Array.from(e.entries()).map((([e,t])=>[e,r(t)])));if(ya(e))return new Set(Array.from(e).map(r));const t=Object.create(aa(e));for(const n in e)t[n]=r(e[n]);return fa(e,ra)&&(t[ra]=e[ra]),t}function i(e){return ca(e)?r(e):e}var s,o;o={applyPatches_:function(i,s){return s.forEach((s=>{const{path:o,op:a}=s;let c=i;for(let e=0;e<o.length-1;e++){const t=pa(c);let n=o[e];"string"!=typeof n&&"number"!=typeof n&&(n=""+n),0!==t&&1!==t||"__proto__"!==n&&"constructor"!==n||oa(19),"function"==typeof c&&"prototype"===n&&oa(19),c=ma(c,n),"object"!=typeof c&&oa(18,o.join("/"))}const l=pa(c),u=r(s.value),h=o[o.length-1];switch(a){case e:switch(l){case 2:return c.set(h,u);case 3:oa(16);default:return c[h]=u}case t:switch(l){case 1:return"-"===h?c.push(u):c.splice(h,0,u);case 2:return c.set(h,u);case 3:return c.add(u);default:return c[h]=u}case n:switch(l){case 1:return c.splice(h,1);case 2:return c.delete(h);case 3:return c.delete(s.value);default:return delete c[h]}default:oa(17,a)}})),i},generatePatches_:function(r,s,o,a){switch(r.type_){case 0:case 2:return function(r,s,o,a){const{base_:c,copy_:l}=r;da(r.assigned_,((r,u)=>{const h=ma(c,r),d=ma(l,r),p=u?fa(c,r)?e:t:n;if(h===d&&p===e)return;const f=s.concat(r);o.push(p===n?{op:p,path:f}:{op:p,path:f,value:d}),a.push(p===t?{op:n,path:f}:p===n?{op:t,path:f,value:i(h)}:{op:e,path:f,value:i(h)})}))}(r,s,o,a);case 1:return function(r,s,o,a){let{base_:c,assigned_:l}=r,u=r.copy_;u.length<c.length&&([c,u]=[u,c],[o,a]=[a,o]);for(let t=0;t<c.length;t++)if(l[t]&&u[t]!==c[t]){const n=s.concat([t]);o.push({op:e,path:n,value:i(u[t])}),a.push({op:e,path:n,value:i(c[t])})}for(let e=c.length;e<u.length;e++){const n=s.concat([e]);o.push({op:t,path:n,value:i(u[e])})}for(let e=u.length-1;c.length<=e;--e){const t=s.concat([e]);a.push({op:n,path:t})}}(r,s,o,a);case 3:return function(e,r,i,s){let{base_:o,copy_:a}=e,c=0;o.forEach((e=>{if(!a.has(e)){const o=r.concat([c]);i.push({op:n,path:o,value:e}),s.unshift({op:t,path:o,value:e})}c++})),c=0,a.forEach((e=>{if(!o.has(e)){const o=r.concat([c]);i.push({op:t,path:o,value:e}),s.unshift({op:n,path:o,value:e})}c++}))}(r,s,o,a)}},generateReplacementPatches_:function(t,n,r,i){r.push({op:e,path:[],value:n===na?void 0:n}),i.push({op:e,path:[],value:t})}},Ta[s="Patches"]||(Ta[s]=o)}var Ha=new class{constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(e,t,n)=>{if("function"==typeof e&&"function"!=typeof t){const n=t;t=e;const r=this;return function(e=n,...i){return r.produce(e,(e=>t.call(this,e,...i)))}}let r;if("function"!=typeof t&&oa(6),void 0!==n&&"function"!=typeof n&&oa(7),la(e)){const i=Oa(this),s=Ua(e,void 0);let o=!0;try{r=t(s),o=!1}finally{o?Pa(i):xa(i)}return ka(i,n),Ra(r,i)}if(!e||"object"!=typeof e){if(r=t(e),void 0===r&&(r=e),r===na&&(r=void 0),this.autoFreeze_&&wa(r,!0),n){const t=[],i=[];Ia("Patches").generateReplacementPatches_(e,r,t,i),n(t,i)}return r}oa(1,e)},this.produceWithPatches=(e,t)=>{if("function"==typeof e)return(t,...n)=>this.produceWithPatches(t,(t=>e(t,...n)));let n,r;return[this.produce(e,t,((e,t)=>{n=e,r=t})),n,r]},"boolean"==typeof e?.autoFreeze&&this.setAutoFreeze(e.autoFreeze),"boolean"==typeof e?.useStrictShallowCopy&&this.setUseStrictShallowCopy(e.useStrictShallowCopy)}createDraft(e){la(e)||oa(8),ca(e)&&(e=function(e){ca(e)||oa(10,e);return Wa(e)}(e));const t=Oa(this),n=Ua(e,void 0);return n[ia].isManual_=!0,xa(t),n}finishDraft(e,t){const n=e&&e[ia];n&&n.isManual_||oa(9);const{scope_:r}=n;return ka(r,t),Ra(void 0,r)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}applyPatches(e,t){let n;for(n=t.length-1;n>=0;n--){const r=t[n];if(0===r.path.length&&"replace"===r.op){e=r.value;break}}n>-1&&(t=t.slice(n+1));const r=Ia("Patches").applyPatches_;return ca(e)?r(e,t):this.produce(e,(e=>r(e,t)))}},Qa=Ha.produce,Ka=Ha.produceWithPatches.bind(Ha);Ha.setAutoFreeze.bind(Ha),Ha.setUseStrictShallowCopy.bind(Ha);var Ya=Ha.applyPatches.bind(Ha);Ha.createDraft.bind(Ha),Ha.finishDraft.bind(Ha);var Ga=(e,t,n)=>{if(1===t.length&&t[0]===n){let t=!1;try{const n={};e(n)===n&&(t=!0)}catch{}if(t){let e;try{throw new Error}catch(t){({stack:e}=t)}console.warn("The result function returned its own inputs without modification. e.g\n`createSelector([state => state.todos], todos => todos)`\nThis could lead to inefficient memoization and unnecessary re-renders.\nEnsure transformation logic is in the result function, and extraction logic is in the input selectors.",{stack:e})}}},Ja=(e,t,n)=>{const{memoize:r,memoizeOptions:i}=t,{inputSelectorResults:s,inputSelectorResultsCopy:o}=e,a=r((()=>({})),...i);if(!(a.apply(null,s)===a.apply(null,o))){let e;try{throw new Error}catch(t){({stack:e}=t)}console.warn("An input selector returned a different result when passed same arguments.\nThis means your output selector will likely run more frequently than intended.\nAvoid returning a new reference inside your input selector, e.g.\n`createSelector([state => state.todos.map(todo => todo.id)], todoIds => todoIds.length)`",{arguments:n,firstInputs:s,secondInputs:o,stack:e})}},Xa={inputStabilityCheck:"once",identityFunctionCheck:"once"};var Za=e=>Array.isArray(e)?e:[e];function ec(e){const t=Array.isArray(e[0])?e[0]:e;return function(e,t="expected all items to be functions, instead received the following types: "){if(!e.every((e=>"function"==typeof e))){const n=e.map((e=>"function"==typeof e?`function ${e.name||"unnamed"}()`:typeof e)).join(", ");throw new TypeError(`${t}[${n}]`)}}(t,"createSelector expects all input-selectors to be functions, but received the following types: "),t}function tc(e,t){const n=[],{length:r}=e;for(let i=0;i<r;i++)n.push(e[i].apply(null,t));return n}var nc="undefined"!=typeof WeakRef?WeakRef:class{constructor(e){this.value=e}deref(){return this.value}};function rc(e,t={}){let n={s:0,v:void 0,o:null,p:null};const{resultEqualityCheck:r}=t;let i,s=0;function o(){let t=n;const{length:o}=arguments;for(let e=0,n=o;e<n;e++){const n=arguments[e];if("function"==typeof n||"object"==typeof n&&null!==n){let e=t.o;null===e&&(t.o=e=new WeakMap);const r=e.get(n);void 0===r?(t={s:0,v:void 0,o:null,p:null},e.set(n,t)):t=r}else{let e=t.p;null===e&&(t.p=e=new Map);const r=e.get(n);void 0===r?(t={s:0,v:void 0,o:null,p:null},e.set(n,t)):t=r}}const a=t;let c;if(1===t.s)c=t.v;else if(c=e.apply(null,arguments),s++,r){const e=i?.deref?.()??i;null!=e&&r(e,c)&&(c=e,0!==s&&s--);i="object"==typeof c&&null!==c||"function"==typeof c?new nc(c):c}return a.s=1,a.v=c,c}return o.clearCache=()=>{n={s:0,v:void 0,o:null,p:null},o.resetResultsCount()},o.resultsCount=()=>s,o.resetResultsCount=()=>{s=0},o}function ic(e,...t){const n="function"==typeof e?{memoize:e,memoizeOptions:t}:e,r=(...e)=>{let t,r=0,i=0,s={},o=e.pop();"object"==typeof o&&(s=o,o=e.pop()),function(e,t="expected a function, instead received "+typeof e){if("function"!=typeof e)throw new TypeError(t)}(o,`createSelector expects an output function after the inputs, but received: [${typeof o}]`);const a={...n,...s},{memoize:c,memoizeOptions:l=[],argsMemoize:u=rc,argsMemoizeOptions:h=[],devModeChecks:d={}}=a,p=Za(l),f=Za(h),m=ec(e),_=c((function(){return r++,o.apply(null,arguments)}),...p);let g=!0;const y=u((function(){i++;const e=tc(m,arguments);if(t=_.apply(null,e),"production"!==process.env.NODE_ENV){const{identityFunctionCheck:n,inputStabilityCheck:r}=((e,t)=>{const{identityFunctionCheck:n,inputStabilityCheck:r}={...Xa,...t};return{identityFunctionCheck:{shouldRun:"always"===n||"once"===n&&e,run:Ga},inputStabilityCheck:{shouldRun:"always"===r||"once"===r&&e,run:Ja}}})(g,d);if(n.shouldRun&&n.run(o,e,t),r.shouldRun){const t=tc(m,arguments);r.run({inputSelectorResults:e,inputSelectorResultsCopy:t},{memoize:c,memoizeOptions:p},arguments)}g&&(g=!1)}return t}),...f);return Object.assign(y,{resultFunc:o,memoizedResultFunc:_,dependencies:m,dependencyRecomputations:()=>i,resetDependencyRecomputations:()=>{i=0},lastResult:()=>t,recomputations:()=>r,resetRecomputations:()=>{r=0},memoize:c,argsMemoize:u})};return Object.assign(r,{withTypes:()=>r}),r}var sc=ic(rc),oc=Object.assign(((e,t=sc)=>{!function(e,t="expected an object, instead received "+typeof e){if("object"!=typeof e)throw new TypeError(t)}(e,"createStructuredSelector expects first argument to be an object where each property is a selector, instead received a "+typeof e);const n=Object.keys(e);return t(n.map((t=>e[t])),((...e)=>e.reduce(((e,t,r)=>(e[n[r]]=t,e)),{})))}),{withTypes:()=>oc});function ac(e){return({dispatch:t,getState:n})=>r=>i=>"function"==typeof i?i(t,n,e):r(i)}var cc=ac(),lc=ac,uc="undefined"!=typeof window&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(0!==arguments.length)return"object"==typeof arguments[0]?ea:ea.apply(null,arguments)},hc=e=>e&&"function"==typeof e.match;function dc(e,t){function n(...n){if(t){let r=t(...n);if(!r)throw new Error("production"===process.env.NODE_ENV?rl(0):"prepareAction did not return an object");return{type:e,payload:r.payload,..."meta"in r&&{meta:r.meta},..."error"in r&&{error:r.error}}}return{type:e,payload:n[0]}}return n.toString=()=>`${e}`,n.type=e,n.match=t=>ta(t)&&t.type===e,n}function pc(e){return"function"==typeof e&&"type"in e&&hc(e)}function fc(e,t){let n=0;return{measureTime(e){const t=Date.now();try{return e()}finally{const e=Date.now();n+=e-t}},warnIfExceeded(){n>e&&console.warn(`${t} took ${n}ms, which is more than the warning threshold of ${e}ms. \nIf your state or actions are very large, you may want to disable the middleware as it might cause too much of a slowdown in development mode. See https://redux-toolkit.js.org/api/getDefaultMiddleware for instructions.\nIt is disabled in production builds, so you don't need to worry about that.`)}}}var mc=class e extends Array{constructor(...t){super(...t),Object.setPrototypeOf(this,e.prototype)}static get[Symbol.species](){return e}concat(...e){return super.concat.apply(this,e)}prepend(...t){return 1===t.length&&Array.isArray(t[0])?new e(...t[0].concat(this)):new e(...t.concat(this))}};function _c(e){return la(e)?Qa(e,(()=>{})):e}function gc(e,t,n){if(e.has(t)){let r=e.get(t);return n.update&&(r=n.update(r,t,e),e.set(t,r)),r}if(!n.insert)throw new Error("production"===process.env.NODE_ENV?rl(10):"No insert provided for key not already in map");const r=n.insert(t,e);return e.set(t,r),r}function yc(e){return"object"!=typeof e||null==e||Object.isFrozen(e)}function vc(e,t,n){const r=bc(e,t,n);return{detectMutations:()=>wc(e,t,r,n)}}function bc(e,t=[],n,r="",i=new Set){const s={value:n};if(!e(n)&&!i.has(n)){i.add(n),s.children={};for(const i in n){const o=r?r+"."+i:i;t.length&&-1!==t.indexOf(o)||(s.children[i]=bc(e,t,n[i],o))}}return s}function wc(e,t=[],n,r,i=!1,s=""){const o=n?n.value:void 0,a=o===r;if(i&&!a&&!Number.isNaN(r))return{wasMutated:!0,path:s};if(e(o)||e(r))return{wasMutated:!1};const c={};for(let e in n.children)c[e]=!0;for(let e in r)c[e]=!0;const l=t.length>0;for(let i in c){const o=s?s+"."+i:i;if(l){if(t.some((e=>e instanceof RegExp?e.test(o):o===e)))continue}const c=wc(e,t,n.children[i],r[i],a,o);if(c.wasMutated)return c}return{wasMutated:!1}}function Cc(e){const t=typeof e;return null==e||"string"===t||"boolean"===t||"number"===t||Array.isArray(e)||Ko(e)}function Ec(e,t="",n=Cc,r,i=[],s){let o;if(!n(e))return{keyPath:t||"<root>",value:e};if("object"!=typeof e||null===e)return!1;if(s?.has(e))return!1;const a=null!=r?r(e):Object.entries(e),c=i.length>0;for(const[e,l]of a){const a=t?t+"."+e:e;if(c){if(i.some((e=>e instanceof RegExp?e.test(a):a===e)))continue}if(!n(l))return{keyPath:a,value:l};if("object"==typeof l&&(o=Ec(l,a,n,r,i,s),o))return o}return s&&Sc(e)&&s.add(e),!1}function Sc(e){if(!Object.isFrozen(e))return!1;for(const t of Object.values(e))if("object"==typeof t&&null!==t&&!Sc(t))return!1;return!0}function Tc(e){return"boolean"==typeof e}var Ic=()=>function(e){const{thunk:t=!0,immutableCheck:n=!0,serializableCheck:r=!0,actionCreatorCheck:i=!0}=e??{};let s=new mc;if(t&&(Tc(t)?s.push(cc):s.push(lc(t.extraArgument))),"production"!==process.env.NODE_ENV){if(n){let e={};Tc(n)||(e=n),s.unshift(function(e={}){if("production"===process.env.NODE_ENV)return()=>e=>t=>e(t);{let t=function(e,t,r,i){return JSON.stringify(e,n(t,i),r)},n=function(e,t){let n=[],r=[];return t||(t=function(e,t){return n[0]===t?"[Circular ~]":"[Circular ~."+r.slice(0,n.indexOf(t)).join(".")+"]"}),function(i,s){if(n.length>0){var o=n.indexOf(this);~o?n.splice(o+1):n.push(this),~o?r.splice(o,1/0,i):r.push(i),~n.indexOf(s)&&(s=t.call(this,i,s))}else n.push(s);return null==e?s:e.call(this,i,s)}},{isImmutable:r=yc,ignoredPaths:i,warnAfter:s=32}=e;const o=vc.bind(null,r,i);return({getState:e})=>{let n,r=e(),i=o(r);return a=>c=>{const l=fc(s,"ImmutableStateInvariantMiddleware");l.measureTime((()=>{if(r=e(),n=i.detectMutations(),i=o(r),n.wasMutated)throw new Error("production"===process.env.NODE_ENV?rl(19):`A state mutation was detected between dispatches, in the path '${n.path||""}'.  This may cause incorrect behavior. (https://redux.js.org/style-guide/style-guide#do-not-mutate-state)`)}));const u=a(c);return l.measureTime((()=>{if(r=e(),n=i.detectMutations(),i=o(r),n.wasMutated)throw new Error("production"===process.env.NODE_ENV?rl(20):`A state mutation was detected inside a dispatch, in the path: ${n.path||""}. Take a look at the reducer(s) handling the action ${t(c)}. (https://redux.js.org/style-guide/style-guide#do-not-mutate-state)`)})),l.warnIfExceeded(),u}}}}(e))}if(r){let e={};Tc(r)||(e=r),s.push(function(e={}){if("production"===process.env.NODE_ENV)return()=>e=>t=>e(t);{const{isSerializable:t=Cc,getEntries:n,ignoredActions:r=[],ignoredActionPaths:i=["meta.arg","meta.baseQueryMeta"],ignoredPaths:s=[],warnAfter:o=32,ignoreState:a=!1,ignoreActions:c=!1,disableCache:l=!1}=e,u=!l&&WeakSet?new WeakSet:void 0;return e=>l=>h=>{if(!ta(h))return l(h);const d=l(h),p=fc(o,"SerializableStateInvariantMiddleware");return c||r.length&&-1!==r.indexOf(h.type)||p.measureTime((()=>{const e=Ec(h,"",t,n,i,u);if(e){const{keyPath:t,value:n}=e;console.error(`A non-serializable value was detected in an action, in the path: \`${t}\`. Value:`,n,"\nTake a look at the logic that dispatched this action: ",h,"\n(See https://redux.js.org/faq/actions#why-should-type-be-a-string-or-at-least-serializable-why-should-my-action-types-be-constants)","\n(To allow non-serializable values see: https://redux-toolkit.js.org/usage/usage-guide#working-with-non-serializable-data)")}})),a||(p.measureTime((()=>{const r=Ec(e.getState(),"",t,n,s,u);if(r){const{keyPath:e,value:t}=r;console.error(`A non-serializable value was detected in the state, in the path: \`${e}\`. Value:`,t,`\nTake a look at the reducer(s) handling this action type: ${h.type}.\n(See https://redux.js.org/faq/organizing-state#can-i-put-functions-promises-or-other-non-serializable-items-in-my-store-state)`)}})),p.warnIfExceeded()),d}}}(e))}if(i){let e={};Tc(i)||(e=i),s.unshift(function(e={}){if("production"===process.env.NODE_ENV)return()=>e=>t=>e(t);const{isActionCreator:t=pc}=e;return()=>e=>n=>(t(n)&&console.warn(function(e){const t=e?`${e}`.split("/"):[],n=t[t.length-1]||"actionCreator";return`Detected an action creator with type "${e||"unknown"}" being dispatched. \nMake sure you're calling the action creator before dispatching, i.e. \`dispatch(${n}())\` instead of \`dispatch(${n})\`. This is necessary even if the action has no payload.`}(n.type)),e(n))}(e))}}return s},Nc="RTK_autoBatch",kc=()=>e=>({payload:e,meta:{[Nc]:!0}}),Pc=e=>t=>{setTimeout(t,e)},xc="undefined"!=typeof window&&window.requestAnimationFrame?window.requestAnimationFrame:Pc(10),Oc=e=>function(t){const{autoBatch:n=!0}=t??{};let r=new mc(e);return n&&r.push(((e={type:"raf"})=>t=>(...n)=>{const r=t(...n);let i=!0,s=!1,o=!1;const a=new Set,c="tick"===e.type?queueMicrotask:"raf"===e.type?xc:"callback"===e.type?e.queueNotification:Pc(e.timeout),l=()=>{o=!1,s&&(s=!1,a.forEach((e=>e())))};return Object.assign({},r,{subscribe(e){const t=r.subscribe((()=>i&&e()));return a.add(e),()=>{t(),a.delete(e)}},dispatch(e){try{return i=!e?.meta?.[Nc],s=!i,s&&(o||(o=!0,c(l))),r.dispatch(e)}finally{i=!0}}})})("object"==typeof n?n:void 0)),r};function Dc(e){const t=Ic(),{reducer:n,middleware:r,devTools:i=!0,preloadedState:s,enhancers:o}=e||{};let a,c;if("function"==typeof n)a=n;else{if(!Ko(n))throw new Error("production"===process.env.NODE_ENV?rl(1):"`reducer` is a required argument, and must be a function or an object of functions that can be passed to combineReducers");a=Zo(n)}if("production"!==process.env.NODE_ENV&&r&&"function"!=typeof r)throw new Error("production"===process.env.NODE_ENV?rl(2):"`middleware` field must be a callback");if("function"==typeof r){if(c=r(t),"production"!==process.env.NODE_ENV&&!Array.isArray(c))throw new Error("production"===process.env.NODE_ENV?rl(3):"when using a middleware builder function, an array of middleware must be returned")}else c=t();if("production"!==process.env.NODE_ENV&&c.some((e=>"function"!=typeof e)))throw new Error("production"===process.env.NODE_ENV?rl(4):"each middleware provided to configureStore must be a function");let l=ea;i&&(l=uc({trace:"production"!==process.env.NODE_ENV,..."object"==typeof i&&i}));const u=function(...e){return t=>(n,r)=>{const i=t(n,r);let s=()=>{throw new Error("production"===process.env.NODE_ENV?Wo(15):"Dispatching while constructing your middleware is not allowed. Other middleware would not be applied to this dispatch.")};const o={getState:i.getState,dispatch:(e,...t)=>s(e,...t)},a=e.map((e=>e(o)));return s=ea(...a)(i.dispatch),{...i,dispatch:s}}}(...c),h=Oc(u);if("production"!==process.env.NODE_ENV&&o&&"function"!=typeof o)throw new Error("production"===process.env.NODE_ENV?rl(5):"`enhancers` field must be a callback");let d="function"==typeof o?o(h):h();if("production"!==process.env.NODE_ENV&&!Array.isArray(d))throw new Error("production"===process.env.NODE_ENV?rl(6):"`enhancers` callback must return an array");if("production"!==process.env.NODE_ENV&&d.some((e=>"function"!=typeof e)))throw new Error("production"===process.env.NODE_ENV?rl(7):"each enhancer provided to configureStore must be a function");"production"!==process.env.NODE_ENV&&c.length&&!d.includes(u)&&console.error("middlewares were provided, but middleware enhancer was not included in final enhancers - make sure to call `getDefaultEnhancers`");return Jo(a,s,l(...d))}function Rc(e){const t={},n=[];let r;const i={addCase(e,s){if("production"!==process.env.NODE_ENV){if(n.length>0)throw new Error("production"===process.env.NODE_ENV?rl(26):"`builder.addCase` should only be called before calling `builder.addMatcher`");if(r)throw new Error("production"===process.env.NODE_ENV?rl(27):"`builder.addCase` should only be called before calling `builder.addDefaultCase`")}const o="string"==typeof e?e:e.type;if(!o)throw new Error("production"===process.env.NODE_ENV?rl(28):"`builder.addCase` cannot be called with an empty action type");if(o in t)throw new Error("production"===process.env.NODE_ENV?rl(29):`\`builder.addCase\` cannot be called with two reducers for the same action type '${o}'`);return t[o]=s,i},addMatcher(e,t){if("production"!==process.env.NODE_ENV&&r)throw new Error("production"===process.env.NODE_ENV?rl(30):"`builder.addMatcher` should only be called before calling `builder.addDefaultCase`");return n.push({matcher:e,reducer:t}),i},addDefaultCase(e){if("production"!==process.env.NODE_ENV&&r)throw new Error("production"===process.env.NODE_ENV?rl(31):"`builder.addDefaultCase` can only be called once");return r=e,i}};return e(i),[t,n,r]}var Ac=(e,t)=>hc(e)?e.match(t):e(t);function qc(...e){return t=>e.some((e=>Ac(e,t)))}function Mc(...e){return t=>e.every((e=>Ac(e,t)))}function jc(e,t){if(!e||!e.meta)return!1;const n="string"==typeof e.meta.requestId,r=t.indexOf(e.meta.requestStatus)>-1;return n&&r}function Fc(e){return"function"==typeof e[0]&&"pending"in e[0]&&"fulfilled"in e[0]&&"rejected"in e[0]}function Lc(...e){return 0===e.length?e=>jc(e,["pending"]):Fc(e)?qc(...e.map((e=>e.pending))):Lc()(e[0])}function zc(...e){return 0===e.length?e=>jc(e,["rejected"]):Fc(e)?qc(...e.map((e=>e.rejected))):zc()(e[0])}function $c(...e){const t=e=>e&&e.meta&&e.meta.rejectedWithValue;return 0===e.length||Fc(e)?Mc(zc(...e),t):$c()(e[0])}function Vc(...e){return 0===e.length?e=>jc(e,["fulfilled"]):Fc(e)?qc(...e.map((e=>e.fulfilled))):Vc()(e[0])}function Uc(...e){return 0===e.length?e=>jc(e,["pending","fulfilled","rejected"]):Fc(e)?qc(...e.flatMap((e=>[e.pending,e.rejected,e.fulfilled]))):Uc()(e[0])}var Wc=(e=21)=>{let t="",n=e;for(;n--;)t+="ModuleSymbhasOwnPr-0123456789ABCDEFGHNRVfgctiUvz_KqYTJkLxpZXIjQW"[64*Math.random()|0];return t},Bc=["name","message","stack","code"],Hc=class{constructor(e,t){this.payload=e,this.meta=t}_type},Qc=class{constructor(e,t){this.payload=e,this.meta=t}_type},Kc=e=>{if("object"==typeof e&&null!==e){const t={};for(const n of Bc)"string"==typeof e[n]&&(t[n]=e[n]);return t}return{message:String(e)}},Yc=(()=>{function e(e,t,n){const r=dc(e+"/fulfilled",((e,t,n,r)=>({payload:e,meta:{...r||{},arg:n,requestId:t,requestStatus:"fulfilled"}}))),i=dc(e+"/pending",((e,t,n)=>({payload:void 0,meta:{...n||{},arg:t,requestId:e,requestStatus:"pending"}}))),s=dc(e+"/rejected",((e,t,r,i,s)=>({payload:i,error:(n&&n.serializeError||Kc)(e||"Rejected"),meta:{...s||{},arg:r,requestId:t,rejectedWithValue:!!i,requestStatus:"rejected",aborted:"AbortError"===e?.name,condition:"ConditionError"===e?.name}})));return Object.assign((function(e){return(o,a,c)=>{const l=n?.idGenerator?n.idGenerator(e):Wc(),u=new AbortController;let h,d;function p(e){d=e,u.abort()}const f=async function(){let f;try{let s=n?.condition?.(e,{getState:a,extra:c});if(null!==(m=s)&&"object"==typeof m&&"function"==typeof m.then&&(s=await s),!1===s||u.signal.aborted)throw{name:"ConditionError",message:"Aborted due to condition callback returning false."};const _=new Promise(((e,t)=>{h=()=>{t({name:"AbortError",message:d||"Aborted"})},u.signal.addEventListener("abort",h)}));o(i(l,e,n?.getPendingMeta?.({requestId:l,arg:e},{getState:a,extra:c}))),f=await Promise.race([_,Promise.resolve(t(e,{dispatch:o,getState:a,extra:c,requestId:l,signal:u.signal,abort:p,rejectWithValue:(e,t)=>new Hc(e,t),fulfillWithValue:(e,t)=>new Qc(e,t)})).then((t=>{if(t instanceof Hc)throw t;return t instanceof Qc?r(t.payload,l,e,t.meta):r(t,l,e)}))])}catch(t){f=t instanceof Hc?s(null,l,e,t.payload,t.meta):s(t,l,e)}finally{h&&u.signal.removeEventListener("abort",h)}var m;return n&&!n.dispatchConditionRejection&&s.match(f)&&f.meta.condition||o(f),f}();return Object.assign(f,{abort:p,requestId:l,arg:e,unwrap:()=>f.then(Gc)})}}),{pending:i,rejected:s,fulfilled:r,settled:qc(s,r),typePrefix:e})}return e.withTypes=()=>e,e})();function Gc(e){if(e.meta&&e.meta.rejectedWithValue)throw e.payload;if(e.error)throw e.error;return e.payload}var Jc=Symbol.for("rtk-slice-createasyncthunk");function Xc(e,t){return`${e}/${t}`}function Zc({creators:e}={}){const t=e?.asyncThunk?.[Jc];return function(e){const{name:n,reducerPath:r=n}=e;if(!n)throw new Error("production"===process.env.NODE_ENV?rl(11):"`name` is a required option for createSlice");"undefined"!=typeof process&&"development"===process.env.NODE_ENV&&void 0===e.initialState&&console.error("You must provide an `initialState` value that is not `undefined`. You may have misspelled `initialState`");const i=("function"==typeof e.reducers?e.reducers(function(){function e(e,t){return{_reducerDefinitionType:"asyncThunk",payloadCreator:e,...t}}return e.withTypes=()=>e,{reducer:e=>Object.assign({[e.name]:(...t)=>e(...t)}[e.name],{_reducerDefinitionType:"reducer"}),preparedReducer:(e,t)=>({_reducerDefinitionType:"reducerWithPrepare",prepare:e,reducer:t}),asyncThunk:e}}()):e.reducers)||{},s=Object.keys(i),o={sliceCaseReducersByName:{},sliceCaseReducersByType:{},actionCreators:{},sliceMatchers:[]},a={addCase(e,t){const n="string"==typeof e?e:e.type;if(!n)throw new Error("production"===process.env.NODE_ENV?rl(12):"`context.addCase` cannot be called with an empty action type");if(n in o.sliceCaseReducersByType)throw new Error("production"===process.env.NODE_ENV?rl(13):"`context.addCase` cannot be called with two reducers for the same action type: "+n);return o.sliceCaseReducersByType[n]=t,a},addMatcher:(e,t)=>(o.sliceMatchers.push({matcher:e,reducer:t}),a),exposeAction:(e,t)=>(o.actionCreators[e]=t,a),exposeCaseReducer:(e,t)=>(o.sliceCaseReducersByName[e]=t,a)};function c(){if("production"!==process.env.NODE_ENV&&"object"==typeof e.extraReducers)throw new Error("production"===process.env.NODE_ENV?rl(14):"The object notation for `createSlice.extraReducers` has been removed. Please use the 'builder callback' notation instead: https://redux-toolkit.js.org/api/createSlice");const[t={},n=[],r]="function"==typeof e.extraReducers?Rc(e.extraReducers):[e.extraReducers],i={...t,...o.sliceCaseReducersByType};return function(e,t){if("production"!==process.env.NODE_ENV&&"object"==typeof t)throw new Error("production"===process.env.NODE_ENV?rl(8):"The object notation for `createReducer` has been removed. Please use the 'builder callback' notation instead: https://redux-toolkit.js.org/api/createReducer");let n,[r,i,s]=Rc(t);if("function"==typeof e)n=()=>_c(e());else{const t=_c(e);n=()=>t}function o(e=n(),t){let o=[r[t.type],...i.filter((({matcher:e})=>e(t))).map((({reducer:e})=>e))];return 0===o.filter((e=>!!e)).length&&(o=[s]),o.reduce(((e,n)=>{if(n){if(ca(e)){const r=n(e,t);return void 0===r?e:r}if(la(e))return Qa(e,(e=>n(e,t)));{const r=n(e,t);if(void 0===r){if(null===e)return e;throw Error("A case reducer on a non-draftable value must not return undefined")}return r}}return e}),e)}return o.getInitialState=n,o}(e.initialState,(e=>{for(let t in i)e.addCase(t,i[t]);for(let t of o.sliceMatchers)e.addMatcher(t.matcher,t.reducer);for(let t of n)e.addMatcher(t.matcher,t.reducer);r&&e.addDefaultCase(r)}))}s.forEach((r=>{const s=i[r],o={reducerName:r,type:Xc(n,r),createNotation:"function"==typeof e.reducers};!function(e){return"asyncThunk"===e._reducerDefinitionType}(s)?function({type:e,reducerName:t,createNotation:n},r,i){let s,o;if("reducer"in r){if(n&&!function(e){return"reducerWithPrepare"===e._reducerDefinitionType}(r))throw new Error("production"===process.env.NODE_ENV?rl(17):"Please use the `create.preparedReducer` notation for prepared action creators with the `create` notation.");s=r.reducer,o=r.prepare}else s=r;i.addCase(e,s).exposeCaseReducer(t,s).exposeAction(t,o?dc(e,o):dc(e))}(o,s,a):function({type:e,reducerName:t},n,r,i){if(!i)throw new Error("production"===process.env.NODE_ENV?rl(18):"Cannot use `create.asyncThunk` in the built-in `createSlice`. Use `buildCreateSlice({ creators: { asyncThunk: asyncThunkCreator } })` to create a customised version of `createSlice`.");const{payloadCreator:s,fulfilled:o,pending:a,rejected:c,settled:l,options:u}=n,h=i(e,s,u);r.exposeAction(t,h),o&&r.addCase(h.fulfilled,o);a&&r.addCase(h.pending,a);c&&r.addCase(h.rejected,c);l&&r.addMatcher(h.settled,l);r.exposeCaseReducer(t,{fulfilled:o||nl,pending:a||nl,rejected:c||nl,settled:l||nl})}(o,s,a,t)}));const l=e=>e,u=new Map;let h;function d(e,t){return h||(h=c()),h(e,t)}function p(){return h||(h=c()),h.getInitialState()}function f(t,n=!1){function r(e){let r=e[t];if(void 0===r)if(n)r=p();else if("production"!==process.env.NODE_ENV)throw new Error("production"===process.env.NODE_ENV?rl(15):"selectSlice returned undefined for an uninjected slice reducer");return r}function i(t=l){const r=gc(u,n,{insert:()=>new WeakMap});return gc(r,t,{insert:()=>{const r={};for(const[i,s]of Object.entries(e.selectors??{}))r[i]=el(s,t,p,n);return r}})}return{reducerPath:t,getSelectors:i,get selectors(){return i(r)},selectSlice:r}}const m={name:n,reducer:d,actions:o.actionCreators,caseReducers:o.sliceCaseReducersByName,getInitialState:p,...f(r),injectInto(e,{reducerPath:t,...n}={}){const i=t??r;return e.inject({reducerPath:i,reducer:d},n),{...m,...f(i,!0)}}};return m}}function el(e,t,n,r){function i(i,...s){let o=t(i);if(void 0===o)if(r)o=n();else if("production"!==process.env.NODE_ENV)throw new Error("production"===process.env.NODE_ENV?rl(16):"selectState returned undefined for an uninjected slice reducer");return e(o,...s)}return i.unwrapped=e,i}var tl=Zc();function nl(){}function rl(e){return`Minified Redux Toolkit error #${e}; visit https://redux-toolkit.js.org/Errors?code=${e} for the full message or use the non-minified dev environment for full errors. `}var il=Ko;function sl(e,t){if(e===t||!(il(e)&&il(t)||Array.isArray(e)&&Array.isArray(t)))return t;const n=Object.keys(t),r=Object.keys(e);let i=n.length===r.length;const s=Array.isArray(t)?[]:{};for(const r of n)s[r]=sl(e[r],t[r]),i&&(i=e[r]===s[r]);return i?e:s}function ol(e){let t=0;for(const n in e)t++;return t}var al=e=>[].concat(...e);function cl(e){return null!=e}var ll=class{constructor(e,t=void 0){this.value=e,this.meta=t}},ul=dc("__rtkq/focused"),hl=dc("__rtkq/unfocused"),dl=dc("__rtkq/online"),pl=dc("__rtkq/offline"),fl=!1;function ml(e,t){return function(){const t=()=>e(ul()),n=()=>e(dl()),r=()=>e(pl()),i=()=>{"visible"===window.document.visibilityState?t():e(hl())};return fl||"undefined"!=typeof window&&window.addEventListener&&(window.addEventListener("visibilitychange",i,!1),window.addEventListener("focus",t,!1),window.addEventListener("online",n,!1),window.addEventListener("offline",r,!1),fl=!0),()=>{window.removeEventListener("focus",t),window.removeEventListener("visibilitychange",i),window.removeEventListener("online",n),window.removeEventListener("offline",r),fl=!1}}()}function _l(e){return"query"===e.type}function gl(e,t,n,r,i,s){return"function"==typeof e?e(t,n,r,i).map(yl).map(s):Array.isArray(e)?e.map(yl).map(s):[]}function yl(e){return"string"==typeof e?{type:e}:e}var vl=Symbol("forceQueryFn"),bl=e=>"function"==typeof e[vl];function wl(e){return e}function Cl(e,t,n,r){return gl(n[e.meta.arg.endpointName][t],Vc(e)?e.payload:void 0,$c(e)?e.payload:void 0,e.meta.arg.originalArgs,"baseQueryMeta"in e.meta?e.meta.baseQueryMeta:void 0,r)}function El(e,t,n){const r=e[t];r&&n(r)}function Sl(e){return("arg"in e?e.arg.fixedCacheKey:e.fixedCacheKey)??e.requestId}function Tl(e,t,n){const r=e[Sl(t)];r&&n(r)}var Il={};function Nl({reducerPath:e,queryThunk:t,mutationThunk:n,context:{endpointDefinitions:r,apiUid:i,extractRehydrationInfo:s,hasRehydrationInfo:o},assertTagType:a,config:c}){const l=dc(`${e}/resetApiState`),u=tl({name:`${e}/queries`,initialState:Il,reducers:{removeQueryResult:{reducer(e,{payload:{queryCacheKey:t}}){delete e[t]},prepare:kc()},queryResultPatched:{reducer(e,{payload:{queryCacheKey:t,patches:n}}){El(e,t,(e=>{e.data=Ya(e.data,n.concat())}))},prepare:kc()}},extraReducers(e){e.addCase(t.pending,((e,{meta:t,meta:{arg:n}})=>{const r=bl(n);e[n.queryCacheKey]??={status:"uninitialized",endpointName:n.endpointName},El(e,n.queryCacheKey,(e=>{e.status="pending",e.requestId=r&&e.requestId?e.requestId:t.requestId,void 0!==n.originalArgs&&(e.originalArgs=n.originalArgs),e.startedTimeStamp=t.startedTimeStamp}))})).addCase(t.fulfilled,((e,{meta:t,payload:n})=>{El(e,t.arg.queryCacheKey,(e=>{if(e.requestId!==t.requestId&&!bl(t.arg))return;const{merge:i}=r[t.arg.endpointName];if(e.status="fulfilled",i)if(void 0!==e.data){const{fulfilledTimeStamp:r,arg:s,baseQueryMeta:o,requestId:a}=t;let c=Qa(e.data,(e=>i(e,n,{arg:s.originalArgs,baseQueryMeta:o,fulfilledTimeStamp:r,requestId:a})));e.data=c}else e.data=n;else e.data=r[t.arg.endpointName].structuralSharing??1?sl(ca(e.data)?(ca(s=e.data)||oa(15,s),s[ia].base_):e.data,n):n;var s;delete e.error,e.fulfilledTimeStamp=t.fulfilledTimeStamp}))})).addCase(t.rejected,((e,{meta:{condition:t,arg:n,requestId:r},error:i,payload:s})=>{El(e,n.queryCacheKey,(e=>{if(t);else{if(e.requestId!==r)return;e.status="rejected",e.error=s??i}}))})).addMatcher(o,((e,t)=>{const{queries:n}=s(t);for(const[t,r]of Object.entries(n))"fulfilled"!==r?.status&&"rejected"!==r?.status||(e[t]=r)}))}}),h=tl({name:`${e}/mutations`,initialState:Il,reducers:{removeMutationResult:{reducer(e,{payload:t}){const n=Sl(t);n in e&&delete e[n]},prepare:kc()}},extraReducers(e){e.addCase(n.pending,((e,{meta:t,meta:{requestId:n,arg:r,startedTimeStamp:i}})=>{r.track&&(e[Sl(t)]={requestId:n,status:"pending",endpointName:r.endpointName,startedTimeStamp:i})})).addCase(n.fulfilled,((e,{payload:t,meta:n})=>{n.arg.track&&Tl(e,n,(e=>{e.requestId===n.requestId&&(e.status="fulfilled",e.data=t,e.fulfilledTimeStamp=n.fulfilledTimeStamp)}))})).addCase(n.rejected,((e,{payload:t,error:n,meta:r})=>{r.arg.track&&Tl(e,r,(e=>{e.requestId===r.requestId&&(e.status="rejected",e.error=t??n)}))})).addMatcher(o,((e,t)=>{const{mutations:n}=s(t);for(const[t,r]of Object.entries(n))"fulfilled"!==r?.status&&"rejected"!==r?.status||t===r?.requestId||(e[t]=r)}))}}),d=tl({name:`${e}/invalidation`,initialState:Il,reducers:{updateProvidedBy:{reducer(e,t){const{queryCacheKey:n,providedTags:r}=t.payload;for(const t of Object.values(e))for(const e of Object.values(t)){const t=e.indexOf(n);-1!==t&&e.splice(t,1)}for(const{type:t,id:i}of r){const r=(e[t]??={})[i||"__internal_without_id"]??=[];r.includes(n)||r.push(n)}},prepare:kc()}},extraReducers(e){e.addCase(u.actions.removeQueryResult,((e,{payload:{queryCacheKey:t}})=>{for(const n of Object.values(e))for(const e of Object.values(n)){const n=e.indexOf(t);-1!==n&&e.splice(n,1)}})).addMatcher(o,((e,t)=>{const{provided:n}=s(t);for(const[t,r]of Object.entries(n))for(const[n,i]of Object.entries(r)){const r=(e[t]??={})[n||"__internal_without_id"]??=[];for(const e of i){r.includes(e)||r.push(e)}}})).addMatcher(qc(Vc(t),$c(t)),((e,t)=>{const n=Cl(t,"providesTags",r,a),{queryCacheKey:i}=t.meta.arg;d.caseReducers.updateProvidedBy(e,d.actions.updateProvidedBy({queryCacheKey:i,providedTags:n}))}))}}),p=tl({name:`${e}/subscriptions`,initialState:Il,reducers:{updateSubscriptionOptions(e,t){},unsubscribeQueryResult(e,t){},internal_getRTKQSubscriptions(){}}}),f=tl({name:`${e}/internalSubscriptions`,initialState:Il,reducers:{subscriptionsUpdated:{reducer:(e,t)=>Ya(e,t.payload),prepare:kc()}}}),m=tl({name:`${e}/config`,initialState:{online:"undefined"==typeof navigator||void 0===navigator.onLine||navigator.onLine,focused:"undefined"==typeof document||"hidden"!==document.visibilityState,middlewareRegistered:!1,...c},reducers:{middlewareRegistered(e,{payload:t}){e.middlewareRegistered="conflict"!==e.middlewareRegistered&&i===t||"conflict"}},extraReducers:e=>{e.addCase(dl,(e=>{e.online=!0})).addCase(pl,(e=>{e.online=!1})).addCase(ul,(e=>{e.focused=!0})).addCase(hl,(e=>{e.focused=!1})).addMatcher(o,(e=>({...e})))}}),_=Zo({queries:u.reducer,mutations:h.reducer,provided:d.reducer,subscriptions:f.reducer,config:m.reducer});return{reducer:(e,t)=>_(l.match(t)?void 0:e,t),actions:{...m.actions,...u.actions,...p.actions,...f.actions,...h.actions,...d.actions,resetApiState:l}}}var kl=Symbol.for("RTKQ/skipToken"),Pl={status:"uninitialized"},xl=Qa(Pl,(()=>{})),Ol=Qa(Pl,(()=>{}));var Dl=WeakMap?new WeakMap:void 0,Rl=({endpointName:e,queryArgs:t})=>{let n="";const r=Dl?.get(t);if("string"==typeof r)n=r;else{const e=JSON.stringify(t,((e,t)=>t=Ko(t="bigint"==typeof t?{$bigint:t.toString()}:t)?Object.keys(t).sort().reduce(((e,n)=>(e[n]=t[n],e)),{}):t));Ko(t)&&Dl?.set(t,e),n=e}return`${e}(${n})`};function Al(...e){return function(t){const n=rc((e=>t.extractRehydrationInfo?.(e,{reducerPath:t.reducerPath??"api"}))),r={reducerPath:"api",keepUnusedDataFor:60,refetchOnMountOrArgChange:!1,refetchOnFocus:!1,refetchOnReconnect:!1,invalidationBehavior:"delayed",...t,extractRehydrationInfo:n,serializeQueryArgs(e){let n=Rl;if("serializeQueryArgs"in e.endpointDefinition){const t=e.endpointDefinition.serializeQueryArgs;n=e=>{const n=t(e);return"string"==typeof n?n:Rl({...e,queryArgs:n})}}else t.serializeQueryArgs&&(n=t.serializeQueryArgs);return n(e)},tagTypes:[...t.tagTypes||[]]},i={endpointDefinitions:{},batch(e){e()},apiUid:Wc(),extractRehydrationInfo:n,hasRehydrationInfo:rc((e=>null!=n(e)))},s={injectEndpoints:function(e){const t=e.endpoints({query:e=>({...e,type:"query"}),mutation:e=>({...e,type:"mutation"})});for(const[n,r]of Object.entries(t))if(!0!==e.overrideExisting&&n in i.endpointDefinitions){if("throw"===e.overrideExisting)throw new Error("production"===process.env.NODE_ENV?rl(39):`called \`injectEndpoints\` to override already-existing endpointName ${n} without specifying \`overrideExisting: true\``);"undefined"!=typeof process&&"development"===process.env.NODE_ENV&&console.error(`called \`injectEndpoints\` to override already-existing endpointName ${n} without specifying \`overrideExisting: true\``)}else{i.endpointDefinitions[n]=r;for(const e of o)e.injectEndpoint(n,r)}return s},enhanceEndpoints({addTagTypes:e,endpoints:t}){if(e)for(const t of e)r.tagTypes.includes(t)||r.tagTypes.push(t);if(t)for(const[e,n]of Object.entries(t))"function"==typeof n?n(i.endpointDefinitions[e]):Object.assign(i.endpointDefinitions[e]||{},n);return s}},o=e.map((e=>e.init(s,r,i)));return s.injectEndpoints({endpoints:t.endpoints})}}function ql(e,...t){return Object.assign(e,...t)}var Ml=({api:e,queryThunk:t,internalState:n})=>{const r=`${e.reducerPath}/subscriptions`;let i=null,s=null;const{updateSubscriptionOptions:o,unsubscribeQueryResult:a}=e.internalActions,c=()=>n.currentSubscriptions,l={getSubscriptions:c,getSubscriptionCount:e=>ol(c()[e]??{}),isRequestSubscribed:(e,t)=>{const n=c();return!!n?.[e]?.[t]}};return(c,u)=>{if(i||(i=JSON.parse(JSON.stringify(n.currentSubscriptions))),e.util.resetApiState.match(c))return i=n.currentSubscriptions={},s=null,[!0,!1];if(e.internalActions.internal_getRTKQSubscriptions.match(c))return[!1,l];const h=((n,r)=>{if(o.match(r)){const{queryCacheKey:e,requestId:t,options:i}=r.payload;return n?.[e]?.[t]&&(n[e][t]=i),!0}if(a.match(r)){const{queryCacheKey:e,requestId:t}=r.payload;return n[e]&&delete n[e][t],!0}if(e.internalActions.removeQueryResult.match(r))return delete n[r.payload.queryCacheKey],!0;if(t.pending.match(r)){const{meta:{arg:e,requestId:t}}=r,i=n[e.queryCacheKey]??={};return i[`${t}_running`]={},e.subscribe&&(i[t]=e.subscriptionOptions??i[t]??{}),!0}let i=!1;if(t.fulfilled.match(r)||t.rejected.match(r)){const e=n[r.meta.arg.queryCacheKey]||{},t=`${r.meta.requestId}_running`;i||=!!e[t],delete e[t]}if(t.rejected.match(r)){const{meta:{condition:e,arg:t,requestId:s}}=r;if(e&&t.subscribe){const e=n[t.queryCacheKey]??={};e[s]=t.subscriptionOptions??e[s]??{},i=!0}}return i})(n.currentSubscriptions,c);let d=!0;if(h){s||(s=setTimeout((()=>{const t=JSON.parse(JSON.stringify(n.currentSubscriptions)),[,r]=Ka(i,(()=>t));u.next(e.internalActions.subscriptionsUpdated(r)),i=t,s=null}),500));const o="string"==typeof c.type&&!!c.type.startsWith(r),a=t.rejected.match(c)&&c.meta.condition&&!!c.meta.arg.subscribe;d=!o&&!a}return[d,!1]}};var jl=({reducerPath:e,api:t,queryThunk:n,context:r,internalState:i})=>{const{removeQueryResult:s,unsubscribeQueryResult:o}=t.internalActions,a=qc(o.match,n.fulfilled,n.rejected);function c(e){const t=i.currentSubscriptions[e];return!!t&&!function(e){for(const t in e)return!1;return!0}(t)}const l={};function u(e,t,n,i){const o=r.endpointDefinitions[t],a=o?.keepUnusedDataFor??i.keepUnusedDataFor;if(a===1/0)return;const u=Math.max(0,Math.min(a,2147482.647));if(!c(e)){const t=l[e];t&&clearTimeout(t),l[e]=setTimeout((()=>{c(e)||n.dispatch(s({queryCacheKey:e})),delete l[e]}),1e3*u)}}return(n,i,s)=>{if(a(n)){const t=i.getState()[e],{queryCacheKey:r}=o.match(n)?n.payload:n.meta.arg;u(r,t.queries[r]?.endpointName,i,t.config)}if(t.util.resetApiState.match(n))for(const[e,t]of Object.entries(l))t&&clearTimeout(t),delete l[e];if(r.hasRehydrationInfo(n)){const t=i.getState()[e],{queries:s}=r.extractRehydrationInfo(n);for(const[e,n]of Object.entries(s))u(e,n?.endpointName,i,t.config)}}},Fl=new Error("Promise never resolved before cacheEntryRemoved."),Ll=({api:e,reducerPath:t,context:n,queryThunk:r,mutationThunk:i,internalState:s})=>{const o=Uc(r),a=Uc(i),c=Vc(r,i),l={};function u(t,r,i,s,o){const a=n.endpointDefinitions[t],c=a?.onCacheEntryAdded;if(!c)return;const u={},h=new Promise((e=>{u.cacheEntryRemoved=e})),d=Promise.race([new Promise((e=>{u.valueResolved=e})),h.then((()=>{throw Fl}))]);d.catch((()=>{})),l[i]=u;const p=e.endpoints[t].select("query"===a.type?r:i),f=s.dispatch(((e,t,n)=>n)),m={...s,getCacheEntry:()=>p(s.getState()),requestId:o,extra:f,updateCachedData:"query"===a.type?n=>s.dispatch(e.util.updateQueryData(t,r,n)):void 0,cacheDataLoaded:d,cacheEntryRemoved:h},_=c(r,m);Promise.resolve(_).catch((e=>{if(e!==Fl)throw e}))}return(n,s,h)=>{const d=function(t){if(o(t))return t.meta.arg.queryCacheKey;if(a(t))return t.meta.arg.fixedCacheKey??t.meta.requestId;return e.internalActions.removeQueryResult.match(t)?t.payload.queryCacheKey:e.internalActions.removeMutationResult.match(t)?Sl(t.payload):""}(n);if(r.pending.match(n)){const e=h[t].queries[d],r=s.getState()[t].queries[d];!e&&r&&u(n.meta.arg.endpointName,n.meta.arg.originalArgs,d,s,n.meta.requestId)}else if(i.pending.match(n)){s.getState()[t].mutations[d]&&u(n.meta.arg.endpointName,n.meta.arg.originalArgs,d,s,n.meta.requestId)}else if(c(n)){const e=l[d];e?.valueResolved&&(e.valueResolved({data:n.payload,meta:n.meta.baseQueryMeta}),delete e.valueResolved)}else if(e.internalActions.removeQueryResult.match(n)||e.internalActions.removeMutationResult.match(n)){const e=l[d];e&&(delete l[d],e.cacheEntryRemoved())}else if(e.util.resetApiState.match(n))for(const[e,t]of Object.entries(l))delete l[e],t.cacheEntryRemoved()}},zl=({api:e,context:{apiUid:t},reducerPath:n})=>(r,i)=>{e.util.resetApiState.match(r)&&i.dispatch(e.internalActions.middlewareRegistered(t)),"undefined"!=typeof process&&"development"===process.env.NODE_ENV&&e.internalActions.middlewareRegistered.match(r)&&r.payload===t&&"conflict"===i.getState()[n]?.config?.middlewareRegistered&&console.warn(`There is a mismatch between slice and middleware for the reducerPath "${n}".\nYou can only have one api per reducer path, this will lead to crashes in various situations!${"api"===n?"\nIf you have multiple apis, you *have* to specify the reducerPath option when using createApi!":""}`)},$l=({reducerPath:e,context:t,context:{endpointDefinitions:n},mutationThunk:r,queryThunk:i,api:s,assertTagType:o,refetchQuery:a,internalState:c})=>{const{removeQueryResult:l}=s.internalActions,u=qc(Vc(r),$c(r)),h=qc(Vc(r,i),zc(r,i));let d=[];function p(n,r){const i=r.getState(),o=i[e];if(d.push(...n),"delayed"===o.config.invalidationBehavior&&function(e){for(const t in e.queries)if("pending"===e.queries[t]?.status)return!0;for(const t in e.mutations)if("pending"===e.mutations[t]?.status)return!0;return!1}(o))return;const u=d;if(d=[],0===u.length)return;const h=s.util.selectInvalidatedBy(i,u);t.batch((()=>{const e=Array.from(h.values());for(const{queryCacheKey:t}of e){const e=o.queries[t],n=c.currentSubscriptions[t]??{};e&&(0===ol(n)?r.dispatch(l({queryCacheKey:t})):"uninitialized"!==e.status&&r.dispatch(a(e)))}}))}return(e,t)=>{u(e)?p(Cl(e,"invalidatesTags",n,o),t):h(e)?p([],t):s.util.invalidateTags.match(e)&&p(gl(e.payload,void 0,void 0,void 0,void 0,o),t)}},Vl=({reducerPath:e,queryThunk:t,api:n,refetchQuery:r,internalState:i})=>{const s={};function o({queryCacheKey:t},n){const a=n.getState()[e],c=a.queries[t],u=i.currentSubscriptions[t];if(!c||"uninitialized"===c.status)return;const{lowestPollingInterval:h,skipPollingIfUnfocused:d}=l(u);if(!Number.isFinite(h))return;const p=s[t];p?.timeout&&(clearTimeout(p.timeout),p.timeout=void 0);const f=Date.now()+h;s[t]={nextPollTimestamp:f,pollingInterval:h,timeout:setTimeout((()=>{!a.config.focused&&d||n.dispatch(r(c)),o({queryCacheKey:t},n)}),h)}}function a({queryCacheKey:t},n){const r=n.getState()[e].queries[t],a=i.currentSubscriptions[t];if(!r||"uninitialized"===r.status)return;const{lowestPollingInterval:u}=l(a);if(!Number.isFinite(u))return void c(t);const h=s[t],d=Date.now()+u;(!h||d<h.nextPollTimestamp)&&o({queryCacheKey:t},n)}function c(e){const t=s[e];t?.timeout&&clearTimeout(t.timeout),delete s[e]}function l(e={}){let t=!1,n=Number.POSITIVE_INFINITY;for(let r in e)e[r].pollingInterval&&(n=Math.min(e[r].pollingInterval,n),t=e[r].skipPollingIfUnfocused||t);return{lowestPollingInterval:n,skipPollingIfUnfocused:t}}return(e,r)=>{(n.internalActions.updateSubscriptionOptions.match(e)||n.internalActions.unsubscribeQueryResult.match(e))&&a(e.payload,r),(t.pending.match(e)||t.rejected.match(e)&&e.meta.condition)&&a(e.meta.arg,r),(t.fulfilled.match(e)||t.rejected.match(e)&&!e.meta.condition)&&o(e.meta.arg,r),n.util.resetApiState.match(e)&&function(){for(const e of Object.keys(s))c(e)}()}},Ul=({api:e,context:t,queryThunk:n,mutationThunk:r})=>{const i=Lc(n,r),s=zc(n,r),o=Vc(n,r),a={};return(n,r)=>{if(i(n)){const{requestId:i,arg:{endpointName:s,originalArgs:o}}=n.meta,c=t.endpointDefinitions[s],l=c?.onQueryStarted;if(l){const t={},n=new Promise(((e,n)=>{t.resolve=e,t.reject=n}));n.catch((()=>{})),a[i]=t;const u=e.endpoints[s].select("query"===c.type?o:i),h=r.dispatch(((e,t,n)=>n)),d={...r,getCacheEntry:()=>u(r.getState()),requestId:i,extra:h,updateCachedData:"query"===c.type?t=>r.dispatch(e.util.updateQueryData(s,o,t)):void 0,queryFulfilled:n};l(o,d)}}else if(o(n)){const{requestId:e,baseQueryMeta:t}=n.meta;a[e]?.resolve({data:n.payload,meta:t}),delete a[e]}else if(s(n)){const{requestId:e,rejectedWithValue:t,baseQueryMeta:r}=n.meta;a[e]?.reject({error:n.payload??n.error,isUnhandledError:!t,meta:r}),delete a[e]}}};function Wl(e){const{reducerPath:t,queryThunk:n,api:r,context:i}=e,{apiUid:s}=i,o={invalidateTags:dc(`${t}/invalidateTags`)},a=e=>e.type.startsWith(`${t}/`),c=[zl,jl,$l,Vl,Ll,Ul];return{middleware:n=>{let o=!1;const u={...e,internalState:{currentSubscriptions:{}},refetchQuery:l,isThisApiSliceAction:a},h=c.map((e=>e(u))),d=Ml(u),p=(({reducerPath:e,context:t,api:n,refetchQuery:r,internalState:i})=>{const{removeQueryResult:s}=n.internalActions;function o(n,o){const a=n.getState()[e],c=a.queries,l=i.currentSubscriptions;t.batch((()=>{for(const e of Object.keys(l)){const t=c[e],i=l[e];i&&t&&((Object.values(i).some((e=>!0===e[o]))||Object.values(i).every((e=>void 0===e[o]))&&a.config[o])&&(0===ol(i)?n.dispatch(s({queryCacheKey:e})):"uninitialized"!==t.status&&n.dispatch(r(t))))}}))}return(e,t)=>{ul.match(e)&&o(t,"refetchOnFocus"),dl.match(e)&&o(t,"refetchOnReconnect")}})(u);return e=>c=>{if(!ta(c))return e(c);o||(o=!0,n.dispatch(r.internalActions.middlewareRegistered(s)));const l={...n,next:e},u=n.getState(),[f,m]=d(c,l,u);let _;if(_=f?e(c):m,n.getState()[t]&&(p(c,l,u),a(c)||i.hasRehydrationInfo(c)))for(const e of h)e(c,l,u);return _}},actions:o};function l(t){return e.api.endpoints[t.endpointName].initiate(t.originalArgs,{subscribe:!1,forceRefetch:!0})}}var Bl=Symbol(),Hl=Al((({createSelector:e=sc}={})=>({name:Bl,init(t,{baseQuery:n,tagTypes:r,reducerPath:i,serializeQueryArgs:s,keepUnusedDataFor:o,refetchOnMountOrArgChange:a,refetchOnFocus:c,refetchOnReconnect:l,invalidationBehavior:u},h){Ba();const d=e=>("undefined"!=typeof process&&"development"===process.env.NODE_ENV&&(r.includes(e.type)||console.error(`Tag type '${e.type}' was used, but not specified in \`tagTypes\`!`)),e);Object.assign(t,{reducerPath:i,endpoints:{},internalActions:{onOnline:dl,onOffline:pl,onFocus:ul,onFocusLost:hl},util:{}});const{queryThunk:p,mutationThunk:f,patchQueryData:m,updateQueryData:_,upsertQueryData:g,prefetch:y,buildMatchThunkActions:v}=function({reducerPath:e,baseQuery:t,context:{endpointDefinitions:n},serializeQueryArgs:r,api:i,assertTagType:s}){const o=async(e,{signal:r,abort:i,rejectWithValue:s,fulfillWithValue:o,dispatch:c,getState:l,extra:u})=>{const h=n[e.endpointName];try{let n,s=wl;const d={signal:r,abort:i,dispatch:c,getState:l,extra:u,endpoint:e.endpointName,type:e.type,forced:"query"===e.type?a(e,l()):void 0,queryCacheKey:"query"===e.type?e.queryCacheKey:void 0},p="query"===e.type?e[vl]:void 0;if(p?n=p():h.query?(n=await t(h.query(e.originalArgs),d,h.extraOptions),h.transformResponse&&(s=h.transformResponse)):n=await h.queryFn(e.originalArgs,d,h.extraOptions,(e=>t(e,d,h.extraOptions))),"undefined"!=typeof process&&"development"===process.env.NODE_ENV){const t=h.query?"`baseQuery`":"`queryFn`";let r;if(n){if("object"!=typeof n)r=`${t} did not return an object.`;else if(n.error&&n.data)r=`${t} returned an object containing both \`error\` and \`result\`.`;else if(void 0===n.error&&void 0===n.data)r=`${t} returned an object containing neither a valid \`error\` and \`result\`. At least one of them should not be \`undefined\``;else for(const e of Object.keys(n))if("error"!==e&&"data"!==e&&"meta"!==e){r=`The object returned by ${t} has the unknown property ${e}.`;break}}else r=`${t} did not return anything.`;r&&console.error(`Error encountered handling the endpoint ${e.endpointName}.\n              ${r}\n              It needs to return an object with either the shape \`{ data: <value> }\` or \`{ error: <value> }\` that may contain an optional \`meta\` property.\n              Object returned was:`,n)}if(n.error)throw new ll(n.error,n.meta);return o(await s(n.data,n.meta,e.originalArgs),{fulfilledTimeStamp:Date.now(),baseQueryMeta:n.meta,[Nc]:!0})}catch(t){let n=t;if(n instanceof ll){let t=wl;h.query&&h.transformErrorResponse&&(t=h.transformErrorResponse);try{return s(await t(n.value,n.meta,e.originalArgs),{baseQueryMeta:n.meta,[Nc]:!0})}catch(e){n=e}}throw"undefined"!=typeof process&&"production"!==process.env.NODE_ENV?console.error(`An unhandled error occurred processing a request for the endpoint "${e.endpointName}".\nIn the case of an unhandled error, no tags will be "provided" or "invalidated".`,n):console.error(n),n}};function a(t,n){const r=n[e]?.queries?.[t.queryCacheKey],i=n[e]?.config.refetchOnMountOrArgChange,s=r?.fulfilledTimeStamp,o=t.forceRefetch??(t.subscribe&&i);return!!o&&(!0===o||(Number(new Date)-Number(s))/1e3>=o)}const c=Yc(`${e}/executeQuery`,o,{getPendingMeta:()=>({startedTimeStamp:Date.now(),[Nc]:!0}),condition(t,{getState:r}){const i=r(),s=i[e]?.queries?.[t.queryCacheKey],o=s?.fulfilledTimeStamp,c=t.originalArgs,l=s?.originalArgs,u=n[t.endpointName];return!(!bl(t)&&("pending"===s?.status||!a(t,i)&&(!_l(u)||!u?.forceRefetch?.({currentArg:c,previousArg:l,endpointState:s,state:i}))&&o))},dispatchConditionRejection:!0}),l=Yc(`${e}/executeMutation`,o,{getPendingMeta:()=>({startedTimeStamp:Date.now(),[Nc]:!0})});function u(e){return t=>t?.meta?.arg?.endpointName===e}return{queryThunk:c,mutationThunk:l,prefetch:(e,t,n)=>(r,s)=>{const o=(e=>"force"in e)(n)&&n.force,a=(e=>"ifOlderThan"in e)(n)&&n.ifOlderThan,c=(n=!0)=>{const r={forceRefetch:n,isPrefetch:!0};return i.endpoints[e].initiate(t,r)},l=i.endpoints[e].select(t)(s());if(o)r(c());else if(a){const e=l?.fulfilledTimeStamp;if(!e)return void r(c());(Number(new Date)-Number(new Date(e)))/1e3>=a&&r(c())}else r(c(!1))},updateQueryData:(e,t,n,r=!0)=>(s,o)=>{const a=i.endpoints[e].select(t)(o()),c={patches:[],inversePatches:[],undo:()=>s(i.util.patchQueryData(e,t,c.inversePatches,r))};if("uninitialized"===a.status)return c;let l;if("data"in a)if(la(a.data)){const[e,t,r]=Ka(a.data,n);c.patches.push(...t),c.inversePatches.push(...r),l=e}else l=n(a.data),c.patches.push({op:"replace",path:[],value:l}),c.inversePatches.push({op:"replace",path:[],value:a.data});return 0===c.patches.length||s(i.util.patchQueryData(e,t,c.patches,r)),c},upsertQueryData:(e,t,n)=>r=>r(i.endpoints[e].initiate(t,{subscribe:!1,forceRefetch:!0,[vl]:()=>({data:n})})),patchQueryData:(e,t,o,a)=>(c,l)=>{const u=n[e],h=r({queryArgs:t,endpointDefinition:u,endpointName:e});if(c(i.internalActions.queryResultPatched({queryCacheKey:h,patches:o})),!a)return;const d=i.endpoints[e].select(t)(l()),p=gl(u.providesTags,d.data,void 0,t,{},s);c(i.internalActions.updateProvidedBy({queryCacheKey:h,providedTags:p}))},buildMatchThunkActions:function(e,t){return{matchPending:Mc(Lc(e),u(t)),matchFulfilled:Mc(Vc(e),u(t)),matchRejected:Mc(zc(e),u(t))}}}}({baseQuery:n,reducerPath:i,context:h,api:t,serializeQueryArgs:s,assertTagType:d}),{reducer:b,actions:w}=Nl({context:h,queryThunk:p,mutationThunk:f,reducerPath:i,assertTagType:d,config:{refetchOnFocus:c,refetchOnReconnect:l,refetchOnMountOrArgChange:a,keepUnusedDataFor:o,reducerPath:i,invalidationBehavior:u}});ql(t.util,{patchQueryData:m,updateQueryData:_,upsertQueryData:g,prefetch:y,resetApiState:w.resetApiState}),ql(t.internalActions,w);const{middleware:C,actions:E}=Wl({reducerPath:i,context:h,queryThunk:p,mutationThunk:f,api:t,assertTagType:d});ql(t.util,E),ql(t,{reducer:b,middleware:C});const{buildQuerySelector:S,buildMutationSelector:T,selectInvalidatedBy:I,selectCachedArgsForQuery:N}=function({serializeQueryArgs:e,reducerPath:t,createSelector:n}){const r=e=>xl,i=e=>Ol;return{buildQuerySelector:function(t,i){return a=>{const c=e({queryArgs:a,endpointDefinition:i,endpointName:t});return n(a===kl?r:e=>o(e)?.queries?.[c]??xl,s)}},buildMutationSelector:function(){return e=>{let t;return t="object"==typeof e?Sl(e)??kl:e,n(t===kl?i:e=>o(e)?.mutations?.[t]??Ol,s)}},selectInvalidatedBy:function(e,n){const r=e[t],i=new Set;for(const e of n.map(yl)){const t=r.provided[e.type];if(!t)continue;let n=(void 0!==e.id?t[e.id]:al(Object.values(t)))??[];for(const e of n)i.add(e)}return al(Array.from(i.values()).map((e=>{const t=r.queries[e];return t?[{queryCacheKey:e,endpointName:t.endpointName,originalArgs:t.originalArgs}]:[]})))},selectCachedArgsForQuery:function(e,n){return Object.values(e[t].queries).filter((e=>e?.endpointName===n&&"uninitialized"!==e.status)).map((e=>e.originalArgs))}};function s(e){return{...e,...(t=e.status,{status:t,isUninitialized:"uninitialized"===t,isLoading:"pending"===t,isSuccess:"fulfilled"===t,isError:"rejected"===t})};var t}function o(e){const n=e[t];if("production"!==process.env.NODE_ENV&&!n){if(o.triggered)return n;o.triggered=!0,console.error(`Error: No data found at \`state.${t}\`. Did you forget to add the reducer to the store?`)}return n}}({serializeQueryArgs:s,reducerPath:i,createSelector:e});ql(t.util,{selectInvalidatedBy:I,selectCachedArgsForQuery:N});const{buildInitiateQuery:k,buildInitiateMutation:P,getRunningMutationThunk:x,getRunningMutationsThunk:O,getRunningQueriesThunk:D,getRunningQueryThunk:R}=function({serializeQueryArgs:e,queryThunk:t,mutationThunk:n,api:r,context:i}){const s=new Map,o=new Map,{unsubscribeQueryResult:a,removeMutationResult:c,updateSubscriptionOptions:l}=r.internalActions;return{buildInitiateQuery:function(n,i){const o=(c,{subscribe:h=!0,forceRefetch:d,subscriptionOptions:p,[vl]:f,...m}={})=>(_,g)=>{const y=e({queryArgs:c,endpointDefinition:i,endpointName:n}),v=t({...m,type:"query",subscribe:h,forceRefetch:d,subscriptionOptions:p,endpointName:n,originalArgs:c,queryCacheKey:y,[vl]:f}),b=r.endpoints[n].select(c),w=_(v),C=b(g());u(_);const{requestId:E,abort:S}=w,T=C.requestId!==E,I=s.get(_)?.[y],N=()=>b(g()),k=Object.assign(f?w.then(N):T&&!I?Promise.resolve(C):Promise.all([I,w]).then(N),{arg:c,requestId:E,subscriptionOptions:p,queryCacheKey:y,abort:S,async unwrap(){const e=await k;if(e.isError)throw e.error;return e.data},refetch:()=>_(o(c,{subscribe:!1,forceRefetch:!0})),unsubscribe(){h&&_(a({queryCacheKey:y,requestId:E}))},updateSubscriptionOptions(e){k.subscriptionOptions=e,_(l({endpointName:n,requestId:E,queryCacheKey:y,options:e}))}});if(!I&&!T&&!f){const e=s.get(_)||{};e[y]=k,s.set(_,e),k.then((()=>{delete e[y],ol(e)||s.delete(_)}))}return k};return o},buildInitiateMutation:function(e){return(t,{track:r=!0,fixedCacheKey:i}={})=>(s,a)=>{const l=n({type:"mutation",endpointName:e,originalArgs:t,track:r,fixedCacheKey:i}),h=s(l);u(s);const{requestId:d,abort:p,unwrap:f}=h,m=(_=e=>({error:e}),h.unwrap().then((e=>({data:e}))).catch(_));var _;const g=Object.assign(m,{arg:h.arg,requestId:d,abort:p,unwrap:f,reset:()=>{s(c({requestId:d,fixedCacheKey:i}))}}),y=o.get(s)||{};return o.set(s,y),y[d]=g,g.then((()=>{delete y[d],ol(y)||o.delete(s)})),i&&(y[i]=g,g.then((()=>{y[i]===g&&(delete y[i],ol(y)||o.delete(s))}))),g}},getRunningQueryThunk:function(t,n){return r=>{const o=i.endpointDefinitions[t],a=e({queryArgs:n,endpointDefinition:o,endpointName:t});return s.get(r)?.[a]}},getRunningMutationThunk:function(e,t){return e=>o.get(e)?.[t]},getRunningQueriesThunk:function(){return e=>Object.values(s.get(e)||{}).filter(cl)},getRunningMutationsThunk:function(){return e=>Object.values(o.get(e)||{}).filter(cl)}};function u(e){if("production"!==process.env.NODE_ENV){if(u.triggered)return;const t=e(r.internalActions.internal_getRTKQSubscriptions());if(u.triggered=!0,"object"!=typeof t||"string"==typeof t?.type)throw new Error("production"===process.env.NODE_ENV?rl(34):`Warning: Middleware for RTK-Query API at reducerPath "${r.reducerPath}" has not been added to the store.\nYou must add the middleware for RTK-Query to function correctly!`)}}}({queryThunk:p,mutationThunk:f,api:t,serializeQueryArgs:s,context:h});return ql(t.util,{getRunningMutationThunk:x,getRunningMutationsThunk:O,getRunningQueryThunk:R,getRunningQueriesThunk:D}),{name:Bl,injectEndpoint(e,n){const r=t;r.endpoints[e]??={},_l(n)?ql(r.endpoints[e],{name:e,select:S(e,n),initiate:k(e,n)},v(p,e)):"mutation"===n.type&&ql(r.endpoints[e],{name:e,select:T(),initiate:P(e)},v(f,e))}}}}))());if(vt().length>1&&async function(e){let t=!1;const n=e.name;ht.has(n)?(t=!0,ht.delete(n)):dt.has(n)&&e.decRefCount()<=0&&(dt.delete(n),t=!0);t&&(await Promise.all(e.container.getProviders().map((e=>e.delete()))),e.isDeleted=!0)}(vt()[1]).then((function(){console.log("App deleted successfully")})).catch((function(e){console.log("Error deleting app:",e)})),vt().length<1){let e={};try{e=document.body.dataset}catch(e){throw new Error("Unable to get params"+e)}yt({apiKey:e.api,databaseURL:"https://"+e.base+".firebaseio.com",appId:e.app})}const Ql=function(e=function(e=lt){const t=ht.get(e);if(!t&&e===lt&&$())return yt();if(!t)throw _t.create("no-app",{appName:e});return t}(),t){const n=function(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}(e,"database").getImmediate({identifier:t});if(!n._instanceStarted){const e=z("database");e&&function(e,t,n,r={}){e=oe(e),e._checkNotDeleted("useEmulator"),e._instanceStarted&&Kt("Cannot call useEmulator() after instance has already been initialized.");const i=e._repoInternal;let s;if(i.repoInfo_.nodeAdmin)r.mockUserToken&&Kt('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),s=new pn(pn.OWNER);else if(r.mockUserToken){const t="string"==typeof r.mockUserToken?r.mockUserToken:function(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",r=e.iat||0,i=e.sub||e.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const s=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},e);return[A(JSON.stringify({alg:"none",type:"JWT"})),A(JSON.stringify(s)),""].join(".")}(r.mockUserToken,e.app.options.projectId);s=new pn(t)}!function(e,t,n,r){e.repoInfo_=new yn(`${t}:${n}`,!1,e.repoInfo_.namespace,e.repoInfo_.webSocketOnly,e.repoInfo_.nodeAdmin,e.repoInfo_.persistenceKey,e.repoInfo_.includeNamespaceInQueryParams,!0),r&&(e.authTokenProvider_=r)}(i,t,n,s)}(n,...e)}return n}();async function Kl({url:e="crafts/temp_gmail_com/posts/-Ml6DEjYhdnjuW6HiHB7",type:t="array"}){try{let n=await Fo(qo(Ql,e));if(n.exists()){let e=n.val();return"array"===t?Object.keys(e).map((t=>e[t])):e}return"array"===t?[]:null}catch(e){return console.log(e),"array"===t?[]:{}}}const Yl=Hl({reducerPath:"api",tagTypes:["OpenQuiz","Quiz","Answer","Avatar","Post","QuizCase","OpenQuizCase"],baseQuery:function(){throw new Error("production"===process.env.NODE_ENV?rl(33):"When using `fakeBaseQuery`, all queries & mutations must use the `queryFn` definition syntax.")},endpoints:e=>({fetchOpenQuizCaseById:e.query({async queryFn(e){try{let t=await Kl({url:"quizescases/quizesCasesIds/"+e,type:"object"});return{data:t||{}}}catch(e){return console.log(e),{error:e}}},providesTags:(e,t,n)=>[{type:"OpenQuizCase",id:n}]}),fetchOpenQuizesCasesIds:e.query({async queryFn(){try{return{data:await Kl({url:"quizescases/quizesCasesIds",type:"array"})}}catch(e){return console.log(e),{error:e}}},providesTags:(e=[],t,n)=>["QuizCase",...e.map((({id:e})=>({type:"QuizCase",id:e})))]}),fetchUserPosts:e.query({async queryFn(e){try{let t=await Kl({url:"usersCraft/"+e+"/posts",type:"array"});return{data:Array.isArray(t)?t:[]}}catch(e){return console.log(e),{error:e}}},providesTags:(e,t,n)=>[{type:"Post",id:n}]}),fetchQuizesArray:e.query({async queryFn(){let e=new Date,t=new Intl.DateTimeFormat("en",{weekday:"short",year:"numeric",month:"short",day:"numeric"}).format(new Date(e.getFullYear(),e.getMonth(),e.getDate())).replace(/[^a-zA-Z0-9]/g,"_");try{let e=await Kl({url:"/currentquiz/"+t+"/",type:"array"}),n=[],r=window?.quizesSets?window.quizesSets.map((t=>{let r=e.findIndex((e=>t.id===e.id));return r>-1?(e[r],n.push(r),e[r]):t})):[];return e=e.filter(((e,t)=>!n.includes(t)&&!!e.id)),r=[...r,...e],{data:r.map((e=>{let t={...e};return Array.isArray(e?.quizes)&&(t={...e,type:"onerandommanyanswers"}),Array.isArray(e?.choices)&&Array.isArray(e?.answers)&&"accounting"!==e?.type&&(t={...e,type:"multiplechoices"}),e?.answer&&e.answer.includes("{var1-10}")&&(t={...e,type:"quizwithrandomnumber"}),t}))}}catch(e){return console.log(e),{error:e}}},providesTags:(e,t,n)=>[{type:"Quiz",id:n}]}),updatesForOpenQuizes:e.mutation({async queryFn({base:e="",updates:t={temp:"temp"}}){let n={};Object.keys(t).forEach((r=>{n[e+"/"+r]=t[r]}));try{await async function(e={temp:"temp"}){try{return await jo(qo(Ql),e),!0}catch(e){return console.error(e),e}}(n)}catch(e){return console.log(e),{error:e}}return{data:n}},invalidatesTags:["Answer"]})})}),Gl=tl({name:"application",initialState:{email:"",userEmail:"",user:"",avatarUrl:"",isLoading:!0,selectedoption:null,selectedoptions:[],activePage:null,correctquizes:[]},reducers:{loadCorrectquizes:(e,t)=>{e.correctquizes=t.payload},addCorrectQuiz:(e,t)=>{e.correctquizes.push(t.payload)},setInitialQuizOptions:e=>{e.selectedoptions=[],e.selectedoption=9*Math.random()+1},setSelectedOptions:(e,t)=>{e.selectedoptions=t.payload},setSelectedOption:(e,t)=>{e.selectedoption=t.payload},setUser:(e,t)=>{e.email=t.payload.email,e.userEmail=t.payload.userEmail,e.user=t.payload.user,e.avatarUrl=t.payload?.avatarUrl?t.payload?.avatarUrl:"https://images.unsplash.com/photo-1536300099515-6c61b290b654?q=80&w=200&auto=format&fit=crop",e.isLoading=!1},setAvatar:(e,t)=>{e.avatarUrl=t.payload},setActivePage:(e,t)=>{e.activePage=t.payload}}});const{setUser:Jl,setSelectedOption:Xl,setInitialQuizOptions:Zl,setAvatar:eu,setActivePage:tu,setSelectedOptions:nu,addCorrectQuiz:ru,loadCorrectquizes:iu}=Gl.actions;function su(e,t){return"string"==typeof t&&t.includes("<br>")?e+" "+t.split("<br>")[0]:e+" "+!!t?t:""}function ou(e){e.preventDefault(),(e=>{try{const t=JSON.stringify(e);localStorage.setItem("econolabs",t)}catch(e){console.log(e)}})({application:{email:document.getElementById("emailInput")?.value,user:document.getElementById("userInput")?.value}}),window.location.reload()}async function au(){let e=function(){try{const e=localStorage.getItem("econolabs");if(null===e)return;return JSON.parse(e)}catch(e){return}}();return e&&e?.application&&/(.+)@(.+){2,}\.(.+){2,}/.test(e.application?.email)?{...e.application,userEmail:e?.application?e.application?.email.replace(/[^a-zA-Z0-9]/g,"_"):null}:null}function cu({quizString:e="this {={var1-10}+1} some {=2+{var1-10}} that can be {=3+{var1-10}} with a {=4+{var1-10}} function",answer:t,randomNumber:n}){if(e.includes("{var1-10}")){function r([e,t]){const n=new RegExp(`${e}(.*?)${t}`,"gm"),r=n=>n.slice(e.length,-1*t.length);return function(e){return e.match(n).map(r)}}let i=new formulaParser.Parser;const s=/{var1-10}/g,o=n.toString();e=e.replace(s,o),t=t.replace(s,o),t=Math.round(1e4*i.parse(t).result)/1e4;let a=r(["{=","}"])(e);for(let c=0;c<a.length;c++){let l=Math.round(1e4*i.parse(a[c]).result)/1e4;e=e.replace("{="+a[c]+"}",l)}return{quizString:e,answer:t}}return{quizString:e,answer:t}}const lu=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"];function uu(e){let t='<div class=\'row g-2\'>\n       <div class="col-1">\n           <input type="text" class="form-control form-control-sm m-1" placeholder="" aria-label="letter" disabled>\n       </div>   \n    '+e[0].map(((e,t)=>`\n           <div class="col">\n               <input type="text" class="form-control form-control-sm m-1" placeholder="${lu[t]}" aria-label="letter" disabled>\n           </div>        \n     `)).join("")+"</div>";return t+=e.map(((e,t)=>`\n       <div class="row g-2">\n           <div class="col-1">\n               <input type="text" class="form-control form-control-sm m-1" placeholder="${0+t+1}" aria-label="number" disabled>\n           </div>\n           <div class="col">\n               <input type="text" class="form-control form-control-sm m-1" placeholder="${e[0]}" aria-label="month">\n           </div>\n           <div class="col">\n               <input type="text" class="form-control form-control-sm m-1" placeholder="${e[1]}" aria-label="X1">            \n           </div>\n           <div class="col">\n               <input type="text" class="form-control form-control-sm m-1" placeholder="${e[2]}" aria-label="X2">            \n           </div>\n            <div class="col">\n               <input type="text" class="form-control form-control-sm m-1" placeholder="${e[3]}" aria-label="Y">            \n           </div>\n       </div>`)).join(""),t+=`<div class="row g-3 align-items-center">\n   <div class="col-auto">\n     <label for="formulacell" class="col-form-label">A${e.length+1}</label>\n   </div>\n   <div class="col-auto">\n     <input name="formulacell" type="text id="formulacell" class="form-control" aria-describedby="formulacell">\n   </div>\n    <div class="col-auto">\n       <span class="form-text" id="formularesult">...</span>\n     </div>\n   </div>`,t}const hu=document.querySelector.bind(document),du=document.querySelectorAll.bind(document),pu=new formulaParser.Parser,fu=function(){const e=Dc({reducer:{application:Gl.reducer,[Yl.reducerPath]:Yl.reducer},middleware:e=>e().concat(Yl.middleware)});return ml(e.dispatch),e}();let mu,_u,gu;function yu(e){let t=_u.data[e];if(hu("#quizformdataarray").style.display="none",hu("#usercalculations").style.display="none",hu("#inputFormula").value="",hu("#resformula").innerHTML="<small class='text-muted'>,  =2+2  =AVERAGE(B2:B13)</small>",hu("#answerButton").disabled=!1,hu("#quizTitle").innerHTML=t.title,hu("#quizHeader").innerText=t.header+" "+(e+1),hu("#userComment").style.display="block",hu("#answerButton").className="btn btn-outline-primary m-3",hu("#answerButton").style.display="block","casewithrandomnumber"===t?.type&&Array.isArray(t?.dataArray)&&(hu("#usercalculations").style.display="block",hu("#quizformdataarray").innerHTML=uu(t?.dataArray)+"<br>"+t?.text+"<hr>",hu("#quizformdataarray").style.display="block",hu("#quizHint").innerHTML=t?.hint),"multiplechoices"===t.type&&(hu("#quizString").innerHTML=t.text,t.answers.length>1?Su.addEvents(t.choices):Eu.addEvents(t.choices)),"accounting"===t.type){hu("#quizString").innerHTML=t.text;let e=`\n           <div class="row m-1 g-1">\n                <div class="col-12 col-md-6">\n                    <select class="form-select form-select-sm" aria-label="debet" id="debet" name="debet"">\n                    ${'<option value="..."></option>'+t.choices.map((e=>`<option value="${e}">${e}</option>`)).join("")}                       \n                    </select>\n                </div>\n                <div class="col-12 col-md-6">\n                    <select class="form-select form-select-sm" aria-label="credit" id="credit" name="credit">\n                       ${'<option value="..."></option>'+t.choices.map((e=>`<option value="${e}">${e}</option>`)).join("")}\n                    </select>\n                </div>\n           </div>\n           `;hu("#accountingblock").innerHTML=e,hu("#accountingblock").style.display="block"}if("quizwithrandomnumber"===t.type){hu("#usercalculations").style.display="block";let e=cu({quizString:t.text,answer:t.answer,randomNumber:fu.getState().application.selectedoption});hu("#quizString").innerHTML=e.quizString,hu("#quizChecks").innerHTML='\n            <div class="input-group input-group-sm mb-3">\n                <span class="input-group-text" id="inputGroup-sizing-sm"></span>\n                <input type="text" class="form-control" aria-label="quizinput" aria-describedby="quiz-input-sm" id="feedback">\n            </div>'}vu()}function vu(){let e=fu.getState().application.correctquizes;hu("#quizbuttonslist").innerHTML=_u.data.map(((t,n)=>`<button\n        class='${function(e,t){let n=!1;return t.forEach((t=>{"string"==typeof t&&t.includes(e)&&(n=!0)})),n}(su(t.title,t.text),e)?"btn btn-sm btn-success page m-1":"btn btn-sm btn-outline-secondary page m-1"}'\n        page=${n}\n       >\n        ${n+1}\n        </button>`)).join("")+'<a href="/myworkbook" title=" " class="btn btn-sm btn btn-outline-primary m-1" target="_blank"></a>',[...du(".page")].forEach((function(e){e.addEventListener("click",(function(e){const t=parseInt(e.target.getAttribute("page"));fu.dispatch(Zl()),fu.dispatch(tu(t)),hu("#userComment").value=" ",hu("#quizChecks").innerHTML="",hu("#accountingblock").style.display="none",hu("#quizHint").innerHTML="",hu("#quizTitle").innerHTML="",hu("#quizString").innerHTML="",_u.data[t]?.quizesCasesId?async function(e){let t=_u.data[e];gu=await fu.dispatch(Yl.endpoints.fetchOpenQuizCaseById.initiate(t.quizesCasesId));let n=t?.hint?t.hint:"";gu.data?.hint&&(n=gu.data.hint+"<br>"+n),gu.data?.exampleSpreadsheet&&(n=gu.data.exampleSpreadsheet+"<br>"+n),hu("#quizHint").innerHTML=n,yu(e)}(t):yu(t)}),!1)}))}let bu=T((function(e,t){pu.on("callRangeValue",(function(t,n,r){for(var i=[],s=t.row.index;s<=n.row.index;s++){for(var o=e[s],a=[],c=t.column.index;c<=n.column.index;c++)a.push(o[c]);i.push(a)}i&&r(i)}));let n=pu.parse(t.slice(1));n.error||(hu("#resformula").innerText=n.result)}),275),wu=T((function(e){pu.on("callCellValue",(function(e,t){e&&t()}));let t=pu.parse(e.slice(1));t.error||(hu("#resformula").innerText=t.result)}),275),Cu=T((function(e){hu("#resformula").innerText=cu({quizString:"this {={var1-10}+1} some {=2+{var1-10}} that can be {=3+{var1-10}} with a {=4+{var1-10}} function",answer:e.substring(1),randomNumber:.5}).answer}),275);hu("#loginbutton").addEventListener("click",(e=>ou(e)),!1),hu("#quizform").addEventListener("submit",(function(e){e.preventDefault();let t,n,r,{selectedoption:i,selectedoptions:s,activePage:o}=fu.getState().application,{text:a,answer:c,hint:l="",dataArray:u=[],type:h,answers:d=[]}=_u.data[o],p=!1,f="";hu("#userComment").style.display="none";try{let e=hu("#userComment").value;f=" "!==e?e:""}catch{f=""}const m=new FormData(hu("#quizform"));let _={};for(const[e,t]of m)_[e]=t;if("accounting"===h&&hu("#debet").value+hu("#credit").value===d[0]&&(p=!0,t=" "+hu("#debet").value+"  "+hu("#credit").value,n=a+"<br>"+l+"<br>"+f,r="multiplechoices"),"multiplechoices"===h&&1===d.length&&i===d[0]&&(p=!0,t=i,n=a+"<br>"+l+"<br>"+f,r="multiplechoices"),"multiplechoices"===h&&d.length>1&&(s.length===d.length&&(p=!0,s.map((e=>{d.includes(e)||(p=!1)}))),t=s.map((e=>e)).join("   "),n=a+"<br>"+l+"<br>"+f,r="multiplechoices"),"quizwithrandomnumber"===h){let e=cu({quizString:a,answer:c,randomNumber:fu.getState().application.selectedoption});t=e.answer,n=e.quizString+"<br>"+l+"<br>"+f,r="multiplechoices";let i=hu("#feedback").value;parseFloat(i)/parseFloat(t)<1.02&&parseFloat(i)/parseFloat(t)>.98&&(p=!0,hu("#inputFormula").value.length>2&&(l=l+"<br>"+hu("#inputFormula").value))}if("casewithrandomnumber"===h){pu.on("callRangeValue",(function(e,t,n){for(var r=[],i=e.row.index;i<=t.row.index;i++){for(var s=u[i],o=[],a=e.column.index;a<=t.column.index;a++)o.push(s[a]);r.push(o)}r&&n(r)}));let e=pu.parse(_[Object.keys(_)[0]].slice(1)),i=pu.parse(c);e?.error||i?.error||parseFloat(i.result)/parseFloat(e.result)<1.02&&parseFloat(i.result)/parseFloat(e.result)>.98&&(p=!0,hu("#formularesult").innerHTML=e.result,t="="+c,n=a+"<br>"+uu(u)+"<br>"+l+"<br>"+f,r="multiplechoices")}p?function(e,t,n,r){let{userEmail:i,user:s,avatarUrl:o,email:a,activePage:c}=fu.getState().application,{title:l,theme:u,text:h,hint:d="",dataArray:p=[]}=_u.data[c],f=getFirebaseNodeKey("usersCraft/"+i+"/posts"),m=new Intl.DateTimeFormat("en",{weekday:"short",year:"numeric",month:"short",day:"numeric"}).format(new Date).replace(/[^a-zA-Z0-9]/g,"_"),_={id:f,title:l,theme:u,comment:l+" ("+u+")",type:t,answer:e,content:n,quizString:r,deleted:!1,email:a,user:s,avatarUrl:o,date:new Intl.DateTimeFormat("ru",{weekday:"short",year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric"}).format(new Date)},g={id:f,title:l,theme:u,email:a,user:s,avatarUrl:o,timestamp:+Date.now()},y={};y["usersCraft/"+i+"/posts/"+f]=_,y["currentDay/"+m+"/posts/"+f]=g,fu.dispatch(Yl.endpoints.updatesForOpenQuizes.initiate({base:"",updates:y})).then((()=>{fu.dispatch(ru(su(l,h))),hu("#answerButton").classList.toggle("btn-outline-primary"),hu("#answerButton").classList.toggle("btn-success"),hu("#quizHint").innerHTML=d,hu("#answerButton").disabled=!0}))}(t,r,n,n):(hu("#answerButton").classList.toggle("btn-danger"),hu("#answerButton").classList.toggle("btn-outline-primary"),hu("#quizHint").innerHTML=l,hu("#answerButton").disabled=!0)}));const Eu=new class{constructor(t,n){this.ul=e(`#${t}`),this.selector=t,this.callBack=n}addEvents(e){let t=[...e].sort((()=>Math.random()-.5));let n=t.map(((e,t)=>`<div class="form-check">\n        <input class="form-check-input ${this.selector}" type="radio" name="quizRadio" id="${t}">\n        <label class="form-check-label" for='${t}'>${e}</label>\n    </div>`)).join("");this.ul.innerHTML=n;let r=document.getElementsByClassName(this.selector);for(var i=0;i<r.length;i++)r[i].addEventListener("click",(e=>{this.callBack(t[e.target.id])}))}}("quizChecks",(function(e){fu.dispatch(Xl(e))})),Su=new class{constructor(e,n){this.ul=t(`#${e}`),this.selector=e,this.callBack=n}addEvents(e){let t=[...e].sort((()=>Math.random()-.5));let n=t.map(((e,t)=>`\n        <div class="form-check">\n          <input class="form-check-input ${this.selector}" type="checkbox" value="" id="${t}">\n          <label class="form-check-label" for='${t}'>\n          ${e}\n          </label>\n        </div>`)).join("");this.ul.innerHTML=n;let r=document.getElementsByClassName(this.selector);for(var i=0;i<r.length;i++)r[i].addEventListener("click",(e=>{this.callBack(t[e.target.id])}))}}("quizChecks",(function(e){let t=fu.getState().application.selectedoptions.map((e=>e));const n=t.indexOf(e);n>-1?(t.splice(n,1),fu.dispatch(nu(t))):fu.dispatch(nu([...t,e]))}));hu("#inputFormula").addEventListener("input",(e=>function(e){e.preventDefault();let t=hu("#inputFormula").value,n=fu.getState().application.activePage,{dataArray:r=[],type:i}=_u.data[n];i.includes("case")?t.includes(":")?bu(r,t):wu(t):Cu(t)}(e)),!1),async function(){let e=await au();e?(mu=await fu.dispatch(Yl.endpoints.fetchUserPosts.initiate(e.userEmail)),_u=await fu.dispatch(Yl.endpoints.fetchQuizesArray.initiate()),fu.dispatch(iu([...new Set(mu.data.map((e=>su(e.title,e?.quizString))))])),fu.dispatch(Jl(e))):hu("#formcontainer").style.display="block"}().then((()=>{hu("#quizcontainer").style.display="block",vu()}))}();
