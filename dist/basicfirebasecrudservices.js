var basicfirebasecrudservices=function(e){"use strict";!function(){const e={NODE_ENV:"production"};try{if(process)return process.env=Object.assign({},process.env),void Object.assign(process.env,e)}catch(e){}globalThis.process={env:e}}();const t=!1,n="${JSCORE_VERSION}",i=function(e,t){if(!e)throw r(t)},r=function(e){return new Error("Firebase Database ("+n+") INTERNAL ASSERT FAILED: "+e)},s=function(e){const t=[];let n=0;for(let i=0;i<e.length;i++){let r=e.charCodeAt(i);r<128?t[n++]=r:r<2048?(t[n++]=r>>6|192,t[n++]=63&r|128):55296==(64512&r)&&i+1<e.length&&56320==(64512&e.charCodeAt(i+1))?(r=65536+((1023&r)<<10)+(1023&e.charCodeAt(++i)),t[n++]=r>>18|240,t[n++]=r>>12&63|128,t[n++]=r>>6&63|128,t[n++]=63&r|128):(t[n++]=r>>12|224,t[n++]=r>>6&63|128,t[n++]=63&r|128)}return t},o={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let t=0;t<e.length;t+=3){const r=e[t],s=t+1<e.length,o=s?e[t+1]:0,a=t+2<e.length,c=a?e[t+2]:0,l=r>>2,h=(3&r)<<4|o>>4;let u=(15&o)<<2|c>>6,d=63&c;a||(d=64,s||(u=64)),i.push(n[l],n[h],n[u],n[d])}return i.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(s(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,i=0;for(;n<e.length;){const r=e[n++];if(r<128)t[i++]=String.fromCharCode(r);else if(r>191&&r<224){const s=e[n++];t[i++]=String.fromCharCode((31&r)<<6|63&s)}else if(r>239&&r<365){const s=((7&r)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[i++]=String.fromCharCode(55296+(s>>10)),t[i++]=String.fromCharCode(56320+(1023&s))}else{const s=e[n++],o=e[n++];t[i++]=String.fromCharCode((15&r)<<12|(63&s)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let t=0;t<e.length;){const r=n[e.charAt(t++)],s=t<e.length?n[e.charAt(t)]:0;++t;const o=t<e.length?n[e.charAt(t)]:64;++t;const c=t<e.length?n[e.charAt(t)]:64;if(++t,null==r||null==s||null==o||null==c)throw new a;const l=r<<2|s>>4;if(i.push(l),64!==o){const e=s<<4&240|o>>2;if(i.push(e),64!==c){const e=o<<6&192|c;i.push(e)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class a extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const c=function(e){const t=s(e);return o.encodeByteArray(t,!0)},l=function(e){return c(e).replace(/\./g,"")},h=function(e){try{return o.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function u(e){return d(void 0,e)}function d(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(const n in t)t.hasOwnProperty(n)&&"__proto__"!==n&&(e[n]=d(e[n],t[n]));return e}const p=()=>function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__,_=()=>{try{return p()||(()=>{if("undefined"==typeof process||void 0===process.env)return;const e=process.env.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}const t=e&&h(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},f=e=>{const t=(e=>{var t,n;return null===(n=null===(t=_())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]})(e);if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const i=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),i]:[t.substring(0,n),i]},g=()=>{var e;return null===(e=_())||void 0===e?void 0:e.config};class m{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,n))}}}function y(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test("undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:"")}function v(){return!0===t}class w extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,w.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,b.prototype.create)}}class b{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},i=`${this.service}/${e}`,r=this.errors[e],s=r?function(e,t){return e.replace(C,((e,n)=>{const i=t[n];return null!=i?String(i):`<${n}?>`}))}(r,n):"Error",o=`${this.serviceName}: ${s} (${i}).`;return new w(i,o,n)}}const C=/\{\$([^}]+)}/g;function E(e){return JSON.parse(e)}function I(e){return JSON.stringify(e)}const T=function(e){let t={},n={},i={},r="";try{const s=e.split(".");t=E(h(s[0])||""),n=E(h(s[1])||""),r=s[2],i=n.d||{},delete n.d}catch(e){}return{header:t,claims:n,data:i,signature:r}};function S(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function N(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0}function k(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function P(e,t,n){const i={};for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&(i[r]=t.call(n,e[r],r,e));return i}function R(e,t){if(e===t)return!0;const n=Object.keys(e),i=Object.keys(t);for(const r of n){if(!i.includes(r))return!1;const n=e[r],s=t[r];if(D(n)&&D(s)){if(!R(n,s))return!1}else if(n!==s)return!1}for(const e of i)if(!n.includes(e))return!1;return!0}function D(e){return null!==e&&"object"==typeof e}class x{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const n=this.W_;if("string"==typeof e)for(let i=0;i<16;i++)n[i]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let i=0;i<16;i++)n[i]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let e=16;e<80;e++){const t=n[e-3]^n[e-8]^n[e-14]^n[e-16];n[e]=4294967295&(t<<1|t>>>31)}let i,r,s=this.chain_[0],o=this.chain_[1],a=this.chain_[2],c=this.chain_[3],l=this.chain_[4];for(let e=0;e<80;e++){e<40?e<20?(i=c^o&(a^c),r=1518500249):(i=o^a^c,r=1859775393):e<60?(i=o&a|c&(o|a),r=2400959708):(i=o^a^c,r=3395469782);const t=(s<<5|s>>>27)+i+l+r+n[e]&4294967295;l=c,c=a,a=4294967295&(o<<30|o>>>2),o=s,s=t}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+o&4294967295,this.chain_[2]=this.chain_[2]+a&4294967295,this.chain_[3]=this.chain_[3]+c&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295}update(e,t){if(null==e)return;void 0===t&&(t=e.length);const n=t-this.blockSize;let i=0;const r=this.buf_;let s=this.inbuf_;for(;i<t;){if(0===s)for(;i<=n;)this.compress_(e,i),i+=this.blockSize;if("string"==typeof e){for(;i<t;)if(r[s]=e.charCodeAt(i),++s,++i,s===this.blockSize){this.compress_(r),s=0;break}}else for(;i<t;)if(r[s]=e[i],++s,++i,s===this.blockSize){this.compress_(r),s=0;break}}this.inbuf_=s,this.total_+=t}digest(){const e=[];let t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let e=this.blockSize-1;e>=56;e--)this.buf_[e]=255&t,t/=256;this.compress_(this.buf_);let n=0;for(let t=0;t<5;t++)for(let i=24;i>=0;i-=8)e[n]=this.chain_[t]>>i&255,++n;return e}}function O(e,t){return`${e} failed: ${t} argument `}const A=function(e){let t=0;for(let n=0;n<e.length;n++){const i=e.charCodeAt(n);i<128?t++:i<2048?t+=2:i>=55296&&i<=56319?(t+=4,n++):t+=3}return t};function M(e){return e&&e._delegate?e._delegate:e}class F{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const L="[DEFAULT]";class q{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new m;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),i=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(i)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(i)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:L})}catch(e){}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=L){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}isComponentSet(){return null!=this.component}isInitialized(e=L){return this.instances.has(e)}getOptions(e=L){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[e,t]of this.instancesDeferred.entries()){n===this.normalizeInstanceIdentifier(e)&&t.resolve(i)}return i}onInit(e,t){var n;const i=this.normalizeInstanceIdentifier(t),r=null!==(n=this.onInitCallbacks.get(i))&&void 0!==n?n:new Set;r.add(e),this.onInitCallbacks.set(i,r);const s=this.instances.get(i);return s&&e(s,i),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const i of n)try{i(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(i=e,i===L?void 0:i),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}var i;return n||null}normalizeInstanceIdentifier(e=L){return this.component?this.component.multipleInstances?e:L:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class j{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new q(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}var U;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(U||(U={}));const W={debug:U.DEBUG,verbose:U.VERBOSE,info:U.INFO,warn:U.WARN,error:U.ERROR,silent:U.SILENT},B=U.INFO,z={[U.DEBUG]:"log",[U.VERBOSE]:"log",[U.INFO]:"info",[U.WARN]:"warn",[U.ERROR]:"error"},H=(e,t,...n)=>{if(t<e.logLevel)return;const i=(new Date).toISOString(),r=z[t];if(!r)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[r](`[${i}]  ${e.name}:`,...n)};class V{constructor(e){this.name=e,this._logLevel=B,this._logHandler=H,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in U))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?W[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,U.DEBUG,...e),this._logHandler(this,U.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,U.VERBOSE,...e),this._logHandler(this,U.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,U.INFO,...e),this._logHandler(this,U.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,U.WARN,...e),this._logHandler(this,U.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,U.ERROR,...e),this._logHandler(this,U.ERROR,...e)}}let $,Y;const K=new WeakMap,G=new WeakMap,Q=new WeakMap,J=new WeakMap,X=new WeakMap;let Z={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return G.get(e);if("objectStoreNames"===t)return e.objectStoreNames||Q.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return ne(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function ee(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(Y||(Y=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(ie(this),t),ne(K.get(this))}:function(...t){return ne(e.apply(ie(this),t))}:function(t,...n){const i=e.call(ie(this),t,...n);return Q.set(i,t.sort?t.sort():[t]),ne(i)}}function te(e){return"function"==typeof e?ee(e):(e instanceof IDBTransaction&&function(e){if(G.has(e))return;const t=new Promise(((t,n)=>{const i=()=>{e.removeEventListener("complete",r),e.removeEventListener("error",s),e.removeEventListener("abort",s)},r=()=>{t(),i()},s=()=>{n(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",r),e.addEventListener("error",s),e.addEventListener("abort",s)}));G.set(e,t)}(e),((e,t)=>t.some((t=>e instanceof t)))(e,$||($=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,Z):e)}function ne(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const i=()=>{e.removeEventListener("success",r),e.removeEventListener("error",s)},r=()=>{t(ne(e.result)),i()},s=()=>{n(e.error),i()};e.addEventListener("success",r),e.addEventListener("error",s)}));return t.then((t=>{t instanceof IDBCursor&&K.set(t,e)})).catch((()=>{})),X.set(t,e),t}(e);if(J.has(e))return J.get(e);const t=te(e);return t!==e&&(J.set(e,t),X.set(t,e)),t}const ie=e=>X.get(e);const re=["get","getKey","getAll","getAllKeys","count"],se=["put","add","delete","clear"],oe=new Map;function ae(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(oe.get(t))return oe.get(t);const n=t.replace(/FromIndex$/,""),i=t!==n,r=se.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!r&&!re.includes(n))return;const s=async function(e,...t){const s=this.transaction(e,r?"readwrite":"readonly");let o=s.store;return i&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),r&&s.done]))[0]};return oe.set(t,s),s}Z=(e=>({...e,get:(t,n,i)=>ae(t,n)||e.get(t,n,i),has:(t,n)=>!!ae(t,n)||e.has(t,n)}))(Z);class ce{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null})).filter((e=>e)).join(" ")}}const le="@firebase/app",he="0.10.15",ue=new V("@firebase/app"),de="@firebase/app-compat",pe="@firebase/analytics-compat",_e="@firebase/analytics",fe="@firebase/app-check-compat",ge="@firebase/app-check",me="@firebase/auth",ye="@firebase/auth-compat",ve="@firebase/database",we="@firebase/data-connect",be="@firebase/database-compat",Ce="@firebase/functions",Ee="@firebase/functions-compat",Ie="@firebase/installations",Te="@firebase/installations-compat",Se="@firebase/messaging",Ne="@firebase/messaging-compat",ke="@firebase/performance",Pe="@firebase/performance-compat",Re="@firebase/remote-config",De="@firebase/remote-config-compat",xe="@firebase/storage",Oe="@firebase/storage-compat",Ae="@firebase/firestore",Me="@firebase/vertexai",Fe="@firebase/firestore-compat",Le="firebase",qe="[DEFAULT]",je={[le]:"fire-core",[de]:"fire-core-compat",[_e]:"fire-analytics",[pe]:"fire-analytics-compat",[ge]:"fire-app-check",[fe]:"fire-app-check-compat",[me]:"fire-auth",[ye]:"fire-auth-compat",[ve]:"fire-rtdb",[we]:"fire-data-connect",[be]:"fire-rtdb-compat",[Ce]:"fire-fn",[Ee]:"fire-fn-compat",[Ie]:"fire-iid",[Te]:"fire-iid-compat",[Se]:"fire-fcm",[Ne]:"fire-fcm-compat",[ke]:"fire-perf",[Pe]:"fire-perf-compat",[Re]:"fire-rc",[De]:"fire-rc-compat",[xe]:"fire-gcs",[Oe]:"fire-gcs-compat",[Ae]:"fire-fst",[Fe]:"fire-fst-compat",[Me]:"fire-vertex","fire-js":"fire-js",[Le]:"fire-js-all"},Ue=new Map,We=new Map,Be=new Map;function ze(e,t){try{e.container.addComponent(t)}catch(n){ue.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function He(e){const t=e.name;if(Be.has(t))return ue.debug(`There were multiple attempts to register component ${t}.`),!1;Be.set(t,e);for(const t of Ue.values())ze(t,e);for(const t of We.values())ze(t,e);return!0}const Ve=new b("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class $e{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new F("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Ve.create("app-deleted",{appName:this._name})}}function Ye(e,t={}){let n=e;if("object"!=typeof t){t={name:t}}const i=Object.assign({name:qe,automaticDataCollectionEnabled:!1},t),r=i.name;if("string"!=typeof r||!r)throw Ve.create("bad-app-name",{appName:String(r)});if(n||(n=g()),!n)throw Ve.create("no-options");const s=Ue.get(r);if(s){if(R(n,s.options)&&R(i,s.config))return s;throw Ve.create("duplicate-app",{appName:r})}const o=new j(r);for(const e of Be.values())o.addComponent(e);const a=new $e(n,i,o);return Ue.set(r,a),a}function Ke(){return Array.from(Ue.values())}function Ge(e,t,n){var i;let r=null!==(i=je[e])&&void 0!==i?i:e;n&&(r+=`-${n}`);const s=r.match(/\s|\//),o=t.match(/\s|\//);if(s||o){const e=[`Unable to register library "${r}" with version "${t}":`];return s&&e.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&o&&e.push("and"),o&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void ue.warn(e.join(" "))}He(new F(`${r}-version`,(()=>({library:r,version:t})),"VERSION"))}const Qe="firebase-heartbeat-store";let Je=null;function Xe(){return Je||(Je=function(e,t,{blocked:n,upgrade:i,blocking:r,terminated:s}={}){const o=indexedDB.open(e,t),a=ne(o);return i&&o.addEventListener("upgradeneeded",(e=>{i(ne(o.result),e.oldVersion,e.newVersion,ne(o.transaction),e)})),n&&o.addEventListener("blocked",(e=>n(e.oldVersion,e.newVersion,e))),a.then((e=>{s&&e.addEventListener("close",(()=>s())),r&&e.addEventListener("versionchange",(e=>r(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),a}("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(Qe)}catch(e){console.warn(e)}}}).catch((e=>{throw Ve.create("idb-open",{originalErrorMessage:e.message})}))),Je}async function Ze(e,t){try{const n=(await Xe()).transaction(Qe,"readwrite"),i=n.objectStore(Qe);await i.put(t,et(e)),await n.done}catch(e){if(e instanceof w)ue.warn(e.message);else{const t=Ve.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});ue.warn(t.message)}}}function et(e){return`${e.name}!${e.options.appId}`}class tt{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new it(t),this._heartbeatsCachePromise=this._storage.read().then((e=>(this._heartbeatsCache=e,e)))}async triggerHeartbeat(){var e,t;try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=nt();if(null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)&&(this._heartbeatsCache=await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)))return;if(this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some((e=>e.date===i)))return;return this._heartbeatsCache.heartbeats.push({date:i,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((e=>{const t=new Date(e.date).valueOf();return Date.now()-t<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}catch(e){ue.warn(e)}}async getHeartbeatsHeader(){var e;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=nt(),{heartbeatsToSend:n,unsentEntries:i}=function(e,t=1024){const n=[];let i=e.slice();for(const r of e){const e=n.find((e=>e.agent===r.agent));if(e){if(e.dates.push(r.date),rt(n)>t){e.dates.pop();break}}else if(n.push({agent:r.agent,dates:[r.date]}),rt(n)>t){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}(this._heartbeatsCache.heartbeats),r=l(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}catch(e){return ue.warn(e),""}}}function nt(){return(new Date).toISOString().substring(0,10)}class it{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!function(){try{return"object"==typeof indexedDB}catch(e){return!1}}()&&new Promise(((e,t)=>{try{let n=!0;const i="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(i);r.onsuccess=()=>{r.result.close(),n||self.indexedDB.deleteDatabase(i),e(!0)},r.onupgradeneeded=()=>{n=!1},r.onerror=()=>{var e;t((null===(e=r.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}})).then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await Xe()).transaction(Qe),n=await t.objectStore(Qe).get(et(e));return await t.done,n}catch(e){if(e instanceof w)ue.warn(e.message);else{const t=Ve.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});ue.warn(t.message)}}}(this.app);return(null==e?void 0:e.heartbeats)?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Ze(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return Ze(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function rt(e){return l(JSON.stringify({version:2,heartbeats:e})).length}var st;st="",He(new F("platform-logger",(e=>new ce(e)),"PRIVATE")),He(new F("heartbeat",(e=>new tt(e)),"PRIVATE")),Ge(le,he,st),Ge(le,he,"esm2017"),Ge("fire-js","");Ge("firebase","11.0.1","app");const ot="@firebase/database",at="1.0.9";let ct="";class lt{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),I(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:E(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class ht{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return S(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const ut=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){const t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new lt(t)}}catch(e){}return new ht},dt=ut("localStorage"),pt=ut("sessionStorage"),_t=new V("@firebase/database"),ft=function(){let e=1;return function(){return e++}}(),gt=function(e){const t=function(e){const t=[];let n=0;for(let r=0;r<e.length;r++){let s=e.charCodeAt(r);if(s>=55296&&s<=56319){const t=s-55296;r++,i(r<e.length,"Surrogate pair missing trail surrogate."),s=65536+(t<<10)+(e.charCodeAt(r)-56320)}s<128?t[n++]=s:s<2048?(t[n++]=s>>6|192,t[n++]=63&s|128):s<65536?(t[n++]=s>>12|224,t[n++]=s>>6&63|128,t[n++]=63&s|128):(t[n++]=s>>18|240,t[n++]=s>>12&63|128,t[n++]=s>>6&63|128,t[n++]=63&s|128)}return t}(e),n=new x;n.update(t);const r=n.digest();return o.encodeByteArray(r)},mt=function(...e){let t="";for(let n=0;n<e.length;n++){const i=e[n];Array.isArray(i)||i&&"object"==typeof i&&"number"==typeof i.length?t+=mt.apply(null,i):t+="object"==typeof i?I(i):i,t+=" "}return t};let yt=null,vt=!0;const wt=function(...e){var t;if(!0===vt&&(vt=!1,null===yt&&!0===pt.get("logging_enabled")&&(i(!t,"Can't turn on custom loggers persistently."),_t.logLevel=U.VERBOSE,yt=_t.log.bind(_t))),yt){const t=mt.apply(null,e);yt(t)}},bt=function(e){return function(...t){wt(e,...t)}},Ct=function(...e){const t="FIREBASE INTERNAL ERROR: "+mt(...e);_t.error(t)},Et=function(...e){const t=`FIREBASE FATAL ERROR: ${mt(...e)}`;throw _t.error(t),new Error(t)},It=function(...e){const t="FIREBASE WARNING: "+mt(...e);_t.warn(t)},Tt=function(e){return"number"==typeof e&&(e!=e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},St="[MIN_NAME]",Nt="[MAX_NAME]",kt=function(e,t){if(e===t)return 0;if(e===St||t===Nt)return-1;if(t===St||e===Nt)return 1;{const n=Ft(e),i=Ft(t);return null!==n?null!==i?n-i==0?e.length-t.length:n-i:-1:null!==i?1:e<t?-1:1}},Pt=function(e,t){return e===t?0:e<t?-1:1},Rt=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+I(t))},Dt=function(e){if("object"!=typeof e||null===e)return I(e);const t=[];for(const n in e)t.push(n);t.sort();let n="{";for(let i=0;i<t.length;i++)0!==i&&(n+=","),n+=I(t[i]),n+=":",n+=Dt(e[t[i]]);return n+="}",n},xt=function(e,t){const n=e.length;if(n<=t)return[e];const i=[];for(let r=0;r<n;r+=t)r+t>n?i.push(e.substring(r,n)):i.push(e.substring(r,r+t));return i};function Ot(e,t){for(const n in e)e.hasOwnProperty(n)&&t(n,e[n])}const At=function(e){i(!Tt(e),"Invalid JSON number");const t=1023;let n,r,s,o,a;0===e?(r=0,s=0,n=1/e==-1/0?1:0):(n=e<0,(e=Math.abs(e))>=Math.pow(2,-1022)?(o=Math.min(Math.floor(Math.log(e)/Math.LN2),t),r=o+t,s=Math.round(e*Math.pow(2,52-o)-Math.pow(2,52))):(r=0,s=Math.round(e/Math.pow(2,-1074))));const c=[];for(a=52;a;a-=1)c.push(s%2?1:0),s=Math.floor(s/2);for(a=11;a;a-=1)c.push(r%2?1:0),r=Math.floor(r/2);c.push(n?1:0),c.reverse();const l=c.join("");let h="";for(a=0;a<64;a+=8){let e=parseInt(l.substr(a,8),2).toString(16);1===e.length&&(e="0"+e),h+=e}return h.toLowerCase()};const Mt=new RegExp("^-?(0*)\\d{1,10}$"),Ft=function(e){if(Mt.test(e)){const t=Number(e);if(t>=-2147483648&&t<=2147483647)return t}return null},Lt=function(e){try{e()}catch(e){setTimeout((()=>{const t=e.stack||"";throw It("Exception was thrown by user callback.",t),e}),Math.floor(0))}},qt=function(e,t){const n=setTimeout(e,t);return"number"==typeof n&&"undefined"!=typeof Deno&&Deno.unrefTimer?Deno.unrefTimer(n):"object"==typeof n&&n.unref&&n.unref(),n};class jt{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null==t||t.get().then((e=>this.appCheck=e))}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise(((t,n)=>{setTimeout((()=>{this.appCheck?this.getToken(e).then(t,n):t(null)}),0)}))}addTokenChangeListener(e){var t;null===(t=this.appCheckProvider)||void 0===t||t.get().then((t=>t.addTokenListener(e)))}notifyForInvalidToken(){It(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}class Ut{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit((e=>this.auth_=e))}getToken(e){return this.auth_?this.auth_.getToken(e).catch((e=>e&&"auth/token-not-initialized"===e.code?(wt("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e))):new Promise(((t,n)=>{setTimeout((()=>{this.auth_?this.getToken(e).then(t,n):t(null)}),0)}))}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then((t=>t.addAuthTokenListener(e)))}removeTokenChangeListener(e){this.authProvider_.get().then((t=>t.removeAuthTokenListener(e)))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',It(e)}}class Wt{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}Wt.OWNER="owner";const Bt=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,zt="ac",Ht="websocket",Vt="long_polling";class $t{constructor(e,t,n,i,r=!1,s="",o=!1,a=!1){this.secure=t,this.namespace=n,this.webSocketOnly=i,this.nodeAdmin=r,this.persistenceKey=s,this.includeNamespaceInQueryParams=o,this.isUsingEmulator=a,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=dt.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&dt.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function Yt(e,t,n){let r;if(i("string"==typeof t,"typeof type must == string"),i("object"==typeof n,"typeof params must == object"),t===Ht)r=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if(t!==Vt)throw new Error("Unknown connection type: "+t);r=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}(function(e){return e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams})(e)&&(n.ns=e.namespace);const s=[];return Ot(n,((e,t)=>{s.push(e+"="+t)})),r+s.join("&")}class Kt{constructor(){this.counters_={}}incrementCounter(e,t=1){S(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return u(this.counters_)}}const Gt={},Qt={};function Jt(e){const t=e.toString();return Gt[t]||(Gt[t]=new Kt),Gt[t]}class Xt{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const e=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let t=0;t<e.length;++t)e[t]&&Lt((()=>{this.onMessage_(e[t])}));if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}const Zt="start";class en{constructor(e,t,n,i,r,s,o){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=i,this.authToken=r,this.transportSessionId=s,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=bt(e),this.stats_=Jt(t),this.urlFn=e=>(this.appCheckToken&&(e[zt]=this.appCheckToken),Yt(t,Vt,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Xt(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout((()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null}),Math.floor(3e4)),function(e){if("complete"===document.readyState)e();else{let t=!1;const n=function(){document.body?t||(t=!0,e()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",(()=>{"complete"===document.readyState&&n()})),window.attachEvent("onload",n))}}((()=>{if(this.isClosed_)return;this.scriptTagHolder=new tn(((...e)=>{const[t,n,i,r,s]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,t===Zt)this.id=n,this.password=i;else{if("close"!==t)throw new Error("Unrecognized command received: "+t);n?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(n,(()=>{this.onClosed_()}))):this.onClosed_()}}),((...e)=>{const[t,n]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,n)}),(()=>{this.onClosed_()}),this.urlFn);const e={};e[Zt]="t",e.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=this.scriptTagHolder.uniqueCallbackIdentifier),e.v="5",this.transportSessionId&&(e.s=this.transportSessionId),this.lastSessionId&&(e.ls=this.lastSessionId),this.applicationId&&(e.p=this.applicationId),this.appCheckToken&&(e[zt]=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&Bt.test(location.hostname)&&(e.r="f");const t=this.urlFn(e);this.log_("Connecting via long-poll to "+t),this.scriptTagHolder.addTag(t,(()=>{}))}))}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){en.forceAllow_=!0}static forceDisallow(){en.forceDisallow_=!0}static isAvailable(){return!!en.forceAllow_||!(en.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI)}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=I(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=c(t),i=xt(n,1840);for(let e=0;e<i.length;e++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[e]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const n={dframe:"t"};n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=I(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class tn{constructor(e,t,n,i){this.onDisconnect=n,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=ft(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=tn.createIFrame_();let n="";if(this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)){n='<script>document.domain="'+document.domain+'";<\/script>'}const i="<html><body>"+n+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(i),this.myIFrame.doc.close()}catch(e){wt("frame writing exception"),e.stack&&wt(e.stack),wt(e)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||wt("No IE domain setting required")}catch(t){const n=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout((()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)}),Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),n="",i=0;for(;this.pendingSegs.length>0;){if(!(this.pendingSegs[0].d.length+30+n.length<=1870))break;{const e=this.pendingSegs.shift();n=n+"&seg"+i+"="+e.seg+"&ts"+i+"="+e.ts+"&d"+i+"="+e.d,i++}}return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}return!1}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},i=setTimeout(n,Math.floor(25e3));this.addTag(e,(()=>{clearTimeout(i),n()}))}addTag(e,t){setTimeout((()=>{try{if(!this.sendNewPolls)return;const n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){const e=n.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),t())},n.onerror=()=>{wt("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch(e){}}),Math.floor(1))}}let nn=null;"undefined"!=typeof MozWebSocket?nn=MozWebSocket:"undefined"!=typeof WebSocket&&(nn=WebSocket);class rn{constructor(e,t,n,i,r,s,o){this.connId=e,this.applicationId=n,this.appCheckToken=i,this.authToken=r,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=bt(this.connId),this.stats_=Jt(t),this.connURL=rn.connectionURL_(t,s,o,i,n),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,n,i,r){const s={v:"5"};return"undefined"!=typeof location&&location.hostname&&Bt.test(location.hostname)&&(s.r="f"),t&&(s.s=t),n&&(s.ls=n),i&&(s[zt]=i),r&&(s.p=r),Yt(e,Ht,s)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,dt.set("previous_websocket_failure",!0);try{let e;v(),this.mySock=new nn(this.connURL,[],e)}catch(e){this.log_("Error instantiating WebSocket.");const t=e.message||e.data;return t&&this.log_(t),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");const t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){rn.forceDisallow_=!0}static isAvailable(){let e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,n=navigator.userAgent.match(t);n&&n.length>1&&parseFloat(n[1])<4.4&&(e=!0)}return!e&&null!==nn&&!rn.forceDisallow_}static previouslyFailed(){return dt.isInMemoryStorage||!0===dt.get("previous_websocket_failure")}markConnectionHealthy(){dt.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const e=this.frames.join("");this.frames=null;const t=E(e);this.onMessage(t)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(i(null===this.frames,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(null===this.mySock)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{const e=this.extractFrameCount_(t);null!==e&&this.appendFrame_(e)}}send(e){this.resetKeepAlive();const t=I(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=xt(t,16384);n.length>1&&this.sendString_(String(n.length));for(let e=0;e<n.length;e++)this.sendString_(n[e])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval((()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()}),Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}rn.responsesRequiredToBeHealthy=2,rn.healthyTimeout=3e4;class sn{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[en,rn]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(e){const t=rn&&rn.isAvailable();let n=t&&!rn.previouslyFailed();if(e.webSocketOnly&&(t||It("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[rn];else{const e=this.transports_=[];for(const t of sn.ALL_TRANSPORTS)t&&t.isAvailable()&&e.push(t);sn.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}sn.globalTransportInitialized_=!1;class on{constructor(e,t,n,i,r,s,o,a,c,l){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=i,this.authToken_=r,this.onMessage_=s,this.onReady_=o,this.onDisconnect_=a,this.onKill_=c,this.lastSessionId=l,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=bt("c:"+this.id+":"),this.transportManager_=new sn(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout((()=>{this.conn_&&this.conn_.open(t,n)}),Math.floor(0));const i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=qt((()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))}),Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){const t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=Rt("t",e),n=Rt("d",e);if("c"===t)this.onSecondaryControl_(n);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(n)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=Rt("t",e),n=Rt("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=Rt("t",e);if("d"in e){const n=e.d;if("h"===t){const e=Object.assign({},n);this.repoInfo_.isUsingEmulator&&(e.h=this.repoInfo_.host),this.onHandshake_(e)}else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?Ct("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Ct("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,n=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==n&&It("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),qt((()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())}),Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):qt((()=>{this.sendPingOnPrimaryIfNecessary_()}),Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(dt.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class an{put(e,t,n,i){}merge(e,t,n,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}class cn{constructor(e){this.allowedEvents_=e,this.listeners_={},i(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const n=[...this.listeners_[e]];for(let e=0;e<n.length;e++)n[e].callback.apply(n[e].context,t)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});const i=this.getInitialEvent(e);i&&t.apply(n,i)}off(e,t,n){this.validateEventType_(e);const i=this.listeners_[e]||[];for(let e=0;e<i.length;e++)if(i[e].callback===t&&(!n||n===i[e].context))return void i.splice(e,1)}validateEventType_(e){i(this.allowedEvents_.find((t=>t===e)),"Unknown event: "+e)}}class ln extends cn{constructor(){super(["online"]),this.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||y()||(window.addEventListener("online",(()=>{this.online_||(this.online_=!0,this.trigger("online",!0))}),!1),window.addEventListener("offline",(()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))}),!1))}static getInstance(){return new ln}getInitialEvent(e){return i("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}class hn{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let e=0;e<this.pieces_.length;e++)this.pieces_[e].length>0&&(this.pieces_[t]=this.pieces_[e],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function un(){return new hn("")}function dn(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function pn(e){return e.pieces_.length-e.pieceNum_}function _n(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new hn(e.pieces_,t)}function fn(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function gn(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function mn(e){if(e.pieceNum_>=e.pieces_.length)return null;const t=[];for(let n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new hn(t,0)}function yn(e,t){const n=[];for(let t=e.pieceNum_;t<e.pieces_.length;t++)n.push(e.pieces_[t]);if(t instanceof hn)for(let e=t.pieceNum_;e<t.pieces_.length;e++)n.push(t.pieces_[e]);else{const e=t.split("/");for(let t=0;t<e.length;t++)e[t].length>0&&n.push(e[t])}return new hn(n,0)}function vn(e){return e.pieceNum_>=e.pieces_.length}function wn(e,t){const n=dn(e),i=dn(t);if(null===n)return t;if(n===i)return wn(_n(e),_n(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function bn(e,t){const n=gn(e,0),i=gn(t,0);for(let e=0;e<n.length&&e<i.length;e++){const t=kt(n[e],i[e]);if(0!==t)return t}return n.length===i.length?0:n.length<i.length?-1:1}function Cn(e,t){if(pn(e)!==pn(t))return!1;for(let n=e.pieceNum_,i=t.pieceNum_;n<=e.pieces_.length;n++,i++)if(e.pieces_[n]!==t.pieces_[i])return!1;return!0}function En(e,t){let n=e.pieceNum_,i=t.pieceNum_;if(pn(e)>pn(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[i])return!1;++n,++i}return!0}class In{constructor(e,t){this.errorPrefix_=t,this.parts_=gn(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let e=0;e<this.parts_.length;e++)this.byteLength_+=A(this.parts_[e]);Tn(this)}}function Tn(e){if(e.byteLength_>768)throw new Error(e.errorPrefix_+"has a key path longer than 768 bytes ("+e.byteLength_+").");if(e.parts_.length>32)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+Sn(e))}function Sn(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class Nn extends cn{constructor(){let e,t;super(["visible"]),"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,(()=>{const t=!document[e];t!==this.visible_&&(this.visible_=t,this.trigger("visible",t))}),!1)}static getInstance(){return new Nn}getInitialEvent(e){return i("visible"===e,"Unknown event type: "+e),[this.visible_]}}const kn=1e3;class Pn extends an{constructor(e,t,n,i,r,s,o,a){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=n,this.onConnectStatus_=i,this.onServerInfoUpdate_=r,this.authTokenProvider_=s,this.appCheckTokenProvider_=o,this.authOverride_=a,this.id=Pn.nextPersistentConnectionId_++,this.log_=bt("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=kn,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,a&&!v())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Nn.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&ln.getInstance().on("online",this.onOnline_,this)}sendRequest(e,t,n){const r=++this.requestNumber_,s={r:r,a:e,b:t};this.log_(I(s)),i(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(s),n&&(this.requestCBHash_[r]=n)}get(e){this.initConnection_();const t=new m,n={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:e=>{const n=e.d;"ok"===e.s?t.resolve(n):t.reject(n)}};this.outstandingGets_.push(n),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(i),t.promise}listen(e,t,n,r){this.initConnection_();const s=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+s),this.listens.has(o)||this.listens.set(o,new Map),i(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),i(!this.listens.get(o).has(s),"listen() called twice for same path/queryId.");const a={onComplete:r,hashFn:t,query:e,tag:n};this.listens.get(o).set(s,a),this.connected_&&this.sendListen_(a)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,(n=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(n)}))}sendListen_(e){const t=e.query,n=t._path.toString(),i=t._queryIdentifier;this.log_("Listen on "+n+" for "+i);const r={p:n};e.tag&&(r.q=t._queryObject,r.t=e.tag),r.h=e.hashFn(),this.sendRequest("q",r,(r=>{const s=r.d,o=r.s;Pn.warnOnListenWarnings_(s,t);(this.listens.get(n)&&this.listens.get(n).get(i))===e&&(this.log_("listen response",r),"ok"!==o&&this.removeListen_(n,i),e.onComplete&&e.onComplete(o,s))}))}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&S(e,"w")){const n=N(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){const e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',n=t._path.toString();It(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${e} at ${n} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},(()=>{})),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||function(e){const t=T(e).claims;return"object"==typeof t&&!0===t.admin}(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},(()=>{}))}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=function(e){const t=T(e).claims;return!!t&&"object"==typeof t&&t.hasOwnProperty("iat")}(e)?"auth":"gauth",n={cred:e};null===this.authOverride_?n.noauth=!0:"object"==typeof this.authOverride_&&(n.authvar=this.authOverride_),this.sendRequest(t,n,(t=>{const n=t.s,i=t.d||"error";this.authToken_===e&&("ok"===n?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(n,i))}))}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},(e=>{const t=e.s,n=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,n)}))}unlisten(e,t){const n=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+n+" "+r),i(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query");this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,e._queryObject,t)}sendUnlisten_(e,t,n,i){this.log_("Unlisten on "+e+" for "+t);const r={p:e};i&&(r.q=n,r.t=i),this.sendRequest("n",r)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,i){const r={p:t,d:n};this.log_("onDisconnect "+e,r),this.sendRequest(e,r,(e=>{i&&setTimeout((()=>{i(e.s,e.d)}),Math.floor(0))}))}put(e,t,n,i){this.putInternal("p",e,t,n,i)}merge(e,t,n,i){this.putInternal("m",e,t,n,i)}putInternal(e,t,n,i,r){this.initConnection_();const s={p:t,d:n};void 0!==r&&(s.h=r),this.outstandingPuts_.push({action:e,request:s,onComplete:i}),this.outstandingPutCount_++;const o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,n=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,n,(n=>{this.log_(t+" response",n),delete this.outstandingPuts_[e],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),i&&i(n.s,n.d)}))}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,(e=>{if("ok"!==e.s){const t=e.d;this.log_("reportStats","Error sending stats: "+t)}}))}}onDataMessage_(e){if("r"in e){this.log_("from server: "+I(e));const t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):Ct("Unrecognized action received from server: "+I(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){i(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout((()=>{this.establishConnectionTimer_=null,this.establishConnection_()}),Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=kn,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=kn,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){if(this.visible_){if(this.lastConnectionEstablishedTime_){(new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=kn),this.lastConnectionEstablishedTime_=null}}else this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime();const e=(new Date).getTime()-this.lastConnectionAttemptTime_;let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),t=this.onReady_.bind(this),n=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+Pn.nextConnectionId_++,s=this.lastSessionId;let o=!1,a=null;const c=function(){a?a.close():(o=!0,n())},l=function(e){i(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(e)};this.realtime_={close:c,sendRequest:l};const h=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[i,c]=await Promise.all([this.authTokenProvider_.getToken(h),this.appCheckTokenProvider_.getToken(h)]);o?wt("getToken() completed but was canceled"):(wt("getToken() completed. Creating connection."),this.authToken_=i&&i.accessToken,this.appCheckToken_=c&&c.token,a=new on(r,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,t,n,(e=>{It(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")}),s))}catch(e){this.log_("Failed to get token: "+e),o||(this.repoInfo_.nodeAdmin&&It(e),c())}}}interrupt(e){wt("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){wt("Resuming connection for reason: "+e),delete this.interruptReasons_[e],k(this.interruptReasons_)&&(this.reconnectDelay_=kn,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;n=t?t.map((e=>Dt(e))).join("$"):"default";const i=this.removeListen_(e,n);i&&i.onComplete&&i.onComplete("permission_denied")}removeListen_(e,t){const n=new hn(e).toString();let i;if(this.listens.has(n)){const e=this.listens.get(n);i=e.get(t),e.delete(t),0===e.size&&this.listens.delete(n)}else i=void 0;return i}onAuthRevoked_(e,t){wt("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){wt("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};e["sdk.js."+ct.replace(/\./g,"-")]=1,y()?e["framework.cordova"]=1:"object"==typeof navigator&&"ReactNative"===navigator.product&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=ln.getInstance().currentlyOnline();return k(this.interruptReasons_)&&e}}Pn.nextPersistentConnectionId_=0,Pn.nextConnectionId_=0;class Rn{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new Rn(e,t)}}class Dn{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const n=new Rn(St,e),i=new Rn(St,t);return 0!==this.compare(n,i)}minPost(){return Rn.MIN}}let xn;class On extends Dn{static get __EMPTY_NODE(){return xn}static set __EMPTY_NODE(e){xn=e}compare(e,t){return kt(e.name,t.name)}isDefinedOn(e){throw r("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return Rn.MIN}maxPost(){return new Rn(Nt,xn)}makePost(e,t){return i("string"==typeof e,"KeyIndex indexValue must always be a string."),new Rn(e,xn)}toString(){return".key"}}const An=new On;class Mn{constructor(e,t,n,i,r=null){this.isReverse_=i,this.resultGenerator_=r,this.nodeStack_=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,i&&(s*=-1),s<0)e=this.isReverse_?e.left:e.right;else{if(0===s){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}getNext(){if(0===this.nodeStack_.length)return null;let e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class Fn{constructor(e,t,n,i,r){this.key=e,this.value=t,this.color=null!=n?n:Fn.RED,this.left=null!=i?i:Ln.EMPTY_NODE,this.right=null!=r?r:Ln.EMPTY_NODE}copy(e,t,n,i,r){return new Fn(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=r?r:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this;const r=n(e,i.key);return i=r<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===r?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp_()}removeMin_(){if(this.left.isEmpty())return Ln.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let n,i;if(n=this,t(e,n.key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return Ln.EMPTY_NODE;i=n.right.min_(),n=n.copy(i.key,i.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,Fn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,Fn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}Fn.RED=!0,Fn.BLACK=!1;class Ln{constructor(e,t=Ln.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new Ln(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Fn.BLACK,null,null))}remove(e){return new Ln(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Fn.BLACK,null,null))}get(e){let t,n=this.root_;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t)return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,i=null;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t){if(n.left.isEmpty())return i?i.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(i=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Mn(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new Mn(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new Mn(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new Mn(this.root_,null,this.comparator_,!0,e)}}function qn(e,t){return kt(e.name,t.name)}function jn(e,t){return kt(e,t)}let Un;Ln.EMPTY_NODE=new class{copy(e,t,n,i,r){return this}insert(e,t,n){return new Fn(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};const Wn=function(e){return"number"==typeof e?"number:"+At(e):"string:"+e},Bn=function(e){if(e.isLeafNode()){const t=e.val();i("string"==typeof t||"number"==typeof t||"object"==typeof t&&S(t,".sv"),"Priority must be a string or number.")}else i(e===Un||e.isEmpty(),"priority of unexpected type.");i(e===Un||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let zn,Hn,Vn;class $n{constructor(e,t=$n.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=t,this.lazyHash_=null,i(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),Bn(this.priorityNode_)}static set __childrenNodeConstructor(e){zn=e}static get __childrenNodeConstructor(){return zn}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new $n(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:$n.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return vn(e)?this:".priority"===dn(e)?this.priorityNode_:$n.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:$n.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,t){const n=dn(e);return null===n?t:t.isEmpty()&&".priority"!==n?this:(i(".priority"!==n||1===pn(e),".priority must be the last token in a path"),this.updateImmediateChild(n,$n.__childrenNodeConstructor.EMPTY_NODE.updateChild(_n(e),t)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+Wn(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",e+="number"===t?At(this.value_):this.value_,this.lazyHash_=gt(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===$n.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof $n.__childrenNodeConstructor?-1:(i(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const t=typeof e.value_,n=typeof this.value_,r=$n.VALUE_TYPE_ORDER.indexOf(t),s=$n.VALUE_TYPE_ORDER.indexOf(n);return i(r>=0,"Unknown leaf type: "+t),i(s>=0,"Unknown leaf type: "+n),r===s?"object"===n?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:s-r}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}return!1}}$n.VALUE_TYPE_ORDER=["object","boolean","number","string"];const Yn=new class extends Dn{compare(e,t){const n=e.node.getPriority(),i=t.node.getPriority(),r=n.compareTo(i);return 0===r?kt(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return Rn.MIN}maxPost(){return new Rn(Nt,new $n("[PRIORITY-POST]",Vn))}makePost(e,t){const n=Hn(e);return new Rn(t,new $n("[PRIORITY-POST]",n))}toString(){return".priority"}},Kn=Math.log(2);class Gn{constructor(e){var t;this.count=(t=e+1,parseInt(Math.log(t)/Kn,10)),this.current_=this.count-1;const n=(i=this.count,parseInt(Array(i+1).join("1"),2));var i;this.bits_=e+1&n}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Qn=function(e,t,n,i){e.sort(t);const r=function(t,i){const s=i-t;let o,a;if(0===s)return null;if(1===s)return o=e[t],a=n?n(o):o,new Fn(a,o.node,Fn.BLACK,null,null);{const c=parseInt(s/2,10)+t,l=r(t,c),h=r(c+1,i);return o=e[c],a=n?n(o):o,new Fn(a,o.node,Fn.BLACK,l,h)}},s=function(t){let i=null,s=null,o=e.length;const a=function(t,i){const s=o-t,a=o;o-=t;const l=r(s+1,a),h=e[s],u=n?n(h):h;c(new Fn(u,h.node,i,null,l))},c=function(e){i?(i.left=e,i=e):(s=e,i=e)};for(let e=0;e<t.count;++e){const n=t.nextBitIsOne(),i=Math.pow(2,t.count-(e+1));n?a(i,Fn.BLACK):(a(i,Fn.BLACK),a(i,Fn.RED))}return s}(new Gn(e.length));return new Ln(i||t,s)};let Jn;const Xn={};class Zn{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return i(Xn&&Yn,"ChildrenNode.ts has not been loaded"),Jn=Jn||new Zn({".priority":Xn},{".priority":Yn}),Jn}get(e){const t=N(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof Ln?t:null}hasIndex(e){return S(this.indexSet_,e.toString())}addIndex(e,t){i(e!==An,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const n=[];let r=!1;const s=t.getIterator(Rn.Wrap);let o,a=s.getNext();for(;a;)r=r||e.isDefinedOn(a.node),n.push(a),a=s.getNext();o=r?Qn(n,e.getCompare()):Xn;const c=e.toString(),l=Object.assign({},this.indexSet_);l[c]=e;const h=Object.assign({},this.indexes_);return h[c]=o,new Zn(h,l)}addToIndexes(e,t){const n=P(this.indexes_,((n,r)=>{const s=N(this.indexSet_,r);if(i(s,"Missing index implementation for "+r),n===Xn){if(s.isDefinedOn(e.node)){const n=[],i=t.getIterator(Rn.Wrap);let r=i.getNext();for(;r;)r.name!==e.name&&n.push(r),r=i.getNext();return n.push(e),Qn(n,s.getCompare())}return Xn}{const i=t.get(e.name);let r=n;return i&&(r=r.remove(new Rn(e.name,i))),r.insert(e,e.node)}}));return new Zn(n,this.indexSet_)}removeFromIndexes(e,t){const n=P(this.indexes_,(n=>{if(n===Xn)return n;{const i=t.get(e.name);return i?n.remove(new Rn(e.name,i)):n}}));return new Zn(n,this.indexSet_)}}let ei;class ti{constructor(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&Bn(this.priorityNode_),this.children_.isEmpty()&&i(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return ei||(ei=new ti(new Ln(jn),null,Zn.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||ei}updatePriority(e){return this.children_.isEmpty()?this:new ti(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();{const t=this.children_.get(e);return null===t?ei:t}}getChild(e){const t=dn(e);return null===t?this:this.getImmediateChild(t).getChild(_n(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(e,t){if(i(t,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(t);{const n=new Rn(e,t);let i,r;t.isEmpty()?(i=this.children_.remove(e),r=this.indexMap_.removeFromIndexes(n,this.children_)):(i=this.children_.insert(e,t),r=this.indexMap_.addToIndexes(n,this.children_));const s=i.isEmpty()?ei:this.priorityNode_;return new ti(i,s,r)}}updateChild(e,t){const n=dn(e);if(null===n)return t;{i(".priority"!==dn(e)||1===pn(e),".priority must be the last token in a path");const r=this.getImmediateChild(n).updateChild(_n(e),t);return this.updateImmediateChild(n,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let n=0,i=0,r=!0;if(this.forEachChild(Yn,((s,o)=>{t[s]=o.val(e),n++,r&&ti.INTEGER_REGEXP_.test(s)?i=Math.max(i,Number(s)):r=!1})),!e&&r&&i<2*n){const e=[];for(const n in t)e[n]=t[n];return e}return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(null===this.lazyHash_){let e="";this.getPriority().isEmpty()||(e+="priority:"+Wn(this.getPriority().val())+":"),this.forEachChild(Yn,((t,n)=>{const i=n.hash();""!==i&&(e+=":"+t+":"+i)})),this.lazyHash_=""===e?"":gt(e)}return this.lazyHash_}getPredecessorChildName(e,t,n){const i=this.resolveIndex_(n);if(i){const n=i.getPredecessorKey(new Rn(e,t));return n?n.name:null}return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.minKey();return e&&e.name}return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new Rn(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.maxKey();return e&&e.name}return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new Rn(t,this.children_.get(t)):null}forEachChild(e,t){const n=this.resolveIndex_(e);return n?n.inorderTraversal((e=>t(e.name,e.node))):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,(e=>e));{const n=this.children_.getIteratorFrom(e.name,Rn.Wrap);let i=n.peek();for(;null!=i&&t.compare(i,e)<0;)n.getNext(),i=n.peek();return n}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,(e=>e));{const n=this.children_.getReverseIteratorFrom(e.name,Rn.Wrap);let i=n.peek();for(;null!=i&&t.compare(i,e)>0;)n.getNext(),i=n.peek();return n}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===ni?-1:0}withIndex(e){if(e===An||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new ti(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===An||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority())){if(this.children_.count()===t.children_.count()){const e=this.getIterator(Yn),n=t.getIterator(Yn);let i=e.getNext(),r=n.getNext();for(;i&&r;){if(i.name!==r.name||!i.node.equals(r.node))return!1;i=e.getNext(),r=n.getNext()}return null===i&&null===r}return!1}return!1}}resolveIndex_(e){return e===An?null:this.indexMap_.get(e.toString())}}ti.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;const ni=new class extends ti{constructor(){super(new Ln(jn),ti.EMPTY_NODE,Zn.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return ti.EMPTY_NODE}isEmpty(){return!1}};Object.defineProperties(Rn,{MIN:{value:new Rn(St,ti.EMPTY_NODE)},MAX:{value:new Rn(Nt,ni)}}),On.__EMPTY_NODE=ti.EMPTY_NODE,$n.__childrenNodeConstructor=ti,Un=ni,function(e){Vn=e}(ni);function ii(e,t=null){if(null===e)return ti.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(t=e[".priority"]),i(null===t||"string"==typeof t||"number"==typeof t||"object"==typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e){return new $n(e,ii(t))}if(e instanceof Array){let n=ti.EMPTY_NODE;return Ot(e,((t,i)=>{if(S(e,t)&&"."!==t.substring(0,1)){const e=ii(i);!e.isLeafNode()&&e.isEmpty()||(n=n.updateImmediateChild(t,e))}})),n.updatePriority(ii(t))}{const n=[];let i=!1;if(Ot(e,((e,t)=>{if("."!==e.substring(0,1)){const r=ii(t);r.isEmpty()||(i=i||!r.getPriority().isEmpty(),n.push(new Rn(e,r)))}})),0===n.length)return ti.EMPTY_NODE;const r=Qn(n,qn,(e=>e.name),jn);if(i){const e=Qn(n,Yn.getCompare());return new ti(r,ii(t),new Zn({".priority":e},{".priority":Yn}))}return new ti(r,ii(t),Zn.Default)}}!function(e){Hn=e}(ii);class ri extends Dn{constructor(e){super(),this.indexPath_=e,i(!vn(e)&&".priority"!==dn(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const n=this.extractChild(e.node),i=this.extractChild(t.node),r=n.compareTo(i);return 0===r?kt(e.name,t.name):r}makePost(e,t){const n=ii(e),i=ti.EMPTY_NODE.updateChild(this.indexPath_,n);return new Rn(t,i)}maxPost(){const e=ti.EMPTY_NODE.updateChild(this.indexPath_,ni);return new Rn(Nt,e)}toString(){return gn(this.indexPath_,0).join("/")}}const si=new class extends Dn{compare(e,t){const n=e.node.compareTo(t.node);return 0===n?kt(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return Rn.MIN}maxPost(){return Rn.MAX}makePost(e,t){const n=ii(e);return new Rn(t,n)}toString(){return".value"}};function oi(e){return{type:"value",snapshotNode:e}}function ai(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function ci(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function li(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}class hi{constructor(e){this.index_=e}updateChild(e,t,n,r,s,o){i(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(t);return a.getChild(r).equals(n.getChild(r))&&a.isEmpty()===n.isEmpty()?e:(null!=o&&(n.isEmpty()?e.hasChild(t)?o.trackChildChange(ci(t,a)):i(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(ai(t,n)):o.trackChildChange(li(t,n,a))),e.isLeafNode()&&n.isEmpty()?e:e.updateImmediateChild(t,n).withIndex(this.index_))}updateFullNode(e,t,n){return null!=n&&(e.isLeafNode()||e.forEachChild(Yn,((e,i)=>{t.hasChild(e)||n.trackChildChange(ci(e,i))})),t.isLeafNode()||t.forEachChild(Yn,((t,i)=>{if(e.hasChild(t)){const r=e.getImmediateChild(t);r.equals(i)||n.trackChildChange(li(t,i,r))}else n.trackChildChange(ai(t,i))}))),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?ti.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class ui{constructor(e){this.indexedFilter_=new hi(e.getIndex()),this.index_=e.getIndex(),this.startPost_=ui.getStartPost_(e),this.endPost_=ui.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,n=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&n}updateChild(e,t,n,i,r,s){return this.matches(new Rn(t,n))||(n=ti.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,i,r,s)}updateFullNode(e,t,n){t.isLeafNode()&&(t=ti.EMPTY_NODE);let i=t.withIndex(this.index_);i=i.updatePriority(ti.EMPTY_NODE);const r=this;return t.forEachChild(Yn,((e,t)=>{r.matches(new Rn(e,t))||(i=i.updateImmediateChild(e,ti.EMPTY_NODE))})),this.indexedFilter_.updateFullNode(e,i,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()}}class di{constructor(e){this.withinDirectionalStart=e=>this.reverse_?this.withinEndPost(e):this.withinStartPost(e),this.withinDirectionalEnd=e=>this.reverse_?this.withinStartPost(e):this.withinEndPost(e),this.withinStartPost=e=>{const t=this.index_.compare(this.rangedFilter_.getStartPost(),e);return this.startIsInclusive_?t<=0:t<0},this.withinEndPost=e=>{const t=this.index_.compare(e,this.rangedFilter_.getEndPost());return this.endIsInclusive_?t<=0:t<0},this.rangedFilter_=new ui(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,n,i,r,s){return this.rangedFilter_.matches(new Rn(t,n))||(n=ti.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,i,r,s):this.fullLimitUpdateChild_(e,t,n,r,s)}updateFullNode(e,t,n){let i;if(t.isLeafNode()||t.isEmpty())i=ti.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){let e;i=ti.EMPTY_NODE.withIndex(this.index_),e=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let n=0;for(;e.hasNext()&&n<this.limit_;){const t=e.getNext();if(this.withinDirectionalStart(t)){if(!this.withinDirectionalEnd(t))break;i=i.updateImmediateChild(t.name,t.node),n++}}}else{let e;i=t.withIndex(this.index_),i=i.updatePriority(ti.EMPTY_NODE),e=this.reverse_?i.getReverseIterator(this.index_):i.getIterator(this.index_);let n=0;for(;e.hasNext();){const t=e.getNext();n<this.limit_&&this.withinDirectionalStart(t)&&this.withinDirectionalEnd(t)?n++:i=i.updateImmediateChild(t.name,ti.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,i,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,n,r,s){let o;if(this.reverse_){const e=this.index_.getCompare();o=(t,n)=>e(n,t)}else o=this.index_.getCompare();const a=e;i(a.numChildren()===this.limit_,"");const c=new Rn(t,n),l=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),h=this.rangedFilter_.matches(c);if(a.hasChild(t)){const e=a.getImmediateChild(t);let i=r.getChildAfterChild(this.index_,l,this.reverse_);for(;null!=i&&(i.name===t||a.hasChild(i.name));)i=r.getChildAfterChild(this.index_,i,this.reverse_);const u=null==i?1:o(i,c);if(h&&!n.isEmpty()&&u>=0)return null!=s&&s.trackChildChange(li(t,n,e)),a.updateImmediateChild(t,n);{null!=s&&s.trackChildChange(ci(t,e));const n=a.updateImmediateChild(t,ti.EMPTY_NODE);return null!=i&&this.rangedFilter_.matches(i)?(null!=s&&s.trackChildChange(ai(i.name,i.node)),n.updateImmediateChild(i.name,i.node)):n}}return n.isEmpty()?e:h&&o(l,c)>=0?(null!=s&&(s.trackChildChange(ci(l.name,l.node)),s.trackChildChange(ai(t,n))),a.updateImmediateChild(t,n).updateImmediateChild(l.name,ti.EMPTY_NODE)):e}}class pi{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Yn}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return i(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return i(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:St}hasEnd(){return this.endSet_}getIndexEndValue(){return i(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return i(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Nt}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return i(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===Yn}copy(){const e=new pi;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function _i(e){const t={};if(e.isDefault())return t;let n;if(e.index_===Yn?n="$priority":e.index_===si?n="$value":e.index_===An?n="$key":(i(e.index_ instanceof ri,"Unrecognized index type!"),n=e.index_.toString()),t.orderBy=I(n),e.startSet_){const n=e.startAfterSet_?"startAfter":"startAt";t[n]=I(e.indexStartValue_),e.startNameSet_&&(t[n]+=","+I(e.indexStartName_))}if(e.endSet_){const n=e.endBeforeSet_?"endBefore":"endAt";t[n]=I(e.indexEndValue_),e.endNameSet_&&(t[n]+=","+I(e.indexEndName_))}return e.limitSet_&&(e.isViewFromLeft()?t.limitToFirst=e.limit_:t.limitToLast=e.limit_),t}function fi(e){const t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_),t.sin=!e.startAfterSet_),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_),t.ein=!e.endBeforeSet_),e.limitSet_){t.l=e.limit_;let n=e.viewFrom_;""===n&&(n=e.isViewFromLeft()?"l":"r"),t.vf=n}return e.index_!==Yn&&(t.i=e.index_.toString()),t}class gi extends an{constructor(e,t,n,i){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=i,this.log_=bt("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(i(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,n,i){const r=e._path.toString();this.log_("Listen called for "+r+" "+e._queryIdentifier);const s=gi.getListenId_(e,n),o={};this.listens_[s]=o;const a=_i(e._queryParams);this.restRequest_(r+".json",a,((e,t)=>{let a=t;if(404===e&&(a=null,e=null),null===e&&this.onDataUpdate_(r,a,!1,n),N(this.listens_,s)===o){let t;t=e?401===e?"permission_denied":"rest_error:"+e:"ok",i(t,null)}}))}unlisten(e,t){const n=gi.getListenId_(e,t);delete this.listens_[n]}get(e){const t=_i(e._queryParams),n=e._path.toString(),i=new m;return this.restRequest_(n+".json",t,((e,t)=>{let r=t;404===e&&(r=null,e=null),null===e?(this.onDataUpdate_(n,r,!1,null),i.resolve(r)):i.reject(new Error(r))})),i.promise}refreshAuthToken(e){}restRequest_(e,t={},n){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then((([i,r])=>{i&&i.accessToken&&(t.auth=i.accessToken),r&&r.token&&(t.ac=r.token);const s=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+function(e){const t=[];for(const[n,i]of Object.entries(e))Array.isArray(i)?i.forEach((e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(i));return t.length?"&"+t.join("&"):""}(t);this.log_("Sending REST request for "+s);const o=new XMLHttpRequest;o.onreadystatechange=()=>{if(n&&4===o.readyState){this.log_("REST Response for "+s+" received. status:",o.status,"response:",o.responseText);let e=null;if(o.status>=200&&o.status<300){try{e=E(o.responseText)}catch(e){It("Failed to parse JSON response for "+s+": "+o.responseText)}n(null,e)}else 401!==o.status&&404!==o.status&&It("Got unsuccessful REST response for "+s+" Status: "+o.status),n(o.status);n=null}},o.open("GET",s,!0),o.send()}))}}class mi{constructor(){this.rootNode_=ti.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function yi(){return{value:null,children:new Map}}function vi(e,t,n){if(vn(t))e.value=n,e.children.clear();else if(null!==e.value)e.value=e.value.updateChild(t,n);else{const i=dn(t);e.children.has(i)||e.children.set(i,yi());vi(e.children.get(i),t=_n(t),n)}}function wi(e,t,n){null!==e.value?n(t,e.value):function(e,t){e.children.forEach(((e,n)=>{t(n,e)}))}(e,((e,i)=>{wi(i,new hn(t.toString()+"/"+e),n)}))}class bi{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=Object.assign({},e);return this.last_&&Ot(this.last_,((e,n)=>{t[e]=t[e]-n})),this.last_=e,t}}class Ci{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new bi(e);const n=1e4+2e4*Math.random();qt(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){const e=this.statsListener_.get(),t={};let n=!1;Ot(e,((e,i)=>{i>0&&S(this.statsToReport_,e)&&(t[e]=i,n=!0)})),n&&this.server_.reportStats(t),qt(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}var Ei;function Ii(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}!function(e){e[e.OVERWRITE=0]="OVERWRITE",e[e.MERGE=1]="MERGE",e[e.ACK_USER_WRITE=2]="ACK_USER_WRITE",e[e.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(Ei||(Ei={}));class Ti{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=Ei.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}operationForChild(e){if(vn(this.path)){if(null!=this.affectedTree.value)return i(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new hn(e));return new Ti(un(),t,this.revert)}}return i(dn(this.path)===e,"operationForChild called for unrelated child."),new Ti(_n(this.path),this.affectedTree,this.revert)}}class Si{constructor(e,t){this.source=e,this.path=t,this.type=Ei.LISTEN_COMPLETE}operationForChild(e){return vn(this.path)?new Si(this.source,un()):new Si(this.source,_n(this.path))}}class Ni{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=Ei.OVERWRITE}operationForChild(e){return vn(this.path)?new Ni(this.source,un(),this.snap.getImmediateChild(e)):new Ni(this.source,_n(this.path),this.snap)}}class ki{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=Ei.MERGE}operationForChild(e){if(vn(this.path)){const t=this.children.subtree(new hn(e));return t.isEmpty()?null:t.value?new Ni(this.source,un(),t.value):new ki(this.source,un(),t)}return i(dn(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new ki(this.source,_n(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class Pi{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(vn(e))return this.isFullyInitialized()&&!this.filtered_;const t=dn(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class Ri{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function Di(e,t,n,i,s,o){const a=i.filter((e=>e.type===n));a.sort(((t,n)=>function(e,t,n){if(null==t.childName||null==n.childName)throw r("Should only compare child_ events.");const i=new Rn(t.childName,t.snapshotNode),s=new Rn(n.childName,n.snapshotNode);return e.index_.compare(i,s)}(e,t,n))),a.forEach((n=>{const i=function(e,t,n){return"value"===t.type||"child_removed"===t.type||(t.prevName=n.getPredecessorChildName(t.childName,t.snapshotNode,e.index_)),t}(e,n,o);s.forEach((r=>{r.respondsTo(n.type)&&t.push(r.createEvent(i,e.query_))}))}))}function xi(e,t){return{eventCache:e,serverCache:t}}function Oi(e,t,n,i){return xi(new Pi(t,n,i),e.serverCache)}function Ai(e,t,n,i){return xi(e.eventCache,new Pi(t,n,i))}function Mi(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function Fi(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}let Li;class qi{constructor(e,t=(()=>(Li||(Li=new Ln(Pt)),Li))()){this.value=e,this.children=t}static fromObject(e){let t=new qi(null);return Ot(e,((e,n)=>{t=t.set(new hn(e),n)})),t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:un(),value:this.value};if(vn(e))return null;{const n=dn(e),i=this.children.get(n);if(null!==i){const r=i.findRootMostMatchingPathAndValue(_n(e),t);if(null!=r){return{path:yn(new hn(n),r.path),value:r.value}}return null}return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,(()=>!0))}subtree(e){if(vn(e))return this;{const t=dn(e),n=this.children.get(t);return null!==n?n.subtree(_n(e)):new qi(null)}}set(e,t){if(vn(e))return new qi(t,this.children);{const n=dn(e),i=(this.children.get(n)||new qi(null)).set(_n(e),t),r=this.children.insert(n,i);return new qi(this.value,r)}}remove(e){if(vn(e))return this.children.isEmpty()?new qi(null):new qi(null,this.children);{const t=dn(e),n=this.children.get(t);if(n){const i=n.remove(_n(e));let r;return r=i.isEmpty()?this.children.remove(t):this.children.insert(t,i),null===this.value&&r.isEmpty()?new qi(null):new qi(this.value,r)}return this}}get(e){if(vn(e))return this.value;{const t=dn(e),n=this.children.get(t);return n?n.get(_n(e)):null}}setTree(e,t){if(vn(e))return t;{const n=dn(e),i=(this.children.get(n)||new qi(null)).setTree(_n(e),t);let r;return r=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),new qi(this.value,r)}}fold(e){return this.fold_(un(),e)}fold_(e,t){const n={};return this.children.inorderTraversal(((i,r)=>{n[i]=r.fold_(yn(e,i),t)})),t(e,this.value,n)}findOnPath(e,t){return this.findOnPath_(e,un(),t)}findOnPath_(e,t,n){const i=!!this.value&&n(t,this.value);if(i)return i;if(vn(e))return null;{const i=dn(e),r=this.children.get(i);return r?r.findOnPath_(_n(e),yn(t,i),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,un(),t)}foreachOnPath_(e,t,n){if(vn(e))return this;{this.value&&n(t,this.value);const i=dn(e),r=this.children.get(i);return r?r.foreachOnPath_(_n(e),yn(t,i),n):new qi(null)}}foreach(e){this.foreach_(un(),e)}foreach_(e,t){this.children.inorderTraversal(((n,i)=>{i.foreach_(yn(e,n),t)})),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal(((t,n)=>{n.value&&e(t,n.value)}))}}class ji{constructor(e){this.writeTree_=e}static empty(){return new ji(new qi(null))}}function Ui(e,t,n){if(vn(t))return new ji(new qi(n));{const i=e.writeTree_.findRootMostValueAndPath(t);if(null!=i){const r=i.path;let s=i.value;const o=wn(r,t);return s=s.updateChild(o,n),new ji(e.writeTree_.set(r,s))}{const i=new qi(n),r=e.writeTree_.setTree(t,i);return new ji(r)}}}function Wi(e,t,n){let i=e;return Ot(n,((e,n)=>{i=Ui(i,yn(t,e),n)})),i}function Bi(e,t){if(vn(t))return ji.empty();{const n=e.writeTree_.setTree(t,new qi(null));return new ji(n)}}function zi(e,t){return null!=Hi(e,t)}function Hi(e,t){const n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(wn(n.path,t)):null}function Vi(e){const t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(Yn,((e,n)=>{t.push(new Rn(e,n))})):e.writeTree_.children.inorderTraversal(((e,n)=>{null!=n.value&&t.push(new Rn(e,n.value))})),t}function $i(e,t){if(vn(t))return e;{const n=Hi(e,t);return new ji(null!=n?new qi(n):e.writeTree_.subtree(t))}}function Yi(e){return e.writeTree_.isEmpty()}function Ki(e,t){return Gi(un(),e.writeTree_,t)}function Gi(e,t,n){if(null!=t.value)return n.updateChild(e,t.value);{let r=null;return t.children.inorderTraversal(((t,s)=>{".priority"===t?(i(null!==s.value,"Priority writes must always be leaf nodes"),r=s.value):n=Gi(yn(e,t),s,n)})),n.getChild(e).isEmpty()||null===r||(n=n.updateChild(yn(e,".priority"),r)),n}}function Qi(e,t){return lr(t,e)}function Ji(e,t){const n=e.allWrites.findIndex((e=>e.writeId===t));i(n>=0,"removeWrite called with nonexistent writeId.");const r=e.allWrites[n];e.allWrites.splice(n,1);let s=r.visible,o=!1,a=e.allWrites.length-1;for(;s&&a>=0;){const t=e.allWrites[a];t.visible&&(a>=n&&Xi(t,r.path)?s=!1:En(r.path,t.path)&&(o=!0)),a--}if(s){if(o)return function(e){e.visibleWrites=er(e.allWrites,Zi,un()),e.allWrites.length>0?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1}(e),!0;if(r.snap)e.visibleWrites=Bi(e.visibleWrites,r.path);else{Ot(r.children,(t=>{e.visibleWrites=Bi(e.visibleWrites,yn(r.path,t))}))}return!0}return!1}function Xi(e,t){if(e.snap)return En(e.path,t);for(const n in e.children)if(e.children.hasOwnProperty(n)&&En(yn(e.path,n),t))return!0;return!1}function Zi(e){return e.visible}function er(e,t,n){let i=ji.empty();for(let s=0;s<e.length;++s){const o=e[s];if(t(o)){const e=o.path;let t;if(o.snap)En(n,e)?(t=wn(n,e),i=Ui(i,t,o.snap)):En(e,n)&&(t=wn(e,n),i=Ui(i,un(),o.snap.getChild(t)));else{if(!o.children)throw r("WriteRecord should have .snap or .children");if(En(n,e))t=wn(n,e),i=Wi(i,t,o.children);else if(En(e,n))if(t=wn(e,n),vn(t))i=Wi(i,un(),o.children);else{const e=N(o.children,dn(t));if(e){const n=e.getChild(_n(t));i=Ui(i,un(),n)}}}}}return i}function tr(e,t,n,i,r){if(i||r){const s=$i(e.visibleWrites,t);if(!r&&Yi(s))return n;if(r||null!=n||zi(s,un())){const s=function(e){return(e.visible||r)&&(!i||!~i.indexOf(e.writeId))&&(En(e.path,t)||En(t,e.path))};return Ki(er(e.allWrites,s,t),n||ti.EMPTY_NODE)}return null}{const i=Hi(e.visibleWrites,t);if(null!=i)return i;{const i=$i(e.visibleWrites,t);if(Yi(i))return n;if(null!=n||zi(i,un())){return Ki(i,n||ti.EMPTY_NODE)}return null}}}function nr(e,t,n,i){return tr(e.writeTree,e.treePath,t,n,i)}function ir(e,t){return function(e,t,n){let i=ti.EMPTY_NODE;const r=Hi(e.visibleWrites,t);if(r)return r.isLeafNode()||r.forEachChild(Yn,((e,t)=>{i=i.updateImmediateChild(e,t)})),i;if(n){const r=$i(e.visibleWrites,t);return n.forEachChild(Yn,((e,t)=>{const n=Ki($i(r,new hn(e)),t);i=i.updateImmediateChild(e,n)})),Vi(r).forEach((e=>{i=i.updateImmediateChild(e.name,e.node)})),i}return Vi($i(e.visibleWrites,t)).forEach((e=>{i=i.updateImmediateChild(e.name,e.node)})),i}(e.writeTree,e.treePath,t)}function rr(e,t,n,r){return function(e,t,n,r,s){i(r||s,"Either existingEventSnap or existingServerSnap must exist");const o=yn(t,n);if(zi(e.visibleWrites,o))return null;{const t=$i(e.visibleWrites,o);return Yi(t)?s.getChild(n):Ki(t,s.getChild(n))}}(e.writeTree,e.treePath,t,n,r)}function sr(e,t){return function(e,t){return Hi(e.visibleWrites,t)}(e.writeTree,yn(e.treePath,t))}function or(e,t,n,i,r,s){return function(e,t,n,i,r,s,o){let a;const c=$i(e.visibleWrites,t),l=Hi(c,un());if(null!=l)a=l;else{if(null==n)return[];a=Ki(c,n)}if(a=a.withIndex(o),a.isEmpty()||a.isLeafNode())return[];{const e=[],t=o.getCompare(),n=s?a.getReverseIteratorFrom(i,o):a.getIteratorFrom(i,o);let c=n.getNext();for(;c&&e.length<r;)0!==t(c,i)&&e.push(c),c=n.getNext();return e}}(e.writeTree,e.treePath,t,n,i,r,s)}function ar(e,t,n){return function(e,t,n,i){const r=yn(t,n),s=Hi(e.visibleWrites,r);if(null!=s)return s;if(i.isCompleteForChild(n))return Ki($i(e.visibleWrites,r),i.getNode().getImmediateChild(n));return null}(e.writeTree,e.treePath,t,n)}function cr(e,t){return lr(yn(e.treePath,t),e.writeTree)}function lr(e,t){return{treePath:e,writeTree:t}}class hr{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,n=e.childName;i("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),i(".priority"!==n,"Only non-priority child changes can be tracked.");const s=this.changeMap.get(n);if(s){const i=s.type;if("child_added"===t&&"child_removed"===i)this.changeMap.set(n,li(n,e.snapshotNode,s.snapshotNode));else if("child_removed"===t&&"child_added"===i)this.changeMap.delete(n);else if("child_removed"===t&&"child_changed"===i)this.changeMap.set(n,ci(n,s.oldSnap));else if("child_changed"===t&&"child_added"===i)this.changeMap.set(n,ai(n,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==i)throw r("Illegal combination of changes: "+e+" occurred after "+s);this.changeMap.set(n,li(n,e.snapshotNode,s.oldSnap))}}else this.changeMap.set(n,e)}getChanges(){return Array.from(this.changeMap.values())}}const ur=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}};class dr{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const t=null!=this.optCompleteServerCache_?new Pi(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return ar(this.writes_,e,t)}}getChildAfterChild(e,t,n){const i=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:Fi(this.viewCache_),r=or(this.writes_,i,t,1,n,e);return 0===r.length?null:r[0]}}function pr(e,t,n,s,o){const a=new hr;let c,l;if(n.type===Ei.OVERWRITE){const r=n;r.source.fromUser?c=gr(e,t,r.path,r.snap,s,o,a):(i(r.source.fromServer,"Unknown source."),l=r.source.tagged||t.serverCache.isFiltered()&&!vn(r.path),c=fr(e,t,r.path,r.snap,s,o,l,a))}else if(n.type===Ei.MERGE){const r=n;r.source.fromUser?c=function(e,t,n,i,r,s,o){let a=t;return i.foreach(((i,c)=>{const l=yn(n,i);mr(t,dn(l))&&(a=gr(e,a,l,c,r,s,o))})),i.foreach(((i,c)=>{const l=yn(n,i);mr(t,dn(l))||(a=gr(e,a,l,c,r,s,o))})),a}(e,t,r.path,r.children,s,o,a):(i(r.source.fromServer,"Unknown source."),l=r.source.tagged||t.serverCache.isFiltered(),c=vr(e,t,r.path,r.children,s,o,l,a))}else if(n.type===Ei.ACK_USER_WRITE){const r=n;c=r.revert?function(e,t,n,r,s,o){let a;if(null!=sr(r,n))return t;{const c=new dr(r,t,s),l=t.eventCache.getNode();let h;if(vn(n)||".priority"===dn(n)){let n;if(t.serverCache.isFullyInitialized())n=nr(r,Fi(t));else{const e=t.serverCache.getNode();i(e instanceof ti,"serverChildren would be complete if leaf node"),n=ir(r,e)}h=e.filter.updateFullNode(l,n,o)}else{const i=dn(n);let s=ar(r,i,t.serverCache);null==s&&t.serverCache.isCompleteForChild(i)&&(s=l.getImmediateChild(i)),h=null!=s?e.filter.updateChild(l,i,s,_n(n),c,o):t.eventCache.getNode().hasChild(i)?e.filter.updateChild(l,i,ti.EMPTY_NODE,_n(n),c,o):l,h.isEmpty()&&t.serverCache.isFullyInitialized()&&(a=nr(r,Fi(t)),a.isLeafNode()&&(h=e.filter.updateFullNode(h,a,o)))}return a=t.serverCache.isFullyInitialized()||null!=sr(r,un()),Oi(t,h,a,e.filter.filtersNodes())}}(e,t,r.path,s,o,a):function(e,t,n,i,r,s,o){if(null!=sr(r,n))return t;const a=t.serverCache.isFiltered(),c=t.serverCache;if(null!=i.value){if(vn(n)&&c.isFullyInitialized()||c.isCompleteForPath(n))return fr(e,t,n,c.getNode().getChild(n),r,s,a,o);if(vn(n)){let i=new qi(null);return c.getNode().forEachChild(An,((e,t)=>{i=i.set(new hn(e),t)})),vr(e,t,n,i,r,s,a,o)}return t}{let l=new qi(null);return i.foreach(((e,t)=>{const i=yn(n,e);c.isCompleteForPath(i)&&(l=l.set(e,c.getNode().getChild(i)))})),vr(e,t,n,l,r,s,a,o)}}(e,t,r.path,r.affectedTree,s,o,a)}else{if(n.type!==Ei.LISTEN_COMPLETE)throw r("Unknown operation type: "+n.type);c=function(e,t,n,i,r){const s=t.serverCache,o=Ai(t,s.getNode(),s.isFullyInitialized()||vn(n),s.isFiltered());return _r(e,o,n,i,ur,r)}(e,t,n.path,s,a)}const h=a.getChanges();return function(e,t,n){const i=t.eventCache;if(i.isFullyInitialized()){const r=i.getNode().isLeafNode()||i.getNode().isEmpty(),s=Mi(e);(n.length>0||!e.eventCache.isFullyInitialized()||r&&!i.getNode().equals(s)||!i.getNode().getPriority().equals(s.getPriority()))&&n.push(oi(Mi(t)))}}(t,c,h),{viewCache:c,changes:h}}function _r(e,t,n,r,s,o){const a=t.eventCache;if(null!=sr(r,n))return t;{let c,l;if(vn(n))if(i(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){const n=Fi(t),i=ir(r,n instanceof ti?n:ti.EMPTY_NODE);c=e.filter.updateFullNode(t.eventCache.getNode(),i,o)}else{const n=nr(r,Fi(t));c=e.filter.updateFullNode(t.eventCache.getNode(),n,o)}else{const h=dn(n);if(".priority"===h){i(1===pn(n),"Can't have a priority with additional path components");const s=a.getNode();l=t.serverCache.getNode();const o=rr(r,n,s,l);c=null!=o?e.filter.updatePriority(s,o):a.getNode()}else{const i=_n(n);let u;if(a.isCompleteForChild(h)){l=t.serverCache.getNode();const e=rr(r,n,a.getNode(),l);u=null!=e?a.getNode().getImmediateChild(h).updateChild(i,e):a.getNode().getImmediateChild(h)}else u=ar(r,h,t.serverCache);c=null!=u?e.filter.updateChild(a.getNode(),h,u,i,s,o):a.getNode()}}return Oi(t,c,a.isFullyInitialized()||vn(n),e.filter.filtersNodes())}}function fr(e,t,n,i,r,s,o,a){const c=t.serverCache;let l;const h=o?e.filter:e.filter.getIndexedFilter();if(vn(n))l=h.updateFullNode(c.getNode(),i,null);else if(h.filtersNodes()&&!c.isFiltered()){const e=c.getNode().updateChild(n,i);l=h.updateFullNode(c.getNode(),e,null)}else{const e=dn(n);if(!c.isCompleteForPath(n)&&pn(n)>1)return t;const r=_n(n),s=c.getNode().getImmediateChild(e).updateChild(r,i);l=".priority"===e?h.updatePriority(c.getNode(),s):h.updateChild(c.getNode(),e,s,r,ur,null)}const u=Ai(t,l,c.isFullyInitialized()||vn(n),h.filtersNodes());return _r(e,u,n,r,new dr(r,u,s),a)}function gr(e,t,n,i,r,s,o){const a=t.eventCache;let c,l;const h=new dr(r,t,s);if(vn(n))l=e.filter.updateFullNode(t.eventCache.getNode(),i,o),c=Oi(t,l,!0,e.filter.filtersNodes());else{const r=dn(n);if(".priority"===r)l=e.filter.updatePriority(t.eventCache.getNode(),i),c=Oi(t,l,a.isFullyInitialized(),a.isFiltered());else{const s=_n(n),l=a.getNode().getImmediateChild(r);let u;if(vn(s))u=i;else{const e=h.getCompleteChild(r);u=null!=e?".priority"===fn(s)&&e.getChild(mn(s)).isEmpty()?e:e.updateChild(s,i):ti.EMPTY_NODE}if(l.equals(u))c=t;else{c=Oi(t,e.filter.updateChild(a.getNode(),r,u,s,h,o),a.isFullyInitialized(),e.filter.filtersNodes())}}}return c}function mr(e,t){return e.eventCache.isCompleteForChild(t)}function yr(e,t,n){return n.foreach(((e,n)=>{t=t.updateChild(e,n)})),t}function vr(e,t,n,i,r,s,o,a){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let c,l=t;c=vn(n)?i:new qi(null).setTree(n,i);const h=t.serverCache.getNode();return c.children.inorderTraversal(((n,i)=>{if(h.hasChild(n)){const c=yr(0,t.serverCache.getNode().getImmediateChild(n),i);l=fr(e,l,new hn(n),c,r,s,o,a)}})),c.children.inorderTraversal(((n,i)=>{const c=!t.serverCache.isCompleteForChild(n)&&null===i.value;if(!h.hasChild(n)&&!c){const c=yr(0,t.serverCache.getNode().getImmediateChild(n),i);l=fr(e,l,new hn(n),c,r,s,o,a)}})),l}class wr{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const n=this.query_._queryParams,i=new hi(n.getIndex()),r=(s=n).loadsAllData()?new hi(s.getIndex()):s.hasLimit()?new di(s):new ui(s);var s;this.processor_=function(e){return{filter:e}}(r);const o=t.serverCache,a=t.eventCache,c=i.updateFullNode(ti.EMPTY_NODE,o.getNode(),null),l=r.updateFullNode(ti.EMPTY_NODE,a.getNode(),null),h=new Pi(c,o.isFullyInitialized(),i.filtersNodes()),u=new Pi(l,a.isFullyInitialized(),r.filtersNodes());this.viewCache_=xi(u,h),this.eventGenerator_=new Ri(this.query_)}get query(){return this.query_}}function br(e,t){const n=Fi(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!vn(t)&&!n.getImmediateChild(dn(t)).isEmpty())?n.getChild(t):null}function Cr(e){return 0===e.eventRegistrations_.length}function Er(e,t,n){const r=[];if(n){i(null==t,"A cancel should cancel all event registrations.");const s=e.query._path;e.eventRegistrations_.forEach((e=>{const t=e.createCancelEvent(n,s);t&&r.push(t)}))}if(t){let n=[];for(let i=0;i<e.eventRegistrations_.length;++i){const r=e.eventRegistrations_[i];if(r.matches(t)){if(t.hasAnyCallback()){n=n.concat(e.eventRegistrations_.slice(i+1));break}}else n.push(r)}e.eventRegistrations_=n}else e.eventRegistrations_=[];return r}function Ir(e,t,n,r){t.type===Ei.MERGE&&null!==t.source.queryId&&(i(Fi(e.viewCache_),"We should always have a full cache before handling merges"),i(Mi(e.viewCache_),"Missing event cache, even though we have a server cache"));const s=e.viewCache_,o=pr(e.processor_,s,t,n,r);var a,c;return a=e.processor_,c=o.viewCache,i(c.eventCache.getNode().isIndexed(a.filter.getIndex()),"Event snap not indexed"),i(c.serverCache.getNode().isIndexed(a.filter.getIndex()),"Server snap not indexed"),i(o.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=o.viewCache,Tr(e,o.changes,o.viewCache.eventCache.getNode(),null)}function Tr(e,t,n,i){const r=i?[i]:e.eventRegistrations_;return function(e,t,n,i){const r=[],s=[];return t.forEach((t=>{var n;"child_changed"===t.type&&e.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&s.push((n=t.childName,{type:"child_moved",snapshotNode:t.snapshotNode,childName:n}))})),Di(e,r,"child_removed",t,i,n),Di(e,r,"child_added",t,i,n),Di(e,r,"child_moved",s,i,n),Di(e,r,"child_changed",t,i,n),Di(e,r,"value",t,i,n),r}(e.eventGenerator_,t,n,r)}let Sr,Nr;class kr{constructor(){this.views=new Map}}function Pr(e,t,n,r){const s=t.source.queryId;if(null!==s){const o=e.views.get(s);return i(null!=o,"SyncTree gave us an op for an invalid query."),Ir(o,t,n,r)}{let i=[];for(const s of e.views.values())i=i.concat(Ir(s,t,n,r));return i}}function Rr(e,t,n,i,r){const s=t._queryIdentifier,o=e.views.get(s);if(!o){let e=nr(n,r?i:null),s=!1;e?s=!0:i instanceof ti?(e=ir(n,i),s=!1):(e=ti.EMPTY_NODE,s=!1);const o=xi(new Pi(e,s,!1),new Pi(i,r,!1));return new wr(t,o)}return o}function Dr(e,t,n,i,r,s){const o=Rr(e,t,i,r,s);return e.views.has(t._queryIdentifier)||e.views.set(t._queryIdentifier,o),function(e,t){e.eventRegistrations_.push(t)}(o,n),function(e,t){const n=e.viewCache_.eventCache,i=[];n.getNode().isLeafNode()||n.getNode().forEachChild(Yn,((e,t)=>{i.push(ai(e,t))}));return n.isFullyInitialized()&&i.push(oi(n.getNode())),Tr(e,i,n.getNode(),t)}(o,n)}function xr(e,t,n,r){const s=t._queryIdentifier,o=[];let a=[];const c=Lr(e);if("default"===s)for(const[t,i]of e.views.entries())a=a.concat(Er(i,n,r)),Cr(i)&&(e.views.delete(t),i.query._queryParams.loadsAllData()||o.push(i.query));else{const t=e.views.get(s);t&&(a=a.concat(Er(t,n,r)),Cr(t)&&(e.views.delete(s),t.query._queryParams.loadsAllData()||o.push(t.query)))}return c&&!Lr(e)&&o.push(new(i(Sr,"Reference.ts has not been loaded"),Sr)(t._repo,t._path)),{removed:o,events:a}}function Or(e){const t=[];for(const n of e.views.values())n.query._queryParams.loadsAllData()||t.push(n);return t}function Ar(e,t){let n=null;for(const i of e.views.values())n=n||br(i,t);return n}function Mr(e,t){if(t._queryParams.loadsAllData())return qr(e);{const n=t._queryIdentifier;return e.views.get(n)}}function Fr(e,t){return null!=Mr(e,t)}function Lr(e){return null!=qr(e)}function qr(e){for(const t of e.views.values())if(t.query._queryParams.loadsAllData())return t;return null}let jr=1;class Ur{constructor(e){this.listenProvider_=e,this.syncPointTree_=new qi(null),this.pendingWriteTree_={visibleWrites:ji.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function Wr(e,t,n,r,s){return function(e,t,n,r,s){i(r>e.lastWriteId,"Stacking an older write on top of newer ones"),void 0===s&&(s=!0),e.allWrites.push({path:t,snap:n,writeId:r,visible:s}),s&&(e.visibleWrites=Ui(e.visibleWrites,t,n)),e.lastWriteId=r}(e.pendingWriteTree_,t,n,r,s),s?Qr(e,new Ni({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},t,n)):[]}function Br(e,t,n,r){!function(e,t,n,r){i(r>e.lastWriteId,"Stacking an older merge on top of newer ones"),e.allWrites.push({path:t,children:n,writeId:r,visible:!0}),e.visibleWrites=Wi(e.visibleWrites,t,n),e.lastWriteId=r}(e.pendingWriteTree_,t,n,r);const s=qi.fromObject(n);return Qr(e,new ki({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},t,s))}function zr(e,t,n=!1){const i=function(e,t){for(let n=0;n<e.allWrites.length;n++){const i=e.allWrites[n];if(i.writeId===t)return i}return null}(e.pendingWriteTree_,t);if(Ji(e.pendingWriteTree_,t)){let t=new qi(null);return null!=i.snap?t=t.set(un(),!0):Ot(i.children,(e=>{t=t.set(new hn(e),!0)})),Qr(e,new Ti(i.path,t,n))}return[]}function Hr(e,t,n){return Qr(e,new Ni({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,n))}function Vr(e,t,n,i,r=!1){const s=t._path,o=e.syncPointTree_.get(s);let a=[];if(o&&("default"===t._queryIdentifier||Fr(o,t))){const c=xr(o,t,n,i);0===o.views.size&&(e.syncPointTree_=e.syncPointTree_.remove(s));const l=c.removed;if(a=c.events,!r){const n=-1!==l.findIndex((e=>e._queryParams.loadsAllData())),r=e.syncPointTree_.findOnPath(s,((e,t)=>Lr(t)));if(n&&!r){const t=e.syncPointTree_.subtree(s);if(!t.isEmpty()){const n=function(e){return e.fold(((e,t,n)=>{if(t&&Lr(t)){return[qr(t)]}{let e=[];return t&&(e=Or(t)),Ot(n,((t,n)=>{e=e.concat(n)})),e}}))}(t);for(let t=0;t<n.length;++t){const i=n[t],r=i.query,s=Zr(e,i);e.listenProvider_.startListening(ss(r),es(e,r),s.hashFn,s.onComplete)}}}if(!r&&l.length>0&&!i)if(n){const n=null;e.listenProvider_.stopListening(ss(t),n)}else l.forEach((t=>{const n=e.queryToTagMap.get(ts(t));e.listenProvider_.stopListening(ss(t),n)}))}!function(e,t){for(let n=0;n<t.length;++n){const i=t[n];if(!i._queryParams.loadsAllData()){const t=ts(i),n=e.queryToTagMap.get(t);e.queryToTagMap.delete(t),e.tagToQueryMap.delete(n)}}}(e,l)}return a}function $r(e,t,n,i){const r=ns(e,i);if(null!=r){const i=is(r),s=i.path,o=i.queryId,a=wn(s,t);return rs(e,s,new Ni(Ii(o),a,n))}return[]}function Yr(e,t,n,r=!1){const s=t._path;let o=null,a=!1;e.syncPointTree_.foreachOnPath(s,((e,t)=>{const n=wn(e,s);o=o||Ar(t,n),a=a||Lr(t)}));let c,l=e.syncPointTree_.get(s);if(l?(a=a||Lr(l),o=o||Ar(l,un())):(l=new kr,e.syncPointTree_=e.syncPointTree_.set(s,l)),null!=o)c=!0;else{c=!1,o=ti.EMPTY_NODE;e.syncPointTree_.subtree(s).foreachChild(((e,t)=>{const n=Ar(t,un());n&&(o=o.updateImmediateChild(e,n))}))}const h=Fr(l,t);if(!h&&!t._queryParams.loadsAllData()){const n=ts(t);i(!e.queryToTagMap.has(n),"View does not exist, but we have a tag");const r=jr++;e.queryToTagMap.set(n,r),e.tagToQueryMap.set(r,n)}let u=Dr(l,t,n,Qi(e.pendingWriteTree_,s),o,c);if(!h&&!a&&!r){const n=Mr(l,t);u=u.concat(function(e,t,n){const r=t._path,s=es(e,t),o=Zr(e,n),a=e.listenProvider_.startListening(ss(t),s,o.hashFn,o.onComplete),c=e.syncPointTree_.subtree(r);if(s)i(!Lr(c.value),"If we're adding a query, it shouldn't be shadowed");else{const t=c.fold(((e,t,n)=>{if(!vn(e)&&t&&Lr(t))return[qr(t).query];{let e=[];return t&&(e=e.concat(Or(t).map((e=>e.query)))),Ot(n,((t,n)=>{e=e.concat(n)})),e}}));for(let n=0;n<t.length;++n){const i=t[n];e.listenProvider_.stopListening(ss(i),es(e,i))}}return a}(e,t,n))}return u}function Kr(e,t,n){const i=e.pendingWriteTree_,r=e.syncPointTree_.findOnPath(t,((e,n)=>{const i=Ar(n,wn(e,t));if(i)return i}));return tr(i,t,r,n,!0)}function Gr(e,t){const n=t._path;let i=null;e.syncPointTree_.foreachOnPath(n,((e,t)=>{const r=wn(e,n);i=i||Ar(t,r)}));let r=e.syncPointTree_.get(n);r?i=i||Ar(r,un()):(r=new kr,e.syncPointTree_=e.syncPointTree_.set(n,r));const s=null!=i,o=s?new Pi(i,!0,!1):null;return function(e){return Mi(e.viewCache_)}(Rr(r,t,Qi(e.pendingWriteTree_,t._path),s?o.getNode():ti.EMPTY_NODE,s))}function Qr(e,t){return Jr(t,e.syncPointTree_,null,Qi(e.pendingWriteTree_,un()))}function Jr(e,t,n,i){if(vn(e.path))return Xr(e,t,n,i);{const r=t.get(un());null==n&&null!=r&&(n=Ar(r,un()));let s=[];const o=dn(e.path),a=e.operationForChild(o),c=t.children.get(o);if(c&&a){const e=n?n.getImmediateChild(o):null,t=cr(i,o);s=s.concat(Jr(a,c,e,t))}return r&&(s=s.concat(Pr(r,e,i,n))),s}}function Xr(e,t,n,i){const r=t.get(un());null==n&&null!=r&&(n=Ar(r,un()));let s=[];return t.children.inorderTraversal(((t,r)=>{const o=n?n.getImmediateChild(t):null,a=cr(i,t),c=e.operationForChild(t);c&&(s=s.concat(Xr(c,r,o,a)))})),r&&(s=s.concat(Pr(r,e,i,n))),s}function Zr(e,t){const n=t.query,i=es(e,n);return{hashFn:()=>{const e=function(e){return e.viewCache_.serverCache.getNode()}(t)||ti.EMPTY_NODE;return e.hash()},onComplete:t=>{if("ok"===t)return i?function(e,t,n){const i=ns(e,n);if(i){const n=is(i),r=n.path,s=n.queryId,o=wn(r,t);return rs(e,r,new Si(Ii(s),o))}return[]}(e,n._path,i):function(e,t){return Qr(e,new Si({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t))}(e,n._path);{const i=function(e,t){let n="Unknown Error";"too_big"===e?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===e?n="Client doesn't have permission to access the desired data.":"unavailable"===e&&(n="The service is unavailable");const i=new Error(e+" at "+t._path.toString()+": "+n);return i.code=e.toUpperCase(),i}(t,n);return Vr(e,n,null,i)}}}}function es(e,t){const n=ts(t);return e.queryToTagMap.get(n)}function ts(e){return e._path.toString()+"$"+e._queryIdentifier}function ns(e,t){return e.tagToQueryMap.get(t)}function is(e){const t=e.indexOf("$");return i(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new hn(e.substr(0,t))}}function rs(e,t,n){const r=e.syncPointTree_.get(t);i(r,"Missing sync point for query tag that we're tracking");return Pr(r,n,Qi(e.pendingWriteTree_,t),null)}function ss(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?new(i(Nr,"Reference.ts has not been loaded"),Nr)(e._repo,e._path):e}class os{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new os(t)}node(){return this.node_}}class as{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=yn(this.path_,e);return new as(this.syncTree_,t)}node(){return Kr(this.syncTree_,this.path_)}}const cs=function(e,t,n){return e&&"object"==typeof e?(i(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"]?ls(e[".sv"],t,n):"object"==typeof e[".sv"]?hs(e[".sv"],t):void i(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e},ls=function(e,t,n){if("timestamp"===e)return n.timestamp;i(!1,"Unexpected server value: "+e)},hs=function(e,t,n){e.hasOwnProperty("increment")||i(!1,"Unexpected server value: "+JSON.stringify(e,null,2));const r=e.increment;"number"!=typeof r&&i(!1,"Unexpected increment value: "+r);const s=t.node();if(i(null!=s,"Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return r;const o=s.getValue();return"number"!=typeof o?r:o+r},us=function(e,t,n,i){return ps(t,new as(n,e),i)},ds=function(e,t,n){return ps(e,new os(t),n)};function ps(e,t,n){const i=e.getPriority().val(),r=cs(i,t.getImmediateChild(".priority"),n);let s;if(e.isLeafNode()){const i=e,s=cs(i.getValue(),t,n);return s!==i.getValue()||r!==i.getPriority().val()?new $n(s,ii(r)):e}{const i=e;return s=i,r!==i.getPriority().val()&&(s=s.updatePriority(new $n(r))),i.forEachChild(Yn,((e,i)=>{const r=ps(i,t.getImmediateChild(e),n);r!==i&&(s=s.updateImmediateChild(e,r))})),s}}class _s{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}}function fs(e,t){let n=t instanceof hn?t:new hn(t),i=e,r=dn(n);for(;null!==r;){const e=N(i.node.children,r)||{children:{},childCount:0};i=new _s(r,i,e),n=_n(n),r=dn(n)}return i}function gs(e){return e.node.value}function ms(e,t){e.node.value=t,Cs(e)}function ys(e){return e.node.childCount>0}function vs(e,t){Ot(e.node.children,((n,i)=>{t(new _s(n,e,i))}))}function ws(e,t,n,i){n&&!i&&t(e),vs(e,(e=>{ws(e,t,!0,i)})),n&&i&&t(e)}function bs(e){return new hn(null===e.parent?e.name:bs(e.parent)+"/"+e.name)}function Cs(e){null!==e.parent&&function(e,t,n){const i=function(e){return void 0===gs(e)&&!ys(e)}(n),r=S(e.node.children,t);i&&r?(delete e.node.children[t],e.node.childCount--,Cs(e)):i||r||(e.node.children[t]=n.node,e.node.childCount++,Cs(e))}(e.parent,e.name,e)}const Es=/[\[\].#$\/\u0000-\u001F\u007F]/,Is=/[\[\].#$\u0000-\u001F\u007F]/,Ts=10485760,Ss=function(e){return"string"==typeof e&&0!==e.length&&!Es.test(e)},Ns=function(e){return"string"==typeof e&&0!==e.length&&!Is.test(e)},ks=function(e,t,n){const i=n instanceof hn?new In(n,e):n;if(void 0===t)throw new Error(e+"contains undefined "+Sn(i));if("function"==typeof t)throw new Error(e+"contains a function "+Sn(i)+" with contents = "+t.toString());if(Tt(t))throw new Error(e+"contains "+t.toString()+" "+Sn(i));if("string"==typeof t&&t.length>Ts/3&&A(t)>Ts)throw new Error(e+"contains a string greater than "+Ts+" utf8 bytes "+Sn(i)+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){let n=!1,r=!1;if(Ot(t,((t,s)=>{if(".value"===t)n=!0;else if(".priority"!==t&&".sv"!==t&&(r=!0,!Ss(t)))throw new Error(e+" contains an invalid key ("+t+") "+Sn(i)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');!function(e,t){e.parts_.length>0&&(e.byteLength_+=1),e.parts_.push(t),e.byteLength_+=A(t),Tn(e)}(i,t),ks(e,s,i),function(e){const t=e.parts_.pop();e.byteLength_-=A(t),e.parts_.length>0&&(e.byteLength_-=1)}(i)})),n&&r)throw new Error(e+' contains ".value" child '+Sn(i)+" in addition to actual children.")}},Ps=function(e,t,n,i){const r=O(e,"values");if(!t||"object"!=typeof t||Array.isArray(t))throw new Error(r+" must be an object containing the children to replace.");const s=[];Ot(t,((e,t)=>{const i=new hn(e);if(ks(r,t,yn(n,i)),".priority"===fn(i)&&!(null===(o=t)||"string"==typeof o||"number"==typeof o&&!Tt(o)||o&&"object"==typeof o&&S(o,".sv")))throw new Error(r+"contains an invalid value for '"+i.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");var o;s.push(i)})),function(e,t){let n,i;for(n=0;n<t.length;n++){i=t[n];const r=gn(i);for(let t=0;t<r.length;t++)if(".priority"===r[t]&&t===r.length-1);else if(!Ss(r[t]))throw new Error(e+"contains an invalid key ("+r[t]+") in path "+i.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}t.sort(bn);let r=null;for(n=0;n<t.length;n++){if(i=t[n],null!==r&&En(r,i))throw new Error(e+"contains a path "+r.toString()+" that is ancestor of another path "+i.toString());r=i}}(r,s)},Rs=function(e,t,n,i){if(!Ns(n))throw new Error(O(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},Ds=function(e,t){const n=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!Ss(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==n.length&&!function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),Ns(e)}(n))throw new Error(O(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class xs{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Os(e,t){let n=null;for(let i=0;i<t.length;i++){const r=t[i],s=r.getPath();null===n||Cn(s,n.path)||(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:s}),n.events.push(r)}n&&e.eventLists_.push(n)}function As(e,t,n){Os(e,n),function(e,t){e.recursionDepth_++;let n=!0;for(let i=0;i<e.eventLists_.length;i++){const r=e.eventLists_[i];if(r){t(r.path)?(Ms(e.eventLists_[i]),e.eventLists_[i]=null):n=!1}}n&&(e.eventLists_=[]);e.recursionDepth_--}(e,(e=>En(e,t)||En(t,e)))}function Ms(e){for(let t=0;t<e.events.length;t++){const n=e.events[t];if(null!==n){e.events[t]=null;const i=n.getEventRunner();yt&&wt("event: "+n.toString()),Lt(i)}}}class Fs{constructor(e,t,n,i){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new xs,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=yi(),this.transactionQueueTree_=new _s,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function Ls(e,t,n){if(e.stats_=Jt(e.repoInfo_),e.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)e.server_=new gi(e.repoInfo_,((t,n,i,r)=>{Us(e,t,n,i,r)}),e.authTokenProvider_,e.appCheckProvider_),setTimeout((()=>Ws(e,!0)),0);else{if(null!=n){if("object"!=typeof n)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{I(n)}catch(e){throw new Error("Invalid authOverride provided: "+e)}}e.persistentConnection_=new Pn(e.repoInfo_,t,((t,n,i,r)=>{Us(e,t,n,i,r)}),(t=>{Ws(e,t)}),(t=>{!function(e,t){Ot(t,((t,n)=>{Bs(e,t,n)}))}(e,t)}),e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener((t=>{e.server_.refreshAuthToken(t)})),e.appCheckProvider_.addTokenChangeListener((t=>{e.server_.refreshAppCheckToken(t.token)})),e.statsReporter_=function(e,t){const n=e.toString();return Qt[n]||(Qt[n]=t()),Qt[n]}(e.repoInfo_,(()=>new Ci(e.stats_,e.server_))),e.infoData_=new mi,e.infoSyncTree_=new Ur({startListening:(t,n,i,r)=>{let s=[];const o=e.infoData_.getNode(t._path);return o.isEmpty()||(s=Hr(e.infoSyncTree_,t._path,o),setTimeout((()=>{r("ok")}),0)),s},stopListening:()=>{}}),Bs(e,"connected",!1),e.serverSyncTree_=new Ur({startListening:(t,n,i,r)=>(e.server_.listen(t,i,n,((n,i)=>{const s=r(n,i);As(e.eventQueue_,t._path,s)})),[]),stopListening:(t,n)=>{e.server_.unlisten(t,n)}})}function qs(e){const t=e.infoData_.getNode(new hn(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t}function js(e){return(t=(t={timestamp:qs(e)})||{}).timestamp=t.timestamp||(new Date).getTime(),t;var t}function Us(e,t,n,i,r){e.dataUpdateCount++;const s=new hn(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;let o=[];if(r)if(i){const t=P(n,(e=>ii(e)));o=function(e,t,n,i){const r=ns(e,i);if(r){const i=is(r),s=i.path,o=i.queryId,a=wn(s,t),c=qi.fromObject(n);return rs(e,s,new ki(Ii(o),a,c))}return[]}(e.serverSyncTree_,s,t,r)}else{const t=ii(n);o=$r(e.serverSyncTree_,s,t,r)}else if(i){const t=P(n,(e=>ii(e)));o=function(e,t,n){const i=qi.fromObject(n);return Qr(e,new ki({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,i))}(e.serverSyncTree_,s,t)}else{const t=ii(n);o=Hr(e.serverSyncTree_,s,t)}let a=s;o.length>0&&(a=Ks(e,s)),As(e.eventQueue_,a,o)}function Ws(e,t){Bs(e,"connected",t),!1===t&&function(e){Hs(e,"onDisconnectEvents");const t=js(e),n=yi();wi(e.onDisconnect_,un(),((i,r)=>{const s=us(i,r,e.serverSyncTree_,t);vi(n,i,s)}));let i=[];wi(n,un(),((t,n)=>{i=i.concat(Hr(e.serverSyncTree_,t,n));const r=Zs(e,t);Ks(e,r)})),e.onDisconnect_=yi(),As(e.eventQueue_,un(),i)}(e)}function Bs(e,t,n){const i=new hn("/.info/"+t),r=ii(n);e.infoData_.updateSnapshot(i,r);const s=Hr(e.infoSyncTree_,i,r);As(e.eventQueue_,i,s)}function zs(e){return e.nextWriteId_++}function Hs(e,...t){let n="";e.persistentConnection_&&(n=e.persistentConnection_.id+":"),wt(n,...t)}function Vs(e,t,n,i){t&&Lt((()=>{if("ok"===n)t(null);else{const e=(n||"error").toUpperCase();let r=e;i&&(r+=": "+i);const s=new Error(r);s.code=e,t(s)}}))}function $s(e,t,n){return Kr(e.serverSyncTree_,t,n)||ti.EMPTY_NODE}function Ys(e,t=e.transactionQueueTree_){if(t||Xs(e,t),gs(t)){const n=Qs(e,t);i(n.length>0,"Sending zero length transaction queue");n.every((e=>0===e.status))&&function(e,t,n){const r=n.map((e=>e.currentWriteId)),s=$s(e,t,r);let o=s;const a=s.hash();for(let e=0;e<n.length;e++){const r=n[e];i(0===r.status,"tryToSendTransactionQueue_: items in queue should all be run."),r.status=1,r.retryCount++;const s=wn(t,r.path);o=o.updateChild(s,r.currentOutputSnapshotRaw)}const c=o.val(!0),l=t;e.server_.put(l.toString(),c,(i=>{Hs(e,"transaction put response",{path:l.toString(),status:i});let r=[];if("ok"===i){const i=[];for(let t=0;t<n.length;t++)n[t].status=2,r=r.concat(zr(e.serverSyncTree_,n[t].currentWriteId)),n[t].onComplete&&i.push((()=>n[t].onComplete(null,!0,n[t].currentOutputSnapshotResolved))),n[t].unwatcher();Xs(e,fs(e.transactionQueueTree_,t)),Ys(e,e.transactionQueueTree_),As(e.eventQueue_,t,r);for(let e=0;e<i.length;e++)Lt(i[e])}else{if("datastale"===i)for(let e=0;e<n.length;e++)3===n[e].status?n[e].status=4:n[e].status=0;else{It("transaction at "+l.toString()+" failed: "+i);for(let e=0;e<n.length;e++)n[e].status=4,n[e].abortReason=i}Ks(e,t)}}),a)}(e,bs(t),n)}else ys(t)&&vs(t,(t=>{Ys(e,t)}))}function Ks(e,t){const n=Gs(e,t),r=bs(n);return function(e,t,n){if(0===t.length)return;const r=[];let s=[];const o=t.filter((e=>0===e.status)),a=o.map((e=>e.currentWriteId));for(let o=0;o<t.length;o++){const l=t[o],h=wn(n,l.path);let u,d=!1;if(i(null!==h,"rerunTransactionsUnderNode_: relativePath should not be null."),4===l.status)d=!0,u=l.abortReason,s=s.concat(zr(e.serverSyncTree_,l.currentWriteId,!0));else if(0===l.status)if(l.retryCount>=25)d=!0,u="maxretry",s=s.concat(zr(e.serverSyncTree_,l.currentWriteId,!0));else{const n=$s(e,l.path,a);l.currentInputSnapshot=n;const i=t[o].update(n.val());if(void 0!==i){ks("transaction failed: Data returned ",i,l.path);let t=ii(i);"object"==typeof i&&null!=i&&S(i,".priority")||(t=t.updatePriority(n.getPriority()));const r=l.currentWriteId,o=js(e),c=ds(t,n,o);l.currentOutputSnapshotRaw=t,l.currentOutputSnapshotResolved=c,l.currentWriteId=zs(e),a.splice(a.indexOf(r),1),s=s.concat(Wr(e.serverSyncTree_,l.path,c,l.currentWriteId,l.applyLocally)),s=s.concat(zr(e.serverSyncTree_,r,!0))}else d=!0,u="nodata",s=s.concat(zr(e.serverSyncTree_,l.currentWriteId,!0))}As(e.eventQueue_,n,s),s=[],d&&(t[o].status=2,c=t[o].unwatcher,setTimeout(c,Math.floor(0)),t[o].onComplete&&("nodata"===u?r.push((()=>t[o].onComplete(null,!1,t[o].currentInputSnapshot))):r.push((()=>t[o].onComplete(new Error(u),!1,null)))))}var c;Xs(e,e.transactionQueueTree_);for(let e=0;e<r.length;e++)Lt(r[e]);Ys(e,e.transactionQueueTree_)}(e,Qs(e,n),r),r}function Gs(e,t){let n,i=e.transactionQueueTree_;for(n=dn(t);null!==n&&void 0===gs(i);)i=fs(i,n),n=dn(t=_n(t));return i}function Qs(e,t){const n=[];return Js(e,t,n),n.sort(((e,t)=>e.order-t.order)),n}function Js(e,t,n){const i=gs(t);if(i)for(let e=0;e<i.length;e++)n.push(i[e]);vs(t,(t=>{Js(e,t,n)}))}function Xs(e,t){const n=gs(t);if(n){let e=0;for(let t=0;t<n.length;t++)2!==n[t].status&&(n[e]=n[t],e++);n.length=e,ms(t,n.length>0?n:void 0)}vs(t,(t=>{Xs(e,t)}))}function Zs(e,t){const n=bs(Gs(e,t)),i=fs(e.transactionQueueTree_,t);return function(e,t){let n=e.parent;for(;null!==n;){if(t(n))return!0;n=n.parent}}(i,(t=>{eo(e,t)})),eo(e,i),ws(i,(t=>{eo(e,t)})),n}function eo(e,t){const n=gs(t);if(n){const r=[];let s=[],o=-1;for(let t=0;t<n.length;t++)3===n[t].status||(1===n[t].status?(i(o===t-1,"All SENT items should be at beginning of queue."),o=t,n[t].status=3,n[t].abortReason="set"):(i(0===n[t].status,"Unexpected transaction status in abort"),n[t].unwatcher(),s=s.concat(zr(e.serverSyncTree_,n[t].currentWriteId,!0)),n[t].onComplete&&r.push(n[t].onComplete.bind(null,new Error("set"),!1,null))));-1===o?ms(t,void 0):n.length=o+1,As(e.eventQueue_,bs(t),s);for(let e=0;e<r.length;e++)Lt(r[e])}}const to=function(e,t){const n=no(e),i=n.namespace;"firebase.com"===n.domain&&Et(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),i&&"undefined"!==i||"localhost"===n.domain||Et("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&It("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");const r="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new $t(n.host,n.secure,i,r,t,"",i!==n.subdomain),path:new hn(n.pathString)}},no=function(e){let t="",n="",i="",r="",s="",o=!0,a="https",c=443;if("string"==typeof e){let l=e.indexOf("//");l>=0&&(a=e.substring(0,l-1),e=e.substring(l+2));let h=e.indexOf("/");-1===h&&(h=e.length);let u=e.indexOf("?");-1===u&&(u=e.length),t=e.substring(0,Math.min(h,u)),h<u&&(r=function(e){let t="";const n=e.split("/");for(let e=0;e<n.length;e++)if(n[e].length>0){let i=n[e];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(e){}t+="/"+i}return t}(e.substring(h,u)));const d=function(e){const t={};"?"===e.charAt(0)&&(e=e.substring(1));for(const n of e.split("&")){if(0===n.length)continue;const i=n.split("=");2===i.length?t[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):It(`Invalid query segment '${n}' in query '${e}'`)}return t}(e.substring(Math.min(e.length,u)));l=t.indexOf(":"),l>=0?(o="https"===a||"wss"===a,c=parseInt(t.substring(l+1),10)):l=t.length;const p=t.slice(0,l);if("localhost"===p.toLowerCase())n="localhost";else if(p.split(".").length<=2)n=p;else{const e=t.indexOf(".");i=t.substring(0,e).toLowerCase(),n=t.substring(e+1),s=i}"ns"in d&&(s=d.ns)}return{host:t,port:c,domain:n,subdomain:i,secure:o,scheme:a,pathString:r,namespace:s}},io="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",ro=function(){let e=0;const t=[];return function(n){const r=n===e;let s;e=n;const o=new Array(8);for(s=7;s>=0;s--)o[s]=io.charAt(n%64),n=Math.floor(n/64);i(0===n,"Cannot push at time == 0");let a=o.join("");if(r){for(s=11;s>=0&&63===t[s];s--)t[s]=0;t[s]++}else for(s=0;s<12;s++)t[s]=Math.floor(64*Math.random());for(s=0;s<12;s++)a+=io.charAt(t[s]);return i(20===a.length,"nextPushId: Length should be 20."),a}}();class so{constructor(e,t,n,i){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=i}getPath(){const e=this.snapshot.ref;return"value"===this.eventType?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+I(this.snapshot.exportVal())}}class oo{constructor(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class ao{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return i(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class co{constructor(e,t,n,i){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=i}get key(){return vn(this._path)?null:fn(this._path)}get ref(){return new lo(this._repo,this._path)}get _queryIdentifier(){const e=fi(this._queryParams),t=Dt(e);return"{}"===t?"default":t}get _queryObject(){return fi(this._queryParams)}isEqual(e){if(!((e=M(e))instanceof co))return!1;const t=this._repo===e._repo,n=Cn(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return t&&n&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(e){let t="";for(let n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}(this._path)}}class lo extends co{constructor(e,t){super(e,t,new pi,!1)}get parent(){const e=mn(this._path);return null===e?null:new lo(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class ho{constructor(e,t,n){this._node=e,this.ref=t,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new hn(e),n=po(this.ref,e);return new ho(this._node.getChild(t),n,Yn)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){if(this._node.isLeafNode())return!1;return!!this._node.forEachChild(this._index,((t,n)=>e(new ho(n,po(this.ref,t),Yn))))}hasChild(e){const t=new hn(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function uo(e,t){return(e=M(e))._checkNotDeleted("ref"),void 0!==t?po(e._root,t):e._root}function po(e,t){var n,i,r;return null===dn((e=M(e))._path)?(n="child",i="path",(r=t)&&(r=r.replace(/^\/*\.info(\/|$)/,"/")),Rs(n,i,r)):Rs("child","path",t),new lo(e._repo,yn(e._path,t))}function _o(e,t){(function(e,t){if(".info"===dn(t))throw new Error(e+" failed = Can't modify data under /.info/")})("push",(e=M(e))._path),e._path;const n=qs(e._repo),i=ro(n),r=po(e,i),s=po(e,i);let o;return o=Promise.resolve(s),r.then=o.then.bind(o),r.catch=o.then.bind(o,void 0),r}function fo(e,t){Ps("update",t,e._path);const n=new m;return function(e,t,n,i){Hs(e,"update",{path:t.toString(),value:n});let r=!0;const s=js(e),o={};if(Ot(n,((n,i)=>{r=!1,o[n]=us(yn(t,n),ii(i),e.serverSyncTree_,s)})),r)wt("update() called with empty data.  Don't do anything."),Vs(0,i,"ok",void 0);else{const r=zs(e),s=Br(e.serverSyncTree_,t,o,r);Os(e.eventQueue_,s),e.server_.merge(t.toString(),n,((n,s)=>{const o="ok"===n;o||It("update at "+t+" failed: "+n);const a=zr(e.serverSyncTree_,r,!o),c=a.length>0?Ks(e,t):t;As(e.eventQueue_,c,a),Vs(0,i,n,s)})),Ot(n,(n=>{const i=Zs(e,yn(t,n));Ks(e,i)})),As(e.eventQueue_,t,[])}}(e._repo,e._path,t,n.wrapCallback((()=>{}))),n.promise}function go(e){e=M(e);const t=new ao((()=>{})),n=new mo(t);return function(e,t,n){const i=Gr(e.serverSyncTree_,t);return null!=i?Promise.resolve(i):e.server_.get(t).then((i=>{const r=ii(i).withIndex(t._queryParams.getIndex());let s;if(Yr(e.serverSyncTree_,t,n,!0),t._queryParams.loadsAllData())s=Hr(e.serverSyncTree_,t._path,r);else{const n=es(e.serverSyncTree_,t);s=$r(e.serverSyncTree_,t._path,r,n)}return As(e.eventQueue_,t._path,s),Vr(e.serverSyncTree_,t,n,null,!0),r}),(n=>(Hs(e,"get for query "+I(t)+" failed: "+n),Promise.reject(new Error(n)))))}(e._repo,e,n).then((t=>new ho(t,new lo(e._repo,e._path),e._queryParams.getIndex())))}class mo{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){const n=t._queryParams.getIndex();return new so("value",this,new ho(e.snapshotNode,new lo(t._repo,t._path),n))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new oo(this,e,t):null}matches(e){return e instanceof mo&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}!function(e){i(!Sr,"__referenceConstructor has already been defined"),Sr=e}(lo),function(e){i(!Nr,"__referenceConstructor has already been defined"),Nr=e}(lo);const yo={};let vo=!1;function wo(e,t,n,i,r){let s=i||e.options.databaseURL;void 0===s&&(e.options.projectId||Et("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),wt("Using default host for project ",e.options.projectId),s=`${e.options.projectId}-default-rtdb.firebaseio.com`);let o,a=to(s,r),c=a.repoInfo;"undefined"!=typeof process&&process.env&&(o=process.env.FIREBASE_DATABASE_EMULATOR_HOST),o?(s=`http://${o}?ns=${c.namespace}`,a=to(s,r),c=a.repoInfo):a.repoInfo.secure;const l=new Ut(e.name,e.options,t);Ds("Invalid Firebase Database URL",a),vn(a.path)||Et("Database URL must point to the root of a Firebase Database (not including a child path).");const h=function(e,t,n,i){let r=yo[t.name];r||(r={},yo[t.name]=r);let s=r[e.toURLString()];s&&Et("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call.");return s=new Fs(e,vo,n,i),r[e.toURLString()]=s,s}(c,e,l,new jt(e.name,n));return new bo(h,e)}class bo{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(Ls(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new lo(this._repo,un())),this._rootInternal}_delete(){return null!==this._rootInternal&&(!function(e,t){const n=yo[t];n&&n[e.key]===e||Et(`Database ${t}(${e.repoInfo_}) has already been deleted.`),function(e){e.persistentConnection_&&e.persistentConnection_.interrupt("repo_interrupt")}(e),delete n[e.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&Et("Cannot call "+e+" on a deleted database.")}}function Co(e){return`Minified Redux error #${e}; visit https://redux.js.org/Errors?code=${e} for the full message or use the non-minified dev environment for full errors. `}Pn.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},Pn.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)},function(e){!function(e){ct=e}("11.0.1"),He(new F("database",((e,{instanceIdentifier:t})=>wo(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t)),"PUBLIC").setMultipleInstances(!0)),Ge(ot,at,e),Ge(ot,at,"esm2017")}();var Eo=(()=>"function"==typeof Symbol&&Symbol.observable||"@@observable")(),Io=()=>Math.random().toString(36).substring(7).split("").join("."),To={INIT:`@@redux/INIT${Io()}`,REPLACE:`@@redux/REPLACE${Io()}`,PROBE_UNKNOWN_ACTION:()=>`@@redux/PROBE_UNKNOWN_ACTION${Io()}`};function So(e){if(void 0===e)return"undefined";if(null===e)return"null";const t=typeof e;switch(t){case"boolean":case"string":case"number":case"symbol":case"function":return t}if(Array.isArray(e))return"array";if(function(e){return e instanceof Date||"function"==typeof e.toDateString&&"function"==typeof e.getDate&&"function"==typeof e.setDate}(e))return"date";if(function(e){return e instanceof Error||"string"==typeof e.message&&e.constructor&&"number"==typeof e.constructor.stackTraceLimit}(e))return"error";const n=function(e){return"function"==typeof e.constructor?e.constructor.name:null}(e);switch(n){case"Symbol":case"Promise":case"WeakMap":case"WeakSet":case"Map":case"Set":return n}return Object.prototype.toString.call(e).slice(8,-1).toLowerCase().replace(/\s/g,"")}function No(e){let t=typeof e;return"production"!==process.env.NODE_ENV&&(t=So(e)),t}var ko=Symbol.for("immer-nothing"),Po=Symbol.for("immer-draftable"),Ro=Symbol.for("immer-state"),Do="production"!==process.env.NODE_ENV?[function(e){return`The plugin for '${e}' has not been loaded into Immer. To enable the plugin, import and call \`enable${e}()\` when initializing your application.`},function(e){return`produce can only be called on things that are draftable: plain objects, arrays, Map, Set or classes that are marked with '[immerable]: true'. Got '${e}'`},"This object has been frozen and should not be mutated",function(e){return"Cannot use a proxy that has been revoked. Did you pass an object from inside an immer function to an async process? "+e},"An immer producer returned a new value *and* modified its draft. Either return a new value *or* modify the draft.","Immer forbids circular references","The first or second argument to `produce` must be a function","The third argument to `produce` must be a function or undefined","First argument to `createDraft` must be a plain object, an array, or an immerable object","First argument to `finishDraft` must be a draft returned by `createDraft`",function(e){return`'current' expects a draft, got: ${e}`},"Object.defineProperty() cannot be used on an Immer draft","Object.setPrototypeOf() cannot be used on an Immer draft","Immer only supports deleting array indices","Immer only supports setting array indices and the 'length' property",function(e){return`'original' expects a draft, got: ${e}`}]:[];function xo(e,...t){if("production"!==process.env.NODE_ENV){const n=Do[e],i="function"==typeof n?n.apply(null,t):n;throw new Error(`[Immer] ${i}`)}throw new Error(`[Immer] minified error nr: ${e}. Full error at: https://bit.ly/3cXEKWf`)}var Oo=Object.getPrototypeOf;function Ao(e){return!!e&&!!e[Ro]}function Mo(e){return!!e&&(Lo(e)||Array.isArray(e)||!!e[Po]||!!e.constructor?.[Po]||Bo(e)||zo(e))}var Fo=Object.prototype.constructor.toString();function Lo(e){if(!e||"object"!=typeof e)return!1;const t=Oo(e);if(null===t)return!0;const n=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;return n===Object||"function"==typeof n&&Function.toString.call(n)===Fo}function qo(e,t){0===jo(e)?Reflect.ownKeys(e).forEach((n=>{t(n,e[n],e)})):e.forEach(((n,i)=>t(i,n,e)))}function jo(e){const t=e[Ro];return t?t.type_:Array.isArray(e)?1:Bo(e)?2:zo(e)?3:0}function Uo(e,t){return 2===jo(e)?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function Wo(e,t,n){const i=jo(e);2===i?e.set(t,n):3===i?e.add(n):e[t]=n}function Bo(e){return e instanceof Map}function zo(e){return e instanceof Set}function Ho(e){return e.copy_||e.base_}function Vo(e,t){if(Bo(e))return new Map(e);if(zo(e))return new Set(e);if(Array.isArray(e))return Array.prototype.slice.call(e);const n=Lo(e);if(!0===t||"class_only"===t&&!n){const t=Object.getOwnPropertyDescriptors(e);delete t[Ro];let n=Reflect.ownKeys(t);for(let i=0;i<n.length;i++){const r=n[i],s=t[r];!1===s.writable&&(s.writable=!0,s.configurable=!0),(s.get||s.set)&&(t[r]={configurable:!0,writable:!0,enumerable:s.enumerable,value:e[r]})}return Object.create(Oo(e),t)}{const t=Oo(e);if(null!==t&&n)return{...e};const i=Object.create(t);return Object.assign(i,e)}}function $o(e,t=!1){return Ko(e)||Ao(e)||!Mo(e)||(jo(e)>1&&(e.set=e.add=e.clear=e.delete=Yo),Object.freeze(e),t&&Object.entries(e).forEach((([e,t])=>$o(t,!0)))),e}function Yo(){xo(2)}function Ko(e){return Object.isFrozen(e)}var Go,Qo={};function Jo(e){const t=Qo[e];return t||xo(0,e),t}function Xo(){return Go}function Zo(e,t){t&&(Jo("Patches"),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function ea(e){ta(e),e.drafts_.forEach(ia),e.drafts_=null}function ta(e){e===Go&&(Go=e.parent_)}function na(e){return Go={drafts_:[],parent_:Go,immer_:e,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function ia(e){const t=e[Ro];0===t.type_||1===t.type_?t.revoke_():t.revoked_=!0}function ra(e,t){t.unfinalizedDrafts_=t.drafts_.length;const n=t.drafts_[0];return void 0!==e&&e!==n?(n[Ro].modified_&&(ea(t),xo(4)),Mo(e)&&(e=sa(t,e),t.parent_||aa(t,e)),t.patches_&&Jo("Patches").generateReplacementPatches_(n[Ro].base_,e,t.patches_,t.inversePatches_)):e=sa(t,n,[]),ea(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==ko?e:void 0}function sa(e,t,n){if(Ko(t))return t;const i=t[Ro];if(!i)return qo(t,((r,s)=>oa(e,i,t,r,s,n))),t;if(i.scope_!==e)return t;if(!i.modified_)return aa(e,i.base_,!0),i.base_;if(!i.finalized_){i.finalized_=!0,i.scope_.unfinalizedDrafts_--;const t=i.copy_;let r=t,s=!1;3===i.type_&&(r=new Set(t),t.clear(),s=!0),qo(r,((r,o)=>oa(e,i,t,r,o,n,s))),aa(e,t,!1),n&&e.patches_&&Jo("Patches").generatePatches_(i,n,e.patches_,e.inversePatches_)}return i.copy_}function oa(e,t,n,i,r,s,o){if("production"!==process.env.NODE_ENV&&r===n&&xo(5),Ao(r)){const o=sa(e,r,s&&t&&3!==t.type_&&!Uo(t.assigned_,i)?s.concat(i):void 0);if(Wo(n,i,o),!Ao(o))return;e.canAutoFreeze_=!1}else o&&n.add(r);if(Mo(r)&&!Ko(r)){if(!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1)return;sa(e,r),t&&t.scope_.parent_||"symbol"==typeof i||!Object.prototype.propertyIsEnumerable.call(n,i)||aa(e,r)}}function aa(e,t,n=!1){!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&$o(t,n)}var ca={get(e,t){if(t===Ro)return e;const n=Ho(e);if(!Uo(n,t))return function(e,t,n){const i=ua(t,n);return i?"value"in i?i.value:i.get?.call(e.draft_):void 0}(e,n,t);const i=n[t];return e.finalized_||!Mo(i)?i:i===ha(e.base_,t)?(pa(e),e.copy_[t]=_a(i,e)):i},has:(e,t)=>t in Ho(e),ownKeys:e=>Reflect.ownKeys(Ho(e)),set(e,t,n){const i=ua(Ho(e),t);if(i?.set)return i.set.call(e.draft_,n),!0;if(!e.modified_){const i=ha(Ho(e),t),o=i?.[Ro];if(o&&o.base_===n)return e.copy_[t]=n,e.assigned_[t]=!1,!0;if(((r=n)===(s=i)?0!==r||1/r==1/s:r!=r&&s!=s)&&(void 0!==n||Uo(e.base_,t)))return!0;pa(e),da(e)}var r,s;return e.copy_[t]===n&&(void 0!==n||t in e.copy_)||Number.isNaN(n)&&Number.isNaN(e.copy_[t])||(e.copy_[t]=n,e.assigned_[t]=!0),!0},deleteProperty:(e,t)=>(void 0!==ha(e.base_,t)||t in e.base_?(e.assigned_[t]=!1,pa(e),da(e)):delete e.assigned_[t],e.copy_&&delete e.copy_[t],!0),getOwnPropertyDescriptor(e,t){const n=Ho(e),i=Reflect.getOwnPropertyDescriptor(n,t);return i?{writable:!0,configurable:1!==e.type_||"length"!==t,enumerable:i.enumerable,value:n[t]}:i},defineProperty(){xo(11)},getPrototypeOf:e=>Oo(e.base_),setPrototypeOf(){xo(12)}},la={};function ha(e,t){const n=e[Ro];return(n?Ho(n):e)[t]}function ua(e,t){if(!(t in e))return;let n=Oo(e);for(;n;){const e=Object.getOwnPropertyDescriptor(n,t);if(e)return e;n=Oo(n)}}function da(e){e.modified_||(e.modified_=!0,e.parent_&&da(e.parent_))}function pa(e){e.copy_||(e.copy_=Vo(e.base_,e.scope_.immer_.useStrictShallowCopy_))}qo(ca,((e,t)=>{la[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}})),la.deleteProperty=function(e,t){return"production"!==process.env.NODE_ENV&&isNaN(parseInt(t))&&xo(13),la.set.call(this,e,t,void 0)},la.set=function(e,t,n){return"production"!==process.env.NODE_ENV&&"length"!==t&&isNaN(parseInt(t))&&xo(14),ca.set.call(this,e[0],t,n,e[0])};function _a(e,t){const n=Bo(e)?Jo("MapSet").proxyMap_(e,t):zo(e)?Jo("MapSet").proxySet_(e,t):function(e,t){const n=Array.isArray(e),i={type_:n?1:0,scope_:t?t.scope_:Xo(),modified_:!1,finalized_:!1,assigned_:{},parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1};let r=i,s=ca;n&&(r=[i],s=la);const{revoke:o,proxy:a}=Proxy.revocable(r,s);return i.draft_=a,i.revoke_=o,a}(e,t);return(t?t.scope_:Xo()).drafts_.push(n),n}function fa(e){if(!Mo(e)||Ko(e))return e;const t=e[Ro];let n;if(t){if(!t.modified_)return t.base_;t.finalized_=!0,n=Vo(e,t.scope_.immer_.useStrictShallowCopy_)}else n=Vo(e,!0);return qo(n,((e,t)=>{Wo(n,e,fa(t))})),t&&(t.finalized_=!1),n}var ga=new class{constructor(e){this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.produce=(e,t,n)=>{if("function"==typeof e&&"function"!=typeof t){const n=t;t=e;const i=this;return function(e=n,...r){return i.produce(e,(e=>t.call(this,e,...r)))}}let i;if("function"!=typeof t&&xo(6),void 0!==n&&"function"!=typeof n&&xo(7),Mo(e)){const r=na(this),s=_a(e,void 0);let o=!0;try{i=t(s),o=!1}finally{o?ea(r):ta(r)}return Zo(r,n),ra(i,r)}if(!e||"object"!=typeof e){if(i=t(e),void 0===i&&(i=e),i===ko&&(i=void 0),this.autoFreeze_&&$o(i,!0),n){const t=[],r=[];Jo("Patches").generateReplacementPatches_(e,i,t,r),n(t,r)}return i}xo(1,e)},this.produceWithPatches=(e,t)=>{if("function"==typeof e)return(t,...n)=>this.produceWithPatches(t,(t=>e(t,...n)));let n,i;return[this.produce(e,t,((e,t)=>{n=e,i=t})),n,i]},"boolean"==typeof e?.autoFreeze&&this.setAutoFreeze(e.autoFreeze),"boolean"==typeof e?.useStrictShallowCopy&&this.setUseStrictShallowCopy(e.useStrictShallowCopy)}createDraft(e){Mo(e)||xo(8),Ao(e)&&(e=function(e){Ao(e)||xo(10,e);return fa(e)}(e));const t=na(this),n=_a(e,void 0);return n[Ro].isManual_=!0,ta(t),n}finishDraft(e,t){const n=e&&e[Ro];n&&n.isManual_||xo(9);const{scope_:i}=n;return Zo(i,t),ra(void 0,i)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}applyPatches(e,t){let n;for(n=t.length-1;n>=0;n--){const i=t[n];if(0===i.path.length&&"replace"===i.op){e=i.value;break}}n>-1&&(t=t.slice(n+1));const i=Jo("Patches").applyPatches_;return Ao(e)?i(e,t):this.produce(e,(e=>i(e,t)))}},ma=ga.produce;if(ga.produceWithPatches.bind(ga),ga.setAutoFreeze.bind(ga),ga.setUseStrictShallowCopy.bind(ga),ga.applyPatches.bind(ga),ga.createDraft.bind(ga),ga.finishDraft.bind(ga),console.log("basicfirebasecrudservices"),Ke().length>1&&async function(e){let t=!1;const n=e.name;Ue.has(n)?(t=!0,Ue.delete(n)):We.has(n)&&e.decRefCount()<=0&&(We.delete(n),t=!0);t&&(await Promise.all(e.container.getProviders().map((e=>e.delete()))),e.isDeleted=!0)}(Ke()[1]).then((function(){console.log("App deleted successfully")})).catch((function(e){console.log("Error deleting app:",e)})),Ke().length<1){let e={};try{e=document.body.dataset}catch(e){throw new Error("Unable to get params"+e)}Ye({apiKey:e.api,databaseURL:"https://"+e.base+".firebaseio.com",appId:e.app})}const ya=function(e=function(e=qe){const t=Ue.get(e);if(!t&&e===qe&&g())return Ye();if(!t)throw Ve.create("no-app",{appName:e});return t}(),t){const n=function(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}(e,"database").getImmediate({identifier:t});if(!n._instanceStarted){const e=f("database");e&&function(e,t,n,i={}){e=M(e),e._checkNotDeleted("useEmulator"),e._instanceStarted&&Et("Cannot call useEmulator() after instance has already been initialized.");const r=e._repoInternal;let s;if(r.repoInfo_.nodeAdmin)i.mockUserToken&&Et('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),s=new Wt(Wt.OWNER);else if(i.mockUserToken){const t="string"==typeof i.mockUserToken?i.mockUserToken:function(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",i=e.iat||0,r=e.sub||e.user_id;if(!r)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const s=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:i,exp:i+3600,auth_time:i,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}}},e);return[l(JSON.stringify({alg:"none",type:"JWT"})),l(JSON.stringify(s)),""].join(".")}(i.mockUserToken,e.app.options.projectId);s=new Wt(t)}!function(e,t,n,i){e.repoInfo_=new $t(`${t}:${n}`,!1,e.repoInfo_.namespace,e.repoInfo_.webSocketOnly,e.repoInfo_.nodeAdmin,e.repoInfo_.persistenceKey,e.repoInfo_.includeNamespaceInQueryParams,!0),i&&(e.authTokenProvider_=i)}(r,t,n,s)}(n,...e)}return n}();async function va({url:e="crafts/temp_gmail_com/posts/-Ml6DEjYhdnjuW6HiHB7",type:t="array"}){try{let n=await go(uo(ya,e));if(n.exists()){let e=n.val();return"array"===t?Object.keys(e).map((t=>e[t])):e}return"array"===t?[]:null}catch(e){return console.log(e),"array"===t?[]:{}}}async function wa(e={temp:"temp"}){try{return await fo(uo(ya),e),!0}catch(e){return console.error(e),e}}function ba(e,t){switch(t.type){case"SET_STORE_OBJECT":return{...e,[t.payload.key]:t.payload.value};case"SEED_ARRAY":return{...e,[t.payload.arrayName]:t.payload.arrayItems};case"PUSH_ITEM_TO_ARRAY":return{...e,[t.payload.arrayName]:[...e[t.payload.arrayName],t.payload.item]};case"DELETE_ITEM_FROM_ARRAY":return{...e,[t.payload.arrayName]:e[t.payload.arrayName].filter((e=>e.id!==t.payload.id))};case"PUSH_SOME_ITEMS_TO_ARRAY":return{...e,[t.payload.arrayName]:[...draft[t.payload.arrayName],...t.payload.newArrayItems]};case"UPDATE_ITEM_IN_ARRAY":{const n=e[t.payload.arrayName].findIndex((e=>e.id===t.payload.id));if(-1!==n){const i=[...e[t.payload.arrayName]];return i[n]=t.payload.item,{...e,[t.payload.arrayName]:i}}}default:return e}}const Ca=function e(t,n,i){if("function"!=typeof t)throw new Error("production"===process.env.NODE_ENV?Co(2):`Expected the root reducer to be a function. Instead, received: '${No(t)}'`);if("function"==typeof n&&"function"==typeof i||"function"==typeof i&&"function"==typeof arguments[3])throw new Error("production"===process.env.NODE_ENV?Co(0):"It looks like you are passing several store enhancers to createStore(). This is not supported. Instead, compose them together to a single function. See https://redux.js.org/tutorials/fundamentals/part-4-store#creating-a-store-with-enhancers for an example.");if("function"==typeof n&&void 0===i&&(i=n,n=void 0),void 0!==i){if("function"!=typeof i)throw new Error("production"===process.env.NODE_ENV?Co(1):`Expected the enhancer to be a function. Instead, received: '${No(i)}'`);return i(e)(t,n)}let r=t,s=n,o=new Map,a=o,c=0,l=!1;function h(){a===o&&(a=new Map,o.forEach(((e,t)=>{a.set(t,e)})))}function u(){if(l)throw new Error("production"===process.env.NODE_ENV?Co(3):"You may not call store.getState() while the reducer is executing. The reducer has already received the state as an argument. Pass it down from the top reducer instead of reading it from the store.");return s}function d(e){if("function"!=typeof e)throw new Error("production"===process.env.NODE_ENV?Co(4):`Expected the listener to be a function. Instead, received: '${No(e)}'`);if(l)throw new Error("production"===process.env.NODE_ENV?Co(5):"You may not call store.subscribe() while the reducer is executing. If you would like to be notified after the store has been updated, subscribe from a component and invoke store.getState() in the callback to access the latest state. See https://redux.js.org/api/store#subscribelistener for more details.");let t=!0;h();const n=c++;return a.set(n,e),function(){if(t){if(l)throw new Error("production"===process.env.NODE_ENV?Co(6):"You may not unsubscribe from a store listener while the reducer is executing. See https://redux.js.org/api/store#subscribelistener for more details.");t=!1,h(),a.delete(n),o=null}}}function p(e){if(!function(e){if("object"!=typeof e||null===e)return!1;let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t||null===Object.getPrototypeOf(e)}(e))throw new Error("production"===process.env.NODE_ENV?Co(7):`Actions must be plain objects. Instead, the actual type was: '${No(e)}'. You may need to add middleware to your store setup to handle dispatching other values, such as 'redux-thunk' to handle dispatching functions. See https://redux.js.org/tutorials/fundamentals/part-4-store#middleware and https://redux.js.org/tutorials/fundamentals/part-6-async-logic#using-the-redux-thunk-middleware for examples.`);if(void 0===e.type)throw new Error("production"===process.env.NODE_ENV?Co(8):'Actions may not have an undefined "type" property. You may have misspelled an action type string constant.');if("string"!=typeof e.type)throw new Error("production"===process.env.NODE_ENV?Co(17):`Action "type" property must be a string. Instead, the actual type was: '${No(e.type)}'. Value was: '${e.type}' (stringified)`);if(l)throw new Error("production"===process.env.NODE_ENV?Co(9):"Reducers may not dispatch actions.");try{l=!0,s=r(s,e)}finally{l=!1}return(o=a).forEach((e=>{e()})),e}return p({type:To.INIT}),{dispatch:p,subscribe:d,getState:u,replaceReducer:function(e){if("function"!=typeof e)throw new Error("production"===process.env.NODE_ENV?Co(10):`Expected the nextReducer to be a function. Instead, received: '${No(e)}`);r=e,p({type:To.REPLACE})},[Eo]:function(){const e=d;return{subscribe(t){if("object"!=typeof t||null===t)throw new Error("production"===process.env.NODE_ENV?Co(11):`Expected the observer to be an object. Instead, received: '${No(t)}'`);function n(){const e=t;e.next&&e.next(u())}n();return{unsubscribe:e(n)}},[Eo](){return this}}}}}(ba,{isLoading:!0,isUpdating:!1,choices:[{id:0,text:"Philosopher’s Path",isRight:!0},{id:1,text:"Visit the temple",isRight:!1},{id:2,text:"Drink matcha",isRight:!1}],openquizes:[]},(window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||Redux.compose)(function(...e){return t=>(n,i)=>{const r=t(n,i);let s=()=>{throw new Error("production"===process.env.NODE_ENV?Co(15):"Dispatching while constructing your middleware is not allowed. Other middleware would not be applied to this dispatch.")};const o={getState:r.getState,dispatch:(e,...t)=>s(e,...t)},a=e.map((e=>e(o)));return s=function(...e){return 0===e.length?e=>e:1===e.length?e[0]:e.reduce(((e,t)=>(...n)=>e(t(...n))))}(...a)(r.dispatch),{...r,dispatch:s}}}((function(e){return function(t){return function(n){return"LOAD_FROM_FIREBASE"===n.type&&(e.dispatch({type:"SET_STORE_OBJECT",payload:{key:"isLoading",value:!0}}),va({url:n.payload.url,type:n.payload.datatype}).then((t=>{"array"===n.payload.datatype?e.dispatch({type:"SEED_ARRAY",payload:{arrayName:n.payload.destination,arrayItems:t}}):e.dispatch({type:"SET_STORE_OBJECT",payload:{key:n.payload.destination,value:t}}),e.dispatch({type:"SET_STORE_OBJECT",payload:{key:"isLoading",value:!1}})}))),"UPDATE_IN_FIREBASE"===n.type&&(e.dispatch({type:"SET_STORE_OBJECT",payload:{key:"isUpdating",value:!0}}),wa(n.payload.updates).then((t=>{e.dispatch({type:"SEED_ARRAY",payload:{arrayName:"openquizes",arrayItems:t}}),e.dispatch({type:"SET_STORE_OBJECT",payload:{key:"isUpdating",value:!1}})}))),"function"==typeof n?n(e.dispatch,e.getState):t(n)}}})))),Ea=ma(((e,t)=>{switch(t.type){case"SET_STORE_OBJECT":e[t.payload.key]=t.payload.value;break;case"SEED_ARRAY":e[t.payload.arrayName]=t.payload.arrayItems;break;case"PUSH_SOME_ITEMS_TO_ARRAY":console.log(e[t.payload.arrayName]),console.log(t.payload.newArrayItems),e[t.payload.arrayName]=[...e[t.payload.arrayName],...t.payload.newArrayItems];break;case"EMPTY_ARRAY":e[t.payload.arrayName]=[];break;case"PUSH_ITEM_TO_ARRAY":e[t.payload.arrayName].push(t.payload.item);break;case"DELETE_ITEM_FROM_ARRAY":e[t.payload.arrayName]=e[t.payload.arrayName].filter((e=>e.id!==t.payload.item.id));break;case"UPDATE_ITEM_IN_ARRAY_BY_ID":const n=e[t.payload.arrayName].findIndex((e=>e.id===t.payload.id));-1!==n&&(e[t.payload.arrayName][n]=t.payload)}}));return e.caseReducer=Ea,e.commonReducer=ba,e.getFirebaseNode=va,e.getFirebaseNodeKey=function(e){return _o(po(uo(ya),e+"/")).key},e.store=Ca,e.updateFirebaseNode=wa,e.useFirebaseNode=function(e="crafts/temp_gmail_com/posts/-Ml6DEjYhdnjuW6HiHB7",t){const[n,i]=!!React&&React.useState({loading:!1,data:void 0,error:void 0});function r(e,t){i({loading:!0}),va({url:e,type:t?.type&&t.type===object?"object":"array"}).then((e=>{i({loading:!1,data:e})})).catch((e=>{i({loading:!1,error:e})}))}return React&&React.useEffect((()=>{e&&r(e,t)}),[]),{...n,fetchNow:r}},e}({});
